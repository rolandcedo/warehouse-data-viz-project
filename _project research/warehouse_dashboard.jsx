import React, { useState, createContext, useContext } from 'react';
import { AreaChart, Area, XAxis, YAxis, ResponsiveContainer, ReferenceLine } from 'recharts';
import { Users, MapPin, ClipboardList, Calendar, DollarSign, ChevronRight, ChevronLeft, ChevronDown, Clock, Package, Truck, AlertTriangle, ArrowRight, ArrowUpRight, ArrowDownRight, Zap, Sun, Moon, Star, UserCheck, UserX, UserPlus, Wrench, CheckCircle, Info, AlertOctagon, LayoutDashboard, Radio, TrendingUp, TrendingDown, Search, Filter, X, RotateCcw, GripVertical, Grid3X3, BoxSelect, Lightbulb, Coffee, MoreVertical, MoreHorizontal, Eye, RefreshCw, MapPinIcon, Settings, Trash2, Navigation, Route, Activity, Minus, Fuel, Play, Circle, Plus } from 'lucide-react';

// ===== TIME CONTEXT =====
// Global state for contextual time across all components
const TimeContext = createContext();

const useTimeContext = () => {
  const context = useContext(TimeContext);
  if (!context) {
    throw new Error('useTimeContext must be used within TimeProvider');
  }
  return context;
};

// Convert time string "HH:MM" to decimal hours (e.g., "10:30" -> 10.5)
const timeToDecimal = (timeStr) => {
  const [h, m] = timeStr.split(':').map(Number);
  return h + m / 60;
};

// Convert decimal hours to time string
const decimalToTime = (decimal) => {
  const h = Math.floor(decimal);
  const m = Math.round((decimal - h) * 60);
  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
};

// Interpolate a value from timeline data at a given time
const interpolateValue = (timelineData, targetTime, valueKey = 'actual') => {
  if (!timelineData || timelineData.length === 0) return null;
  
  const targetDecimal = typeof targetTime === 'string' ? timeToDecimal(targetTime) : targetTime;
  
  // Find surrounding data points
  for (let i = 0; i < timelineData.length - 1; i++) {
    const curr = timelineData[i];
    const next = timelineData[i + 1];
    const currTime = timeToDecimal(curr.time);
    const nextTime = timeToDecimal(next.time);
    
    if (targetDecimal >= currTime && targetDecimal <= nextTime) {
      const progress = (targetDecimal - currTime) / (nextTime - currTime);
      const currVal = curr[valueKey] ?? curr.predicted ?? curr.actual;
      const nextVal = next[valueKey] ?? next.predicted ?? next.actual;
      if (currVal !== null && nextVal !== null) {
        return Math.round(currVal + (nextVal - currVal) * progress);
      }
    }
  }
  
  // Return first or last value if out of range
  const firstTime = timeToDecimal(timelineData[0].time);
  const lastTime = timeToDecimal(timelineData[timelineData.length - 1].time);
  if (targetDecimal <= firstTime) {
    return timelineData[0][valueKey] ?? timelineData[0].actual;
  }
  if (targetDecimal >= lastTime) {
    const last = timelineData[timelineData.length - 1];
    return last[valueKey] ?? last.predicted ?? last.actual;
  }
  
  return null;
};

// Available scenarios (mock data)
const AVAILABLE_SCENARIOS = [
  { 
    id: 'scenario-1', 
    name: '+2 FTEs for Outbound Surge',
    description: 'Add 2 temp workers starting at 12:00 to handle predicted volume spike',
    triggerTime: '12:00',
    impacts: {
      staffing: { delta: +8 },
      throughput: { delta: +12 },
      health: { delta: +7 },
      laborCost: { delta: +320 }
    },
    alertImpact: {
      mitigated: ['alert-1', 'alert-2', 'alert-3'], // Zone capacity, UPS cutoff, Swing understaffed
      persists: ['alert-4', 'alert-5'],              // Labor over budget, Receiving backup
      newAlerts: ['alert-new-1']                     // Possible overtime concern
    }
  },
  { 
    id: 'scenario-2', 
    name: 'Stagger Breaks by 15min',
    description: 'Offset break times to maintain coverage during lunch',
    triggerTime: '11:00',
    impacts: {
      staffing: { delta: +4 },
      throughput: { delta: +5 },
      health: { delta: +3 },
      laborCost: { delta: 0 }
    },
    alertImpact: {
      mitigated: ['alert-3'],                        // Swing understaffed partially addressed
      persists: ['alert-1', 'alert-2', 'alert-4', 'alert-5'],
      newAlerts: []
    }
  },
  { 
    id: 'scenario-3', 
    name: 'Activate Overflow Zone Z07',
    description: 'Enable overflow zone to handle bulk storage capacity breach',
    triggerTime: '11:30',
    impacts: {
      staffing: { delta: 0 },
      throughput: { delta: +3 },
      health: { delta: +4 },
      laborCost: { delta: +80 }
    },
    alertImpact: {
      mitigated: ['alert-1'],                        // Zone capacity
      persists: ['alert-2', 'alert-3', 'alert-4', 'alert-5'],
      newAlerts: []
    }
  }
];

const TimeProvider = ({ children }) => {
  const NOW_TIME = '10:00'; // Fixed "now" for mockup
  const [contextualTime, setContextualTime] = useState(NOW_TIME);
  
  // View Mode state - controls baseline reality
  const [viewMode, setViewMode] = useState('live-plan'); // 'live' | 'live-plan'
  
  // Scenario state
  const [scenarioMode, setScenarioMode] = useState(false);
  const [activeScenarioId, setActiveScenarioId] = useState(null);
  const [scenarioSource, setScenarioSource] = useState('manual'); // 'manual' | 'draft-plan'
  const [draftPlanScenario, setDraftPlanScenario] = useState(null); // { planId, planName, projectedImpacts }
  
  // EOS vs EOD toggle (global)
  const [endTimeMode, setEndTimeMode] = useState('eos'); // 'eos' or 'eod'
  const END_OF_SHIFT = '14:00';  // Day shift ends
  const END_OF_DAY = '22:00';    // End of operations
  const endTime = endTimeMode === 'eos' ? END_OF_SHIFT : END_OF_DAY;
  const endTimeLabel = endTimeMode === 'eos' ? 'EOS' : 'EOD';
  
  const isContextualDifferent = contextualTime !== NOW_TIME;
  const isContextualPast = timeToDecimal(contextualTime) < timeToDecimal(NOW_TIME);
  const isContextualFuture = timeToDecimal(contextualTime) > timeToDecimal(NOW_TIME);
  
  const resetToNow = () => setContextualTime(NOW_TIME);
  
  // Get active scenario data
  const activeScenario = activeScenarioId ? AVAILABLE_SCENARIOS.find(s => s.id === activeScenarioId) : null;
  
  // Toggle scenario mode
  const toggleScenarioMode = (enabled, scenarioId = null) => {
    setScenarioMode(enabled);
    setActiveScenarioId(enabled ? (scenarioId || AVAILABLE_SCENARIOS[0].id) : null);
    if (!enabled) {
      setScenarioSource('manual');
      setDraftPlanScenario(null);
    }
  };
  
  // Activate draft plan scenario mode
  const activateDraftPlanScenario = (planId, planName, projectedImpacts) => {
    setScenarioMode(true);
    setScenarioSource('draft-plan');
    setDraftPlanScenario({ planId, planName, projectedImpacts });
    setActiveScenarioId(null); // Clear manual scenario
  };
  
  // Exit draft plan scenario
  const exitDraftPlanScenario = () => {
    setScenarioMode(false);
    setScenarioSource('manual');
    setDraftPlanScenario(null);
  };
  
  // Calculate scenario-adjusted value based on time and scenario impacts
  const getScenarioValue = (baseValue, impactKey, atTime) => {
    if (!scenarioMode || !activeScenario) return baseValue;
    
    const impact = activeScenario.impacts[impactKey];
    if (!impact) return baseValue;
    
    const triggerDecimal = timeToDecimal(activeScenario.triggerTime);
    const atDecimal = typeof atTime === 'string' ? timeToDecimal(atTime) : atTime;
    
    // Scenario impact only applies after trigger time
    if (atDecimal >= triggerDecimal) {
      // Gradual ramp-up over 1 hour after trigger
      const hoursSinceTrigger = atDecimal - triggerDecimal;
      const rampFactor = Math.min(1, hoursSinceTrigger / 1);
      return Math.round(baseValue + (impact.delta * rampFactor));
    }
    
    return baseValue;
  };
  
  return (
    <TimeContext.Provider value={{
      nowTime: NOW_TIME,
      contextualTime,
      setContextualTime,
      isContextualDifferent,
      isContextualPast,
      isContextualFuture,
      resetToNow,
      timeToDecimal,
      decimalToTime,
      interpolateValue,
      // View mode state
      viewMode,
      setViewMode,
      // Scenario state
      scenarioMode,
      activeScenario,
      activeScenarioId,
      availableScenarios: AVAILABLE_SCENARIOS,
      toggleScenarioMode,
      setActiveScenarioId,
      getScenarioValue,
      // Draft plan scenario
      scenarioSource,
      draftPlanScenario,
      activateDraftPlanScenario,
      exitDraftPlanScenario,
      // End time mode
      endTimeMode,
      setEndTimeMode,
      endTime,
      endTimeLabel
    }}>
      {children}
    </TimeContext.Provider>
  );
};

// ===== TIME SCRUBBER COMPONENT =====
const TimeScrubber = () => {
  const { 
    nowTime, contextualTime, setContextualTime, isContextualDifferent, isContextualPast, resetToNow, decimalToTime, timeToDecimal,
    viewMode, setViewMode,
    scenarioMode, activeScenario, activeScenarioId, availableScenarios, toggleScenarioMode, setActiveScenarioId,
    scenarioSource, draftPlanScenario, exitDraftPlanScenario,
    endTimeMode, setEndTimeMode, endTimeLabel
  } = useTimeContext();
  
  const START_HOUR = 6;  // 06:00
  const END_HOUR = 22;   // 22:00
  const TOTAL_HOURS = END_HOUR - START_HOUR;
  
  const nowDecimal = timeToDecimal(nowTime);
  const contextualDecimal = timeToDecimal(contextualTime);
  
  const timeToPercent = (decimal) => ((decimal - START_HOUR) / TOTAL_HOURS) * 100;
  const percentToTime = (percent) => START_HOUR + (percent / 100) * TOTAL_HOURS;
  
  const handleClick = (e) => {
    const rect = e.currentTarget.getBoundingClientRect();
    const percent = ((e.clientX - rect.left) / rect.width) * 100;
    const decimal = percentToTime(Math.max(0, Math.min(100, percent)));
    // Snap to 15-minute intervals
    const snapped = Math.round(decimal * 4) / 4;
    setContextualTime(decimalToTime(snapped));
  };
  
  // Generate hour markers
  const hourMarkers = [];
  for (let h = START_HOUR; h <= END_HOUR; h += 2) {
    hourMarkers.push(h);
  }
  
  // Shift boundaries
  const shifts = [
    { name: 'Day', start: 6, end: 14, color: C.warning[300] },
    { name: 'Swing', start: 14, end: 22, color: C.purple[300] },
  ];
  
  return (
    <div style={{ background: 'white', border: `1px solid ${C.neutral[200]}`, borderRadius: 8, padding: sp.md, marginBottom: sp.lg }}>
      {/* Scenario Mode Banner - Manual Scenario */}
      {scenarioMode && scenarioSource === 'manual' && activeScenario && (
        <div style={{ 
          display: 'flex', 
          alignItems: 'center', 
          justifyContent: 'space-between',
          padding: sp.sm, 
          marginBottom: sp.md,
          background: `linear-gradient(135deg, ${C.purple[50]} 0%, ${C.brand[50]} 100%)`,
          borderRadius: 6,
          border: `1px solid ${C.purple[200]}`
        }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <Zap style={{ width: 16, height: 16, color: C.purple[600] }} />
            <span style={{ fontSize: '13px', fontWeight: 500, color: C.purple[700] }}>Scenario Mode:</span>
            <span style={{ fontSize: '13px', color: C.purple[600] }}>{activeScenario.name}</span>
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <button
              onClick={() => toggleScenarioMode(false)}
              style={{
                padding: '4px 10px',
                fontSize: '11px',
                background: 'white',
                color: C.neutral[600],
                border: `1px solid ${C.neutral[300]}`,
                borderRadius: 4,
                cursor: 'pointer'
              }}
            >
              Exit Scenario
            </button>
          </div>
        </div>
      )}
      
      {/* Scenario Mode Banner - Exploratory/Draft Plan */}
      {scenarioMode && scenarioSource === 'draft-plan' && draftPlanScenario && (
        <div style={{ 
          display: 'flex', 
          alignItems: 'center', 
          justifyContent: 'space-between',
          padding: sp.sm, 
          marginBottom: sp.md,
          background: `linear-gradient(135deg, ${C.purple[100]} 0%, ${C.brand[50]} 100%)`,
          borderRadius: 6,
          border: `1px solid ${C.purple[300]}`
        }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <Lightbulb style={{ width: 16, height: 16, color: C.purple[600] }} />
            <span style={{ fontSize: '13px', fontWeight: 500, color: C.purple[800] }}>Exploratory Scenario:</span>
            <span style={{ fontSize: '13px', color: C.purple[700] }}>{draftPlanScenario.planName}</span>
            <span style={{ fontSize: '11px', color: C.purple[500], marginLeft: 4 }}>— Viewing projected impact if plan succeeds</span>
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <button
              onClick={() => exitDraftPlanScenario && exitDraftPlanScenario()}
              style={{
                padding: '4px 10px',
                fontSize: '11px',
                background: 'white',
                color: C.purple[700],
                border: `1px solid ${C.purple[300]}`,
                borderRadius: 4,
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: 4
              }}
            >
              <X style={{ width: 12, height: 12 }} />
              Exit to Live
            </button>
          </div>
        </div>
      )}
      
      {/* Header */}
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
          <Clock style={{ width: 18, height: 18, color: C.neutral[500] }} />
          <div>
            <span style={{ fontSize: '14px', fontWeight: 500 }}>Timeline Scrubber</span>
            <span style={{ fontSize: '12px', color: C.neutral[500], marginLeft: sp.sm }}>
              Click to explore metrics at different times
            </span>
          </div>
        </div>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
          {/* EOS/EOD Toggle */}
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, padding: '4px', background: C.neutral[100], borderRadius: 6 }}>
            <button
              onClick={() => setEndTimeMode('eos')}
              style={{
                padding: '4px 8px',
                fontSize: '11px',
                fontWeight: 500,
                border: 'none',
                borderRadius: 4,
                cursor: 'pointer',
                background: endTimeMode === 'eos' ? 'white' : 'transparent',
                color: endTimeMode === 'eos' ? C.brand[600] : C.neutral[500],
                boxShadow: endTimeMode === 'eos' ? '0 1px 2px rgba(0,0,0,0.1)' : 'none'
              }}
            >
              EOS
            </button>
            <button
              onClick={() => setEndTimeMode('eod')}
              style={{
                padding: '4px 8px',
                fontSize: '11px',
                fontWeight: 500,
                border: 'none',
                borderRadius: 4,
                cursor: 'pointer',
                background: endTimeMode === 'eod' ? 'white' : 'transparent',
                color: endTimeMode === 'eod' ? C.brand[600] : C.neutral[500],
                boxShadow: endTimeMode === 'eod' ? '0 1px 2px rgba(0,0,0,0.1)' : 'none'
              }}
            >
              EOD
            </button>
          </div>
          
          <div style={{ width: 1, height: 20, background: C.neutral[200] }} />
          
          {/* View Mode Selector */}
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <span style={{ fontSize: '12px', color: C.neutral[500] }}>View:</span>
            <div style={{ 
              display: 'flex', 
              background: C.neutral[100], 
              borderRadius: 6, 
              padding: 2,
              border: `1px solid ${C.neutral[200]}`
            }}>
              <button
                onClick={() => setViewMode('live')}
                style={{
                  padding: '4px 10px',
                  fontSize: '11px',
                  fontWeight: 500,
                  border: 'none',
                  borderRadius: 4,
                  cursor: 'pointer',
                  background: viewMode === 'live' ? 'white' : 'transparent',
                  color: viewMode === 'live' ? C.neutral[700] : C.neutral[500],
                  boxShadow: viewMode === 'live' ? '0 1px 2px rgba(0,0,0,0.1)' : 'none',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 4
                }}
              >
                <Radio style={{ width: 10, height: 10 }} />
                Live
              </button>
              <button
                onClick={() => setViewMode('live-plan')}
                style={{
                  padding: '4px 10px',
                  fontSize: '11px',
                  fontWeight: 500,
                  border: 'none',
                  borderRadius: 4,
                  cursor: 'pointer',
                  background: viewMode === 'live-plan' ? 'white' : 'transparent',
                  color: viewMode === 'live-plan' ? C.success[700] : C.neutral[500],
                  boxShadow: viewMode === 'live-plan' ? '0 1px 2px rgba(0,0,0,0.1)' : 'none',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 4
                }}
              >
                <Zap style={{ width: 10, height: 10 }} />
                Live + Plan
              </button>
            </div>
          </div>
          
          <div style={{ width: 1, height: 20, background: C.neutral[200] }} />
          
          {/* Scenario Mode Toggle */}
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <span style={{ fontSize: '12px', color: C.neutral[500] }}>Scenario:</span>
            {scenarioSource === 'draft-plan' && draftPlanScenario ? (
              // Exploratory/Draft Plan scenario display
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                <div style={{
                  padding: '4px 10px',
                  fontSize: '12px',
                  border: `1px solid ${C.purple[400]}`,
                  borderRadius: 4,
                  background: C.purple[100],
                  color: C.purple[800],
                  display: 'flex',
                  alignItems: 'center',
                  gap: 6,
                  maxWidth: 200
                }}>
                  <Lightbulb style={{ width: 12, height: 12, color: C.purple[600], flexShrink: 0 }} />
                  <span style={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>
                    Exploratory: {draftPlanScenario.planName.length > 20 ? draftPlanScenario.planName.substring(0, 20) + '...' : draftPlanScenario.planName}
                  </span>
                </div>
                <button
                  onClick={() => exitDraftPlanScenario && exitDraftPlanScenario()}
                  title="Exit to Live Mode"
                  style={{
                    padding: '4px 8px',
                    fontSize: '11px',
                    fontWeight: 500,
                    background: 'white',
                    color: C.purple[600],
                    border: `1px solid ${C.purple[300]}`,
                    borderRadius: 4,
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: 4
                  }}
                >
                  <X style={{ width: 12, height: 12 }} />
                  Exit
                </button>
              </div>
            ) : (
              // Enhanced scenario dropdown with state impacts
              (() => {
                const [isOpen, setIsOpen] = React.useState(false);
                
                // Calculate impact summary from scenario data
                const getScenarioImpact = (scenario) => {
                  if (!scenario.alertImpact) {
                    return { mitigated: 0, persists: 5, newAlerts: 0, healthDelta: scenario.impacts?.health?.delta || 0 };
                  }
                  return { 
                    mitigated: scenario.alertImpact.mitigated?.length || 0, 
                    persists: scenario.alertImpact.persists?.length || 0, 
                    newAlerts: scenario.alertImpact.newAlerts?.length || 0, 
                    healthDelta: scenario.impacts?.health?.delta || 0 
                  };
                };
                
                const currentScenario = scenarioMode ? availableScenarios.find(s => s.id === activeScenarioId) : null;
                const currentImpact = currentScenario ? getScenarioImpact(currentScenario) : null;
                
                return (
                  <div style={{ position: 'relative' }}>
                    {/* Dropdown Trigger */}
                    <button
                      onClick={() => setIsOpen(!isOpen)}
                      style={{
                        padding: '6px 10px',
                        fontSize: '12px',
                        border: `1px solid ${scenarioMode ? C.purple[300] : C.neutral[300]}`,
                        borderRadius: 4,
                        background: scenarioMode ? C.purple[50] : 'white',
                        color: scenarioMode ? C.purple[700] : C.neutral[700],
                        cursor: 'pointer',
                        minWidth: 180,
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'space-between',
                        gap: sp.sm
                      }}
                    >
                      <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}>
                        {scenarioMode ? (
                          <>
                            <Zap style={{ width: 12, height: 12, color: C.purple[500] }} />
                            <span style={{ fontWeight: 500 }}>{currentScenario?.name || 'Scenario'}</span>
                          </>
                        ) : (
                          <>
                            <Radio style={{ width: 12, height: 12, color: C.success[500] }} />
                            <span>Live Mode</span>
                          </>
                        )}
                      </div>
                      <ChevronDown style={{ width: 14, height: 14, opacity: 0.5, transform: isOpen ? 'rotate(180deg)' : 'none', transition: 'transform 0.15s' }} />
                    </button>
                    
                    {/* Dropdown Menu */}
                    {isOpen && (
                      <>
                        {/* Backdrop to close on click outside */}
                        <div 
                          style={{ position: 'fixed', inset: 0, zIndex: 998 }} 
                          onClick={() => setIsOpen(false)} 
                        />
                        <div style={{
                          position: 'absolute',
                          top: '100%',
                          left: 0,
                          marginTop: 4,
                          width: 320,
                          background: 'white',
                          border: `1px solid ${C.neutral[200]}`,
                          borderRadius: 8,
                          boxShadow: '0 4px 16px rgba(0,0,0,0.12)',
                          zIndex: 999,
                          overflow: 'hidden'
                        }}>
                          {/* Live Mode Option */}
                          <div
                            onClick={() => { toggleScenarioMode(false); setIsOpen(false); }}
                            style={{
                              padding: sp.md,
                              cursor: 'pointer',
                              background: !scenarioMode ? C.success[50] : 'white',
                              borderBottom: `1px solid ${C.neutral[100]}`,
                              transition: 'background 0.1s'
                            }}
                            onMouseEnter={(e) => { if (scenarioMode) e.currentTarget.style.background = C.neutral[50]; }}
                            onMouseLeave={(e) => { if (scenarioMode) e.currentTarget.style.background = 'white'; }}
                          >
                            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 4 }}>
                              <Radio style={{ width: 14, height: 14, color: C.success[500] }} />
                              <span style={{ fontSize: '13px', fontWeight: 500, color: C.neutral[800] }}>Live Mode</span>
                              {!scenarioMode && <CheckCircle style={{ width: 14, height: 14, color: C.success[500], marginLeft: 'auto' }} />}
                            </div>
                            <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0, paddingLeft: 22 }}>
                              Ground truth — Current facility state
                            </p>
                          </div>
                          
                          {/* Scenarios Header */}
                          <div style={{ padding: `${sp.sm} ${sp.md}`, background: C.neutral[50], borderBottom: `1px solid ${C.neutral[100]}` }}>
                            <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', letterSpacing: '0.5px' }}>
                              What-If Scenarios
                            </span>
                          </div>
                          
                          {/* Scenario Options */}
                          {availableScenarios.map(scenario => {
                            const impact = getScenarioImpact(scenario);
                            const isSelected = scenarioMode && activeScenarioId === scenario.id;
                            
                            return (
                              <div
                                key={scenario.id}
                                onClick={() => { toggleScenarioMode(true, scenario.id); setIsOpen(false); }}
                                style={{
                                  padding: sp.md,
                                  cursor: 'pointer',
                                  background: isSelected ? C.purple[50] : 'white',
                                  borderBottom: `1px solid ${C.neutral[100]}`,
                                  transition: 'background 0.1s'
                                }}
                                onMouseEnter={(e) => { if (!isSelected) e.currentTarget.style.background = C.neutral[50]; }}
                                onMouseLeave={(e) => { if (!isSelected) e.currentTarget.style.background = 'white'; }}
                              >
                                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 4 }}>
                                  <Zap style={{ width: 14, height: 14, color: C.purple[500] }} />
                                  <span style={{ fontSize: '13px', fontWeight: 500, color: C.neutral[800] }}>{scenario.name}</span>
                                  {isSelected && <CheckCircle style={{ width: 14, height: 14, color: C.purple[500], marginLeft: 'auto' }} />}
                                </div>
                                <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0, marginBottom: 8, paddingLeft: 22 }}>
                                  {scenario.description}
                                </p>
                                
                                {/* Impact Summary */}
                                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, paddingLeft: 22, flexWrap: 'wrap' }}>
                                  {impact.mitigated > 0 && (
                                    <span style={{ 
                                      fontSize: '10px', 
                                      padding: '2px 6px', 
                                      background: C.success[100], 
                                      color: C.success[700], 
                                      borderRadius: 4,
                                      fontWeight: 500
                                    }}>
                                      ✓ {impact.mitigated} mitigated
                                    </span>
                                  )}
                                  {impact.persists > 0 && (
                                    <span style={{ 
                                      fontSize: '10px', 
                                      padding: '2px 6px', 
                                      background: C.neutral[100], 
                                      color: C.neutral[600], 
                                      borderRadius: 4,
                                      fontWeight: 500
                                    }}>
                                      {impact.persists} persist
                                    </span>
                                  )}
                                  {impact.newAlerts > 0 && (
                                    <span style={{ 
                                      fontSize: '10px', 
                                      padding: '2px 6px', 
                                      background: C.warning[100], 
                                      color: C.warning[700], 
                                      borderRadius: 4,
                                      fontWeight: 500
                                    }}>
                                      +{impact.newAlerts} new
                                    </span>
                                  )}
                                  <span style={{ 
                                    fontSize: '10px', 
                                    padding: '2px 6px', 
                                    background: impact.healthDelta > 0 ? C.success[100] : C.neutral[100], 
                                    color: impact.healthDelta > 0 ? C.success[700] : C.neutral[600], 
                                    borderRadius: 4,
                                    fontWeight: 600,
                                    marginLeft: 'auto'
                                  }}>
                                    Health {impact.healthDelta > 0 ? '+' : ''}{impact.healthDelta}
                                  </span>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </>
                    )}
                  </div>
                );
              })()
            )}
          </div>
          
          <div style={{ width: 1, height: 20, background: C.neutral[200] }} />
          
          {/* Current time display */}
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <div style={{ width: 12, height: 12, background: C.neutral[800], borderRadius: 2 }} />
            <span style={{ fontSize: '13px', color: C.neutral[600] }}>Now: <strong>{nowTime}</strong></span>
          </div>
          {/* Contextual time display */}
          {isContextualDifferent && (
            <>
              <div style={{ width: 1, height: 20, background: C.neutral[200] }} />
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <div style={{ width: 12, height: 12, background: C.brand[500], borderRadius: 2 }} />
                <span style={{ fontSize: '13px', color: C.brand[600] }}>
                  Viewing: <strong>{contextualTime}</strong>
                  {isContextualPast && <span style={{ fontSize: '11px', color: C.neutral[500], marginLeft: 4 }}>(past)</span>}
                </span>
              </div>
              <button
                onClick={resetToNow}
                style={{
                  display: 'flex', alignItems: 'center', gap: 4,
                  padding: '4px 10px', borderRadius: 4,
                  border: `1px solid ${C.neutral[300]}`,
                  background: 'white', cursor: 'pointer',
                  fontSize: '12px', color: C.neutral[600]
                }}
              >
                <RotateCcw style={{ width: 12, height: 12 }} />
                Reset
              </button>
            </>
          )}
        </div>
      </div>
      
      {/* Timeline track */}
      <div 
        style={{ position: 'relative', height: 48, cursor: 'pointer', userSelect: 'none' }}
        onClick={handleClick}
      >
        {/* Shift backgrounds */}
        <div style={{ position: 'absolute', top: 8, left: 0, right: 0, height: 24, display: 'flex', borderRadius: 4, overflow: 'hidden' }}>
          {shifts.map((shift, i) => (
            <div
              key={i}
              style={{
                width: `${((shift.end - shift.start) / TOTAL_HOURS) * 100}%`,
                background: `${shift.color}40`,
                borderRight: i < shifts.length - 1 ? `1px dashed ${C.neutral[300]}` : 'none',
                display: 'flex', alignItems: 'center', justifyContent: 'center'
              }}
            >
              <span style={{ fontSize: '10px', fontWeight: 500, color: C.neutral[600], textTransform: 'uppercase' }}>{shift.name}</span>
            </div>
          ))}
        </div>
        
        {/* Track line */}
        <div style={{ position: 'absolute', top: 18, left: 0, right: 0, height: 4, background: C.neutral[200], borderRadius: 2 }} />
        
        {/* Now marker (fixed) */}
        <div style={{
          position: 'absolute',
          left: `${timeToPercent(nowDecimal)}%`,
          top: 6,
          transform: 'translateX(-50%)',
          display: 'flex', flexDirection: 'column', alignItems: 'center',
          zIndex: 10
        }}>
          <div style={{
            width: 4, height: 28,
            background: C.neutral[800],
            borderRadius: 2,
            boxShadow: '0 1px 3px rgba(0,0,0,0.2)'
          }} />
          <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[800], marginTop: 2 }}>NOW</span>
        </div>
        
        {/* Contextual marker (movable) */}
        {isContextualDifferent && (
          <div style={{
            position: 'absolute',
            left: `${timeToPercent(contextualDecimal)}%`,
            top: 4,
            transform: 'translateX(-50%)',
            display: 'flex', flexDirection: 'column', alignItems: 'center',
            zIndex: 15
          }}>
            <div style={{
              width: 14, height: 32,
              background: C.brand[500],
              borderRadius: 4,
              boxShadow: '0 2px 6px rgba(47, 114, 255, 0.4)',
              display: 'flex', alignItems: 'center', justifyContent: 'center'
            }}>
              <GripVertical style={{ width: 10, height: 10, color: 'white' }} />
            </div>
            <span style={{ fontSize: '10px', fontWeight: 600, color: C.brand[600], marginTop: 2 }}>{contextualTime}</span>
          </div>
        )}
        
        {/* Hour markers */}
        <div style={{ position: 'absolute', top: 38, left: 0, right: 0, display: 'flex', justifyContent: 'space-between' }}>
          {hourMarkers.map(h => (
            <span key={h} style={{ fontSize: '10px', color: C.neutral[400], transform: 'translateX(-50%)', position: 'absolute', left: `${timeToPercent(h)}%` }}>
              {h.toString().padStart(2, '0')}:00
            </span>
          ))}
        </div>
      </div>
    </div>
  );
};

// ===== CONTEXTUAL METRIC DISPLAY COMPONENT =====
// Shows: Current → [Contextual @time] → Predicted
const TriTemporalMetric = ({ 
  current, 
  predicted, 
  contextualValue, 
  unit = '', 
  currentLabel = 'Now',
  predictedLabel = 'EOD',
  size = 'default', // 'compact', 'default', 'large'
  showLabels = true 
}) => {
  const { contextualTime, isContextualDifferent, isContextualPast } = useTimeContext();
  
  const sizes = {
    compact: { value: '16px', label: '10px', arrow: 12, gap: sp.sm },
    default: { value: '24px', label: '11px', arrow: 14, gap: sp.md },
    large: { value: '36px', label: '12px', arrow: 18, gap: sp.lg }
  };
  const s = sizes[size];
  
  return (
    <div style={{ display: 'flex', alignItems: 'center', gap: s.gap }}>
      {/* Current */}
      <div style={{ textAlign: 'center' }}>
        <span style={{ fontSize: s.value, fontWeight: 500, color: C.neutral[900] }}>{current}{unit}</span>
        {showLabels && <p style={{ fontSize: s.label, color: C.neutral[500] }}>{currentLabel}</p>}
      </div>
      
      {/* Contextual (only if different from now) */}
      {isContextualDifferent && contextualValue !== null && contextualValue !== undefined && (
        <>
          <div style={{ display: 'flex', alignItems: 'center', gap: 4, color: C.neutral[400] }}>
            <ArrowRight style={{ width: s.arrow, height: s.arrow }} />
          </div>
          <div style={{ 
            textAlign: 'center', 
            padding: '4px 8px', 
            background: C.brand[100], 
            borderRadius: 6,
            border: `1px solid ${C.brand[500]}30`
          }}>
            <span style={{ fontSize: s.value, fontWeight: 500, color: C.brand[600] }}>{contextualValue}{unit}</span>
            {showLabels && (
              <p style={{ fontSize: s.label, color: C.brand[500] }}>
                @{contextualTime} {isContextualPast && <span style={{ fontSize: '9px' }}>(past)</span>}
              </p>
            )}
          </div>
        </>
      )}
      
      {/* Predicted */}
      <div style={{ display: 'flex', alignItems: 'center', gap: 4, color: C.neutral[400] }}>
        <ArrowRight style={{ width: s.arrow, height: s.arrow }} />
      </div>
      <div style={{ textAlign: 'center' }}>
        <span style={{ fontSize: s.value, fontWeight: 500, color: C.purple[600] }}>{predicted}{unit}</span>
        {showLabels && <p style={{ fontSize: s.label, color: C.neutral[500] }}>{predictedLabel}</p>}
      </div>
    </div>
  );
};

// ===== DESIGN SYSTEM =====
const C = {
  brand: { 50: '#EFF6FF', 100: '#D5EDFF', 200: '#BFDBFE', 500: '#2F72FF', 600: '#0037FF', 700: '#1D4ED8' },
  neutral: { 50: '#F9FAFB', 100: '#F2F4F7', 200: '#EAECF0', 300: '#D0D5DD', 400: '#98A2B3', 500: '#667085', 600: '#475467', 700: '#344054', 800: '#1D2939', 900: '#101828' },
  success: { 50: '#ECFDF3', 100: '#D1FADF', 500: '#12B76A', 600: '#039855', 700: '#027A48' },
  warning: { 50: '#FFFCF5', 100: '#FEF0C7', 200: '#FEDF89', 300: '#FEC84B', 500: '#F79009', 600: '#DC6803', 700: '#B54708' },
  error: { 50: '#FEF3F2', 100: '#FEE4E2', 500: '#F04443', 600: '#D92D20', 700: '#B42318' },
  purple: { 50: '#F4F3FF', 100: '#EBE9FE', 200: '#DDD6FE', 300: '#D9D6FE', 400: '#A78BFA', 500: '#7A5AF8', 600: '#6938EF', 700: '#5925DC', 900: '#2E1065' },
  indigo: { 50: '#EEF2FF', 100: '#E0E7FF', 200: '#C7D2FE', 500: '#6366F1', 600: '#4F46E5', 700: '#4338CA' },
  blueLight: { 50: '#F0F9FF', 100: '#E0F2FE', 500: '#0BA5EC', 600: '#0284C7' },
  orange: { 50: '#FFF6ED', 100: '#FFEDD5', 500: '#FB6514', 600: '#EA580C' },
  greenLight: { 50: '#F3FEE7', 100: '#ECFCCB', 500: '#66C61C', 600: '#65A30D' },
  rose: { 50: '#FFF1F2', 100: '#FFE4E6', 500: '#F43F5E', 600: '#E11D48' }
};
const sp = { xs: '4px', sm: '8px', md: '16px', lg: '24px', xl: '32px' };

// ===== UTILITIES =====
const scoreColor = s => s >= 90 ? C.success[500] : s >= 75 ? C.warning[500] : C.error[500];
const scoreStatus = s => s >= 90 ? 'success' : s >= 75 ? 'warning' : 'error';
const spark = (n=12, b=50, v=20) => Array.from({length:n}, (_,i) => ({ v: b + Math.sin(i*0.5)*v*0.5 + (Math.random()-0.5)*v }));

// ===== SHARED ALERTS DATA =====
// Central source of truth for all predictive alerts across the application
const ALERTS_DATA = {
  // Schedule > Staffing alerts
  'staffing-shift-coverage': { 
    id: 'staffing-shift-coverage', 
    sev: 'warning', 
    title: 'Shift Coverage Gap — Day Shift', 
    msg: '42/48 FTE on floor. 4 call-outs not yet backfilled. Consider pulling 2 from Reserve Pool.', 
    time: 'Now', 
    conf: 85,
    category: 'schedules'
  },
  'staffing-ups-cutoff': { 
    id: 'staffing-ups-cutoff', 
    sev: 'critical', 
    title: 'UPS Cutoff at Risk — 15:30', 
    msg: '~40 orders may miss 15:30 cutoff based on current velocity. Reassign 2 FTE to Pack Station 1.', 
    time: '5.5hr out', 
    conf: 72,
    category: 'schedules'
  },
  'staffing-break-coverage': { 
    id: 'staffing-break-coverage', 
    sev: 'warning', 
    title: 'Lunch Break Coverage — 12:00', 
    msg: '20 FTE scheduled for lunch may drop coverage below minimum. Stagger breaks by 15 min.', 
    time: '2hr out', 
    conf: 78,
    category: 'schedules'
  },
  'staffing-swing-callout': { 
    id: 'staffing-swing-callout', 
    sev: 'info', 
    title: 'Swing Shift Pre-Alert', 
    msg: '2 call-outs already reported for swing. Backup staff notified.', 
    time: '4hr out', 
    conf: 90,
    category: 'schedules'
  },
  
  // Schedule > Inbound alerts
  'inbound-dock-congestion': { 
    id: 'inbound-dock-congestion', 
    sev: 'warning', 
    title: 'Dock Congestion Risk — 11:30', 
    msg: 'T-1855 scheduled for Dock 2 while T-1847 may still be unloading at Dock 1. Consider reassigning to Dock 4.', 
    time: '1.5hr out', 
    conf: 82,
    category: 'schedules'
  },
  'inbound-crew-gap': { 
    id: 'inbound-crew-gap', 
    sev: 'warning', 
    title: 'Receiving Crew Gap — 10:30-11:00', 
    msg: '2 FTE waiting at Dock 3 for delayed T-1852. Reassign to assist Dock 1 unload.', 
    time: 'Now', 
    conf: 94,
    category: 'schedules'
  },
  'inbound-afternoon-light': { 
    id: 'inbound-afternoon-light', 
    sev: 'info', 
    title: 'Afternoon Volume Lighter', 
    msg: 'Only 3 trucks scheduled after 13:00. Good window for cycle counts or zone cleanup.', 
    time: '3hr out', 
    conf: 88,
    category: 'schedules'
  },
  
  // Schedule > Outbound alerts
  'outbound-ups-cutoff': { 
    id: 'outbound-ups-cutoff', 
    sev: 'warning', 
    title: 'UPS Cutoff at Risk — 15:30', 
    msg: 'Current velocity 127/hr vs 135/hr needed. Reassign 2 FTE from Pack Station 2 to boost throughput.', 
    time: '5.5hr out', 
    conf: 78,
    category: 'schedules'
  },
  'outbound-fedex-staging': { 
    id: 'outbound-fedex-staging', 
    sev: 'warning', 
    title: 'FedEx Express Staging Delay', 
    msg: '3 loads not yet picked. Start staging by 15:30 to meet 17:00 cutoff.', 
    time: '3hr out', 
    conf: 85,
    category: 'schedules'
  },
  'outbound-fedex-ground-ok': { 
    id: 'outbound-fedex-ground-ok', 
    sev: 'success', 
    title: 'FedEx Ground On Track', 
    msg: 'Both loads at D7 and D11 will complete by 13:45. 70-order buffer projected.', 
    time: '4hr out', 
    conf: 94,
    category: 'schedules'
  },
  
  // Schedule > Maintenance alerts
  'maint-fl02-pm-peak': { 
    id: 'maint-fl02-pm-peak', 
    sev: 'warning', 
    title: 'FL-02 PM During Peak — 14:00', 
    msg: 'Scheduled PM overlaps with swing shift start. Consider rescheduling to 13:00 or 16:00 to minimize Inbound A impact.', 
    time: '4hr out', 
    conf: 72,
    category: 'schedules'
  },
  'maint-epj03-return': { 
    id: 'maint-epj03-return', 
    sev: 'info', 
    title: 'EPJ-03 Return to Service — 11:30', 
    msg: 'Hydraulic repair 70% complete. Unit should be available for afternoon putaway surge.', 
    time: '1.5hr out', 
    conf: 88,
    category: 'schedules'
  },
  'maint-fleet-health': { 
    id: 'maint-fleet-health', 
    sev: 'success', 
    title: 'Fleet Health Good', 
    msg: '23 of 24 units operational. No overdue PMs. Conveyor inspection on track.', 
    time: 'Now', 
    conf: 95,
    category: 'schedules'
  },
  
  // Dashboard alerts (references same as staffing-ups-cutoff for consistency)
  'dashboard-ups-cutoff': { 
    id: 'dashboard-ups-cutoff', 
    sev: 'critical', 
    title: 'UPS cutoff at risk', 
    msg: '~40 orders may miss 15:30 cutoff based on current velocity', 
    time: '+5.5hr', 
    conf: 72,
    category: 'schedules'
  },
  
  // ===== STAFF TAB ALERTS =====
  'staff-break-coverage': {
    id: 'staff-break-coverage',
    sev: 'critical',
    title: 'Break Coverage Gap — 12:00',
    msg: '38 FTE predicted vs 48 required. Stagger breaks or authorize 2 overtime extensions.',
    time: '2hr out',
    conf: 87,
    category: 'staffing'
  },
  'staff-swing-understaffed': {
    id: 'staff-swing-understaffed',
    sev: 'warning',
    title: 'Swing understaffed',
    msg: '4 FTE gap vs volume for 14:00-22:00 shift.',
    time: '4hr out',
    conf: 88,
    category: 'staffing'
  },
  'staff-receiving-uplh': {
    id: 'staff-receiving-uplh',
    sev: 'warning',
    title: 'Receiving UPLH Declining',
    msg: 'Productivity trending to 90 UPLH by 14:00 (target: 95). Consider rebalancing.',
    time: '4hr out',
    conf: 72,
    category: 'staffing'
  },
  'staff-handoff-optimal': {
    id: 'staff-handoff-optimal',
    sev: 'info',
    title: 'Swing Shift Handoff Optimal',
    msg: 'Clean handoff predicted at 14:00 with no carryover labor gaps.',
    time: '4hr out',
    conf: 91,
    category: 'staffing'
  },
  
  // ===== ZONES TAB ALERTS =====
  'zones-z04-capacity': {
    id: 'zones-z04-capacity',
    sev: 'critical',
    title: 'Z04 Capacity Critical — 91% by 12:00',
    msg: 'Bulk Storage trending to breach. Expedite 40 pallets to Reserve or activate overflow zone.',
    time: '2hr out',
    conf: 89,
    category: 'zones'
  },
  'zones-z02-underutilized': {
    id: 'zones-z02-underutilized',
    sev: 'warning',
    title: 'Z02 Underutilized — 45%',
    msg: 'Reserve 1 has capacity for 120 additional pallets. Consider redirecting inbound.',
    time: 'Now',
    conf: 94,
    category: 'zones'
  },
  'zones-z01-pick-congestion': {
    id: 'zones-z01-pick-congestion',
    sev: 'warning',
    title: 'Z01 Pick Congestion Risk',
    msg: '3 pickers competing in Aisle A4-A6. Suggest wave staggering.',
    time: '30min out',
    conf: 76,
    category: 'zones'
  },
  'zones-z03-replen-needed': {
    id: 'zones-z03-replen-needed',
    sev: 'info',
    title: 'Z03 Replenishment Needed',
    msg: '12 pick locations below min. Replen task auto-generated.',
    time: 'Now',
    conf: 98,
    category: 'zones'
  },
  
  // ===== WORK CONTENT TAB ALERTS =====
  'work-ups-velocity': {
    id: 'work-ups-velocity',
    sev: 'critical',
    title: 'UPS Orders Behind — 15:30 Cutoff',
    msg: '~40 orders at risk. Current velocity 127/hr vs 135/hr needed.',
    time: '5.5hr out',
    conf: 78,
    category: 'work'
  },
  'work-pick-queue-growing': {
    id: 'work-pick-queue-growing',
    sev: 'warning',
    title: 'Pick Queue Growing',
    msg: '2,450 orders in queue vs 2,100 target. Add 1 picker to maintain flow.',
    time: 'Now',
    conf: 85,
    category: 'work'
  },
  'work-fedex-express-priority': {
    id: 'work-fedex-express-priority',
    sev: 'warning',
    title: 'FedEx Express Priority',
    msg: '124 priority orders need picking by 15:00 for 17:00 cutoff.',
    time: '5hr out',
    conf: 82,
    category: 'work'
  },
  'work-pack-station-balanced': {
    id: 'work-pack-station-balanced',
    sev: 'success',
    title: 'Pack Stations Balanced',
    msg: 'All 4 stations within 10% of target throughput. No action needed.',
    time: 'Now',
    conf: 96,
    category: 'work'
  },
  // ===== EQUIPMENT ALERTS =====
  'equip-pm-overdue': {
    id: 'equip-pm-overdue',
    sev: 'critical',
    title: 'FL-06 PM overdue',
    msg: '25 hours past scheduled maintenance',
    time: 'Now',
    conf: 95,
    category: 'equipment'
  },
  'equip-tt03-offline': {
    id: 'equip-tt03-offline',
    sev: 'critical',
    title: 'TT-03 offline',
    msg: 'Unit requires major repair - out of service',
    time: 'Now',
    conf: 100,
    category: 'equipment'
  },
  'equip-epj03-repair': {
    id: 'equip-epj03-repair',
    sev: 'warning',
    title: 'EPJ-03 in repair',
    msg: 'Expected return 14:00 today',
    time: '+4hr',
    conf: 85,
    category: 'equipment'
  },
  'equip-battery-low': {
    id: 'equip-battery-low',
    sev: 'warning',
    title: '3 units low battery',
    msg: 'RT-04, EPJ-06 charging; OP-02 at 52%',
    time: 'Now',
    conf: 90,
    category: 'equipment'
  },
  'equip-pm-upcoming': {
    id: 'equip-pm-upcoming',
    sev: 'info',
    title: '4 PMs scheduled this week',
    msg: 'FL-04 today, FL-02 tomorrow, 2 more by Friday',
    time: '+1-5d',
    conf: 100,
    category: 'equipment'
  }
};

// ===== STYLES =====
const styles = `
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap');
.wd { font-family: 'Roboto', sans-serif; color: ${C.neutral[900]}; background: #F2F4F7; min-height: 100vh; padding: ${sp.lg}; }
.wd * { box-sizing: border-box; margin: 0; }
.card { background: white; border: 1px solid #D0D5DD; border-radius: 8px; padding: ${sp.lg}; }
.card-click { cursor: pointer; transition: all 0.15s; }
.card-click:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); transform: translateY(-1px); }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }
@keyframes alertPulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 currentColor; } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
`;

// ===== COMPONENTS =====
const Card = ({ children, style={}, click, top, id }) => (
  <div id={id} className={`card ${click ? 'card-click' : ''}`} style={{ background: 'white', borderTop: top ? `4px solid ${top}` : undefined, ...style }} onClick={click}>{children}</div>
);

const Badge = ({ status, label, dot }) => {
  const cfg = { success: [C.success[50], C.success[700]], warning: [C.warning[50], C.warning[700]], error: [C.error[50], C.error[700]], info: [C.brand[100], C.brand[600]], purple: [C.purple[50], C.purple[700]], neutral: [C.neutral[100], C.neutral[600]] };
  const [bg, txt] = cfg[status] || cfg.neutral;
  return <span style={{ display: 'inline-flex', alignItems: 'center', gap: '4px', padding: '3px 8px', borderRadius: '4px', fontSize: '12px', fontWeight: 500, background: bg, color: txt }}>{dot && <span style={{ width: 6, height: 6, borderRadius: '50%', background: txt }} />}{label}</span>;
};

const Progress = ({ value, max=100, color=C.brand[500], pred, h=8 }) => (
  <div style={{ height: h, background: C.neutral[200], borderRadius: h/2, overflow: 'hidden', position: 'relative' }}>
    {pred && <div style={{ position: 'absolute', height: '100%', width: `${Math.min(pred/max*100,100)}%`, background: `${color}30` }} />}
    <div style={{ position: 'absolute', height: '100%', width: `${Math.min(value/max*100,100)}%`, background: color }} />
  </div>
);

const DonutChart = ({ value, size=80, stroke=8, color }) => {
  const r = (size - stroke) / 2, c = r * 2 * Math.PI, o = c - (value / 100) * c;
  return (
    <div style={{ position: 'relative', width: size, height: size, minWidth: size, minHeight: size, flexShrink: 0 }}>
      <svg width={size} height={size} style={{ transform: 'rotate(-90deg)', display: 'block' }}>
        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke={C.neutral[200]} strokeWidth={stroke} />
        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke={color} strokeWidth={stroke} strokeDasharray={c} strokeDashoffset={o} strokeLinecap="round" />
      </svg>
      <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: size * 0.28, fontWeight: 500, color: C.neutral[700] }}>{Math.round(value)}</div>
    </div>
  );
};

const Alert = ({ id, sev, title, msg, time, conf, onClick, isHighlighted }) => {
  const cfg = { critical: [C.error[50], C.error[100], C.error[700], AlertOctagon], warning: [C.warning[50], C.warning[100], C.warning[700], AlertTriangle], info: [C.brand[100], C.brand[100], C.brand[600], Info], success: [C.success[50], C.success[100], C.success[700], CheckCircle] };
  const [bg, bdr, txt, Icon] = cfg[sev] || cfg.info;
  return (
    <div 
      id={id}
      onClick={onClick}
      style={{ 
        background: bg, 
        borderTop: `1px solid ${bdr}`,
        borderRight: `1px solid ${bdr}`,
        borderBottom: `1px solid ${bdr}`,
        borderLeft: `4px solid ${txt}`,
        borderRadius: '0 6px 6px 0', 
        padding: `${sp.sm} ${sp.md}`,
        cursor: onClick ? 'pointer' : 'default',
        transition: 'all 0.15s',
        animation: isHighlighted ? 'alertPulse 0.6s ease-out' : 'none',
        boxShadow: isHighlighted ? `0 0 0 3px ${txt}40` : 'none'
      }}
      onMouseEnter={(e) => { if (onClick) { e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)'; e.currentTarget.style.transform = 'translateY(-1px)'; }}}
      onMouseLeave={(e) => { e.currentTarget.style.boxShadow = isHighlighted ? `0 0 0 3px ${txt}40` : 'none'; e.currentTarget.style.transform = 'translateY(0)'; }}
    >
      <div style={{ display: 'flex', gap: sp.sm, alignItems: 'flex-start' }}>
        <Icon style={{ width: 14, height: 14, color: txt, flexShrink: 0, marginTop: 2 }} />
        <div style={{ flex: 1, minWidth: 0 }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
            <span style={{ fontSize: '13px', fontWeight: 500, color: txt }}>{title}</span>
            <span style={{ fontSize: '11px', color: txt, opacity: 0.8, marginLeft: sp.sm, flexShrink: 0 }}>{time}</span>
          </div>
          <p style={{ fontSize: '11px', color: txt, marginTop: '2px', opacity: 0.9 }}>{msg}</p>
          {conf && <p style={{ fontSize: '10px', color: txt, opacity: 0.7, marginTop: '3px' }}>Confidence: {conf}%</p>}
        </div>
        {onClick && <ChevronRight style={{ width: 14, height: 14, color: txt, opacity: 0.5, alignSelf: 'center', flexShrink: 0 }} />}
      </div>
    </div>
  );
};

// ===== INLINE ALERT COMPONENT (for embedding in cards/charts) =====
const InlineAlert = ({ sev, title, msg, time, conf, onClick, state }) => {
  const cfg = { 
    critical: [C.error[50], C.error[200], C.error[700], AlertOctagon], 
    warning: [C.warning[50], C.warning[200], C.warning[700], AlertTriangle], 
    info: [C.brand[50], C.brand[200], C.brand[600], Info] 
  };
  const [bg, bdr, txt, Icon] = cfg[sev] || cfg.info;
  
  // State badge configuration
  const stateConfig = {
    resolved: { label: '✓ Resolved', bg: C.success[100], color: C.success[700] },
    mitigated: { label: '✓ Mitigated', bg: C.success[100], color: C.success[700] },
    targeted: { label: '◐ Targeted', bg: C.brand[100], color: C.brand[700] },
    tradeoff: { label: '⚠ Tradeoff', bg: C.warning[100], color: C.warning[700] },
    persists: { label: 'Persists', bg: C.neutral[100], color: C.neutral[600] },
    active: null
  };
  const stateBadge = stateConfig[state];
  const isResolved = ['resolved', 'mitigated'].includes(state);
  
  // Override colors for resolved states
  const finalBg = isResolved ? C.neutral[50] : bg;
  const finalBdr = isResolved ? C.neutral[200] : bdr;
  const finalTxt = isResolved ? C.neutral[400] : txt;
  const finalBorderColor = isResolved ? C.success[400] : txt;
  
  return (
    <div 
      onClick={onClick}
      style={{ 
        display: 'flex',
        alignItems: 'flex-start',
        gap: sp.sm,
        padding: sp.sm,
        background: finalBg, 
        borderLeft: `3px solid ${finalBorderColor}`,
        borderRadius: '0 6px 6px 0',
        marginTop: sp.sm,
        cursor: onClick ? 'pointer' : 'default',
        transition: 'all 0.15s',
        opacity: isResolved ? 0.7 : 1
      }}
      onMouseEnter={(e) => { if (onClick) { e.currentTarget.style.background = finalBdr; }}}
      onMouseLeave={(e) => { e.currentTarget.style.background = finalBg; }}
    >
      <Icon style={{ width: 14, height: 14, color: finalTxt, flexShrink: 0, marginTop: 2 }} />
      <div style={{ flex: 1, minWidth: 0 }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: sp.sm }}>
          <span style={{ 
            fontSize: '13px', 
            fontWeight: 500, 
            color: finalTxt,
            textDecoration: isResolved ? 'line-through' : 'none'
          }}>{title}</span>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, flexShrink: 0 }}>
            <span style={{ fontSize: '11px', color: finalTxt, opacity: 0.7 }}>{time}</span>
            {stateBadge && (
              <span style={{ 
                fontSize: '10px', 
                fontWeight: 600, 
                padding: '2px 6px', 
                background: stateBadge.bg, 
                color: stateBadge.color, 
                borderRadius: 3 
              }}>
                {stateBadge.label}
              </span>
            )}
          </div>
        </div>
        <p style={{ 
          fontSize: '11px', 
          color: finalTxt, 
          opacity: 0.85, 
          marginTop: 2,
          textDecoration: isResolved ? 'line-through' : 'none'
        }}>{msg}</p>
        {conf && <p style={{ fontSize: '10px', color: finalTxt, opacity: 0.6, marginTop: 2 }}>Confidence: {conf}%</p>}
      </div>
      {onClick && <ChevronRight style={{ width: 14, height: 14, color: finalTxt, opacity: 0.5, alignSelf: 'center', flexShrink: 0 }} />}
    </div>
  );
};

// ===== CONTRIBUTING FACTORS MODAL =====
// Draggable modal showing what's driving a metric
const ContributingFactorsModal = ({ isOpen, onClose, title, data }) => {
  const [position, setPosition] = useState({ x: 100, y: 100 });
  const [isDragging, setIsDragging] = useState(false);
  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
  const [showCalculation, setShowCalculation] = useState(false);
  
  if (!isOpen || !data) return null;
  
  const handleMouseDown = (e) => {
    if (e.target.closest('.modal-drag-handle')) {
      setIsDragging(true);
      setDragOffset({
        x: e.clientX - position.x,
        y: e.clientY - position.y
      });
    }
  };
  
  const handleMouseMove = (e) => {
    if (isDragging) {
      setPosition({
        x: e.clientX - dragOffset.x,
        y: e.clientY - dragOffset.y
      });
    }
  };
  
  const handleMouseUp = () => {
    setIsDragging(false);
  };
  
  // Calculate max weight for scaling bars
  const maxWeight = Math.max(...(data.contributors || []).map(c => c.weight));
  
  return (
    <div 
      onMouseMove={handleMouseMove}
      onMouseUp={handleMouseUp}
      onMouseLeave={handleMouseUp}
      style={{ position: 'fixed', inset: 0, zIndex: 1000, pointerEvents: 'none' }}
    >
      <div
        onMouseDown={handleMouseDown}
        style={{
          position: 'absolute',
          left: position.x,
          top: position.y,
          width: 420,
          background: 'white',
          borderRadius: 12,
          boxShadow: '0 8px 32px rgba(0,0,0,0.15), 0 2px 8px rgba(0,0,0,0.1)',
          border: `1px solid ${C.neutral[200]}`,
          pointerEvents: 'auto',
          overflow: 'hidden'
        }}
      >
        {/* Draggable Header */}
        <div 
          className="modal-drag-handle"
          style={{ 
            display: 'flex', 
            justifyContent: 'space-between', 
            alignItems: 'center',
            padding: `${sp.sm} ${sp.md}`,
            background: C.neutral[50],
            borderBottom: `1px solid ${C.neutral[200]}`,
            cursor: isDragging ? 'grabbing' : 'grab'
          }}
        >
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <GripVertical style={{ width: 16, height: 16, color: C.neutral[400] }} />
            <span style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[800] }}>
              Contributing Factors: {title}
            </span>
          </div>
          <button
            onClick={onClose}
            style={{
              width: 28, height: 28,
              display: 'flex', alignItems: 'center', justifyContent: 'center',
              background: 'transparent',
              border: 'none',
              borderRadius: 4,
              cursor: 'pointer'
            }}
            onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[200]}
            onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
          >
            <X style={{ width: 16, height: 16, color: C.neutral[600] }} />
          </button>
        </div>
        
        {/* Content */}
        <div style={{ padding: sp.md, maxHeight: 500, overflowY: 'auto' }}>
          {/* What's Happening */}
          <div style={{ marginBottom: sp.md }}>
            <h4 style={{ fontSize: '11px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: sp.xs }}>
              What's Happening
            </h4>
            <p style={{ fontSize: '14px', color: C.neutral[800], lineHeight: 1.5 }}>
              {data.whatsHappening}
            </p>
          </div>
          
          {/* Why It's Important */}
          <div style={{ marginBottom: sp.md, padding: sp.sm, background: C.brand[50], borderRadius: 6, borderLeft: `3px solid ${C.brand[500]}` }}>
            <h4 style={{ fontSize: '11px', fontWeight: 600, color: C.brand[700], textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: sp.xs }}>
              Why It's Important
            </h4>
            <p style={{ fontSize: '13px', color: C.brand[800], lineHeight: 1.5 }}>
              {data.whyImportant}
            </p>
          </div>
          
          {/* Key Contributors */}
          <div style={{ marginBottom: sp.md }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
              <h4 style={{ fontSize: '11px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', letterSpacing: '0.5px', margin: 0 }}>
                {data.contributorsLabel || 'Key Contributors'}
              </h4>
              <span style={{ fontSize: '10px', color: C.neutral[400] }}>
                ↑ positive impact · ↓ negative impact · → neutral
              </span>
            </div>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {(data.contributors || []).map((contributor, i) => (
                <div 
                  key={i}
                  onClick={contributor.onClick}
                  style={{ 
                    display: 'flex', 
                    alignItems: 'center', 
                    gap: sp.sm,
                    padding: sp.sm,
                    background: C.neutral[50],
                    borderRadius: 6,
                    cursor: contributor.onClick ? 'pointer' : 'default',
                    transition: 'all 0.15s'
                  }}
                  onMouseEnter={(e) => { if (contributor.onClick) e.currentTarget.style.background = C.neutral[100]; }}
                  onMouseLeave={(e) => e.currentTarget.style.background = C.neutral[50]}
                >
                  {/* Weight bar */}
                  <div style={{ width: 80, height: 8, background: C.neutral[200], borderRadius: 4, overflow: 'hidden', flexShrink: 0 }}>
                    <div style={{ 
                      height: '100%', 
                      width: `${(contributor.weight / maxWeight) * 100}%`,
                      background: contributor.direction === 'up' ? C.success[500] : contributor.direction === 'down' ? C.error[500] : C.brand[500],
                      borderRadius: 4
                    }} />
                  </div>
                  
                  {/* Label and detail */}
                  <div style={{ flex: 1 }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                      <span style={{ fontSize: '13px', fontWeight: 500, color: C.neutral[800] }}>{contributor.label}</span>
                      {contributor.direction === 'up' && <ArrowUpRight style={{ width: 14, height: 14, color: C.success[600] }} />}
                      {contributor.direction === 'down' && <ArrowDownRight style={{ width: 14, height: 14, color: C.error[600] }} />}
                      {contributor.direction === 'neutral' && <Minus style={{ width: 14, height: 14, color: C.neutral[500] }} />}
                    </div>
                    {contributor.detail && (
                      <p style={{ fontSize: '11px', color: C.neutral[500], marginTop: 2 }}>{contributor.detail}</p>
                    )}
                  </div>
                  
                  {/* Weight percentage */}
                  <span style={{ fontSize: '14px', fontWeight: 600, color: C.neutral[700], minWidth: 40, textAlign: 'right' }}>
                    {contributor.weight}%
                  </span>
                  
                  {/* Navigate chevron */}
                  {contributor.onClick && (
                    <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
                  )}
                </div>
              ))}
            </div>
          </div>
          
          {/* How It's Calculated - Accordion */}
          <div style={{ borderTop: `1px solid ${C.neutral[200]}`, paddingTop: sp.md }}>
            <button
              onClick={() => setShowCalculation(!showCalculation)}
              style={{
                display: 'flex',
                alignItems: 'center',
                gap: sp.sm,
                width: '100%',
                padding: sp.sm,
                background: 'transparent',
                border: 'none',
                borderRadius: 6,
                cursor: 'pointer',
                textAlign: 'left'
              }}
              onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[50]}
              onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
            >
              <ChevronRight style={{ 
                width: 16, height: 16, 
                color: C.neutral[500],
                transform: showCalculation ? 'rotate(90deg)' : 'rotate(0deg)',
                transition: 'transform 0.2s'
              }} />
              <span style={{ fontSize: '13px', fontWeight: 500, color: C.neutral[600] }}>How It's Calculated</span>
            </button>
            
            {showCalculation && (
              <div style={{ padding: sp.sm, marginTop: sp.xs, background: C.neutral[50], borderRadius: 6 }}>
                {/* Formula */}
                {data.calculation?.formula && (
                  <div style={{ marginBottom: sp.sm }}>
                    <p style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', marginBottom: 4 }}>Formula</p>
                    <code style={{ fontSize: '12px', color: C.purple[700], background: C.purple[50], padding: '4px 8px', borderRadius: 4, display: 'block' }}>
                      {data.calculation.formula}
                    </code>
                  </div>
                )}
                
                {/* Data Sources */}
                {data.calculation?.dataSources && (
                  <div style={{ marginBottom: sp.sm }}>
                    <p style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', marginBottom: 4 }}>Data Sources</p>
                    <p style={{ fontSize: '12px', color: C.neutral[700] }}>{data.calculation.dataSources.join(', ')}</p>
                  </div>
                )}
                
                {/* Refresh Rate & Confidence */}
                <div style={{ display: 'flex', gap: sp.md }}>
                  {data.calculation?.refreshRate && (
                    <div>
                      <p style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', marginBottom: 4 }}>Refresh Rate</p>
                      <p style={{ fontSize: '12px', color: C.neutral[700] }}>{data.calculation.refreshRate}</p>
                    </div>
                  )}
                  {data.calculation?.confidence && (
                    <div>
                      <p style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', marginBottom: 4 }}>Confidence</p>
                      <p style={{ fontSize: '12px', color: C.neutral[700] }}>{data.calculation.confidence}%</p>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>
        
        {/* Footer CTAs */}
        <div style={{ 
          display: 'flex', 
          gap: sp.sm, 
          padding: sp.md, 
          borderTop: `1px solid ${C.neutral[200]}`,
          background: C.neutral[50]
        }}>
          {(data.actions || []).map((action, i) => (
            <button
              key={i}
              onClick={action.onClick}
              style={{
                flex: 1,
                padding: `${sp.sm} ${sp.md}`,
                fontSize: '12px',
                fontWeight: 500,
                background: i === 0 ? C.brand[500] : 'white',
                color: i === 0 ? 'white' : C.neutral[700],
                border: i === 0 ? 'none' : `1px solid ${C.neutral[300]}`,
                borderRadius: 6,
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                gap: sp.xs
              }}
            >
              {action.label}
              <ChevronRight style={{ width: 14, height: 14 }} />
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};

// ===== TASK CREATION MODAL =====
// Modal for creating tasks from action cards
const TaskCreationModal = ({ isOpen, onClose, action }) => {
  const [assignee, setAssignee] = useState('');
  const [dueTime, setDueTime] = useState('');
  const [notes, setNotes] = useState('');
  const [priority, setPriority] = useState('high');
  
  // Icon mapping
  const iconMap = {
    userPlus: <UserPlus style={{ width: 14, height: 14, color: C.brand[600] }} />,
    refresh: <RefreshCw style={{ width: 14, height: 14, color: C.brand[600] }} />,
    grid: <Grid3X3 style={{ width: 14, height: 14, color: C.brand[600] }} />
  };
  
  // Sample assignees based on role
  const assigneeOptions = {
    'Shift Lead': [
      { id: 'mike', name: 'Mike Chen', role: 'Day Shift Lead' },
      { id: 'sarah', name: 'Sarah Kim', role: 'Day Shift Lead' }
    ],
    'Zone Manager': [
      { id: 'james', name: 'James Liu', role: 'Zone Manager - Bulk' },
      { id: 'maria', name: 'Maria Garcia', role: 'Zone Manager - Pick' }
    ],
    'Ops Manager': [
      { id: 'david', name: 'David Park', role: 'Operations Manager' }
    ]
  };
  
  // Early return AFTER all hooks
  if (!isOpen || !action) return null;
  
  const ActionIcon = iconMap[action.iconType] || <ClipboardList style={{ width: 14, height: 14, color: C.brand[600] }} />;
  const availableAssignees = assigneeOptions[action.role] || [];
  
  const handleCreate = () => {
    // TODO: Create task and add to plan
    console.log('Creating task:', { action, assignee, dueTime, notes, priority });
    onClose();
  };
  
  return (
    <div style={{ 
      position: 'fixed', 
      inset: 0, 
      zIndex: 1000, 
      display: 'flex', 
      alignItems: 'center', 
      justifyContent: 'center',
      background: 'rgba(0,0,0,0.4)'
    }}>
      <div style={{
        width: 480,
        background: 'white',
        borderRadius: 12,
        boxShadow: '0 8px 32px rgba(0,0,0,0.2)',
        overflow: 'hidden'
      }}>
        {/* Header */}
        <div style={{ 
          display: 'flex', 
          justifyContent: 'space-between', 
          alignItems: 'center',
          padding: sp.md,
          background: C.neutral[50],
          borderBottom: `1px solid ${C.neutral[200]}`
        }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <div style={{ 
              width: 32, height: 32, borderRadius: 8, 
              background: C.brand[100],
              display: 'flex', alignItems: 'center', justifyContent: 'center'
            }}>
              <ClipboardList style={{ width: 18, height: 18, color: C.brand[600] }} />
            </div>
            <span style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800] }}>Create Task</span>
          </div>
          <button
            onClick={onClose}
            style={{
              width: 32, height: 32,
              display: 'flex', alignItems: 'center', justifyContent: 'center',
              background: 'transparent',
              border: 'none',
              borderRadius: 6,
              cursor: 'pointer'
            }}
            onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[200]}
            onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
          >
            <X style={{ width: 18, height: 18, color: C.neutral[600] }} />
          </button>
        </div>
        
        {/* Content */}
        <div style={{ padding: sp.md }}>
          {/* Action Summary */}
          <div style={{ 
            background: C.neutral[50], 
            borderRadius: 8, 
            padding: sp.md, 
            marginBottom: sp.md,
            border: `1px solid ${C.neutral[200]}`
          }}>
            <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.sm }}>
              <div style={{ 
                width: 28, height: 28, borderRadius: 6, 
                background: C.brand[100],
                display: 'flex', alignItems: 'center', justifyContent: 'center',
                flexShrink: 0
              }}>
                {ActionIcon}
              </div>
              <div>
                <p style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[800], margin: 0 }}>{action.title}</p>
                <p style={{ fontSize: '12px', color: C.neutral[500], margin: 0, marginTop: 2 }}>{action.description}</p>
              </div>
            </div>
            <div style={{ marginTop: sp.sm, paddingTop: sp.sm, borderTop: `1px solid ${C.neutral[200]}` }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                <ArrowRight style={{ width: 12, height: 12, color: C.success[500] }} />
                <span style={{ fontSize: '12px', color: C.success[700] }}>{action.result}</span>
              </div>
            </div>
          </div>
          
          {/* Form Fields */}
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.md }}>
            {/* Assignee */}
            <div>
              <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                Assign To
              </label>
              <select
                value={assignee}
                onChange={(e) => setAssignee(e.target.value)}
                style={{
                  width: '100%',
                  padding: sp.sm,
                  fontSize: '14px',
                  border: `1px solid ${C.neutral[300]}`,
                  borderRadius: 6,
                  background: 'white',
                  cursor: 'pointer'
                }}
              >
                <option value="">Select {action.role}...</option>
                {availableAssignees.map(a => (
                  <option key={a.id} value={a.id}>{a.name} - {a.role}</option>
                ))}
              </select>
            </div>
            
            {/* Due Time */}
            <div>
              <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                Due By
              </label>
              <div style={{ display: 'flex', gap: sp.sm }}>
                {['11:00', '11:30', '12:00', '12:30', '13:00'].map(time => (
                  <button
                    key={time}
                    onClick={() => setDueTime(time)}
                    style={{
                      flex: 1,
                      padding: sp.sm,
                      fontSize: '13px',
                      fontWeight: dueTime === time ? 500 : 400,
                      background: dueTime === time ? C.brand[500] : 'white',
                      color: dueTime === time ? 'white' : C.neutral[700],
                      border: `1px solid ${dueTime === time ? C.brand[500] : C.neutral[300]}`,
                      borderRadius: 6,
                      cursor: 'pointer',
                      transition: 'all 0.15s'
                    }}
                  >
                    {time}
                  </button>
                ))}
              </div>
            </div>
            
            {/* Priority */}
            <div>
              <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                Priority
              </label>
              <div style={{ display: 'flex', gap: sp.sm }}>
                {[
                  { value: 'critical', label: 'Critical', color: C.error },
                  { value: 'high', label: 'High', color: C.warning },
                  { value: 'normal', label: 'Normal', color: C.brand }
                ].map(p => (
                  <button
                    key={p.value}
                    onClick={() => setPriority(p.value)}
                    style={{
                      flex: 1,
                      padding: sp.sm,
                      fontSize: '13px',
                      fontWeight: priority === p.value ? 500 : 400,
                      background: priority === p.value ? p.color[50] : 'white',
                      color: priority === p.value ? p.color[700] : C.neutral[700],
                      border: `1px solid ${priority === p.value ? p.color[300] : C.neutral[300]}`,
                      borderRadius: 6,
                      cursor: 'pointer',
                      transition: 'all 0.15s'
                    }}
                  >
                    {p.label}
                  </button>
                ))}
              </div>
            </div>
            
            {/* Notes */}
            <div>
              <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                Notes (optional)
              </label>
              <textarea
                value={notes}
                onChange={(e) => setNotes(e.target.value)}
                placeholder="Add any additional context..."
                style={{
                  width: '100%',
                  padding: sp.sm,
                  fontSize: '14px',
                  border: `1px solid ${C.neutral[300]}`,
                  borderRadius: 6,
                  resize: 'vertical',
                  minHeight: 60,
                  fontFamily: 'inherit'
                }}
              />
            </div>
          </div>
        </div>
        
        {/* Footer */}
        <div style={{ 
          display: 'flex', 
          justifyContent: 'space-between',
          alignItems: 'center',
          padding: sp.md,
          borderTop: `1px solid ${C.neutral[200]}`,
          background: C.neutral[50]
        }}>
          <button
            onClick={onClose}
            style={{
              padding: `${sp.sm} ${sp.md}`,
              fontSize: '13px',
              fontWeight: 500,
              background: 'white',
              color: C.neutral[700],
              border: `1px solid ${C.neutral[300]}`,
              borderRadius: 6,
              cursor: 'pointer'
            }}
          >
            Cancel
          </button>
          <button
            onClick={handleCreate}
            disabled={!assignee || !dueTime}
            style={{
              padding: `${sp.sm} ${sp.lg}`,
              fontSize: '13px',
              fontWeight: 500,
              background: (!assignee || !dueTime) ? C.neutral[200] : C.brand[500],
              color: (!assignee || !dueTime) ? C.neutral[500] : 'white',
              border: 'none',
              borderRadius: 6,
              cursor: (!assignee || !dueTime) ? 'not-allowed' : 'pointer',
              display: 'flex',
              alignItems: 'center',
              gap: sp.xs
            }}
          >
            Create Task
            <ChevronRight style={{ width: 14, height: 14 }} />
          </button>
        </div>
      </div>
    </div>
  );
};

// ===== EXECUTE LIVE PLAN MODAL =====
// Modal for executing selected actions as a live plan
const ExecuteLivePlanModal = ({ isOpen, onClose, selectedActions, suggestedActions, onExecute }) => {
  const [planName, setPlanName] = useState('Peak Hour Staffing Rebalance');
  const [targetCompletion, setTargetCompletion] = useState('12:30');
  const [shiftContext, setShiftContext] = useState('day');
  const [priority, setPriority] = useState('high');
  const [activeSection, setActiveSection] = useState('tasks'); // 'tasks', 'criteria', 'advanced'
  const [showAdvanced, setShowAdvanced] = useState(false);
  
  // Dragging state
  const [position, setPosition] = useState({ x: 200, y: 50 });
  const [isDragging, setIsDragging] = useState(false);
  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
  
  // Task-specific state
  const [taskRoles, setTaskRoles] = useState({});
  const [taskAssignments, setTaskAssignments] = useState({});
  const [taskDueTimes, setTaskDueTimes] = useState({});
  const [taskDurations, setTaskDurations] = useState({});
  const [taskNotes, setTaskNotes] = useState({});
  
  // Success criteria
  const [successCriteria, setSuccessCriteria] = useState([
    { id: 'c1', text: 'Picking throughput reaches 850 orders/hr by 12:00', checked: true },
    { id: 'c2', text: 'Z02/Z04 backlog cleared', checked: true },
  ]);
  const [newCriterion, setNewCriterion] = useState('');
  
  // Advanced options
  const [notifications, setNotifications] = useState({ slack: true, email: false });
  const [escalationPath, setEscalationPath] = useState('shift-lead');
  const [handoffNotes, setHandoffNotes] = useState('');
  
  // Rollback configuration
  const [rollbackEnabled, setRollbackEnabled] = useState(true);
  const [rollbackTrigger, setRollbackTrigger] = useState('auto');
  
  // Approval detection
  const requiresApproval = selectedActions.some(id => {
    const action = suggestedActions.find(a => a.id === id);
    return action?.cost?.includes('$') && parseInt(action?.cost?.match(/\d+/)?.[0] || 0) > 300;
  });
  
  // Available roles
  const availableRoles = ['Shift Lead', 'Zone Manager', 'Ops Manager', 'Team Lead', 'Picker', 'Receiver'];
  
  // Available assignees
  const assigneesByRole = {
    'Shift Lead': [
      { id: 'mike', name: 'Mike Chen', utilization: 65 },
      { id: 'sarah', name: 'Sarah Kim', utilization: 45 }
    ],
    'Zone Manager': [
      { id: 'james', name: 'James Liu', utilization: 70 },
      { id: 'maria', name: 'Maria Garcia', utilization: 55 }
    ],
    'Ops Manager': [
      { id: 'david', name: 'David Park', utilization: 80 }
    ],
    'Team Lead': [
      { id: 'tom', name: 'Tom Wilson', utilization: 50 },
      { id: 'lisa', name: 'Lisa Park', utilization: 60 }
    ],
    'Picker': [
      { id: 'john', name: 'John Smith', utilization: 75 },
      { id: 'amy', name: 'Amy Lee', utilization: 40 }
    ],
    'Receiver': [
      { id: 'bob', name: 'Bob Johnson', utilization: 55 },
      { id: 'carol', name: 'Carol White', utilization: 65 }
    ]
  };
  
  // Drag handlers
  const handleMouseDown = (e) => {
    if (e.target.closest('.modal-drag-handle')) {
      setIsDragging(true);
      setDragOffset({
        x: e.clientX - position.x,
        y: e.clientY - position.y
      });
    }
  };
  
  const handleMouseMove = (e) => {
    if (isDragging) {
      setPosition({
        x: e.clientX - dragOffset.x,
        y: e.clientY - dragOffset.y
      });
    }
  };
  
  const handleMouseUp = () => {
    setIsDragging(false);
  };
  
  // Initialize task assignments on open
  React.useEffect(() => {
    if (isOpen && selectedActions.length > 0) {
      const initialRoles = {};
      const initialAssignments = {};
      const initialDueTimes = {};
      const initialDurations = {};
      selectedActions.forEach((actionId, idx) => {
        const action = suggestedActions.find(a => a.id === actionId);
        if (action) {
          initialRoles[actionId] = action.role;
          const assignees = assigneesByRole[action.role] || [];
          initialAssignments[actionId] = assignees[0]?.id || '';
          initialDurations[actionId] = '15';
          // Stagger due times by 15 min increments
          const baseTime = 11;
          const minutes = (idx * 15) % 60;
          const hours = baseTime + Math.floor((idx * 15) / 60);
          initialDueTimes[actionId] = `${hours}:${minutes.toString().padStart(2, '0')}`;
        }
      });
      setTaskRoles(initialRoles);
      setTaskAssignments(initialAssignments);
      setTaskDueTimes(initialDueTimes);
      setTaskDurations(initialDurations);
    }
  }, [isOpen, selectedActions]);
  
  // Update assignee when role changes
  const handleRoleChange = (actionId, newRole) => {
    setTaskRoles({ ...taskRoles, [actionId]: newRole });
    const assignees = assigneesByRole[newRole] || [];
    setTaskAssignments({ ...taskAssignments, [actionId]: assignees[0]?.id || '' });
  };
  
  if (!isOpen) return null;
  
  const selectedActionDetails = selectedActions.map(id => suggestedActions.find(a => a.id === id)).filter(Boolean);
  
  const addCriterion = () => {
    if (newCriterion.trim()) {
      setSuccessCriteria([...successCriteria, { id: `c${Date.now()}`, text: newCriterion, checked: false }]);
      setNewCriterion('');
    }
  };
  
  const toggleCriterion = (id) => {
    setSuccessCriteria(successCriteria.map(c => c.id === id ? { ...c, checked: !c.checked } : c));
  };
  
  const handleExecute = () => {
    const planData = {
      name: planName,
      targetCompletion,
      shiftContext,
      priority,
      tasks: selectedActionDetails.map(action => ({
        ...action,
        role: taskRoles[action.id],
        assignee: taskAssignments[action.id],
        dueTime: taskDueTimes[action.id],
        duration: taskDurations[action.id],
        notes: taskNotes[action.id]
      })),
      successCriteria: successCriteria.filter(c => c.checked),
      notifications,
      escalationPath,
      handoffNotes,
      rollback: { enabled: rollbackEnabled, trigger: rollbackTrigger }
    };
    console.log('Executing plan:', planData);
    onExecute?.(planData);
    onClose();
  };
  
  return (
    <div 
      onMouseMove={handleMouseMove}
      onMouseUp={handleMouseUp}
      onMouseLeave={handleMouseUp}
      style={{ 
        position: 'fixed', 
        inset: 0, 
        zIndex: 1000, 
        pointerEvents: 'none'
      }}
    >
      <div 
        onMouseDown={handleMouseDown}
        style={{
          position: 'absolute',
          left: position.x,
          top: position.y,
          width: 640,
          maxHeight: 'calc(100vh - 100px)',
          background: 'white',
          borderRadius: 12,
          boxShadow: '0 8px 32px rgba(0,0,0,0.15), 0 2px 8px rgba(0,0,0,0.1)',
          border: `1px solid ${C.neutral[200]}`,
          display: 'flex',
          flexDirection: 'column',
          overflow: 'hidden',
          pointerEvents: 'auto'
        }}
      >
        {/* Draggable Header */}
        <div 
          className="modal-drag-handle"
          style={{ 
            display: 'flex', 
            justifyContent: 'space-between', 
            alignItems: 'center',
            padding: sp.md,
            background: C.neutral[50],
            borderBottom: `1px solid ${C.neutral[200]}`,
            cursor: isDragging ? 'grabbing' : 'grab'
          }}
        >
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <GripVertical style={{ width: 16, height: 16, color: C.neutral[400] }} />
            <div style={{ 
              width: 36, height: 36, borderRadius: 8, 
              background: C.success[100],
              display: 'flex', alignItems: 'center', justifyContent: 'center'
            }}>
              <Zap style={{ width: 20, height: 20, color: C.success[600] }} />
            </div>
            <div>
              <span style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], display: 'block' }}>Execute as Live Plan</span>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>{selectedActions.length} actions selected</span>
            </div>
          </div>
          <button
            onClick={(e) => { e.stopPropagation(); onClose(); }}
            style={{
              width: 32, height: 32,
              display: 'flex', alignItems: 'center', justifyContent: 'center',
              background: 'transparent',
              border: 'none',
              borderRadius: 6,
              cursor: 'pointer'
            }}
            onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[200]}
            onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
          >
            <X style={{ width: 18, height: 18, color: C.neutral[600] }} />
          </button>
        </div>
        
        {/* Scrollable Content */}
        <div style={{ flex: 1, overflowY: 'auto', padding: sp.md }}>
          {/* Approval Warning */}
          {requiresApproval && (
            <div style={{ 
              background: C.warning[50], 
              border: `1px solid ${C.warning[200]}`,
              borderRadius: 8, 
              padding: sp.md, 
              marginBottom: sp.md,
              display: 'flex',
              alignItems: 'flex-start',
              gap: sp.sm
            }}>
              <AlertTriangle style={{ width: 18, height: 18, color: C.warning[600], flexShrink: 0, marginTop: 2 }} />
              <div>
                <p style={{ fontSize: '13px', fontWeight: 500, color: C.warning[800], margin: 0, marginBottom: 4 }}>
                  This plan requires approval
                </p>
                <p style={{ fontSize: '12px', color: C.warning[700], margin: 0 }}>
                  Budget impact exceeds your $300 threshold. Plan will be submitted to Sarah Kim (Shift Lead) for approval.
                </p>
              </div>
            </div>
          )}
          
          {/* Plan Details */}
          <div style={{ marginBottom: sp.md }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], margin: 0, marginBottom: sp.md }}>Plan Details</h3>
            
            <div style={{ marginBottom: sp.md }}>
              <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                Plan Name
              </label>
              <input
                type="text"
                value={planName}
                onChange={(e) => setPlanName(e.target.value)}
                style={{
                  width: '100%',
                  padding: sp.sm,
                  fontSize: '14px',
                  border: `1px solid ${C.neutral[300]}`,
                  borderRadius: 6,
                  boxSizing: 'border-box'
                }}
              />
            </div>
            
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm }}>
              <div>
                <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                  Target Completion
                </label>
                <select
                  value={targetCompletion}
                  onChange={(e) => setTargetCompletion(e.target.value)}
                  style={{
                    width: '100%',
                    padding: sp.sm,
                    fontSize: '13px',
                    border: `1px solid ${C.neutral[300]}`,
                    borderRadius: 6,
                    background: 'white',
                    cursor: 'pointer'
                  }}
                >
                  <option value="11:30">11:30</option>
                  <option value="12:00">12:00</option>
                  <option value="12:30">12:30</option>
                  <option value="13:00">13:00</option>
                  <option value="14:00">14:00</option>
                  <option value="15:00">15:00</option>
                </select>
              </div>
              
              <div>
                <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                  Shift Context
                </label>
                <select
                  value={shiftContext}
                  onChange={(e) => setShiftContext(e.target.value)}
                  style={{
                    width: '100%',
                    padding: sp.sm,
                    fontSize: '13px',
                    border: `1px solid ${C.neutral[300]}`,
                    borderRadius: 6,
                    background: 'white',
                    cursor: 'pointer'
                  }}
                >
                  <option value="day">Day Shift</option>
                  <option value="swing">Swing Shift</option>
                  <option value="night">Night Shift</option>
                </select>
              </div>
              
              <div>
                <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                  Priority
                </label>
                <select
                  value={priority}
                  onChange={(e) => setPriority(e.target.value)}
                  style={{
                    width: '100%',
                    padding: sp.sm,
                    fontSize: '13px',
                    border: `1px solid ${C.neutral[300]}`,
                    borderRadius: 6,
                    background: 'white',
                    cursor: 'pointer'
                  }}
                >
                  <option value="critical">● Critical</option>
                  <option value="high">● High</option>
                  <option value="normal">● Normal</option>
                  <option value="low">● Low</option>
                </select>
              </div>
            </div>
          </div>
          
          {/* Divider */}
          <div style={{ borderTop: `1px solid ${C.neutral[200]}`, margin: `${sp.md} 0` }} />
          
          {/* Tasks Section */}
          <div style={{ marginBottom: sp.md }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], margin: 0 }}>
                Tasks
                <span style={{ fontSize: '14px', fontWeight: 400, color: C.neutral[500], marginLeft: sp.sm }}>
                  ({selectedActionDetails.length})
                </span>
              </h3>
            </div>
            
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {selectedActionDetails.map((action, idx) => {
                const IconComponent = action.iconType === 'userPlus' ? UserPlus : action.iconType === 'refresh' ? RefreshCw : Grid3X3;
                const currentRole = taskRoles[action.id] || action.role;
                const availableAssignees = assigneesByRole[currentRole] || [];
                const selectedAssignee = availableAssignees.find(a => a.id === taskAssignments[action.id]);
                
                return (
                  <div 
                    key={action.id}
                    style={{ 
                      background: C.neutral[50],
                      border: `1px solid ${C.neutral[200]}`,
                      borderRadius: 8,
                      padding: sp.md
                    }}
                  >
                    <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.sm, marginBottom: sp.sm }}>
                      <div style={{ 
                        width: 24, height: 24, 
                        background: C.neutral[200], 
                        borderRadius: '50%',
                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                        fontSize: '12px', fontWeight: 600, color: C.neutral[600],
                        flexShrink: 0
                      }}>
                        {idx + 1}
                      </div>
                      <div style={{ flex: 1 }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 4 }}>
                          <IconComponent style={{ width: 14, height: 14, color: C.brand[600] }} />
                          <span style={{ fontSize: '13px', fontWeight: 500, color: C.neutral[800] }}>{action.title}</span>
                        </div>
                        {action.tradeoff && (
                          <p style={{ fontSize: '11px', color: C.warning[600], margin: 0, display: 'flex', alignItems: 'center', gap: 4 }}>
                            <AlertTriangle style={{ width: 12, height: 12 }} />
                            Trade-off: {action.tradeoff}
                          </p>
                        )}
                      </div>
                    </div>
                    
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm, marginLeft: 36 }}>
                      {/* Role Dropdown */}
                      <div>
                        <label style={{ fontSize: '10px', fontWeight: 500, color: C.neutral[500], display: 'block', marginBottom: 4 }}>
                          Role
                        </label>
                        <select
                          value={currentRole}
                          onChange={(e) => handleRoleChange(action.id, e.target.value)}
                          style={{
                            width: '100%',
                            padding: '6px 8px',
                            fontSize: '12px',
                            border: `1px solid ${C.neutral[300]}`,
                            borderRadius: 4,
                            background: 'white',
                            cursor: 'pointer'
                          }}
                        >
                          {availableRoles.map(role => (
                            <option key={role} value={role}>{role}</option>
                          ))}
                        </select>
                      </div>
                      
                      {/* Assignee Dropdown */}
                      <div>
                        <label style={{ fontSize: '10px', fontWeight: 500, color: C.neutral[500], display: 'block', marginBottom: 4 }}>
                          Assignee
                        </label>
                        <select
                          value={taskAssignments[action.id] || ''}
                          onChange={(e) => setTaskAssignments({ ...taskAssignments, [action.id]: e.target.value })}
                          style={{
                            width: '100%',
                            padding: '6px 8px',
                            fontSize: '12px',
                            border: `1px solid ${C.neutral[300]}`,
                            borderRadius: 4,
                            background: 'white',
                            cursor: 'pointer'
                          }}
                        >
                          {availableAssignees.length > 0 ? (
                            availableAssignees.map(a => (
                              <option key={a.id} value={a.id}>{a.name}</option>
                            ))
                          ) : (
                            <option value="">No assignees</option>
                          )}
                        </select>
                        {selectedAssignee && (
                          <div style={{ fontSize: '10px', color: C.neutral[500], marginTop: 2 }}>
                            {selectedAssignee.utilization}% utilized
                          </div>
                        )}
                      </div>
                      
                      {/* Due By */}
                      <div>
                        <label style={{ fontSize: '10px', fontWeight: 500, color: C.neutral[500], display: 'block', marginBottom: 4 }}>
                          Due By
                        </label>
                        <select
                          value={taskDueTimes[action.id] || ''}
                          onChange={(e) => setTaskDueTimes({ ...taskDueTimes, [action.id]: e.target.value })}
                          style={{
                            width: '100%',
                            padding: '6px 8px',
                            fontSize: '12px',
                            border: `1px solid ${C.neutral[300]}`,
                            borderRadius: 4,
                            background: 'white',
                            cursor: 'pointer'
                          }}
                        >
                          {['10:30', '10:45', '11:00', '11:15', '11:30', '11:45', '12:00', '12:30', '13:00'].map(t => (
                            <option key={t} value={t}>{t}</option>
                          ))}
                        </select>
                      </div>
                      
                      {/* Editable Duration */}
                      <div>
                        <label style={{ fontSize: '10px', fontWeight: 500, color: C.neutral[500], display: 'block', marginBottom: 4 }}>
                          Est. Duration
                        </label>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                          <input
                            type="number"
                            min="5"
                            max="120"
                            step="5"
                            value={taskDurations[action.id] || '15'}
                            onChange={(e) => setTaskDurations({ ...taskDurations, [action.id]: e.target.value })}
                            style={{
                              width: '100%',
                              padding: '6px 8px',
                              fontSize: '12px',
                              border: `1px solid ${C.neutral[300]}`,
                              borderRadius: 4,
                              background: 'white',
                              boxSizing: 'border-box'
                            }}
                          />
                          <span style={{ fontSize: '11px', color: C.neutral[500], flexShrink: 0 }}>min</span>
                        </div>
                      </div>
                    </div>
                    
                    <div style={{ marginTop: sp.sm, marginLeft: 36 }}>
                      <input
                        type="text"
                        placeholder="Add notes (optional)..."
                        value={taskNotes[action.id] || ''}
                        onChange={(e) => setTaskNotes({ ...taskNotes, [action.id]: e.target.value })}
                        style={{
                          width: '100%',
                          padding: '6px 8px',
                          fontSize: '12px',
                          border: `1px solid ${C.neutral[200]}`,
                          borderRadius: 4,
                          boxSizing: 'border-box'
                        }}
                      />
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
          
          {/* Divider */}
          <div style={{ borderTop: `1px solid ${C.neutral[200]}`, margin: `${sp.md} 0` }} />
          
          {/* Success Criteria */}
          <div style={{ marginBottom: sp.md }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], margin: 0, marginBottom: sp.md }}>
              Success Criteria
              <span style={{ fontSize: '14px', fontWeight: 400, color: C.neutral[500], marginLeft: sp.sm }}>
                — By {targetCompletion} EST
              </span>
            </h3>
            <div style={{ 
              background: C.neutral[50], 
              border: `1px solid ${C.neutral[200]}`,
              borderRadius: 8,
              padding: sp.sm
            }}>
              {successCriteria.map(criterion => (
                <div 
                  key={criterion.id}
                  onClick={() => toggleCriterion(criterion.id)}
                  style={{ 
                    display: 'flex', 
                    alignItems: 'center', 
                    gap: sp.sm, 
                    padding: sp.xs,
                    cursor: 'pointer',
                    borderRadius: 4
                  }}
                  onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[100]}
                  onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                >
                  <div style={{ 
                    width: 16, height: 16, borderRadius: 4, 
                    border: `2px solid ${criterion.checked ? C.brand[500] : C.neutral[300]}`,
                    background: criterion.checked ? C.brand[500] : 'white',
                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                    flexShrink: 0
                  }}>
                    {criterion.checked && <CheckCircle style={{ width: 10, height: 10, color: 'white' }} />}
                  </div>
                  <span style={{ fontSize: '13px', color: C.neutral[700] }}>{criterion.text}</span>
                </div>
              ))}
              
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginTop: sp.sm, paddingTop: sp.sm, borderTop: `1px solid ${C.neutral[200]}` }}>
                <input
                  type="text"
                  placeholder="Add custom criterion..."
                  value={newCriterion}
                  onChange={(e) => setNewCriterion(e.target.value)}
                  onKeyDown={(e) => e.key === 'Enter' && addCriterion()}
                  style={{
                    flex: 1,
                    padding: '6px 8px',
                    fontSize: '12px',
                    border: `1px solid ${C.neutral[200]}`,
                    borderRadius: 4
                  }}
                />
                <button
                  onClick={addCriterion}
                  style={{
                    padding: '6px 12px',
                    fontSize: '12px',
                    fontWeight: 500,
                    color: C.brand[600],
                    background: C.brand[50],
                    border: `1px solid ${C.brand[200]}`,
                    borderRadius: 4,
                    cursor: 'pointer'
                  }}
                >
                  Add
                </button>
              </div>
            </div>
          </div>
          
          {/* Advanced Options Accordion */}
          <div style={{ marginBottom: sp.md }}>
            <button
              onClick={() => setShowAdvanced(!showAdvanced)}
              style={{
                display: 'flex',
                alignItems: 'center',
                gap: sp.sm,
                width: '100%',
                padding: sp.sm,
                background: 'transparent',
                border: 'none',
                borderRadius: 6,
                cursor: 'pointer',
                textAlign: 'left'
              }}
              onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[50]}
              onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
            >
              <ChevronRight style={{ 
                width: 18, height: 18, 
                color: C.neutral[500],
                transform: showAdvanced ? 'rotate(90deg)' : 'rotate(0deg)',
                transition: 'transform 0.2s'
              }} />
              <span style={{ fontSize: '15px', fontWeight: 500, color: C.neutral[700] }}>Advanced Options</span>
            </button>
            
            {showAdvanced && (
              <div style={{ 
                background: C.neutral[50], 
                border: `1px solid ${C.neutral[200]}`,
                borderRadius: 8,
                padding: sp.md,
                marginTop: sp.sm
              }}>
                {/* Notifications */}
                <div style={{ marginBottom: sp.md }}>
                  <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                    Notifications
                  </label>
                  <div style={{ display: 'flex', gap: sp.md }}>
                    <label style={{ display: 'flex', alignItems: 'center', gap: sp.xs, cursor: 'pointer' }}>
                      <input 
                        type="checkbox" 
                        checked={notifications.slack}
                        onChange={(e) => setNotifications({ ...notifications, slack: e.target.checked })}
                      />
                      <span style={{ fontSize: '12px', color: C.neutral[700] }}>Slack</span>
                    </label>
                    <label style={{ display: 'flex', alignItems: 'center', gap: sp.xs, cursor: 'pointer' }}>
                      <input 
                        type="checkbox" 
                        checked={notifications.email}
                        onChange={(e) => setNotifications({ ...notifications, email: e.target.checked })}
                      />
                      <span style={{ fontSize: '12px', color: C.neutral[700] }}>Email</span>
                    </label>
                  </div>
                </div>
                
                {/* Escalation Path */}
                <div style={{ marginBottom: sp.md }}>
                  <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                    Escalation Path (if blocked)
                  </label>
                  <select
                    value={escalationPath}
                    onChange={(e) => setEscalationPath(e.target.value)}
                    style={{
                      width: '100%',
                      padding: sp.sm,
                      fontSize: '13px',
                      border: `1px solid ${C.neutral[300]}`,
                      borderRadius: 6,
                      background: 'white'
                    }}
                  >
                    <option value="shift-lead">Zone Lead → Shift Lead</option>
                    <option value="ops-manager">Zone Lead → Shift Lead → Ops Manager</option>
                    <option value="direct-ops">Direct to Ops Manager</option>
                  </select>
                </div>
                
                {/* Rollback Configuration */}
                <div style={{ marginBottom: sp.md }}>
                  <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                    Rollback Configuration
                  </label>
                  <div style={{ 
                    background: 'white',
                    border: `1px solid ${C.neutral[200]}`,
                    borderRadius: 6,
                    padding: sp.sm
                  }}>
                    <label style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.sm, cursor: 'pointer' }}>
                      <input 
                        type="checkbox" 
                        checked={rollbackEnabled}
                        onChange={(e) => setRollbackEnabled(e.target.checked)}
                      />
                      <span style={{ fontSize: '12px', color: C.neutral[700] }}>Enable rollback monitoring</span>
                    </label>
                    {rollbackEnabled && (
                      <div style={{ marginLeft: 24 }}>
                        <select
                          value={rollbackTrigger}
                          onChange={(e) => setRollbackTrigger(e.target.value)}
                          style={{
                            width: '100%',
                            padding: '6px 8px',
                            fontSize: '12px',
                            border: `1px solid ${C.neutral[300]}`,
                            borderRadius: 4,
                            background: 'white'
                          }}
                        >
                          <option value="auto">Auto-suggest if metrics decline &gt;10%</option>
                          <option value="time">Suggest after 45 min if no improvement</option>
                          <option value="manual">Manual trigger only</option>
                        </select>
                        <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0, marginTop: 4 }}>
                          Rollback actions: Return staff to original positions, restore normal operations
                        </p>
                      </div>
                    )}
                  </div>
                </div>
                
                {/* Shift Handoff Notes */}
                <div>
                  <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: sp.xs }}>
                    Shift Handoff Notes
                  </label>
                  <textarea
                    value={handoffNotes}
                    onChange={(e) => setHandoffNotes(e.target.value)}
                    placeholder="Notes for incoming shift if plan extends beyond current shift..."
                    style={{
                      width: '100%',
                      padding: sp.sm,
                      fontSize: '12px',
                      border: `1px solid ${C.neutral[300]}`,
                      borderRadius: 6,
                      resize: 'vertical',
                      minHeight: 60,
                      fontFamily: 'inherit',
                      boxSizing: 'border-box'
                    }}
                  />
                </div>
              </div>
            )}
          </div>
        </div>
        
        {/* Footer */}
        <div style={{ 
          display: 'flex', 
          justifyContent: 'space-between',
          alignItems: 'center',
          padding: sp.md,
          borderTop: `1px solid ${C.neutral[200]}`,
          background: C.neutral[50]
        }}>
          <button
            onClick={onClose}
            style={{
              padding: `${sp.sm} ${sp.md}`,
              fontSize: '13px',
              fontWeight: 500,
              background: 'white',
              color: C.neutral[700],
              border: `1px solid ${C.neutral[300]}`,
              borderRadius: 6,
              cursor: 'pointer'
            }}
          >
            Cancel
          </button>
          <div style={{ display: 'flex', gap: sp.sm }}>
            <button
              onClick={() => {
                console.log('Saving draft...');
                onClose();
              }}
              style={{
                padding: `${sp.sm} ${sp.md}`,
                fontSize: '13px',
                fontWeight: 500,
                background: 'white',
                color: C.neutral[700],
                border: `1px solid ${C.neutral[300]}`,
                borderRadius: 6,
                cursor: 'pointer'
              }}
            >
              Save Draft
            </button>
            <button
              onClick={handleExecute}
              style={{
                padding: `${sp.sm} ${sp.lg}`,
                fontSize: '13px',
                fontWeight: 500,
                background: requiresApproval ? C.warning[500] : C.success[500],
                color: 'white',
                border: 'none',
                borderRadius: 6,
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: sp.xs
              }}
            >
              {requiresApproval ? 'Submit for Approval' : 'Execute Plan'}
              <ChevronRight style={{ width: 14, height: 14 }} />
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

// ===== CONTRIBUTING FACTORS LINK =====
// Subtle text link for data visualizations only
const ContributingFactorsLink = ({ onClick }) => (
  <span 
    onClick={(e) => { e.stopPropagation(); onClick(); }}
    style={{ 
      display: 'inline-flex', 
      alignItems: 'center', 
      gap: 3,
      cursor: 'pointer',
      transition: 'all 0.15s'
    }}
    onMouseEnter={(e) => { 
      e.currentTarget.querySelector('span').style.textDecoration = 'underline';
      e.currentTarget.querySelector('svg').style.color = C.brand[500];
    }}
    onMouseLeave={(e) => { 
      e.currentTarget.querySelector('span').style.textDecoration = 'none';
      e.currentTarget.querySelector('svg').style.color = C.neutral[400];
    }}
  >
    <Info style={{ width: 12, height: 12, color: C.neutral[400], transition: 'color 0.15s' }} />
    <span style={{ fontSize: '11px', color: C.neutral[500], transition: 'all 0.15s' }}>Contributing Factors</span>
  </span>
);

// ===== CONTEXT-AWARE ALERT COMPONENT =====
// Shows alert state based on context: scenario mode or live+active plan
// state options:
//   Scenario mode: 'mitigated' | 'persists' | 'new'
//   Live + Active Plan: 'resolved' | 'targeted' | 'tradeoff' | 'persists' | 'active'
// context: 'scenario' | 'live-plan' | 'live' (default)
const ScenarioInlineAlert = ({ sev, title, msg, time, conf, state, context = 'scenario', linkedTask, onClick }) => {
  // Determine visual treatment based on state and context
  const isLivePlan = context === 'live-plan';
  
  // Scenario mode states
  const isMitigated = state === 'mitigated';
  const isPersists = state === 'persists';
  const isScenarioNew = state === 'new';
  
  // Live + Plan states
  const isResolved = state === 'resolved';
  const isTargeted = state === 'targeted';
  const isTradeoff = state === 'tradeoff';
  
  // Grouped logic
  const isPositive = isMitigated || isResolved;
  const isInProgress = isTargeted;
  const isNegativeNew = isScenarioNew || isTradeoff;
  const isNeutral = isPersists;
  
  const cfg = { 
    critical: [C.error[50], C.error[200], C.error[700], AlertOctagon], 
    warning: [C.warning[50], C.warning[200], C.warning[700], AlertTriangle], 
    info: [C.brand[50], C.brand[200], C.brand[600], Info] 
  };
  const [bg, bdr, txt, Icon] = cfg[sev] || cfg.info;
  
  // Color treatment by state
  let finalBg, finalBorder, finalTxt;
  
  if (isPositive) {
    finalBg = C.neutral[50];
    finalBorder = C.success[400];
    finalTxt = C.neutral[400];
  } else if (isInProgress) {
    finalBg = C.brand[50];
    finalBorder = C.brand[500];
    finalTxt = C.brand[700];
  } else if (isTradeoff) {
    finalBg = C.warning[50];
    finalBorder = C.warning[500];
    finalTxt = C.warning[700];
  } else if (isScenarioNew) {
    finalBg = C.purple[50];
    finalBorder = C.purple[500];
    finalTxt = C.purple[700];
  } else if (isNeutral) {
    finalBg = bg;
    finalBorder = txt;
    finalTxt = txt;
  } else {
    // Default active alert
    finalBg = bg;
    finalBorder = txt;
    finalTxt = txt;
  }
  
  // Badge configuration by state
  const badgeConfig = {
    mitigated: { label: '✓ Mitigated', bg: C.success[100], color: C.success[700] },
    resolved: { label: '✓ Resolved', bg: C.success[100], color: C.success[700] },
    targeted: { label: '◐ Targeted', bg: C.brand[100], color: C.brand[700] },
    tradeoff: { label: '⚠ Tradeoff', bg: C.warning[100], color: C.warning[700] },
    persists: { label: 'Persists', bg: C.neutral[100], color: C.neutral[600] },
    new: { label: 'Scenario', bg: C.purple[100], color: C.purple[700] }
  };
  
  const badge = badgeConfig[state];
  
  return (
    <div 
      onClick={onClick}
      style={{ 
        display: 'flex',
        alignItems: 'flex-start',
        gap: sp.sm,
        padding: sp.sm,
        background: finalBg, 
        borderLeft: `3px solid ${finalBorder}`,
        borderRadius: '0 6px 6px 0',
        marginTop: sp.sm,
        cursor: onClick ? 'pointer' : 'default',
        transition: 'all 0.15s',
        opacity: isPositive ? 0.7 : 1,
        position: 'relative'
      }}
      onMouseEnter={(e) => { if (onClick) { e.currentTarget.style.background = isPositive ? C.neutral[100] : isScenarioNew ? C.purple[100] : bdr; }}}
      onMouseLeave={(e) => { e.currentTarget.style.background = finalBg; }}
    >
      {/* Icon */}
      {isPositive ? (
        <CheckCircle style={{ width: 14, height: 14, color: C.success[500], flexShrink: 0, marginTop: 2 }} />
      ) : isInProgress ? (
        <Clock style={{ width: 14, height: 14, color: C.brand[500], flexShrink: 0, marginTop: 2 }} />
      ) : (
        <Icon style={{ width: 14, height: 14, color: finalTxt, flexShrink: 0, marginTop: 2 }} />
      )}
      
      {/* Content */}
      <div style={{ flex: 1, minWidth: 0 }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: sp.sm }}>
          <span style={{ 
            fontSize: '13px', 
            fontWeight: 500, 
            color: finalTxt,
            textDecoration: isPositive ? 'line-through' : 'none'
          }}>
            {title}
          </span>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
            <span style={{ fontSize: '11px', color: finalTxt, opacity: 0.7, flexShrink: 0 }}>{time}</span>
            {/* State badge */}
            {badge && (
              <span style={{ 
                fontSize: '9px', 
                fontWeight: 600, 
                padding: '2px 6px', 
                background: badge.bg, 
                color: badge.color, 
                borderRadius: 4,
                textTransform: 'uppercase'
              }}>
                {badge.label}
              </span>
            )}
          </div>
        </div>
        <p style={{ 
          fontSize: '11px', 
          color: finalTxt, 
          opacity: 0.85, 
          marginTop: 2,
          textDecoration: isPositive ? 'line-through' : 'none'
        }}>
          {msg}
        </p>
        {conf && !isPositive && (
          <p style={{ fontSize: '10px', color: finalTxt, opacity: 0.6, marginTop: 2 }}>Confidence: {conf}%</p>
        )}
        {/* Linked task info for live+plan context */}
        {linkedTask && (isLivePlan || isResolved || isTargeted || isTradeoff) && (
          <p style={{ 
            fontSize: '10px', 
            color: isResolved ? C.success[600] : isTargeted ? C.brand[600] : C.warning[600], 
            marginTop: 4,
            display: 'flex',
            alignItems: 'center',
            gap: 4
          }}>
            <span style={{ opacity: 0.7 }}>{isResolved ? '└─ Task:' : isTargeted ? '└─ In progress:' : '└─ From:'}</span>
            <span style={{ fontWeight: 500 }}>"{linkedTask}"</span>
            {isResolved && <CheckCircle style={{ width: 10, height: 10 }} />}
          </p>
        )}
      </div>
      {onClick && <ChevronRight style={{ width: 14, height: 14, color: finalTxt, opacity: 0.5, alignSelf: 'center', flexShrink: 0 }} />}
    </div>
  );
};

// ===== SEVERITY PILLS COMPONENT =====
// Shows count pills for each severity level
const SeverityPills = ({ alerts }) => {
  const counts = { critical: 0, warning: 0, info: 0 };
  alerts.forEach(a => { if (counts[a.sev] !== undefined) counts[a.sev]++; });
  
  const pillCfg = {
    critical: { bg: C.error[100], text: C.error[700], label: 'critical' },
    warning: { bg: C.warning[100], text: C.warning[700], label: 'warning' },
    info: { bg: C.brand[100], text: C.brand[600], label: 'info' }
  };
  
  return (
    <div style={{ display: 'flex', gap: sp.xs }}>
      {Object.entries(counts).map(([sev, count]) => count > 0 && (
        <span 
          key={sev}
          style={{ 
            fontSize: '11px', 
            fontWeight: 500, 
            padding: '2px 8px', 
            borderRadius: 10, 
            background: pillCfg[sev].bg, 
            color: pillCfg[sev].text 
          }}
        >
          {count} {pillCfg[sev].label}
        </span>
      ))}
    </div>
  );
};

// ===== ACCORDION COMPONENT =====
// Collapsible section with optional severity pills
const Accordion = ({ title, children, defaultOpen = false, alerts = null, count = null, badge = null, customHeader = null }) => {
  const [isOpen, setIsOpen] = useState(defaultOpen);
  
  return (
    <div style={{ borderTop: `1px solid ${C.neutral[200]}`, marginTop: sp.sm }}>
      <div 
        onClick={() => setIsOpen(!isOpen)}
        style={{ 
          display: 'flex', 
          alignItems: 'center', 
          justifyContent: 'space-between',
          padding: `${sp.sm} 0`,
          cursor: 'pointer',
          userSelect: 'none'
        }}
      >
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, flex: 1 }}>
          <ChevronRight 
            style={{ 
              width: 16, 
              height: 16, 
              color: C.neutral[500],
              transform: isOpen ? 'rotate(90deg)' : 'rotate(0deg)',
              transition: 'transform 0.2s',
              flexShrink: 0
            }} 
          />
          {customHeader ? customHeader : (
            <>
              <span style={{ fontSize: '13px', fontWeight: 500, color: C.neutral[700] }}>{title}</span>
              {count !== null && !alerts && (
                <span style={{ fontSize: '11px', color: C.neutral[500] }}>({count})</span>
              )}
              {badge && (
                <span style={{ 
                  fontSize: '11px', 
                  fontWeight: 500,
                  color: badge.color === 'success' ? C.success[600] : badge.color === 'warning' ? C.warning[600] : C.neutral[600],
                  background: badge.color === 'success' ? C.success[50] : badge.color === 'warning' ? C.warning[50] : C.neutral[100],
                  padding: '2px 6px',
                  borderRadius: 4
                }}>
                  {badge.label}
                </span>
              )}
            </>
          )}
        </div>
        {alerts && alerts.length > 0 && <SeverityPills alerts={alerts} />}
      </div>
      {isOpen && (
        <div style={{ paddingBottom: sp.sm }}>
          {children}
        </div>
      )}
    </div>
  );
};

// ===== ALERT VISUALIZATION COMPONENT =====
// Renders contextual data visualizations for alert detail views
const AlertVisualization = ({ alertId, type }) => {
  // Visualization data by alert ID
  const vizData = {
    // Zone Z04 Capacity - area chart showing capacity over time
    'alert-1': {
      whatsHappening: {
        type: 'areaChart',
        title: 'Z04 Capacity Trend',
        data: [
          { time: '06:00', value: 68 },
          { time: '07:00', value: 72 },
          { time: '08:00', value: 76 },
          { time: '09:00', value: 80 },
          { time: '10:00', value: 83, isNow: true },
          { time: '11:00', value: 87, isPredicted: true },
          { time: '12:00', value: 91, isPredicted: true },
        ],
        threshold: 90,
        thresholdLabel: 'Critical (90%)',
        unit: '%',
        color: C.error[500]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Detention fees', value: '$150/hr per trailer', icon: 'dollar' },
          { label: 'Forklift slowdown', value: '~15% longer travel', icon: 'clock' },
          { label: 'Safety hazard', value: 'Aisle obstructions', icon: 'alert' }
        ]
      }
    },
    // UPS Cutoff Risk - velocity gauge and orders countdown
    'alert-2': {
      whatsHappening: {
        type: 'velocityGauge',
        current: 520,
        target: 600,
        unit: 'orders/hr',
        ordersRemaining: 1240,
        cutoffTime: '15:30',
        projectedMiss: 40
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'SLA penalties', value: '~$100 ($2.50×40)', icon: 'dollar' },
          { label: 'Customer delays', value: 'Next-day delivery', icon: 'clock' },
          { label: 'Volume impact', value: '35% of daily orders', icon: 'package' }
        ]
      }
    },
    // Swing Understaffed - FTE comparison bars
    'alert-3': {
      whatsHappening: {
        type: 'staffingBars',
        shifts: [
          { name: 'Pick', scheduled: 12, required: 14, present: 12 },
          { name: 'Pack', scheduled: 10, required: 12, present: 9 },
          { name: 'Ship', scheduled: 8, required: 8, present: 8 },
          { name: 'Other', scheduled: 8, required: 8, present: 9 }
        ],
        totalScheduled: 38,
        totalRequired: 42,
        totalPresent: 38,
        callOuts: 2
      },
      whyItMatters: {
        type: 'timelineRisk',
        items: [
          { time: '16:00', event: 'Peak outbound begins', risk: 'high' },
          { time: '18:00', event: 'FedEx cutoff', risk: 'medium' },
          { time: '19:00', event: 'USPS cutoff', risk: 'medium' },
          { time: '22:00', event: 'Night shift carryover', risk: 'low' }
        ]
      }
    },
    // Labor Over Budget - spend trend
    'alert-4': {
      whatsHappening: {
        type: 'spendChart',
        data: [
          { time: '06:00', actual: 800, planned: 760 },
          { time: '07:00', actual: 1650, planned: 1520 },
          { time: '08:00', actual: 2520, planned: 2280 },
          { time: '09:00', actual: 3450, planned: 3040 },
          { time: '10:00', actual: 6420, planned: 6080, isNow: true },
          { time: '12:00', actual: null, planned: 7600, predicted: 8200 },
          { time: '14:00', actual: null, planned: 12400, predicted: 13100 }
        ],
        currentSpend: 6420,
        plannedSpend: 6080,
        projectedEOD: 13100,
        budgetEOD: 12400
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Daily overrun', value: '+$700', icon: 'dollar' },
          { label: 'Weekly impact', value: '+$3,500 projected', icon: 'trending' },
          { label: 'Monthly impact', value: '+$15,000 projected', icon: 'alert' }
        ]
      }
    },
    // Staff break coverage
    'staff-break-coverage': {
      whatsHappening: {
        type: 'coverageTimeline',
        data: [
          { time: '11:00', coverage: 48, required: 48 },
          { time: '11:30', coverage: 45, required: 48 },
          { time: '12:00', coverage: 38, required: 48, isLow: true },
          { time: '12:30', coverage: 40, required: 48, isLow: true },
          { time: '13:00', coverage: 46, required: 48 }
        ],
        peakGap: { time: '12:00', gap: 10 }
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Throughput impact', value: '~20% reduction', icon: 'trending' },
          { label: 'Coverage gap', value: '10 FTE shortfall', icon: 'users' }
        ]
      }
    },
    // Swing understaffed (staff tab version)
    'staff-swing-understaffed': {
      whatsHappening: {
        type: 'staffingBars',
        shifts: [
          { name: 'Pick', scheduled: 12, required: 14, present: 12 },
          { name: 'Pack', scheduled: 10, required: 12, present: 9 },
          { name: 'Ship', scheduled: 8, required: 8, present: 8 },
          { name: 'Other', scheduled: 8, required: 8, present: 9 }
        ],
        totalScheduled: 38,
        totalRequired: 42,
        callOuts: 2
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'FTE gap', value: '4 positions', icon: 'users' },
          { label: 'Cutoff risk', value: 'Evening carriers', icon: 'clock' }
        ]
      }
    },
    // UPLH declining
    'staff-receiving-uplh': {
      whatsHappening: {
        type: 'uplhTrend',
        data: [
          { time: '06:00', value: 98 },
          { time: '07:00', value: 96 },
          { time: '08:00', value: 95 },
          { time: '09:00', value: 93 },
          { time: '10:00', value: 90, isNow: true },
          { time: '12:00', value: 88, isPredicted: true },
          { time: '14:00', value: 85, isPredicted: true }
        ],
        target: 95,
        current: 90
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Cost per unit', value: '+5.3% increase', icon: 'dollar' },
          { label: 'Carryover risk', value: 'Moderate', icon: 'alert' }
        ]
      }
    },
    // Zone capacity
    'zones-z04-capacity': {
      whatsHappening: {
        type: 'areaChart',
        title: 'Z04 Capacity Trend',
        data: [
          { time: '06:00', value: 68 },
          { time: '08:00', value: 76 },
          { time: '10:00', value: 83, isNow: true },
          { time: '12:00', value: 91, isPredicted: true },
        ],
        threshold: 90,
        thresholdLabel: 'Critical',
        unit: '%',
        color: C.error[500]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Receiving blocked', value: 'Dock backup risk', icon: 'alert' },
          { label: 'Detention fees', value: '$150/hr', icon: 'dollar' }
        ]
      }
    },
    // Work - UPS velocity
    'work-ups-velocity': {
      whatsHappening: {
        type: 'velocityGauge',
        current: 127,
        target: 135,
        unit: 'orders/hr',
        ordersRemaining: 1240,
        cutoffTime: '15:30',
        projectedMiss: 40
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Orders at risk', value: '~40 orders', icon: 'package' },
          { label: 'SLA impact', value: '$100 penalties', icon: 'dollar' }
        ]
      }
    },
    // Work - Pick queue growing
    'work-pick-queue-growing': {
      whatsHappening: {
        type: 'queueChart',
        data: [
          { time: '06:00', value: 1800 },
          { time: '08:00', value: 2100 },
          { time: '10:00', value: 2450, isNow: true },
          { time: '12:00', value: 2600, isPredicted: true }
        ],
        target: 2100,
        current: 2450
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Queue growth', value: '+350 above target', icon: 'trending' },
          { label: 'Carryover risk', value: 'Increasing', icon: 'alert' }
        ]
      }
    },
    // ===== ADDITIONAL ALERTS =====
    // Staffing shift coverage
    'staffing-shift-coverage': {
      whatsHappening: {
        type: 'staffingBars',
        shifts: [
          { name: 'Pick', scheduled: 14, required: 14, present: 13 },
          { name: 'Pack', scheduled: 10, required: 10, present: 10 },
          { name: 'Ship', scheduled: 8, required: 8, present: 7 },
          { name: 'Receive', scheduled: 6, required: 6, present: 6 }
        ],
        totalScheduled: 38,
        totalRequired: 38,
        totalPresent: 36,
        callOuts: 2
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Coverage gap', value: '2 FTE short', icon: 'users' },
          { label: 'Throughput risk', value: '~5% reduction', icon: 'trending' }
        ]
      }
    },
    // Staffing UPS cutoff
    'staffing-ups-cutoff': {
      whatsHappening: {
        type: 'velocityGauge',
        current: 520,
        target: 600,
        unit: 'orders/hr',
        ordersRemaining: 1240,
        cutoffTime: '15:30',
        projectedMiss: 40
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Orders at risk', value: '~40 orders', icon: 'package' },
          { label: 'SLA penalties', value: '~$100', icon: 'dollar' }
        ]
      }
    },
    // Staffing break coverage
    'staffing-break-coverage': {
      whatsHappening: {
        type: 'coverageTimeline',
        data: [
          { time: '11:00', value: 48 },
          { time: '11:30', value: 45 },
          { time: '12:00', value: 38, isNow: true, isLow: true },
          { time: '12:30', value: 40, isPredicted: true, isLow: true },
          { time: '13:00', value: 46, isPredicted: true }
        ],
        target: 44
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Coverage gap', value: '10 FTE at peak', icon: 'users' },
          { label: 'Throughput dip', value: '~20% reduction', icon: 'trending' }
        ]
      }
    },
    // Staffing swing callout
    'staffing-swing-callout': {
      whatsHappening: {
        type: 'staffingBars',
        shifts: [
          { name: 'Pick', scheduled: 12, required: 14, present: 10 },
          { name: 'Pack', scheduled: 10, required: 12, present: 9 },
          { name: 'Ship', scheduled: 8, required: 8, present: 8 },
          { name: 'Other', scheduled: 8, required: 8, present: 7 }
        ],
        totalScheduled: 38,
        totalRequired: 42,
        totalPresent: 34,
        callOuts: 4
      },
      whyItMatters: {
        type: 'timelineRisk',
        items: [
          { time: '14:00', event: 'Swing shift start', risk: 'high' },
          { time: '16:00', event: 'Peak outbound', risk: 'high' },
          { time: '18:00', event: 'FedEx cutoff', risk: 'medium' }
        ]
      }
    },
    // Inbound dock congestion
    'inbound-dock-congestion': {
      whatsHappening: {
        type: 'areaChart',
        title: 'Dock Utilization',
        data: [
          { time: '06:00', value: 60 },
          { time: '07:00', value: 72 },
          { time: '08:00', value: 85 },
          { time: '09:00', value: 92 },
          { time: '10:00', value: 95, isNow: true },
          { time: '11:00', value: 88, isPredicted: true },
          { time: '12:00', value: 75, isPredicted: true }
        ],
        threshold: 90,
        thresholdLabel: 'Congested',
        unit: '%',
        color: C.error[500]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Truck dwell time', value: '+45 min avg', icon: 'clock' },
          { label: 'Detention risk', value: '$150/hr per truck', icon: 'dollar' },
          { label: 'Receiving backup', value: '3 trucks waiting', icon: 'alert' }
        ]
      }
    },
    // Inbound crew gap
    'inbound-crew-gap': {
      whatsHappening: {
        type: 'staffingBars',
        shifts: [
          { name: 'Unload', scheduled: 4, required: 6, present: 4 },
          { name: 'Putaway', scheduled: 3, required: 4, present: 3 },
          { name: 'QC', scheduled: 2, required: 2, present: 2 }
        ],
        totalScheduled: 9,
        totalRequired: 12,
        totalPresent: 9,
        callOuts: 0
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Unload delay', value: '+30 min/truck', icon: 'clock' },
          { label: 'FTE gap', value: '3 positions', icon: 'users' }
        ]
      }
    },
    // Inbound afternoon light
    'inbound-afternoon-light': {
      whatsHappening: {
        type: 'areaChart',
        title: 'Inbound Volume Forecast',
        data: [
          { time: '10:00', value: 850 },
          { time: '11:00', value: 720 },
          { time: '12:00', value: 580, isNow: true },
          { time: '13:00', value: 420, isPredicted: true },
          { time: '14:00', value: 350, isPredicted: true }
        ],
        target: 600,
        unit: ' units'
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Idle capacity', value: '~40% afternoon', icon: 'clock' },
          { label: 'Rebalance opportunity', value: 'Move 2 FTE to outbound', icon: 'users' }
        ]
      }
    },
    // Outbound UPS cutoff
    'outbound-ups-cutoff': {
      whatsHappening: {
        type: 'velocityGauge',
        current: 520,
        target: 600,
        unit: 'orders/hr',
        ordersRemaining: 1240,
        cutoffTime: '15:30',
        projectedMiss: 40
      },
      whyItMatters: {
        type: 'timelineRisk',
        items: [
          { time: '13:00', event: 'Current pace', risk: 'high' },
          { time: '14:30', event: 'Last pick wave', risk: 'medium' },
          { time: '15:30', event: 'UPS cutoff', risk: 'high' }
        ]
      }
    },
    // Outbound FedEx staging
    'outbound-fedex-staging': {
      whatsHappening: {
        type: 'areaChart',
        title: 'FedEx Staging Progress',
        data: [
          { time: '08:00', value: 15 },
          { time: '09:00', value: 32 },
          { time: '10:00', value: 48, isNow: true },
          { time: '11:00', value: 65, isPredicted: true },
          { time: '12:00', value: 82, isPredicted: true }
        ],
        threshold: 100,
        thresholdLabel: 'Target',
        unit: '%',
        color: C.warning[500]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Staging gap', value: '52% remaining', icon: 'package' },
          { label: 'Cutoff risk', value: 'FedEx 17:00', icon: 'clock' }
        ]
      }
    },
    // Outbound FedEx ground OK
    'outbound-fedex-ground-ok': {
      whatsHappening: {
        type: 'areaChart',
        title: 'FedEx Ground Progress',
        data: [
          { time: '08:00', value: 20 },
          { time: '09:00', value: 45 },
          { time: '10:00', value: 72, isNow: true },
          { time: '11:00', value: 88, isPredicted: true },
          { time: '12:00', value: 100, isPredicted: true }
        ],
        threshold: 100,
        thresholdLabel: 'Target',
        unit: '%',
        color: C.success[500]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'On track', value: '100% projected', icon: 'package' },
          { label: 'Buffer time', value: '+45 min', icon: 'clock' }
        ]
      }
    },
    // Maintenance FL02 PM peak
    'maint-fl02-pm-peak': {
      whatsHappening: {
        type: 'timelineRisk',
        items: [
          { time: '13:30', event: 'FL02 PM scheduled', risk: 'medium' },
          { time: '14:00', event: 'Swing shift start', risk: 'high' },
          { time: '14:30', event: 'PM completion (est)', risk: 'medium' }
        ]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Equipment downtime', value: '~60 min', icon: 'clock' },
          { label: 'Shift change overlap', value: 'Reduced capacity', icon: 'alert' }
        ]
      }
    },
    // Maintenance EPJ03 return
    'maint-epj03-return': {
      whatsHappening: {
        type: 'areaChart',
        title: 'EPJ03 Repair Timeline',
        data: [
          { time: '08:00', value: 0 },
          { time: '10:00', value: 25, isNow: true },
          { time: '12:00', value: 60, isPredicted: true },
          { time: '14:00', value: 100, isPredicted: true }
        ],
        threshold: 100,
        thresholdLabel: 'Complete',
        unit: '%',
        color: C.success[500]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Return ETA', value: '14:00', icon: 'clock' },
          { label: 'Capacity restored', value: '+1 EPJ unit', icon: 'package' }
        ]
      }
    },
    // Maintenance fleet health
    'maint-fleet-health': {
      whatsHappening: {
        type: 'staffingBars',
        shifts: [
          { name: 'Forklifts', scheduled: 12, required: 12, present: 11 },
          { name: 'EPJ', scheduled: 8, required: 8, present: 7 },
          { name: 'Reach', scheduled: 6, required: 6, present: 6 },
          { name: 'Tuggers', scheduled: 4, required: 4, present: 4 }
        ],
        totalScheduled: 30,
        totalRequired: 30,
        totalPresent: 28,
        callOuts: 0
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Fleet availability', value: '93% operational', icon: 'package' },
          { label: 'Units in repair', value: '2 units', icon: 'alert' }
        ]
      }
    },
    // Dashboard UPS cutoff
    'dashboard-ups-cutoff': {
      whatsHappening: {
        type: 'velocityGauge',
        current: 520,
        target: 600,
        unit: 'orders/hr',
        ordersRemaining: 1240,
        cutoffTime: '15:30',
        projectedMiss: 40
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Orders at risk', value: '~40 orders', icon: 'package' },
          { label: 'SLA penalties', value: '~$100', icon: 'dollar' }
        ]
      }
    },
    // Staff handoff optimal
    'staff-handoff-optimal': {
      whatsHappening: {
        type: 'staffingBars',
        shifts: [
          { name: 'Day→Swing', scheduled: 42, required: 42, present: 42 },
          { name: 'Overlap', scheduled: 8, required: 8, present: 8 }
        ],
        totalScheduled: 50,
        totalRequired: 50,
        totalPresent: 50,
        callOuts: 0
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Handoff status', value: 'On track', icon: 'package' },
          { label: 'Carryover risk', value: 'None', icon: 'alert' }
        ]
      }
    },
    // Zones Z02 underutilized
    'zones-z02-underutilized': {
      whatsHappening: {
        type: 'areaChart',
        title: 'Z02 Utilization Trend',
        data: [
          { time: '06:00', value: 45 },
          { time: '08:00', value: 42 },
          { time: '10:00', value: 38, isNow: true },
          { time: '12:00', value: 35, isPredicted: true }
        ],
        target: 70,
        unit: '%'
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Wasted capacity', value: '~32% unused', icon: 'alert' },
          { label: 'Rebalance opportunity', value: 'Redirect from Z04', icon: 'package' }
        ]
      }
    },
    // Zones Z01 pick congestion
    'zones-z01-pick-congestion': {
      whatsHappening: {
        type: 'areaChart',
        title: 'Z01 Picker Density',
        data: [
          { time: '06:00', value: 3 },
          { time: '08:00', value: 5 },
          { time: '10:00', value: 8, isNow: true },
          { time: '12:00', value: 7, isPredicted: true }
        ],
        threshold: 6,
        thresholdLabel: 'Max safe',
        unit: ' pickers',
        color: C.warning[500]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Congestion level', value: '33% over limit', icon: 'users' },
          { label: 'Productivity impact', value: '-12% pick rate', icon: 'trending' },
          { label: 'Safety concern', value: 'Aisle blocking', icon: 'alert' }
        ]
      }
    },
    // Zones Z03 replen needed
    'zones-z03-replen-needed': {
      whatsHappening: {
        type: 'areaChart',
        title: 'Z03 Pick Face Levels',
        data: [
          { time: '06:00', value: 85 },
          { time: '08:00', value: 68 },
          { time: '10:00', value: 45, isNow: true },
          { time: '12:00', value: 30, isPredicted: true, isLow: true }
        ],
        threshold: 40,
        thresholdLabel: 'Replen trigger',
        unit: '%',
        color: C.warning[500]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Stockout risk', value: '12 SKUs critical', icon: 'package' },
          { label: 'Pick delays', value: '+5 min avg', icon: 'clock' }
        ]
      }
    },
    // Work FedEx express priority
    'work-fedex-express-priority': {
      whatsHappening: {
        type: 'velocityGauge',
        current: 85,
        target: 120,
        unit: 'orders/hr',
        ordersRemaining: 340,
        cutoffTime: '17:00',
        projectedMiss: 25
      },
      whyItMatters: {
        type: 'timelineRisk',
        items: [
          { time: '14:00', event: 'Current pace', risk: 'high' },
          { time: '16:00', event: 'Final staging', risk: 'medium' },
          { time: '17:00', event: 'FedEx Express cutoff', risk: 'high' }
        ]
      }
    },
    // Work pack station balanced
    'work-pack-station-balanced': {
      whatsHappening: {
        type: 'staffingBars',
        shifts: [
          { name: 'Station 1', scheduled: 3, required: 3, present: 3 },
          { name: 'Station 2', scheduled: 3, required: 3, present: 3 },
          { name: 'Station 3', scheduled: 2, required: 2, present: 2 },
          { name: 'Station 4', scheduled: 2, required: 2, present: 2 }
        ],
        totalScheduled: 10,
        totalRequired: 10,
        totalPresent: 10,
        callOuts: 0
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Station balance', value: 'Optimal', icon: 'package' },
          { label: 'Throughput', value: 'On target', icon: 'trending' }
        ]
      }
    },
    // ===== EQUIPMENT ALERTS =====
    'equip-pm-overdue': {
      whatsHappening: {
        type: 'areaChart',
        title: 'FL-06 Operating Hours Since PM',
        data: [
          { time: 'PM Due', value: 400 },
          { time: '+10hr', value: 410 },
          { time: '+20hr', value: 420 },
          { time: 'Now', value: 425, isNow: true }
        ],
        threshold: 400,
        thresholdLabel: 'PM Interval',
        unit: ' hrs',
        color: C.error[500]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Breakdown risk', value: 'Elevated', icon: 'alert' },
          { label: 'Safety concern', value: 'Hydraulic wear', icon: 'alert' },
          { label: 'Repair cost risk', value: '+$500-2000', icon: 'dollar' }
        ]
      }
    },
    'equip-tt03-offline': {
      whatsHappening: {
        type: 'timelineRisk',
        items: [
          { time: '12/14', event: 'Failure occurred', risk: 'high' },
          { time: '12/16', event: 'Parts ordered', risk: 'medium' },
          { time: '12/20', event: 'Parts ETA', risk: 'medium' },
          { time: '12/21', event: 'Repair complete (est)', risk: 'low' }
        ]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Fleet capacity', value: '75% (3 of 4)', icon: 'package' },
          { label: 'Yard throughput', value: '-15% impact', icon: 'trending' },
          { label: 'Downtime', value: '~7 days total', icon: 'clock' }
        ]
      }
    },
    'equip-epj03-repair': {
      whatsHappening: {
        type: 'areaChart',
        title: 'EPJ-03 Repair Progress',
        data: [
          { time: '08:30', value: 0 },
          { time: '10:00', value: 35, isNow: true },
          { time: '12:00', value: 70, isPredicted: true },
          { time: '14:00', value: 100, isPredicted: true }
        ],
        threshold: 100,
        thresholdLabel: 'Complete',
        unit: '%',
        color: C.success[500]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Zone impact', value: 'Z01 Inbound', icon: 'package' },
          { label: 'Return ETA', value: '14:00 today', icon: 'clock' }
        ]
      }
    },
    'equip-battery-low': {
      whatsHappening: {
        type: 'staffingBars',
        shifts: [
          { name: 'RT-04', scheduled: 100, required: 60, present: 35 },
          { name: 'EPJ-06', scheduled: 100, required: 60, present: 28 },
          { name: 'OP-02', scheduled: 100, required: 60, present: 52 }
        ],
        totalScheduled: 300,
        totalRequired: 180,
        totalPresent: 115,
        callOuts: 0
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Charging bays', value: '2 of 4 in use', icon: 'package' },
          { label: 'OP-02 runtime', value: '~2 hrs remaining', icon: 'clock' },
          { label: 'Battery health', value: 'Avoid <20%', icon: 'alert' }
        ]
      }
    },
    'equip-pm-upcoming': {
      whatsHappening: {
        type: 'timelineRisk',
        items: [
          { time: 'Today 14:00', event: 'FL-04 PM', risk: 'low' },
          { time: 'Tomorrow', event: 'FL-02 PM', risk: 'low' },
          { time: '12/18', event: 'EPJ-01 PM', risk: 'low' },
          { time: '12/19', event: 'RT-03 PM', risk: 'low' }
        ]
      },
      whyItMatters: {
        type: 'impactBars',
        items: [
          { label: 'Compliance', value: 'On track', icon: 'package' },
          { label: 'Fleet reliability', value: 'Maintained', icon: 'alert' }
        ]
      }
    }
  };

  const viz = vizData[alertId]?.[type];
  if (!viz) return null;

  // Render different visualization types
  if (viz.type === 'areaChart' || viz.type === 'uplhTrend' || viz.type === 'queueChart' || viz.type === 'coverageTimeline') {
    // Handle different data field names
    const getValue = (d) => d.value !== undefined ? d.value : d.coverage;
    const maxVal = Math.max(...viz.data.map(d => getValue(d)), viz.threshold || 0, viz.target || 0) * 1.15;
    const minVal = Math.min(...viz.data.map(d => getValue(d))) * 0.85;
    const range = maxVal - minVal;
    
    return (
      <div style={{ marginTop: sp.md, marginBottom: sp.sm }}>
        <div style={{ fontSize: '11px', color: C.neutral[500], marginBottom: sp.sm }}>{viz.title || (viz.type === 'uplhTrend' ? 'UPLH Trend' : viz.type === 'queueChart' ? 'Queue Depth' : 'Coverage Over Time')}</div>
        <div style={{ position: 'relative', height: 120, paddingBottom: 20 }}>
          {/* Threshold line */}
          {viz.threshold && (
            <div style={{ 
              position: 'absolute', 
              left: 0, right: 0, 
              bottom: `${20 + ((viz.threshold - minVal) / range) * 100}px`,
              borderTop: `2px dashed ${viz.color || C.error[500]}`,
              zIndex: 2
            }}>
              <span style={{ 
                position: 'absolute', 
                right: 0, 
                top: -14, 
                fontSize: '10px', 
                color: viz.color || C.error[500],
                background: 'white',
                padding: '0 4px',
                fontWeight: 500
              }}>{viz.thresholdLabel} ({viz.threshold}{viz.unit})</span>
            </div>
          )}
          {/* Target line for non-threshold charts */}
          {viz.target && !viz.threshold && (
            <div style={{ 
              position: 'absolute', 
              left: 0, right: 0, 
              bottom: `${20 + ((viz.target - minVal) / range) * 100}px`,
              borderTop: `2px dashed ${C.success[500]}`,
              zIndex: 2
            }}>
              <span style={{ 
                position: 'absolute', 
                right: 0, 
                top: -14, 
                fontSize: '10px', 
                color: C.success[600],
                background: 'white',
                padding: '0 4px',
                fontWeight: 500
              }}>Target: {viz.target}</span>
            </div>
          )}
          
          {/* Chart bars */}
          <div style={{ display: 'flex', height: 100, alignItems: 'flex-end', gap: 4 }}>
            {viz.data.map((d, i) => {
              const val = getValue(d);
              const heightPct = ((val - minVal) / range) * 100;
              const isAboveThreshold = viz.threshold && val >= viz.threshold;
              const isBelowTarget = viz.target && !viz.threshold && val < viz.target;
              const barColor = d.isPredicted 
                ? (isAboveThreshold ? C.error[300] : isBelowTarget ? C.warning[300] : C.brand[300])
                : d.isLow ? C.error[500] : isAboveThreshold ? C.error[500] : isBelowTarget ? C.warning[500] : C.brand[500];
              
              return (
                <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', height: '100%', justifyContent: 'flex-end' }}>
                  <div style={{ position: 'relative', width: '100%', display: 'flex', justifyContent: 'center' }}>
                    {d.isNow && <div style={{ position: 'absolute', top: -16, fontSize: '9px', fontWeight: 600, color: C.neutral[800], whiteSpace: 'nowrap' }}>NOW</div>}
                    <div style={{ 
                      width: '80%', 
                      height: Math.max(heightPct, 4),
                      minHeight: 4,
                      background: d.isPredicted 
                        ? `repeating-linear-gradient(45deg, ${barColor}, ${barColor} 2px, transparent 2px, transparent 4px)`
                        : barColor,
                      borderRadius: '3px 3px 0 0',
                      border: d.isNow ? `2px solid ${C.neutral[800]}` : 'none',
                      boxSizing: 'border-box'
                    }} />
                  </div>
                </div>
              );
            })}
          </div>
          
          {/* X-axis labels */}
          <div style={{ display: 'flex', marginTop: 4 }}>
            {viz.data.map((d, i) => (
              <div key={i} style={{ flex: 1, textAlign: 'center', fontSize: '10px', color: C.neutral[500] }}>
                {d.time}
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  if (viz.type === 'velocityGauge') {
    const pct = Math.min((viz.current / viz.target) * 100, 100);
    const gap = viz.target - viz.current;
    return (
      <div style={{ marginTop: sp.sm, marginBottom: sp.sm }}>
        <div style={{ display: 'flex', gap: sp.md }}>
          {/* Gauge */}
          <div style={{ flex: 1 }}>
            <div style={{ fontSize: '11px', color: C.neutral[500], marginBottom: sp.xs }}>Current Velocity</div>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs }}>
              <span style={{ fontSize: '24px', fontWeight: 300, color: pct < 90 ? C.error[600] : C.warning[600] }}>{viz.current}</span>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>/ {viz.target} {viz.unit}</span>
            </div>
            <div style={{ height: 8, background: C.neutral[200], borderRadius: 4, marginTop: sp.xs, overflow: 'hidden' }}>
              <div style={{ height: '100%', width: `${pct}%`, background: pct < 90 ? C.error[500] : C.warning[500], borderRadius: 4 }} />
            </div>
            <div style={{ fontSize: '10px', color: C.error[600], marginTop: 4 }}>Gap: -{gap} {viz.unit}</div>
          </div>
          {/* Orders countdown */}
          <div style={{ flex: 1, borderLeft: `1px solid ${C.neutral[200]}`, paddingLeft: sp.md }}>
            <div style={{ fontSize: '11px', color: C.neutral[500], marginBottom: sp.xs }}>Orders Remaining</div>
            <div style={{ fontSize: '24px', fontWeight: 300, color: C.neutral[800] }}>{viz.ordersRemaining.toLocaleString()}</div>
            <div style={{ fontSize: '10px', color: C.neutral[500] }}>Cutoff: {viz.cutoffTime}</div>
            <div style={{ fontSize: '10px', color: C.error[600], marginTop: 4 }}>~{viz.projectedMiss} may miss</div>
          </div>
        </div>
      </div>
    );
  }

  if (viz.type === 'staffingBars') {
    return (
      <div style={{ marginTop: sp.sm, marginBottom: sp.sm }}>
        <div style={{ display: 'flex', gap: sp.xs, marginBottom: sp.sm, fontSize: '10px' }}>
          <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 10, height: 10, background: C.neutral[300], borderRadius: 2 }} /> Required</span>
          <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 10, height: 10, background: C.brand[500], borderRadius: 2 }} /> Scheduled</span>
          {viz.shifts[0].present !== undefined && <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 10, height: 10, background: C.success[500], borderRadius: 2 }} /> Present</span>}
        </div>
        {viz.shifts.map((s, i) => {
          const max = Math.max(s.required, s.scheduled, s.present || 0);
          return (
            <div key={i} style={{ marginBottom: sp.xs }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '11px', marginBottom: 2 }}>
                <span>{s.name}</span>
                <span style={{ color: s.scheduled < s.required ? C.error[600] : C.success[600] }}>
                  {s.scheduled}/{s.required}
                </span>
              </div>
              <div style={{ height: 12, background: C.neutral[100], borderRadius: 3, position: 'relative' }}>
                <div style={{ position: 'absolute', height: '100%', width: `${(s.required / max) * 100}%`, background: C.neutral[300], borderRadius: 3 }} />
                <div style={{ position: 'absolute', height: '100%', width: `${(s.scheduled / max) * 100}%`, background: s.scheduled < s.required ? C.warning[400] : C.brand[400], borderRadius: 3 }} />
                {s.present !== undefined && <div style={{ position: 'absolute', height: '60%', top: '20%', width: `${(s.present / max) * 100}%`, background: C.success[500], borderRadius: 2 }} />}
              </div>
            </div>
          );
        })}
        <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: sp.sm, padding: sp.xs, background: C.neutral[50], borderRadius: 4, fontSize: '11px' }}>
          <span>Total: <strong>{viz.totalScheduled}</strong> / {viz.totalRequired} required</span>
          {viz.callOuts > 0 && <span style={{ color: C.error[600] }}>{viz.callOuts} call-outs</span>}
        </div>
      </div>
    );
  }

  if (viz.type === 'spendChart') {
    const maxVal = Math.max(...viz.data.filter(d => d.actual || d.predicted || d.planned).map(d => Math.max(d.actual || 0, d.predicted || 0, d.planned || 0))) * 1.1;
    return (
      <div style={{ marginTop: sp.sm, marginBottom: sp.sm }}>
        <div style={{ display: 'flex', gap: sp.xs, marginBottom: sp.sm, fontSize: '10px' }}>
          <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 10, height: 10, background: C.success[500], borderRadius: 2 }} /> Planned</span>
          <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 10, height: 10, background: C.warning[500], borderRadius: 2 }} /> Actual</span>
          <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 10, height: 3, background: C.error[400] }} /> Projected</span>
        </div>
        <div style={{ height: 80, display: 'flex', alignItems: 'flex-end', gap: 4 }}>
          {viz.data.map((d, i) => (
            <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 2 }}>
              <div style={{ width: '100%', height: 70, position: 'relative', display: 'flex', alignItems: 'flex-end', justifyContent: 'center', gap: 2 }}>
                {d.planned && <div style={{ width: '40%', height: `${(d.planned / maxVal) * 100}%`, background: C.success[300], borderRadius: '2px 2px 0 0' }} />}
                {d.actual && <div style={{ width: '40%', height: `${(d.actual / maxVal) * 100}%`, background: C.warning[500], borderRadius: '2px 2px 0 0', border: d.isNow ? `2px solid ${C.neutral[800]}` : 'none' }} />}
                {d.predicted && !d.actual && <div style={{ width: '40%', height: `${(d.predicted / maxVal) * 100}%`, background: `repeating-linear-gradient(45deg, ${C.error[300]}, ${C.error[300]} 2px, ${C.error[200]} 2px, ${C.error[200]} 4px)`, borderRadius: '2px 2px 0 0' }} />}
              </div>
              <span style={{ fontSize: '8px', color: C.neutral[500] }}>{d.time.split(':')[0]}</span>
            </div>
          ))}
        </div>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: sp.sm, fontSize: '11px' }}>
          <span>Now: <strong style={{ color: C.warning[600] }}>${(viz.currentSpend/1000).toFixed(1)}K</strong> vs ${(viz.plannedSpend/1000).toFixed(1)}K planned</span>
          <span>EOD: <strong style={{ color: C.error[600] }}>${(viz.projectedEOD/1000).toFixed(1)}K</strong> vs ${(viz.budgetEOD/1000).toFixed(1)}K budget</span>
        </div>
      </div>
    );
  }

  if (viz.type === 'impactBars') {
    const iconMap = {
      dollar: DollarSign,
      clock: Clock,
      alert: AlertTriangle,
      package: Package,
      users: Users,
      trending: TrendingDown
    };
    return (
      <div style={{ marginTop: sp.sm, display: 'flex', flexDirection: 'column', gap: sp.xs }}>
        {viz.items.map((item, i) => {
          const Icon = iconMap[item.icon] || Info;
          return (
            <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.sm, padding: sp.xs, background: C.neutral[50], borderRadius: 4 }}>
              <div style={{ width: 24, height: 24, borderRadius: 4, background: C.warning[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                <Icon style={{ width: 12, height: 12, color: C.warning[600] }} />
              </div>
              <div style={{ flex: 1 }}>
                <div style={{ fontSize: '11px', color: C.neutral[600] }}>{item.label}</div>
                <div style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[800] }}>{item.value}</div>
              </div>
            </div>
          );
        })}
      </div>
    );
  }

  if (viz.type === 'timelineRisk') {
    return (
      <div style={{ marginTop: sp.sm }}>
        <div style={{ position: 'relative', paddingLeft: 20 }}>
          {/* Vertical line */}
          <div style={{ position: 'absolute', left: 6, top: 8, bottom: 8, width: 2, background: C.neutral[200] }} />
          {viz.items.map((item, i) => {
            const riskColors = { high: C.error[500], medium: C.warning[500], low: C.success[500] };
            return (
              <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.sm, position: 'relative' }}>
                <div style={{ width: 14, height: 14, borderRadius: '50%', background: riskColors[item.risk], border: '2px solid white', boxShadow: '0 0 0 2px ' + C.neutral[200], zIndex: 1 }} />
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: '11px', fontWeight: 500, color: C.neutral[800] }}>{item.time}</div>
                  <div style={{ fontSize: '11px', color: C.neutral[600] }}>{item.event}</div>
                </div>
                <Badge status={item.risk === 'high' ? 'error' : item.risk === 'medium' ? 'warning' : 'success'} label={item.risk} />
              </div>
            );
          })}
        </div>
      </div>
    );
  }

  return null;
};

// ===== DATA GRID COMPONENT =====
const DataGrid = ({ title, subtitle, columns, data, color, filterOptions = [], entityType = 'item', onAction }) => {
  const [search, setSearch] = useState('');
  const [filters, setFilters] = useState({});
  const [showFilters, setShowFilters] = useState(false);
  const [currentPage, setCurrentPage] = useState(1);
  const [openActionMenu, setOpenActionMenu] = useState(null);
  const rowsPerPage = 12;
  
  // Action menu options based on entity type
  const actionMenus = {
    equipment: [
      { icon: Eye, label: 'View Details', action: 'view' },
      { icon: RefreshCw, label: 'Request Replacement', action: 'replace' },
      { icon: MapPin, label: 'Move to New Location', action: 'move' },
      { icon: Wrench, label: 'Schedule Maintenance', action: 'maintenance' },
      { icon: Settings, label: 'Update Status', action: 'status' }
    ],
    staff: [
      { icon: Eye, label: 'View Profile', action: 'view' },
      { icon: RefreshCw, label: 'Reassign', action: 'reassign' },
      { icon: MapPin, label: 'Move to Zone', action: 'move' },
      { icon: Calendar, label: 'View Schedule', action: 'schedule' }
    ],
    zone: [
      { icon: Eye, label: 'View Details', action: 'view' },
      { icon: Users, label: 'View Staff', action: 'staff' },
      { icon: Package, label: 'View Inventory', action: 'inventory' },
      { icon: Settings, label: 'Configure Zone', action: 'configure' }
    ],
    order: [
      { icon: Eye, label: 'View Details', action: 'view' },
      { icon: TrendingUp, label: 'Prioritize', action: 'prioritize' },
      { icon: Users, label: 'Assign Picker', action: 'assign' },
      { icon: MapPin, label: 'View Location', action: 'location' }
    ],
    item: [
      { icon: Eye, label: 'View Details', action: 'view' },
      { icon: RefreshCw, label: 'Update', action: 'update' },
      { icon: Settings, label: 'Configure', action: 'configure' }
    ]
  };
  
  const actions = actionMenus[entityType] || actionMenus.item;
  
  // Filter and search data
  const filteredData = data.filter(row => {
    // Search across all string fields
    const searchMatch = search === '' || columns.some(col => {
      const val = row[col.key];
      return val && String(val).toLowerCase().includes(search.toLowerCase());
    });
    // Apply filters
    const filterMatch = Object.entries(filters).every(([key, value]) => {
      if (!value || value === 'all') return true;
      return row[key] === value;
    });
    return searchMatch && filterMatch;
  });
  
  // Pagination
  const totalPages = Math.ceil(filteredData.length / rowsPerPage);
  const startIndex = (currentPage - 1) * rowsPerPage;
  const paginatedData = filteredData.slice(startIndex, startIndex + rowsPerPage);
  
  // Reset to page 1 when search/filter changes
  const handleSearch = (value) => {
    setSearch(value);
    setCurrentPage(1);
  };
  
  const toggleFilter = (key, value) => {
    setFilters(prev => ({ ...prev, [key]: prev[key] === value ? 'all' : value }));
    setCurrentPage(1);
  };
  
  const handleActionClick = (action, row) => {
    setOpenActionMenu(null);
    if (onAction) {
      onAction(action, row);
    } else {
      console.log(`Action: ${action}`, row);
    }
  };
  
  return (
    <Card>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.md, flexWrap: 'wrap', gap: sp.sm }}>
        <div style={{ minWidth: 200 }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>{title}</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>{subtitle} • {filteredData.length} of {data.length} items</p>
        </div>
        <div style={{ display: 'flex', gap: sp.sm, flexWrap: 'wrap' }}>
          {/* Search */}
          <div style={{ position: 'relative' }}>
            <Search style={{ position: 'absolute', left: 10, top: '50%', transform: 'translateY(-50%)', width: 14, height: 14, color: C.neutral[400] }} />
            <input
              type="text"
              placeholder="Search..."
              value={search}
              onChange={(e) => handleSearch(e.target.value)}
              style={{ padding: '8px 12px 8px 32px', border: `1px solid ${C.neutral[200]}`, borderRadius: 6, fontSize: '13px', width: 180, outline: 'none' }}
            />
            {search && (
              <button onClick={() => handleSearch('')} style={{ position: 'absolute', right: 8, top: '50%', transform: 'translateY(-50%)', background: 'none', border: 'none', cursor: 'pointer', padding: 0 }}>
                <X style={{ width: 14, height: 14, color: C.neutral[400] }} />
              </button>
            )}
          </div>
          {/* Filter Toggle */}
          {filterOptions.length > 0 && (
            <button
              onClick={() => setShowFilters(!showFilters)}
              style={{ display: 'flex', alignItems: 'center', gap: 6, padding: '8px 12px', background: showFilters ? color + '15' : C.neutral[50], border: `1px solid ${showFilters ? color : C.neutral[200]}`, borderRadius: 6, cursor: 'pointer', fontSize: '13px', color: showFilters ? color : C.neutral[600] }}
            >
              <Filter style={{ width: 14, height: 14 }} />
              Filters
              {Object.values(filters).filter(v => v && v !== 'all').length > 0 && (
                <span style={{ background: color, color: 'white', borderRadius: 10, padding: '2px 6px', fontSize: '11px', fontWeight: 500 }}>
                  {Object.values(filters).filter(v => v && v !== 'all').length}
                </span>
              )}
            </button>
          )}
        </div>
      </div>
      
      {/* Filter Chips */}
      {showFilters && filterOptions.length > 0 && (
        <div style={{ display: 'flex', flexWrap: 'wrap', gap: sp.sm, marginBottom: sp.md, padding: sp.md, background: C.neutral[50], borderRadius: 6 }}>
          {filterOptions.map(filter => (
            <div key={filter.key} style={{ display: 'flex', alignItems: 'center', gap: sp.xs, flexWrap: 'wrap' }}>
              <span style={{ fontSize: '12px', color: C.neutral[500], marginRight: 4 }}>{filter.label}:</span>
              {filter.options.map(opt => (
                <button
                  key={opt}
                  onClick={() => toggleFilter(filter.key, opt)}
                  style={{
                    padding: '4px 10px',
                    borderRadius: 4,
                    border: `1px solid ${filters[filter.key] === opt ? color : C.neutral[200]}`,
                    background: filters[filter.key] === opt ? color + '15' : 'white',
                    color: filters[filter.key] === opt ? color : C.neutral[600],
                    fontSize: '12px',
                    cursor: 'pointer'
                  }}
                >
                  {opt}
                </button>
              ))}
            </div>
          ))}
        </div>
      )}
      
      {/* Table Container */}
      <div style={{ border: `1px solid ${C.neutral[200]}`, borderRadius: 6, position: 'relative' }}>
        <div style={{ overflowX: 'auto' }}>
          <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '13px', minWidth: 600 }}>
            <thead style={{ background: C.neutral[50] }}>
              <tr>
                {/* Actions column header */}
                <th style={{ padding: '10px 8px', textAlign: 'center', fontWeight: 500, color: C.neutral[600], borderBottom: `2px solid ${C.neutral[200]}`, width: 44 }}>
                  
                </th>
                {columns.map(col => (
                  <th key={col.key} style={{ padding: '10px 12px', textAlign: col.align || 'left', fontWeight: 500, color: C.neutral[600], borderBottom: `2px solid ${C.neutral[200]}`, whiteSpace: 'nowrap' }}>
                    {col.label}
                  </th>
                ))}
              </tr>
            </thead>
            <tbody>
              {paginatedData.map((row, i) => (
                <tr key={i} style={{ borderBottom: `1px solid ${C.neutral[100]}` }}>
                  {/* Actions column */}
                  <td style={{ padding: '6px 8px', textAlign: 'center' }}>
                    <div style={{ position: 'relative', display: 'inline-block' }}>
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          if (openActionMenu === i) {
                            setOpenActionMenu(null);
                          } else {
                            // Store button position for dropdown
                            const rect = e.currentTarget.getBoundingClientRect();
                            setOpenActionMenu({ index: i, top: rect.bottom + 4, left: rect.left });
                          }
                        }}
                        style={{ 
                          background: openActionMenu?.index === i ? C.neutral[100] : 'transparent', 
                          border: 'none', 
                          cursor: 'pointer', 
                          padding: 4, 
                          borderRadius: 4,
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center'
                        }}
                      >
                        <MoreVertical style={{ width: 16, height: 16, color: C.neutral[500] }} />
                      </button>
                    </div>
                    {/* Action Menu Dropdown - rendered at body level via fixed positioning */}
                    {openActionMenu?.index === i && (
                      <>
                        <div 
                          style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, zIndex: 999 }}
                          onClick={() => setOpenActionMenu(null)}
                        />
                        <div style={{ 
                          position: 'fixed', 
                          top: openActionMenu.top, 
                          left: openActionMenu.left, 
                          background: 'white', 
                          border: `1px solid ${C.neutral[200]}`, 
                          borderRadius: 8, 
                          boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
                          zIndex: 1000,
                          minWidth: 180,
                          overflow: 'hidden'
                        }}>
                          {actions.map((action, ai) => {
                            const ActionIcon = action.icon;
                            return (
                              <button
                                key={ai}
                                onClick={() => handleActionClick(action.action, row)}
                                style={{
                                  display: 'flex',
                                  alignItems: 'center',
                                  gap: sp.sm,
                                  width: '100%',
                                  padding: '10px 12px',
                                  background: 'transparent',
                                  border: 'none',
                                  cursor: 'pointer',
                                  fontSize: '13px',
                                  color: C.neutral[700],
                                  textAlign: 'left'
                                }}
                                onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[50]}
                                onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                              >
                                <ActionIcon style={{ width: 14, height: 14, color: C.neutral[500] }} />
                                {action.label}
                              </button>
                            );
                          })}
                        </div>
                      </>
                    )}
                  </td>
                  {columns.map(col => (
                    <td key={col.key} style={{ padding: '10px 12px', textAlign: col.align || 'left', color: C.neutral[800] }}>
                      {col.render ? col.render(row[col.key], row) : row[col.key]}
                    </td>
                  ))}
                </tr>
              ))}
              {paginatedData.length === 0 && (
                <tr>
                  <td colSpan={columns.length + 1} style={{ padding: sp.xl, textAlign: 'center', color: C.neutral[400] }}>
                    No items match your search or filters
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
        
        {/* Pagination */}
        {totalPages > 1 && (
          <div style={{ 
            display: 'flex', 
            justifyContent: 'space-between', 
            alignItems: 'center', 
            padding: sp.sm + ' ' + sp.md, 
            borderTop: `1px solid ${C.neutral[200]}`,
            background: C.neutral[50],
            flexWrap: 'wrap',
            gap: sp.sm
          }}>
            <span style={{ fontSize: '12px', color: C.neutral[500] }}>
              Showing {startIndex + 1}-{Math.min(startIndex + rowsPerPage, filteredData.length)} of {filteredData.length}
            </span>
            <div style={{ display: 'flex', gap: sp.xs }}>
              <button
                onClick={() => setCurrentPage(p => Math.max(1, p - 1))}
                disabled={currentPage === 1}
                style={{
                  padding: '6px 10px',
                  border: `1px solid ${C.neutral[200]}`,
                  borderRadius: 4,
                  background: currentPage === 1 ? C.neutral[100] : 'white',
                  color: currentPage === 1 ? C.neutral[400] : C.neutral[600],
                  cursor: currentPage === 1 ? 'not-allowed' : 'pointer',
                  fontSize: '12px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 4
                }}
              >
                <ChevronLeft style={{ width: 14, height: 14 }} /> Prev
              </button>
              
              {/* Page numbers */}
              <div style={{ display: 'flex', gap: 2 }}>
                {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {
                  let pageNum;
                  if (totalPages <= 5) {
                    pageNum = i + 1;
                  } else if (currentPage <= 3) {
                    pageNum = i + 1;
                  } else if (currentPage >= totalPages - 2) {
                    pageNum = totalPages - 4 + i;
                  } else {
                    pageNum = currentPage - 2 + i;
                  }
                  return (
                    <button
                      key={pageNum}
                      onClick={() => setCurrentPage(pageNum)}
                      style={{
                        padding: '6px 10px',
                        border: `1px solid ${currentPage === pageNum ? color : C.neutral[200]}`,
                        borderRadius: 4,
                        background: currentPage === pageNum ? color : 'white',
                        color: currentPage === pageNum ? 'white' : C.neutral[600],
                        cursor: 'pointer',
                        fontSize: '12px',
                        minWidth: 32
                      }}
                    >
                      {pageNum}
                    </button>
                  );
                })}
              </div>
              
              <button
                onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}
                disabled={currentPage === totalPages}
                style={{
                  padding: '6px 10px',
                  border: `1px solid ${C.neutral[200]}`,
                  borderRadius: 4,
                  background: currentPage === totalPages ? C.neutral[100] : 'white',
                  color: currentPage === totalPages ? C.neutral[400] : C.neutral[600],
                  cursor: currentPage === totalPages ? 'not-allowed' : 'pointer',
                  fontSize: '12px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 4
                }}
              >
                Next <ChevronRight style={{ width: 14, height: 14 }} />
              </button>
            </div>
          </div>
        )}
      </div>
    </Card>
  );
};

const Spark = ({ data, color=C.brand[500], h=32 }) => (
  <ResponsiveContainer width="100%" height={h}>
    <AreaChart data={data} margin={{ top: 2, right: 2, left: 2, bottom: 2 }}>
      <defs><linearGradient id={`g${color.slice(1)}`} x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor={color} stopOpacity={0.3} /><stop offset="100%" stopColor={color} stopOpacity={0} /></linearGradient></defs>
      <Area type="monotone" dataKey="v" stroke={color} strokeWidth={1.5} fill={`url(#g${color.slice(1)})`} />
    </AreaChart>
  </ResponsiveContainer>
);

const Back = ({ onClick, label='Back' }) => (
  <button onClick={onClick} style={{ display: 'inline-flex', alignItems: 'center', gap: sp.xs, padding: `${sp.sm} ${sp.md}`, background: C.neutral[100], border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '13px', fontWeight: 500, color: C.neutral[600] }}>
    <ChevronLeft style={{ width: 16, height: 16 }} />{label}
  </button>
);

const Breadcrumb = ({ items, onNavigate }) => (
  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.lg, fontSize: '13px' }}>
    {items.map((item, i) => (
      <React.Fragment key={i}>
        {i > 0 && <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />}
        {item.onClick ? (
          <button 
            onClick={item.onClick} 
            style={{ 
              background: 'none', 
              border: 'none', 
              padding: 0, 
              cursor: 'pointer', 
              fontSize: '13px', 
              color: C.brand[600],
              fontWeight: 500
            }}
          >
            {item.label}
          </button>
        ) : (
          <span style={{ color: C.neutral[500], fontWeight: 400 }}>{item.label}</span>
        )}
      </React.Fragment>
    ))}
  </div>
);

const Header = ({ icon: Icon, title, sub, color, action }) => (
  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: sp.lg }}>
    <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
      <div style={{ width: 44, height: 44, borderRadius: 10, background: `${color}12`, border: `1px solid ${color}25`, display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Icon style={{ width: 22, height: 22, color }} /></div>
      <div><h2 style={{ fontSize: '20px', fontWeight: 400, margin: 0 }}>{title}</h2>{sub && <p style={{ fontSize: '13px', color: C.neutral[500], marginTop: 2 }}>{sub}</p>}</div>
    </div>
    {action}
  </div>
);

// ===== EXECUTIVE SUMMARY =====
const Executive = ({ onCat, onShift, onZone }) => {
  const { 
    contextualTime, isContextualDifferent, isContextualPast, interpolateValue,
    scenarioMode, activeScenario, activeScenarioId, toggleScenarioMode,
    viewMode, setViewMode,
    endTimeMode, endTime, endTimeLabel
  } = useTimeContext();
  const [activeTab, setActiveTabState] = useState('dashboard');
  const [selectedAlert, setSelectedAlert] = useState(null);
  const [insightsSubTab, setInsightsSubTab] = useState('overall');
  const [staffShiftFilter, setStaffShiftFilter] = useState(null);
  const [highlightedAlert, setHighlightedAlert] = useState(null);
  
  // Wrapper to scroll to top on tab change
  const setActiveTab = (tab) => {
    setActiveTabState(tab);
    // Find the scrollable container and scroll to top
    const scrollContainer = document.querySelector('[data-scroll-container]');
    if (scrollContainer) {
      scrollContainer.scrollTo({ top: 0, behavior: 'smooth' });
    } else {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  };
  
  // Contributing Factors Modal state
  const [contributingFactorsModal, setContributingFactorsModal] = useState({ isOpen: false, title: '', data: null });
  
  // Selected actions for Analysis scenario planning
  const [selectedActions, setSelectedActions] = useState(['action-1']); // Default first action selected
  
  // Execute Live Plan Modal state
  const [executePlanModal, setExecutePlanModal] = useState({ isOpen: false });
  
  // Shared Plans State (lifted from PlansTabContent for cross-component access)
  const [allPlans, setAllPlans] = useState([
    {
      id: 'plan-001',
      name: 'Peak Hour Staffing Rebalance',
      status: 'active',
      priority: 'high',
      progress: 75,
      createdAt: '10:15 AM',
      createdBy: { id: 'mike', name: 'Mike Chen', role: 'Zone Lead' },
      targetCompletion: '12:30 PM',
      shiftContext: 'Day',
      date: 'Dec 19',
      duration: null,
      outcome: null,
      origin: {
        type: 'analysis',
        title: 'Picking Shortfall - Root Cause #2',
        alertId: 'alert-z02-staff',
        alertTitle: 'Zone Z02 Understaffed'
      },
      projectedImpact: {
        staff: { base: 76, projected: 88, delta: 12 },
        zones: { base: 82, projected: 88, delta: 6 },
        schedule: { base: 91, projected: 89, delta: -2 },
        equip: { base: 94, projected: 92, delta: -2 }
      },
      successCriteria: [
        { id: 'c1', text: 'Picking throughput reaches 850 orders/hr', met: true },
        { id: 'c2', text: 'Z02/Z04 backlog cleared', met: false }
      ],
      tasks: [
        { 
          id: 'task-1', 
          title: 'Add 4 FTE pickers to Day shift', 
          status: 'done', 
          assignee: { name: 'Mike Chen', role: 'Shift Lead' }, 
          dueTime: '11:00', 
          duration: 15, 
          completedAt: '10:52', 
          notes: 'Pulled from break pool',
          type: 'staff-addition',
          actions: [
            { id: 'a1', type: 'staff-assign', entity: { type: 'staff', id: 's1', name: 'Tom Wilson' }, target: { function: 'Picker', zone: 'Z02' }, actual: { function: 'Picker', zone: 'Z02' }, status: 'applied', appliedAt: '10:45' },
            { id: 'a2', type: 'staff-assign', entity: { type: 'staff', id: 's2', name: 'Amy Chen' }, target: { function: 'Picker', zone: 'Z02' }, actual: { function: 'Picker', zone: 'Z02' }, status: 'applied', appliedAt: '10:47' },
            { id: 'a3', type: 'staff-assign', entity: { type: 'staff', id: 's3', name: 'Carlos Ruiz' }, target: { function: 'Picker', zone: 'Z02' }, actual: { function: 'Picker', zone: 'Z02' }, status: 'applied', appliedAt: '10:50' },
            { id: 'a4', type: 'staff-assign', entity: { type: 'staff', id: 's4', name: 'Diana Park' }, target: { function: 'Picker', zone: 'Z02' }, actual: { function: 'Picker', zone: 'Z02' }, status: 'applied', appliedAt: '10:52' }
          ],
          systemImpact: { before: { pickingFTEs: 8, staffScore: 76 }, after: { pickingFTEs: 12, staffScore: 82 } }
        },
        { 
          id: 'task-2', 
          title: 'Reassign 2 FTEs from Receiving to Picking', 
          status: 'done', 
          assignee: { name: 'Sarah Kim', role: 'Shift Lead' }, 
          dueTime: '11:15', 
          duration: 10, 
          completedAt: '11:08', 
          tradeoff: 'Slower inbound (~30 min delay)',
          type: 'staff-movement',
          actions: [
            { id: 'a5', type: 'staff-move', entity: { type: 'staff', id: 's5', name: 'Jake Morrison' }, target: { fromFunction: 'Receiving', toFunction: 'Picking', fromZone: 'Dock A', toZone: 'Z02' }, actual: { fromFunction: 'Receiving', toFunction: 'Picking', fromZone: 'Dock A', toZone: 'Z02' }, status: 'applied', appliedAt: '11:05' },
            { id: 'a6', type: 'staff-move', entity: { type: 'staff', id: 's6', name: 'Lin Zhang' }, target: { fromFunction: 'Receiving', toFunction: 'Picking', fromZone: 'Dock A', toZone: 'Z02' }, actual: { fromFunction: 'Receiving', toFunction: 'Picking', fromZone: 'Dock A', toZone: 'Z02' }, status: 'applied', appliedAt: '11:08' }
          ],
          systemImpact: { before: { receivingFTEs: 6, pickingFTEs: 12 }, after: { receivingFTEs: 4, pickingFTEs: 14 } }
        },
        { 
          id: 'task-3', 
          title: 'Activate overflow Zone Z07', 
          status: 'in-progress', 
          assignee: { name: 'James Liu', role: 'Zone Manager' }, 
          dueTime: '11:30', 
          duration: 20, 
          startedAt: '11:12', 
          notes: 'Equipment staging in progress',
          type: 'zone-activation',
          actions: [
            { id: 'a7', type: 'zone-status', entity: { type: 'zone', id: 'z07', name: 'Zone Z07' }, target: { status: 'Active', capacity: 500 }, actual: { status: 'Partial', capacity: 250 }, status: 'pending' },
            { id: 'a8', type: 'equipment-stage', entity: { type: 'equipment', id: 'e1', name: 'EPJ-12', equipType: 'Electric Pallet Jack' }, target: { zone: 'Z07' }, actual: { zone: 'Z07' }, status: 'applied', appliedAt: '11:18' },
            { id: 'a9', type: 'equipment-stage', entity: { type: 'equipment', id: 'e2', name: 'EPJ-15', equipType: 'Electric Pallet Jack' }, target: { zone: 'Z07' }, actual: { zone: 'Z07' }, status: 'applied', appliedAt: '11:22' },
            { id: 'a10', type: 'equipment-stage', entity: { type: 'equipment', id: 'e3', name: 'FL-08', equipType: 'Forklift' }, target: { zone: 'Z07' }, actual: null, status: 'pending' },
            { id: 'a11', type: 'staff-assign', entity: { type: 'staff', id: 's7', name: 'Ryan Peters' }, target: { function: 'Picker', zone: 'Z07' }, actual: { function: 'Picker', zone: 'Z07' }, status: 'applied', appliedAt: '11:20' },
            { id: 'a12', type: 'staff-assign', entity: { type: 'staff', id: 's8', name: 'Maria Santos' }, target: { function: 'Picker', zone: 'Z07' }, actual: { function: 'Picker', zone: 'Z07' }, status: 'applied', appliedAt: '11:25' },
            { id: 'a13', type: 'staff-assign', entity: { type: 'staff', id: 's9', name: 'Kevin Tran' }, target: { function: 'Picker', zone: 'Z07' }, actual: null, status: 'pending' },
            { id: 'a14', type: 'staff-assign', entity: { type: 'staff', id: 's10', name: 'Emily Ross' }, target: { function: 'Picker', zone: 'Z07' }, actual: null, status: 'pending' }
          ],
          systemImpact: { before: { z07Status: 'Inactive', activeZones: 6 }, after: { z07Status: 'Partial', activeZones: 7 }, projected: { z07Status: 'Active', activeZones: 7 } }
        },
        { 
          id: 'task-4', 
          title: 'Monitor throughput and adjust if needed', 
          status: 'todo', 
          assignee: { name: 'Mike Chen', role: 'Shift Lead' }, 
          dueTime: '12:30', 
          duration: 60,
          type: 'monitoring',
          actions: [
            { id: 'a15', type: 'metric-watch', entity: { type: 'metric', id: 'm1', name: 'Picking Throughput' }, target: { value: 850, unit: 'orders/hr', threshold: 750 }, actual: null, status: 'pending' }
          ],
          systemImpact: null
        }
      ]
    },
    {
      id: 'plan-002',
      name: 'UPS Cutoff Recovery',
      status: 'completed',
      priority: 'critical',
      progress: 100,
      createdAt: '09:30 AM',
      createdBy: { id: 'sarah', name: 'Sarah Kim', role: 'Shift Lead' },
      targetCompletion: '11:00 AM',
      shiftContext: 'Day',
      date: 'Dec 18',
      duration: '1h 45m',
      outcome: 'success',
      origin: { type: 'alert', alertTitle: 'UPS Cutoff Risk' },
      successCriteria: [
        { id: 'c1', text: 'Clear 200 UPS orders before 10:45', met: true },
        { id: 'c2', text: 'No SLA violations', met: true }
      ],
      tasks: [
        { id: 't1', title: 'Prioritize UPS orders in queue', status: 'done', assignee: { name: 'Sarah Kim' }, completedAt: '09:45', type: 'priority-change', actions: [{ id: 'a1', type: 'queue-priority', entity: { type: 'queue', id: 'q1', name: 'UPS Express Queue' }, target: { priority: 'Critical' }, actual: { priority: 'Critical' }, status: 'applied', appliedAt: '09:45' }], systemImpact: null },
        { id: 't2', title: 'Add 2 pickers to UPS lane', status: 'done', assignee: { name: 'Mike Chen' }, completedAt: '09:50', type: 'staff-addition', actions: [{ id: 'a2', type: 'staff-assign', entity: { type: 'staff', id: 's1', name: 'Alex Thompson' }, target: { function: 'Picker', zone: 'UPS Lane' }, actual: { function: 'Picker', zone: 'UPS Lane' }, status: 'applied', appliedAt: '09:48' }, { id: 'a3', type: 'staff-assign', entity: { type: 'staff', id: 's2', name: 'Jordan Lee' }, target: { function: 'Picker', zone: 'UPS Lane' }, actual: { function: 'Picker', zone: 'UPS Lane' }, status: 'applied', appliedAt: '09:50' }], systemImpact: { before: { upsLaneFTEs: 3 }, after: { upsLaneFTEs: 5 } } },
        { id: 't3', title: 'Expedite packing for UPS', status: 'done', assignee: { name: 'James Liu' }, completedAt: '10:30', type: 'process-change', actions: [{ id: 'a4', type: 'lane-mode', entity: { type: 'lane', id: 'l1', name: 'UPS Priority Lane' }, target: { mode: 'Express' }, actual: { mode: 'Express' }, status: 'applied', appliedAt: '10:30' }], systemImpact: null }
      ]
    },
    {
      id: 'plan-003',
      name: 'Zone Z04 Capacity Fix',
      status: 'completed',
      priority: 'high',
      progress: 100,
      createdAt: '02:15 PM',
      createdBy: { id: 'james', name: 'James Liu', role: 'Zone Manager' },
      targetCompletion: '04:30 PM',
      shiftContext: 'Swing',
      date: 'Dec 18',
      duration: '2h 10m',
      outcome: 'success',
      origin: { type: 'analysis', alertTitle: 'Z04 at 95% capacity' },
      successCriteria: [{ id: 'c1', text: 'Z04 capacity below 80%', met: true }],
      tasks: [
        { id: 't1', title: 'Redistribute inventory to Z05', status: 'done', assignee: { name: 'James Liu' }, completedAt: '03:00', type: 'inventory-movement', actions: [{ id: 'a1', type: 'inventory-move', entity: { type: 'inventory', id: 'inv1', name: '45 Pallets' }, target: { fromZone: 'Z04', toZone: 'Z05', quantity: 45 }, actual: { fromZone: 'Z04', toZone: 'Z05', quantity: 45 }, status: 'applied', appliedAt: '03:00' }], systemImpact: { before: { z04Capacity: 95 }, after: { z04Capacity: 78 } } },
        { id: 't2', title: 'Clear overflow staging', status: 'done', assignee: { name: 'Tom Wilson' }, completedAt: '03:45', type: 'zone-cleanup', actions: [{ id: 'a2', type: 'zone-clear', entity: { type: 'zone', id: 'z04s', name: 'Z04 Staging Area' }, target: { itemsToClear: 120 }, actual: { itemsToClear: 115 }, status: 'applied', appliedAt: '03:45' }], systemImpact: { before: { stagingItems: 120 }, after: { stagingItems: 5 } } }
      ]
    },
    {
      id: 'plan-004',
      name: 'Equipment Reallocation',
      status: 'partial',
      priority: 'medium',
      progress: 60,
      createdAt: '11:00 AM',
      createdBy: { id: 'tom', name: 'Tom Wilson', role: 'Equipment Lead' },
      targetCompletion: '02:00 PM',
      shiftContext: 'Day',
      date: 'Dec 17',
      duration: '2h 15m',
      outcome: 'partial',
      stopReason: 'priority',
      notes: 'Stopped due to UPS emergency taking priority. 2 of 3 forklifts reallocated.',
      origin: { type: 'alert', alertTitle: 'Forklift shortage in Zone A' },
      tasks: [
        { id: 't1', title: 'Move FL-01 to Zone A', status: 'done', assignee: { name: 'Tom Wilson' }, completedAt: '11:30', type: 'equipment-move', actions: [], systemImpact: null },
        { id: 't2', title: 'Move FL-02 to Zone A', status: 'done', assignee: { name: 'Tom Wilson' }, completedAt: '12:15', type: 'equipment-move', actions: [], systemImpact: null },
        { id: 't3', title: 'Move FL-03 to Zone A', status: 'incomplete', assignee: { name: 'Tom Wilson' }, type: 'equipment-move', actions: [], systemImpact: null }
      ]
    }
  ]);
  
  // Derive active plans for Executive Summary
  // When viewMode is 'live', show no plans; when 'live-plan', show active plans
  const activePlans = viewMode === 'live' ? [] : allPlans.filter(p => p.status === 'active');
  
  // Suggested actions data
  const suggestedActions = [
    {
      id: 'action-1',
      title: 'Add 4 FTE pickers to Day shift',
      rationale: '3 picking zones are understaffed during peak hours (10:00-14:00), causing backlog accumulation in Z02 and Z04.',
      role: 'Shift Lead',
      iconType: 'userPlus',
      impact: { staff: 12, zones: 8, schedule: 0, equip: 0 },
      cost: '+$480 labor'
    },
    {
      id: 'action-2',
      title: 'Reassign 2 FTEs from Receiving to Picking',
      rationale: 'Receiving is ahead of schedule; reallocating capacity addresses picking bottleneck without added cost.',
      role: 'Shift Lead',
      iconType: 'refresh',
      impact: { staff: 4, zones: 3, schedule: -2, equip: 0 },
      tradeoff: 'Slower inbound (~30 min delay)',
      cost: 'No added cost'
    },
    {
      id: 'action-3',
      title: 'Activate overflow zone Z07',
      rationale: 'Z04 approaching 95% capacity. Z07 can absorb bulk items and prevent throughput slowdown.',
      role: 'Zone Manager',
      iconType: 'grid',
      impact: { staff: 0, zones: 6, schedule: 0, equip: -2 },
      tradeoff: 'Requires 30 min setup',
      cost: 'Setup time only'
    }
  ];
  
  // Calculate projected impact based on selected actions
  const calculateProjectedImpact = () => {
    const baseScores = { staff: 76, zones: 82, schedule: 91, equip: 94 };
    const impact = { staff: 0, zones: 0, schedule: 0, equip: 0 };
    
    selectedActions.forEach(actionId => {
      const action = suggestedActions.find(a => a.id === actionId);
      if (action) {
        // Simple additive for now - later can model diminishing returns
        impact.staff += action.impact.staff;
        impact.zones += action.impact.zones;
        impact.schedule += action.impact.schedule;
        impact.equip += action.impact.equip;
      }
    });
    
    return {
      staff: { base: baseScores.staff, projected: Math.min(100, baseScores.staff + impact.staff), delta: impact.staff },
      zones: { base: baseScores.zones, projected: Math.min(100, baseScores.zones + impact.zones), delta: impact.zones },
      schedule: { base: baseScores.schedule, projected: Math.min(100, baseScores.schedule + impact.schedule), delta: impact.schedule },
      equip: { base: baseScores.equip, projected: Math.min(100, baseScores.equip + impact.equip), delta: impact.equip }
    };
  };
  
  const projectedImpact = calculateProjectedImpact();
  
  // Toggle action selection
  const toggleAction = (actionId) => {
    setSelectedActions(prev => 
      prev.includes(actionId) 
        ? prev.filter(id => id !== actionId)
        : [...prev, actionId]
    );
  };
  
  // Contributing Factors data for Health Score
  const healthScoreContributingFactors = {
    whatsHappening: 'The facility health score is currently 84, tracking toward 80 by end of shift. This represents a 4-point decline driven primarily by staffing coverage gaps during the lunch period and equipment availability constraints.',
    whyImportant: 'Health scores below 85 correlate with missed SLAs, increased overtime costs, and elevated safety incident risk. Proactive intervention before the 13:00 dip can prevent cascading operational impacts.',
    contributorsLabel: 'Impact on Health Score',
    contributors: [
      { 
        label: 'Equipment Availability', 
        weight: 30, 
        direction: 'down', 
        detail: '2 forklifts in maintenance, 1 reach truck low battery',
        onClick: () => { setActiveTab('equipment'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); }
      },
      { 
        label: 'Staffing Coverage', 
        weight: 25, 
        direction: 'down', 
        detail: '4 call-outs not backfilled, lunch coverage gap at 12:00',
        onClick: () => { setActiveTab('staff'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); }
      },
      { 
        label: 'Zone Throughput', 
        weight: 25, 
        direction: 'neutral', 
        detail: 'Z04 congestion building, Z01 on target',
        onClick: () => { setActiveTab('zones'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); }
      },
      { 
        label: 'Safety Compliance', 
        weight: 20, 
        direction: 'up', 
        detail: '0 incidents today, all certifications current',
        onClick: () => { setActiveTab('insights'); setInsightsSubTab('safety'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); }
      }
    ],
    calculation: {
      formula: 'Health Score = (Equipment × 0.30) + (Staffing × 0.25) + (Throughput × 0.25) + (Safety × 0.20)',
      dataSources: ['Equipment telematics', 'Time & attendance system', 'WMS throughput metrics', 'Safety incident logs', 'Zone sensors'],
      refreshRate: 'Every 5 minutes',
      confidence: 92
    },
    actions: [
      { label: 'View All Alerts', onClick: () => { setActiveTab('insights'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); } },
      { label: 'Run Scenario', onClick: () => { toggleScenarioMode(); setContributingFactorsModal({ isOpen: false, title: '', data: null }); } }
    ]
  };
  
  // Contributing Factors data for Throughput Forecast (context-aware)
  const getThroughputContributingFactors = () => {
    // Current throughput values (would come from real data)
    const currentThroughput = 1890;
    const targetThroughput = 13000;
    const baselinePredicted = 12850;
    const scenarioPredicted = 13850;
    
    // Contextual value when scrubber is moved
    const contextualValue = isContextualDifferent ? Math.round(interpolateValue([
      { time: '06:00', actual: 0 }, { time: '08:00', actual: 420 }, { time: '10:00', actual: 1890 },
      { time: '12:00', predicted: 4200 }, { time: '14:00', predicted: 7800 }
    ], contextualTime) || currentThroughput) : currentThroughput;
    
    const isScenario = scenarioMode;
    const predictedValue = isScenario ? scenarioPredicted : baselinePredicted;
    const willHitTarget = predictedValue >= targetThroughput;
    
    // Build context-aware description
    let whatsHappening;
    if (isScenario) {
      whatsHappening = `With the +4 FTE scenario active, throughput is projected to reach ${scenarioPredicted.toLocaleString()} orders by ${endTimeLabel}, exceeding the ${targetThroughput.toLocaleString()} target by ${(scenarioPredicted - targetThroughput).toLocaleString()} orders. This represents a ${((scenarioPredicted - baselinePredicted) / baselinePredicted * 100).toFixed(0)}% improvement over baseline.`;
    } else if (isContextualDifferent) {
      whatsHappening = `At ${contextualTime}, throughput ${isContextualPast ? 'was' : 'will be'} approximately ${contextualValue.toLocaleString()} orders. Current trajectory projects ${baselinePredicted.toLocaleString()} by ${endTimeLabel}, ${willHitTarget ? 'meeting' : 'falling short of'} the ${targetThroughput.toLocaleString()} target.`;
    } else {
      whatsHappening = `Current throughput is ${currentThroughput.toLocaleString()} orders processed today. Based on current pace, projected to reach ${baselinePredicted.toLocaleString()} by ${endTimeLabel}, ${willHitTarget ? 'meeting' : 'falling short of'} the ${targetThroughput.toLocaleString()} daily target.`;
    }
    
    return {
      whatsHappening,
      whyImportant: 'Throughput directly impacts customer SLAs, carrier pickup windows, and daily revenue recognition. Missing the daily target cascades into overtime costs and next-day backlog accumulation.',
      contributorsLabel: 'Impact on Forecast',
      contributors: [
        { 
          label: 'Work Content Remaining', 
          weight: 35, 
          direction: isScenario ? 'up' : 'neutral',
          detail: isScenario ? '2,100 orders remaining — faster burn rate with added pickers' : '2,100 orders remaining — on pace for completion',
          onClick: () => { setActiveTab('work'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); }
        },
        { 
          label: 'Staffing Levels', 
          weight: 25, 
          direction: isScenario ? 'up' : 'down',
          detail: isScenario ? '46 FTEs active (+4 scenario) — improved pick rate' : '42 FTEs active — 4 call-outs reducing capacity',
          onClick: () => { setActiveTab('staff'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); }
        },
        { 
          label: 'Equipment Availability', 
          weight: 20, 
          direction: 'down',
          detail: '2 forklifts in maintenance — constraining putaway rate',
          onClick: () => { setActiveTab('equipment'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); }
        },
        { 
          label: 'Zone Capacity', 
          weight: 20, 
          direction: isScenario ? 'neutral' : 'down',
          detail: isScenario ? 'Z04 congestion managed with redistributed staff' : 'Z04 at 91% capacity — creating bottleneck',
          onClick: () => { setActiveTab('zones'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); }
        }
      ],
      calculation: {
        formula: 'Throughput = (Active Workers × Avg UPH) × Equipment Factor × Zone Efficiency',
        dataSources: ['WMS order completions', 'Time & attendance', 'Equipment telematics', 'Zone sensors'],
        refreshRate: 'Real-time',
        confidence: isScenario ? 88 : 94
      },
      actions: isScenario ? [
        { label: 'View Work Content', onClick: () => { setActiveTab('work'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); } },
        { label: 'Exit Scenario', onClick: () => { toggleScenarioMode(); setContributingFactorsModal({ isOpen: false, title: '', data: null }); } }
      ] : [
        { label: 'View Work Content', onClick: () => { setActiveTab('work'); setContributingFactorsModal({ isOpen: false, title: '', data: null }); } },
        { label: 'Run Scenario', onClick: () => { toggleScenarioMode(); setContributingFactorsModal({ isOpen: false, title: '', data: null }); } }
      ]
    };
  };
  
  // Navigation stack for journey-based breadcrumbs
  // Each item: { type: 'facility' | 'zone' | 'equipment' | 'staff', id: string, label: string }
  const [navigationStack, setNavigationStack] = useState([
    { type: 'facility', id: 'facility', label: 'Facility Overview' }
  ]);
  
  // Detail view sub-tab state (for zone/equipment/staff detail views)
  const [detailSubTab, setDetailSubTab] = useState('dashboard');
  
  // Get current view from navigation stack
  const currentView = navigationStack[navigationStack.length - 1];
  const isAtFacilityLevel = currentView.type === 'facility';
  
  // Helper to scroll content to top
  const scrollToTop = () => {
    setTimeout(() => {
      const scrollContainer = document.querySelector('[data-scroll-container]');
      if (scrollContainer) {
        scrollContainer.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }, 10);
  };
  
  // Navigate INTO a detail view (push to stack)
  const navigateTo = (type, id, label) => {
    setNavigationStack(prev => [...prev, { type, id, label }]);
    setDetailSubTab('dashboard'); // Reset to dashboard when entering new detail view
    scrollToTop();
  };
  
  // Navigate BACK via breadcrumb (pop stack to that index)
  const navigateBack = (index) => {
    setNavigationStack(prev => prev.slice(0, index + 1));
    setDetailSubTab('dashboard');
    scrollToTop();
  };
  
  // Function to navigate to alert in Insights tab
  const navigateToAlert = (alertId, category, showDetail = false) => {
    // Set the sub-tab based on category
    if (category) {
      setInsightsSubTab(category);
    }
    
    // If showDetail is true, find and select the alert to show its detail view
    if (showDetail) {
      const alertToSelect = alerts.find(a => a.id === alertId);
      if (alertToSelect) {
        setSelectedAlert(alertToSelect);
      }
      // Scroll to top after a short delay to let the view render
      setTimeout(() => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }, 50);
    } else {
      // Set the highlighted alert for scroll + pulse
      setHighlightedAlert(alertId);
      // Scroll to alert after a short delay
      setTimeout(() => {
        const el = document.getElementById(`insight-${alertId}`);
        if (el) {
          el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }, 100);
      // Clear the highlight after the pulse animation
      setTimeout(() => {
        setHighlightedAlert(null);
      }, 2000);
    }
    
    // If at facility level, navigate to insights tab
    // If in detail view, switch to insights sub-tab
    if (isAtFacilityLevel) {
      setActiveTab('insights');
    } else {
      setDetailSubTab('insights');
    }
  };
  
  // Facility-level tabs
  const facilityTabs = [
    { id: 'dashboard', icon: LayoutDashboard, label: 'Dashboard' },
    { id: 'plans', icon: ClipboardList, label: 'Plans' },
    { id: 'staff', icon: Users, label: 'Staff' },
    { id: 'work', icon: Package, label: 'Work Content' },
    { id: 'zones', icon: MapPin, label: 'Zones' },
    { id: 'equipment', icon: Wrench, label: 'Equipment' },
    { id: 'schedule', icon: Calendar, label: 'Schedule' },
    { id: 'financial', icon: DollarSign, label: 'Financial' },
    { id: 'insights', icon: Lightbulb, label: 'Insights' },
    { id: 'config', icon: Filter, label: 'Config' }
  ];
  
  // Equipment detail tabs (contextual)
  const equipmentTabs = [
    { id: 'dashboard', icon: LayoutDashboard, label: 'Dashboard' },
    { id: 'operators', icon: Users, label: 'Operators' },
    { id: 'work', icon: Package, label: 'Work' },
    { id: 'routes', icon: Navigation, label: 'Routes' },
    { id: 'location', icon: MapPin, label: 'Location' },
    { id: 'schedule', icon: Calendar, label: 'Schedule' },
    { id: 'fleet', icon: Truck, label: 'Fleet' },
    { id: 'insights', icon: Lightbulb, label: 'Insights' },
    { id: 'config', icon: Settings, label: 'Config' }
  ];
  
  // Staff detail tabs (contextual)
  const staffTabs = [
    { id: 'dashboard', icon: LayoutDashboard, label: 'Dashboard' },
    { id: 'performance', icon: TrendingUp, label: 'Performance' },
    { id: 'equipment', icon: Truck, label: 'Equipment' },
    { id: 'schedule', icon: Calendar, label: 'Schedule' },
    { id: 'certifications', icon: ClipboardList, label: 'Certifications' },
    { id: 'safety', icon: AlertTriangle, label: 'Safety' },
    { id: 'attendance', icon: Clock, label: 'Attendance' },
    { id: 'history', icon: Activity, label: 'History' },
    { id: 'insights', icon: Lightbulb, label: 'Insights' },
    { id: 'config', icon: Settings, label: 'Config' }
  ];
  
  // Zone detail tabs (contextual) - matching your screenshot
  const zoneTabs = [
    { id: 'dashboard', icon: LayoutDashboard, label: 'Dashboard' },
    { id: 'staff', icon: Users, label: 'Staff' },
    { id: 'work', icon: Package, label: 'Work' },
    { id: 'zones', icon: MapPin, label: 'Locations' },
    { id: 'equipment', icon: Truck, label: 'Equipment' },
    { id: 'schedule', icon: Calendar, label: 'Schedule' },
    { id: 'insights', icon: Lightbulb, label: 'Insights' },
    { id: 'config', icon: Settings, label: 'Config' }
  ];
  
  // Get tabs based on current view type
  const getTabsForView = () => {
    switch (currentView.type) {
      case 'equipment': return equipmentTabs;
      case 'staff': return staffTabs;
      case 'zone': return zoneTabs;
      default: return facilityTabs;
    }
  };
  
  const currentTabs = getTabsForView();
  
  const health = 84;
  const healthPredicted = 80;
  
  // Timeline data for interpolation (baseline)
  const healthTimeline = [
    { time: '06:00', actual: 88, predicted: null },
    { time: '08:00', actual: 86, predicted: null },
    { time: '10:00', actual: 84, predicted: 84, now: true },
    { time: '12:00', actual: null, predicted: 80, upper: 83, lower: 77 },
    { time: '14:00', actual: null, predicted: 82, upper: 86, lower: 78 },
    { time: '16:00', actual: null, predicted: 84, upper: 88, lower: 80 },
    { time: '18:00', actual: null, predicted: 85, upper: 89, lower: 81 },
    { time: '20:00', actual: null, predicted: 86, upper: 90, lower: 82 },
    { time: '22:00', actual: null, predicted: 87, upper: 91, lower: 83 }
  ];
  
  // Scenario timeline data (what happens if we apply the scenario)
  const healthTimelineScenario = [
    { time: '06:00', actual: 88, predicted: null },
    { time: '08:00', actual: 86, predicted: null },
    { time: '10:00', actual: 84, predicted: 84, now: true },
    { time: '12:00', actual: null, predicted: 83, upper: 86, lower: 80 },  // Scenario kicks in
    { time: '14:00', actual: null, predicted: 88, upper: 91, lower: 85 },  // Improved
    { time: '16:00', actual: null, predicted: 90, upper: 93, lower: 87 },  // Improved
    { time: '18:00', actual: null, predicted: 91, upper: 94, lower: 88 },
    { time: '20:00', actual: null, predicted: 91, upper: 94, lower: 88 },
    { time: '22:00', actual: null, predicted: 92, upper: 95, lower: 89 }
  ];
  
  const throughputTimeline = [
    { time: '06:00', actual: 0, predicted: null },
    { time: '08:00', actual: 1680, predicted: null },
    { time: '10:00', actual: 4200, predicted: 4200, now: true },
    { time: '12:00', actual: null, predicted: 6300, upper: 6600, lower: 6000 },
    { time: '14:00', actual: null, predicted: 8400, upper: 8800, lower: 8000 },
    { time: '16:00', actual: null, predicted: 10200, upper: 10800, lower: 9600 },
    { time: '18:00', actual: null, predicted: 11400, upper: 12200, lower: 10600 },
    { time: '20:00', actual: null, predicted: 12400, upper: 13400, lower: 11400 },
    { time: '22:00', actual: null, predicted: 12850, upper: 14000, lower: 11700 }
  ];
  
  // Scenario throughput - improved with additional staffing
  const throughputTimelineScenario = [
    { time: '06:00', actual: 0, predicted: null },
    { time: '08:00', actual: 1680, predicted: null },
    { time: '10:00', actual: 4200, predicted: 4200, now: true },
    { time: '12:00', actual: null, predicted: 6800, upper: 7100, lower: 6500 },
    { time: '14:00', actual: null, predicted: 9200, upper: 9700, lower: 8700 },
    { time: '16:00', actual: null, predicted: 11200, upper: 11900, lower: 10500 },
    { time: '18:00', actual: null, predicted: 12600, upper: 13400, lower: 11800 },
    { time: '20:00', actual: null, predicted: 13400, upper: 14400, lower: 12400 },
    { time: '22:00', actual: null, predicted: 13850, upper: 15000, lower: 12700 }
  ];
  
  // Predictive alerts - baseline
  const baselineAlerts = [
    { id: 'alert-picking', sev: 'warning', title: 'Picking shortfall', msg: 'Zone B velocity dropping below target pace', time: '+2.5hr', conf: 78 },
    { id: 'alert-ups', sev: 'critical', title: 'UPS cutoff at risk', msg: '~40 orders may miss 15:30 cutoff', time: '+5.5hr', conf: 72 },
    { id: 'alert-dock', sev: 'warning', title: 'Dock congestion', msg: 'D03-D06 backing up, dwell time increasing', time: '+4hr', conf: 65 }
  ];
  
  // Scenario alerts - some mitigated, some new
  const scenarioAlerts = [
    { ...baselineAlerts[0], state: 'mitigated' }, // Picking shortfall resolved by added pickers
    { ...baselineAlerts[1], state: 'mitigated' }, // UPS cutoff resolved by improved velocity
    { ...baselineAlerts[2], state: 'persists' },  // Dock congestion still exists
    { id: 'alert-overtime', sev: 'info', title: 'Overtime budget impact', msg: '4 additional FTEs = ~$480 added labor cost', time: '+8hr', conf: 95, state: 'new' }
  ];
  
  // Get contextual values by interpolating from timeline data
  const contextualHealth = isContextualDifferent ? interpolateValue(healthTimeline, contextualTime) : null;
  const contextualThroughput = isContextualDifferent ? interpolateValue(throughputTimeline, contextualTime) : null;
  
  // Scenario values
  const contextualHealthScenario = isContextualDifferent ? interpolateValue(healthTimelineScenario, contextualTime) : null;
  const healthPredictedScenario = interpolateValue(healthTimelineScenario, endTime) || 92;
  const endTimeHealthBaseline = interpolateValue(healthTimeline, endTime) || healthPredicted;
  const endTimeHealthScenario = interpolateValue(healthTimelineScenario, endTime) || healthPredictedScenario;
  
  // Metrics with timeline data for contextual values
  const metricsTimelines = {
    orders: [
      { time: '06:00', actual: 0 },
      { time: '08:00', actual: 5200 },
      { time: '10:00', actual: 12450 },
      { time: '12:00', actual: null, predicted: 12650 },
      { time: '14:00', actual: null, predicted: 12750 },
      { time: '22:00', actual: null, predicted: 12850 }
    ],
    units: [
      { time: '06:00', actual: 0 },
      { time: '08:00', actual: 19500 },
      { time: '10:00', actual: 48200 },
      { time: '14:00', actual: null, predicted: 50800 },
      { time: '22:00', actual: null, predicted: 51400 }
    ],
    onTime: [
      { time: '06:00', actual: 96.2 },
      { time: '08:00', actual: 95.1 },
      { time: '10:00', actual: 94.2 },
      { time: '14:00', actual: null, predicted: 93.8 },
      { time: '22:00', actual: null, predicted: 93.8 }
    ],
    cost: [
      { time: '06:00', actual: 5.20 },
      { time: '08:00', actual: 4.95 },
      { time: '10:00', actual: 4.82 },
      { time: '14:00', actual: null, predicted: 4.78 },
      { time: '22:00', actual: null, predicted: 4.78 }
    ]
  };
  
  const metrics = [
    { l: 'Orders Today', v: '12,450', vNum: 12450, t: '13,000', tNum: 13000, p: 96, tr: '+4.2%', up: true, ok: true, pred: '12,850', predNum: 12850, predScenario: '13,150', predScenarioNum: 13150, timeline: metricsTimelines.orders, format: v => v.toLocaleString(), higherIsBetter: true, tab: 'work' },
    { l: 'Units Processed', v: '48,200', vNum: 48200, t: '52,000', tNum: 52000, p: 93, tr: '+2.8%', up: true, ok: true, pred: '51,400', predNum: 51400, predScenario: '53,800', predScenarioNum: 53800, timeline: metricsTimelines.units, format: v => v.toLocaleString(), higherIsBetter: true, tab: 'work' },
    { l: 'On-Time Ship %', v: '94.2%', vNum: 94.2, t: '95%', tNum: 95, p: 94, tr: '-0.8%', up: false, ok: false, pred: '93.8%', predNum: 93.8, predScenario: '95.4%', predScenarioNum: 95.4, timeline: metricsTimelines.onTime, format: v => v.toFixed(1) + '%', higherIsBetter: true, tab: 'zones' },
    { l: 'Cost per Order', v: '$4.82', vNum: 4.82, t: '$4.50', tNum: 4.50, p: 93, tr: '-2.4%', up: false, ok: false, pred: '$4.78', predNum: 4.78, predScenario: '$4.65', predScenarioNum: 4.65, timeline: metricsTimelines.cost, format: v => '$' + v.toFixed(2), higherIsBetter: false, tab: 'insights' }
  ];
  
  // Day shift timelines for contextual interpolation (active shift only)
  const dayShiftTimelines = {
    throughput: [
      { time: '06:00', actual: 0 },
      { time: '08:00', actual: 1680 },
      { time: '10:00', actual: 4200 },
      { time: '12:00', predicted: 6300 },
      { time: '14:00', predicted: 8400 }
    ],
    completion: [
      { time: '06:00', actual: 0 },
      { time: '08:00', actual: 20 },
      { time: '10:00', actual: 50 },
      { time: '12:00', predicted: 75 },
      { time: '14:00', predicted: 97 }
    ],
    staffing: [
      { time: '06:00', actual: 92 },
      { time: '08:00', actual: 90 },
      { time: '10:00', actual: 88 },
      { time: '12:00', predicted: 83 },
      { time: '14:00', predicted: 85 }
    ]
  };
  
  const shifts = [
    { name: 'Day Shift', id: 'day', status: 'active', time: '06:00-14:00', tp: 4200, tpPred: 8400, tpPredScenario: 9200, comp: 50, compPred: 97, compPredScenario: 99, staff: 88, staffScenario: 92, ot: 94, otScenario: 96, timelines: dayShiftTimelines },
    { name: 'Swing Shift', id: 'swing', status: 'upcoming', time: '14:00-22:00', tp: null, tpPred: 3600, tpPredScenario: 3800, comp: null, compPred: 95, compPredScenario: 97, staff: 87, staffScenario: 87, ot: null, otScenario: null },
    { name: 'Night Shift', id: 'night', status: 'completed', time: '22:00-06:00', tp: 3850, tpPred: null, comp: 96, compPred: null, staff: 94, ot: 91 }
  ];
  
  const alerts = [
    { 
      id: 'alert-1',
      sev: 'critical', 
      title: 'Zone Z04 capacity breach', 
      msg: 'Bulk Storage at 91% by 12:00', 
      time: '+2hr', 
      conf: 84,
      category: 'zones',
      rootCause: { id: 1, name: 'Staffing-Capacity Mismatch', alertCount: 3 },
      whatsHappening: 'Z04 Bulk Storage is currently at 83% capacity and trending upward. Based on inbound velocity and current putaway rates, we project 91% capacity by 12:00. The zone has limited overflow options and is approaching the threshold where new pallets will need to be staged in aisles.',
      whyItMatters: 'Capacity breach in Z04 will block inbound receiving operations, creating a cascade effect. Trailers at dock will experience extended dwell times, potentially triggering detention fees ($150/hr per trailer). Additionally, staged pallets in aisles create safety hazards and slow forklift travel times by ~15%.',
      actions: [
        { action: 'Expedite putaway in Z04 (reassign 1 FTE from Z02)', impact: '-8% capacity in 2hrs', tradeoff: 'Z02 putaway slows ~15%', confidence: 86, owner: 'Shift Lead' },
        { action: 'Activate overflow zone Z07', impact: 'Additional 200 pallet capacity', tradeoff: 'Longer travel times for picks', confidence: 92, owner: 'Ops Manager' }
      ]
    },
    { 
      id: 'alert-2',
      sev: 'critical', 
      title: 'UPS cutoff at risk', 
      msg: '~40 orders may miss 15:30', 
      time: '+5.5hr', 
      conf: 72,
      category: 'work',
      rootCause: { id: 1, name: 'Staffing-Capacity Mismatch', alertCount: 3 },
      whatsHappening: 'Current pick velocity is 520 orders/hr against a target of 600/hr. With 1,240 UPS orders remaining in queue and a 15:30 carrier cutoff, approximately 40 orders are projected to miss the window based on current trajectory.',
      whyItMatters: 'Missed UPS cutoffs result in next-day delivery delays for customers, potential SLA penalties ($2.50/order = ~$100), and customer satisfaction impact. UPS represents 35% of daily volume and has strict cutoff enforcement.',
      actions: [
        { action: 'Reassign 2 FTEs from Pack to Pick zone', impact: '+18% pick velocity', tradeoff: 'Pack queue grows temporarily', confidence: 89, owner: 'Shift Lead' },
        { action: 'Prioritize UPS orders in pick queue', impact: 'UPS on-time ↑15%', tradeoff: 'FedEx orders may slip 8%', confidence: 78, owner: 'System' }
      ]
    },
    { 
      id: 'alert-3',
      sev: 'warning', 
      title: 'Swing understaffed', 
      msg: '4 FTE gap vs volume', 
      time: '+4hr', 
      conf: 88,
      category: 'staffing',
      rootCause: { id: 1, name: 'Staffing-Capacity Mismatch', alertCount: 3 },
      whatsHappening: 'Swing shift (14:00-22:00) is scheduled with 38 FTEs against a volume-based requirement of 42 FTEs. The gap is concentrated in Pick and Pack functions. Two call-outs have been reported, exacerbating the shortage.',
      whyItMatters: 'Understaffing during swing shift will create a throughput bottleneck during peak outbound hours (16:00-20:00). This risks missing evening carrier cutoffs (FedEx 18:00, USPS 19:00) and creates carryover work for night shift, impacting their productivity.',
      actions: [
        { action: 'Authorize 4 hrs OT for 2 Day Shift FTEs', impact: '+2 FTE coverage until 18:00', tradeoff: '+$180 labor cost', confidence: 94, owner: 'Ops Manager', conflict: true },
        { action: 'Request 2 temp workers for 14:00 start', impact: '+2 FTE for full swing', tradeoff: '+$240 temp labor cost', confidence: 85, owner: 'Ops Manager' }
      ]
    },
    { 
      id: 'alert-4',
      sev: 'warning', 
      title: 'Labor over budget', 
      msg: '+5.6% predicted at shift end', 
      time: '+4hr', 
      conf: 95,
      category: 'staffing',
      rootCause: { id: 2, name: 'Labor Cost Overrun', alertCount: 1 },
      whatsHappening: 'Current labor spend is $6,420 against a planned $6,080 at this hour (5.6% over). OT hours are at 24 vs target of 18. Temp labor is at 4 FTEs. Projected end-of-day spend is $13,100 vs $12,400 budget.',
      whyItMatters: 'Continued trajectory will result in $700 budget overrun for the day. If pattern continues through week, monthly impact could reach $15,000+. Finance has flagged labor efficiency as a Q4 focus area with executive visibility.',
      actions: [
        { action: 'Reduce temp labor by 1 FTE after 12:00', impact: '-$95 labor cost', tradeoff: 'Slightly slower pack rate', confidence: 82, owner: 'Shift Lead' },
        { action: 'Cap OT at 40 hrs total for shift', impact: 'Stay within budget ceiling', tradeoff: 'May need to deprioritize non-critical work', confidence: 91, owner: 'Ops Manager', conflict: true }
      ]
    },
    // Schedule > Staffing alerts
    { 
      ...ALERTS_DATA['staffing-ups-cutoff'],
      id: 'staffing-ups-cutoff',
      rootCause: { id: 1, name: 'Staffing-Capacity Mismatch', alertCount: 3 },
      whatsHappening: ALERTS_DATA['staffing-ups-cutoff'].msg,
      whyItMatters: 'Missing UPS cutoff impacts customer delivery promises and carrier relationships.',
      actions: [
        { action: 'Reassign 2 FTE to Pack Station 1', impact: '+8/hr velocity', tradeoff: 'Pick queue grows slightly', confidence: 85, owner: 'Shift Lead' }
      ]
    },
    { 
      ...ALERTS_DATA['staffing-break-coverage'],
      id: 'staffing-break-coverage',
      rootCause: { id: 1, name: 'Staffing-Capacity Mismatch', alertCount: 3 },
      whatsHappening: ALERTS_DATA['staffing-break-coverage'].msg,
      whyItMatters: 'Coverage gaps during breaks can create throughput bottlenecks and safety concerns.',
      actions: [
        { action: 'Stagger breaks by 15 minutes', impact: 'Maintain 24+ FTE coverage', tradeoff: 'Longer total break window', confidence: 88, owner: 'Shift Lead' }
      ]
    },
    // Schedule > Inbound alerts  
    { 
      ...ALERTS_DATA['inbound-dock-congestion'],
      id: 'inbound-dock-congestion',
      rootCause: { id: 3, name: 'Dock Scheduling Conflict', alertCount: 2 },
      whatsHappening: ALERTS_DATA['inbound-dock-congestion'].msg,
      whyItMatters: 'Dock congestion delays unloading, increases truck dwell time and potential detention fees.',
      actions: [
        { action: 'Reassign T-1855 to Dock 4', impact: 'Avoid dock conflict', tradeoff: 'Longer putaway travel', confidence: 90, owner: 'Dock Lead' }
      ]
    },
    { 
      ...ALERTS_DATA['inbound-crew-gap'],
      id: 'inbound-crew-gap',
      rootCause: { id: 3, name: 'Dock Scheduling Conflict', alertCount: 2 },
      whatsHappening: ALERTS_DATA['inbound-crew-gap'].msg,
      whyItMatters: 'Idle crew time is wasted labor cost while other areas may be understaffed.',
      actions: [
        { action: 'Reassign 2 FTE from Dock 3 to Dock 1', impact: 'Accelerate T-1847 unload', tradeoff: 'T-1852 unload delayed further', confidence: 92, owner: 'Dock Lead' }
      ]
    },
    // Schedule > Outbound alerts
    { 
      ...ALERTS_DATA['outbound-ups-cutoff'],
      id: 'outbound-ups-cutoff',
      rootCause: { id: 1, name: 'Staffing-Capacity Mismatch', alertCount: 3 },
      whatsHappening: ALERTS_DATA['outbound-ups-cutoff'].msg,
      whyItMatters: 'UPS cutoff miss impacts same-day delivery commitments and carrier SLAs.',
      actions: [
        { action: 'Reassign 2 FTE from Pack Station 2', impact: '+8/hr ship velocity', tradeoff: 'Pack Station 2 queue grows', confidence: 80, owner: 'Shift Lead' }
      ]
    },
    { 
      ...ALERTS_DATA['outbound-fedex-staging'],
      id: 'outbound-fedex-staging',
      rootCause: { id: 4, name: 'Staging Delay', alertCount: 1 },
      whatsHappening: ALERTS_DATA['outbound-fedex-staging'].msg,
      whyItMatters: 'Late staging risks missing FedEx Express cutoff and premium delivery commitments.',
      actions: [
        { action: 'Prioritize FedEx Express in pick queue', impact: 'On-time staging by 15:30', tradeoff: 'Other carrier orders deprioritized', confidence: 88, owner: 'Pick Lead' }
      ]
    },
    // Schedule > Maintenance alerts
    { 
      ...ALERTS_DATA['maint-fl02-pm-peak'],
      id: 'maint-fl02-pm-peak',
      rootCause: { id: 5, name: 'Maintenance Scheduling', alertCount: 1 },
      whatsHappening: ALERTS_DATA['maint-fl02-pm-peak'].msg,
      whyItMatters: 'Equipment downtime during shift change compounds staffing transition challenges.',
      actions: [
        { action: 'Reschedule PM to 13:00', impact: 'Avoid swing shift conflict', tradeoff: 'Earlier crew assignment needed', confidence: 75, owner: 'Maintenance Lead' }
      ]
    },
    // ===== STAFF TAB ALERTS =====
    { 
      ...ALERTS_DATA['staff-break-coverage'],
      id: 'staff-break-coverage',
      rootCause: { id: 1, name: 'Staffing-Capacity Mismatch', alertCount: 3 },
      whatsHappening: ALERTS_DATA['staff-break-coverage'].msg,
      whyItMatters: 'Break coverage gaps create throughput bottlenecks and safety concerns.',
      actions: [
        { action: 'Stagger breaks by 15 minutes', impact: 'Maintain 24+ FTE coverage', tradeoff: 'Longer total break window', confidence: 88, owner: 'Shift Lead' },
        { action: 'Authorize 2 OT extensions', impact: '+2 FTE during lunch', tradeoff: '+$90 labor cost', confidence: 92, owner: 'Ops Manager' }
      ]
    },
    { 
      ...ALERTS_DATA['staff-swing-understaffed'],
      id: 'staff-swing-understaffed',
      rootCause: { id: 1, name: 'Staffing-Capacity Mismatch', alertCount: 3 },
      whatsHappening: ALERTS_DATA['staff-swing-understaffed'].msg,
      whyItMatters: 'Understaffing during swing shift risks evening carrier cutoffs.',
      actions: [
        { action: 'Request 4 temp workers for 14:00', impact: 'Close FTE gap', tradeoff: '+$320 temp labor cost', confidence: 85, owner: 'Ops Manager' }
      ]
    },
    { 
      ...ALERTS_DATA['staff-receiving-uplh'],
      id: 'staff-receiving-uplh',
      rootCause: { id: 6, name: 'Productivity Decline', alertCount: 1 },
      whatsHappening: ALERTS_DATA['staff-receiving-uplh'].msg,
      whyItMatters: 'Declining UPLH increases labor cost per unit and may cause carryover.',
      actions: [
        { action: 'Rebalance 1 FTE from shipping to receiving', impact: '+5% receiving UPLH', tradeoff: 'Shipping velocity -3%', confidence: 74, owner: 'Shift Lead' }
      ]
    },
    { 
      ...ALERTS_DATA['staff-handoff-optimal'],
      id: 'staff-handoff-optimal',
      rootCause: null,
      whatsHappening: ALERTS_DATA['staff-handoff-optimal'].msg,
      whyItMatters: 'Clean shift handoffs maintain productivity continuity and prevent carryover issues.',
      actions: []
    },
    // ===== ZONES TAB ALERTS =====
    { 
      ...ALERTS_DATA['zones-z04-capacity'],
      id: 'zones-z04-capacity',
      rootCause: { id: 7, name: 'Zone Capacity Breach', alertCount: 1 },
      whatsHappening: ALERTS_DATA['zones-z04-capacity'].msg,
      whyItMatters: 'Capacity breach blocks inbound receiving and triggers detention fees.',
      actions: [
        { action: 'Expedite 40 pallets to Reserve', impact: '-8% capacity in 2hrs', tradeoff: 'Longer pick travel times', confidence: 86, owner: 'Shift Lead' },
        { action: 'Activate overflow zone Z07', impact: 'Additional 200 pallet capacity', tradeoff: '+15% travel time for picks', confidence: 92, owner: 'Ops Manager' }
      ]
    },
    { 
      ...ALERTS_DATA['zones-z02-underutilized'],
      id: 'zones-z02-underutilized',
      rootCause: { id: 8, name: 'Zone Imbalance', alertCount: 1 },
      whatsHappening: ALERTS_DATA['zones-z02-underutilized'].msg,
      whyItMatters: 'Underutilized zones represent wasted capacity while others are constrained.',
      actions: [
        { action: 'Redirect inbound to Z02', impact: 'Balance zone utilization', tradeoff: 'Different putaway routes', confidence: 90, owner: 'Dock Lead' }
      ]
    },
    { 
      ...ALERTS_DATA['zones-z01-pick-congestion'],
      id: 'zones-z01-pick-congestion',
      rootCause: { id: 9, name: 'Pick Congestion', alertCount: 1 },
      whatsHappening: ALERTS_DATA['zones-z01-pick-congestion'].msg,
      whyItMatters: 'Picker congestion reduces individual productivity and creates safety hazards.',
      actions: [
        { action: 'Stagger pick waves by 10 minutes', impact: 'Reduce aisle congestion', tradeoff: 'Slightly longer cycle time', confidence: 78, owner: 'Pick Lead' }
      ]
    },
    { 
      ...ALERTS_DATA['zones-z03-replen-needed'],
      id: 'zones-z03-replen-needed',
      rootCause: null,
      whatsHappening: ALERTS_DATA['zones-z03-replen-needed'].msg,
      whyItMatters: 'Timely replenishment prevents pick stockouts and maintains velocity.',
      actions: []
    },
    // ===== WORK CONTENT TAB ALERTS =====
    { 
      ...ALERTS_DATA['work-ups-velocity'],
      id: 'work-ups-velocity',
      rootCause: { id: 1, name: 'Staffing-Capacity Mismatch', alertCount: 3 },
      whatsHappening: ALERTS_DATA['work-ups-velocity'].msg,
      whyItMatters: 'Missing UPS cutoff impacts customer delivery promises and SLAs.',
      actions: [
        { action: 'Reassign 2 FTE to pack', impact: '+8/hr velocity', tradeoff: 'Pick queue grows slightly', confidence: 85, owner: 'Shift Lead' }
      ]
    },
    { 
      ...ALERTS_DATA['work-pick-queue-growing'],
      id: 'work-pick-queue-growing',
      rootCause: { id: 10, name: 'Queue Imbalance', alertCount: 1 },
      whatsHappening: ALERTS_DATA['work-pick-queue-growing'].msg,
      whyItMatters: 'Growing pick queue risks carryover and missed cutoffs.',
      actions: [
        { action: 'Add 1 picker from pack', impact: 'Stabilize queue growth', tradeoff: 'Pack velocity -5%', confidence: 82, owner: 'Shift Lead' }
      ]
    },
    { 
      ...ALERTS_DATA['work-fedex-express-priority'],
      id: 'work-fedex-express-priority',
      rootCause: { id: 4, name: 'Staging Delay', alertCount: 1 },
      whatsHappening: ALERTS_DATA['work-fedex-express-priority'].msg,
      whyItMatters: 'FedEx Express has premium delivery commitments with higher penalty costs.',
      actions: [
        { action: 'Prioritize in pick queue', impact: 'On-time for 17:00 cutoff', tradeoff: 'Standard orders deprioritized', confidence: 88, owner: 'Pick Lead' }
      ]
    },
    { 
      ...ALERTS_DATA['work-pack-station-balanced'],
      id: 'work-pack-station-balanced',
      rootCause: null,
      whatsHappening: ALERTS_DATA['work-pack-station-balanced'].msg,
      whyItMatters: 'Balanced pack stations maximize throughput and prevent bottlenecks.',
      actions: []
    },
    // ===== EQUIPMENT ALERTS =====
    { 
      ...ALERTS_DATA['equip-pm-overdue'],
      id: 'equip-pm-overdue',
      rootCause: { id: 11, name: 'Maintenance Compliance', alertCount: 2 },
      whatsHappening: 'FL-06 is 25 hours past its scheduled preventive maintenance window. The unit has accumulated 425 operating hours since last PM against a 400-hour interval. Currently pulled from service for inspection.',
      whyItMatters: 'Overdue PM increases breakdown risk and potential safety hazards. Extended operation without maintenance accelerates wear on hydraulics and drivetrain, potentially leading to costly repairs or unplanned downtime during peak operations.',
      actions: [
        { action: 'Complete PM immediately', impact: 'Return to service by 14:00', tradeoff: '1 hr reduced forklift capacity', confidence: 95, owner: 'Maintenance' },
        { action: 'Expedite parts if needed', impact: 'Avoid extended downtime', tradeoff: '+$50 rush delivery', confidence: 88, owner: 'Maintenance' }
      ]
    },
    { 
      ...ALERTS_DATA['equip-tt03-offline'],
      id: 'equip-tt03-offline',
      rootCause: { id: 11, name: 'Maintenance Compliance', alertCount: 2 },
      whatsHappening: 'TT-03 (Tugger/Tow Tractor) is offline due to transmission failure. Unit requires major repair with parts on order. Current ETA for parts is 12/20, with repair completion expected 12/21.',
      whyItMatters: 'With only 3 of 4 tuggers operational, yard operations and dock-to-warehouse material flow is constrained. This impacts inbound receiving throughput and trailer turn times.',
      actions: [
        { action: 'Expedite parts delivery', impact: 'Reduce downtime by 1 day', tradeoff: '+$180 rush shipping', confidence: 75, owner: 'Maintenance' },
        { action: 'Rent temporary replacement', impact: 'Maintain full capacity', tradeoff: '$350/day rental', confidence: 90, owner: 'Ops Manager' }
      ]
    },
    { 
      ...ALERTS_DATA['equip-epj03-repair'],
      id: 'equip-epj03-repair',
      rootCause: { id: 12, name: 'Equipment Availability', alertCount: 1 },
      whatsHappening: 'EPJ-03 is currently in repair for a faulty lift cylinder. Technician started work at 08:30 and estimates completion by 14:00. Unit will require testing before return to service.',
      whyItMatters: 'Inbound receiving area is operating with reduced pallet jack capacity. Current workload is manageable but any additional equipment issues would create bottlenecks.',
      actions: [
        { action: 'Monitor repair progress', impact: 'Ensure on-time return', tradeoff: 'None', confidence: 85, owner: 'Maintenance' }
      ]
    },
    { 
      ...ALERTS_DATA['equip-battery-low'],
      id: 'equip-battery-low',
      rootCause: { id: 13, name: 'Battery Management', alertCount: 1 },
      whatsHappening: 'Three electric MHE units have battery levels below 60%: RT-04 (35%, charging), EPJ-06 (28%, charging), and OP-02 (52%, still in use). OP-02 will need to rotate to charging within 2 hours.',
      whyItMatters: 'Running batteries below 20% damages cells and shortens lifespan. Unplanned charging during peak hours reduces fleet availability. OP-02 operating in Forward Pick zone.',
      actions: [
        { action: 'Schedule OP-02 for lunch break charging', impact: 'Avoid mid-shift interruption', tradeoff: 'None', confidence: 92, owner: 'Shift Lead' },
        { action: 'Swap OP-02 with OP-04 (idle, 89%)', impact: 'Immediate capacity', tradeoff: 'Operator transition time', confidence: 88, owner: 'Shift Lead' }
      ]
    },
    { 
      ...ALERTS_DATA['equip-pm-upcoming'],
      id: 'equip-pm-upcoming',
      rootCause: null,
      whatsHappening: 'Four preventive maintenance appointments scheduled this week: FL-04 (today 14:00), FL-02 (tomorrow 08:00), EPJ-01 (12/18), and RT-03 (12/19). All technicians confirmed.',
      whyItMatters: 'Scheduled PMs maintain equipment reliability and prevent unplanned breakdowns. Proper planning ensures minimal operational impact.',
      actions: []
    }
  ];
  
  // Category timelines for contextual interpolation
  const catTimelines = {
    staff: [{ time: '06:00', actual: 85 }, { time: '08:00', actual: 82 }, { time: '10:00', actual: 78 }, { time: '12:00', predicted: 72 }, { time: '14:00', predicted: 75 }],
    zones: [{ time: '06:00', actual: 88 }, { time: '08:00', actual: 85 }, { time: '10:00', actual: 82 }, { time: '12:00', predicted: 78 }, { time: '14:00', predicted: 78 }],
    work: [{ time: '06:00', actual: 82 }, { time: '08:00', actual: 85 }, { time: '10:00', actual: 88 }, { time: '12:00', predicted: 90 }, { time: '14:00', predicted: 92 }],
    sched: [{ time: '06:00', actual: 90 }, { time: '08:00', actual: 88 }, { time: '10:00', actual: 86 }, { time: '12:00', predicted: 85 }, { time: '14:00', predicted: 88 }],
    fin: [{ time: '06:00', actual: 85 }, { time: '08:00', actual: 82 }, { time: '10:00', actual: 79 }, { time: '12:00', predicted: 76 }, { time: '14:00', predicted: 74 }]
  };
  
  const cats = [
    { id: 'staff', icon: Users, label: 'Staff', color: C.purple[500], score: 78, pred: 75, predScenario: 78, sum: '42/48 now → 38 @ 14:00', sumScenario: '42/48 now → 44/48 scenario', alerts: 2, timeline: catTimelines.staff },
    { id: 'zones', icon: MapPin, label: 'Zones', color: C.blueLight[500], score: 82, pred: 78, predScenario: 78, sum: 'Z04: 83% → 91% @ 14:00', sumScenario: 'Z04: 83% → 91% scenario', alerts: 1, timeline: catTimelines.zones },
    { id: 'work', icon: ClipboardList, label: 'Work Content', color: C.orange[500], score: 88, pred: 92, predScenario: 95, sum: '1,890 done → 1,100 @ 14:00', sumScenario: '1,890 done → 1,200 scenario', alerts: 1, timeline: catTimelines.work },
    { id: 'sched', icon: Calendar, label: 'Schedules', color: C.greenLight[500], score: 86, pred: 88, predScenario: 88, sum: 'All docks active @ 14:00', sumScenario: 'All docks active scenario', alerts: 1, timeline: catTimelines.sched },
    { id: 'fin', icon: DollarSign, label: 'Financials', color: C.success[500], score: 79, pred: 74, predScenario: 77, sum: '$6.34K now → $13.1K @ 14:00', sumScenario: '$6.34K now → $13.5K scenario', alerts: 1, timeline: catTimelines.fin }
  ];

  return (
    <div style={{ display: 'flex', background: 'white', margin: `-${sp.lg}`, minHeight: '100vh' }}>
      {/* Contributing Factors Modal */}
      <ContributingFactorsModal 
        isOpen={contributingFactorsModal.isOpen}
        onClose={() => setContributingFactorsModal({ isOpen: false, title: '', data: null })}
        title={contributingFactorsModal.title}
        data={contributingFactorsModal.data}
      />
      
      {/* Task Creation Modal - temporarily disabled for debugging */}
      {/* <TaskCreationModal 
        isOpen={taskCreationModal.isOpen}
        onClose={() => setTaskCreationModal({ isOpen: false, action: null })}
        action={taskCreationModal.action}
      /> */}
      
      {/* Execute Live Plan Modal */}
      <ExecuteLivePlanModal
        isOpen={executePlanModal.isOpen}
        onClose={() => setExecutePlanModal({ isOpen: false })}
        selectedActions={selectedActions}
        suggestedActions={suggestedActions}
        onExecute={(planData) => {
          console.log('Plan executed:', planData);
          // TODO: Actually execute the plan, update state, show confirmation
        }}
      />
      
      {/* Tab sidebar - LEFT SIDE */}
      <div style={{ width: 52, background: C.neutral[100], borderRight: `1px solid ${C.neutral[200]}`, display: 'flex', flexDirection: 'column', paddingTop: sp.md, flexShrink: 0 }}>
        {currentTabs.map(tab => {
          const Icon = tab.icon;
          const currentTabId = isAtFacilityLevel ? activeTab : detailSubTab;
          const isActive = currentTabId === tab.id;
          return (
            <div
              key={tab.id}
              onClick={() => {
                if (isAtFacilityLevel) {
                  setActiveTab(tab.id);
                } else {
                  setDetailSubTab(tab.id);
                }
              }}
              title={tab.label}
              style={{
                width: 40,
                height: 40,
                margin: '0 auto',
                marginBottom: 4,
                borderRadius: 8,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                cursor: 'pointer',
                background: isActive ? C.brand[100] : 'transparent',
                border: isActive ? `2px solid ${C.brand[500]}` : '2px solid transparent',
                transition: 'all 0.15s'
              }}
            >
              <Icon style={{ width: 18, height: 18, color: isActive ? C.brand[600] : C.neutral[500] }} />
            </div>
          );
        })}
      </div>
      
      {/* Main content area */}
      <div data-scroll-container style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: sp.lg, padding: sp.lg, overflow: 'auto', maxWidth: 708 }}>
        {/* Time Scrubber */}
        <TimeScrubber />
      
        {/* Breadcrumb - journey-based */}
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, fontSize: '12px', flexWrap: 'wrap' }}>
          {navigationStack.map((item, index) => (
            <React.Fragment key={index}>
              {index > 0 && <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />}
              {index < navigationStack.length - 1 ? (
                <span 
                  onClick={() => navigateBack(index)}
                  style={{ color: C.brand[600], cursor: 'pointer', fontWeight: 500 }}
                  onMouseEnter={(e) => e.target.style.textDecoration = 'underline'}
                  onMouseLeave={(e) => e.target.style.textDecoration = 'none'}
                >
                  {index === 0 ? `🏠 ${item.label}` : item.label}
                </span>
              ) : (
                <span style={{ color: C.neutral[700], fontWeight: 500 }}>
                  {index === 0 ? `🏠 ${item.label}` : item.label}
                </span>
              )}
            </React.Fragment>
          ))}
        </div>
      
        {/* ===== FACILITY LEVEL VIEWS ===== */}
        {isAtFacilityLevel && activeTab === 'dashboard' && (
          <>
            <Header icon={LayoutDashboard} title="Executive Summary" sub="Warehouse-wide health and cross-shift visibility • Predictive 16-hour window" color={C.neutral[700]} />
      
      {/* Active Plans Card - Lightweight, time-aware summary */}
      {activePlans.length > 0 && (
        <div style={{ 
          marginBottom: sp.md, 
          padding: `${sp.sm} ${sp.md}`,
          background: C.success[50], 
          borderRadius: 8,
          border: `1px solid ${C.success[200]}`
        }}>
          {(() => {
            const parseTime = (timeStr) => {
              if (!timeStr) return null;
              const match = timeStr.match(/(\d+):(\d+)/);
              if (!match) return null;
              return parseInt(match[1]) * 60 + parseInt(match[2]);
            };
            
            // Use contextual time for time-aware calculations
            const contextualMinutes = parseTime(contextualTime) || (14 * 60 + 15);
            const nowMinutes = parseTime('10:00') || (10 * 60); // NOW_TIME
            
            // Time-aware progress calculation
            const getTimeAwareProgress = (plan) => {
              const tasks = plan.tasks || [];
              if (tasks.length === 0) return { progress: 0, complete: 0, total: 0 };
              
              // If viewing past time, show historical progress
              // If viewing future time, project progress
              let completedTasks = tasks.filter(t => {
                if (t.status === 'done') {
                  // Task is done - check if it would have been done at contextual time
                  const completedAt = parseTime(t.completedAt || t.dueTime);
                  return !completedAt || contextualMinutes >= completedAt;
                }
                return false;
              }).length;
              
              // For future projection, estimate additional completions
              if (contextualMinutes > nowMinutes) {
                const inProgressTasks = tasks.filter(t => t.status === 'in-progress');
                inProgressTasks.forEach(t => {
                  const dueMinutes = parseTime(t.dueTime);
                  if (dueMinutes && contextualMinutes >= dueMinutes) {
                    completedTasks++; // Assume it would be done by due time
                  }
                });
              }
              
              return {
                progress: Math.min(100, Math.round((completedTasks / tasks.length) * 100)),
                complete: Math.min(completedTasks, tasks.length),
                total: tasks.length
              };
            };
            
            const plan = activePlans[0];
            const timeAware = getTimeAwareProgress(plan);
            const tasks = plan.tasks || [];
            
            // Check for overdue at contextual time
            const overdueCount = tasks.filter(t => {
              if (t.status === 'done') return false;
              const dueMinutes = parseTime(t.dueTime);
              return dueMinutes && dueMinutes < contextualMinutes;
            }).length;
            
            // EOS detection
            const currentHour = parseInt(contextualTime?.split(':')[0]) || 14;
            const shiftEndHour = 15;
            const isNearEOS = shiftEndHour - currentHour <= 1 && shiftEndHour > currentHour;
            const minutesToEOS = Math.max(0, (shiftEndHour - currentHour) * 60 - (parseInt(contextualTime?.split(':')[1]) || 0));
            
            return (
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                {/* Icon and Title */}
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, flex: '0 0 auto' }}>
                  <Zap style={{ width: 16, height: 16, color: C.success[600] }} />
                  <span style={{ fontSize: '13px', fontWeight: 500, color: C.success[700] }}>
                    Active Plan
                  </span>
                </div>
                
                {/* Separator */}
                <div style={{ width: 1, height: 20, background: C.success[200] }} />
                
                {/* Plan Name + Priority */}
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, flex: 1, minWidth: 0 }}>
                  <span style={{ fontSize: '13px', color: C.neutral[700], fontWeight: 500, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>
                    {plan.name}
                  </span>
                  <span style={{ 
                    padding: '1px 5px', 
                    fontSize: '9px', 
                    fontWeight: 600, 
                    background: plan.priority === 'critical' ? C.error[100] : plan.priority === 'high' ? C.warning[100] : C.neutral[100], 
                    color: plan.priority === 'critical' ? C.error[700] : plan.priority === 'high' ? C.warning[700] : C.neutral[600], 
                    borderRadius: 3,
                    textTransform: 'uppercase',
                    flexShrink: 0
                  }}>{plan.priority}</span>
                </div>
                
                {/* Progress - Time-aware */}
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, flex: '0 0 auto' }}>
                  {/* Contextual time indicator if different from now */}
                  {isContextualDifferent && (
                    <span style={{ 
                      fontSize: '10px', 
                      padding: '2px 6px', 
                      background: C.brand[100], 
                      color: C.brand[700], 
                      borderRadius: 4,
                      fontWeight: 500
                    }}>
                      @{contextualTime}
                    </span>
                  )}
                  
                  {/* Progress bar */}
                  <div style={{ width: 80, height: 6, background: C.success[100], borderRadius: 3, overflow: 'hidden' }}>
                    <div style={{ 
                      height: '100%', 
                      width: `${timeAware.progress}%`, 
                      background: overdueCount > 0 ? C.warning[500] : C.success[500], 
                      borderRadius: 3,
                      transition: 'width 0.3s'
                    }} />
                  </div>
                  <span style={{ fontSize: '11px', color: C.neutral[600], fontWeight: 500, minWidth: 50 }}>
                    {timeAware.complete}/{timeAware.total} tasks
                  </span>
                </div>
                
                {/* Status Indicators */}
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, flex: '0 0 auto' }}>
                  {overdueCount > 0 && (
                    <span style={{ 
                      fontSize: '10px', 
                      padding: '2px 6px', 
                      background: C.warning[100], 
                      color: C.warning[700], 
                      borderRadius: 4,
                      fontWeight: 500,
                      display: 'flex',
                      alignItems: 'center',
                      gap: 3
                    }}>
                      <AlertTriangle style={{ width: 10, height: 10 }} />
                      {overdueCount} overdue
                    </span>
                  )}
                  {isNearEOS && timeAware.progress < 100 && (
                    <span style={{ 
                      fontSize: '10px', 
                      padding: '2px 6px', 
                      background: C.purple[100], 
                      color: C.purple[700], 
                      borderRadius: 4,
                      fontWeight: 500
                    }}>
                      EOS in {minutesToEOS}m
                    </span>
                  )}
                </div>
                
                {/* View button */}
                <button 
                  onClick={() => setActiveTab('plans')} 
                  style={{ 
                    padding: '4px 8px', 
                    fontSize: '11px', 
                    fontWeight: 500, 
                    background: 'white', 
                    color: C.success[700], 
                    border: `1px solid ${C.success[300]}`, 
                    borderRadius: 4, 
                    cursor: 'pointer', 
                    display: 'flex', 
                    alignItems: 'center', 
                    gap: 3,
                    flexShrink: 0
                  }}
                >
                  View <ChevronRight style={{ width: 12, height: 12 }} />
                </button>
              </div>
            );
          })()}
        </div>
      )}

      {/* Warehouse Health - with tri-temporal display and scenario support */}
      <Card style={{ background: 'white' }}>
        {/* Scenario Mode: Vertical stacked layout */}
        {scenarioMode ? (
          <div style={{ display: 'flex', gap: sp.md }}>
            {/* Left side: Compact stacked Baseline/Scenario */}
            <div style={{ flex: '0 0 auto', width: 200, borderRight: `1px solid ${C.neutral[200]}`, paddingRight: sp.md }}>
              <p style={{ fontSize: '11px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: sp.md, textAlign: 'center' }}>Warehouse Health</p>
              
              {/* BASELINE */}
              <div style={{ marginBottom: sp.md }}>
                <p style={{ fontSize: '9px', fontWeight: 600, color: C.neutral[400], marginBottom: sp.xs }}>BASELINE</p>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <DonutChart value={health} size={64} stroke={6} color={scoreColor(endTimeHealthBaseline)} />
                  <div style={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                    <div style={{ display: 'flex', alignItems: 'baseline', gap: 4 }}>
                      <span style={{ fontSize: '20px', fontWeight: 300 }}>{health}</span>
                      <span style={{ fontSize: '9px', color: C.neutral[500] }}>NOW</span>
                      <span style={{ fontSize: '12px', color: C.neutral[400] }}>→</span>
                      {isContextualDifferent && (
                        <div style={{ padding: '2px 8px', background: C.brand[100], borderRadius: 4 }}>
                          <span style={{ fontSize: '14px', fontWeight: 500, color: C.brand[700] }}>{contextualHealth}</span>
                          <sub style={{ fontSize: '8px', color: C.brand[600], marginLeft: 2 }}>@{contextualTime}</sub>
                        </div>
                      )}
                    </div>
                    <div style={{ display: 'flex', alignItems: 'baseline', gap: 4, marginLeft: 36 }}>
                      <span style={{ fontSize: '12px', color: C.neutral[400] }}>→</span>
                      <span style={{ fontSize: '14px', fontWeight: 500, color: scoreColor(endTimeHealthBaseline) }}>{endTimeHealthBaseline}</span>
                      <sub style={{ fontSize: '8px', color: C.neutral[500] }}>@{endTimeLabel}</sub>
                    </div>
                    <Badge status={scoreStatus(endTimeHealthBaseline)} label={endTimeHealthBaseline >= 85 ? 'Healthy' : 'Needs Attention'} />
                  </div>
                </div>
              </div>
              
              {/* SCENARIO */}
              <div>
                <p style={{ fontSize: '9px', fontWeight: 600, color: C.purple[500], marginBottom: sp.xs }}>SCENARIO</p>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <div style={{ position: 'relative' }}>
                    <DonutChart value={endTimeHealthScenario} size={64} stroke={6} color={scoreColor(endTimeHealthScenario)} />
                    {endTimeHealthScenario > endTimeHealthBaseline && (
                      <div style={{ 
                        position: 'absolute', top: -2, right: -2, 
                        background: C.success[500], borderRadius: '50%', 
                        width: 18, height: 18,
                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                        boxShadow: '0 1px 3px rgba(0,0,0,0.2)'
                      }}>
                        <TrendingUp style={{ width: 10, height: 10, color: 'white' }} />
                      </div>
                    )}
                  </div>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                    <div style={{ display: 'flex', alignItems: 'baseline', gap: 4 }}>
                      <span style={{ fontSize: '20px', fontWeight: 300 }}>{health}</span>
                      <span style={{ fontSize: '9px', color: C.neutral[500] }}>NOW</span>
                      <span style={{ fontSize: '12px', color: C.neutral[400] }}>→</span>
                      {isContextualDifferent && (
                        <div style={{ padding: '2px 8px', background: C.brand[100], borderRadius: 4 }}>
                          <span style={{ fontSize: '14px', fontWeight: 500, color: C.brand[700] }}>{contextualHealthScenario}</span>
                          <sub style={{ fontSize: '8px', color: C.brand[600], marginLeft: 2 }}>@{contextualTime}</sub>
                          {contextualHealthScenario > contextualHealth && (
                            <span style={{ fontSize: '10px', color: C.success[600], marginLeft: 4, fontWeight: 600 }}>+{contextualHealthScenario - contextualHealth}</span>
                          )}
                        </div>
                      )}
                    </div>
                    <div style={{ display: 'flex', alignItems: 'baseline', gap: 4, marginLeft: 36 }}>
                      <span style={{ fontSize: '12px', color: C.neutral[400] }}>→</span>
                      <span style={{ fontSize: '14px', fontWeight: 500, color: scoreColor(endTimeHealthScenario) }}>{endTimeHealthScenario}</span>
                      <sub style={{ fontSize: '8px', color: C.neutral[500] }}>@{endTimeLabel}</sub>
                      {endTimeHealthScenario > endTimeHealthBaseline && (
                        <span style={{ fontSize: '10px', color: C.success[600], fontWeight: 600 }}>+{endTimeHealthScenario - endTimeHealthBaseline}</span>
                      )}
                    </div>
                    <Badge status="success" label="On Track" />
                  </div>
                </div>
              </div>
            </div>
            
            {/* Right side: Chart with more breathing room */}
            <div style={{ flex: 1, minWidth: 0, display: 'flex', flexDirection: 'column' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                <div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 2 }}>
                    <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Health Score Trajectory</h3>
                    <ContributingFactorsLink onClick={() => setContributingFactorsModal({ 
                      isOpen: true, 
                      title: 'Health Score', 
                      data: healthScoreContributingFactors 
                    })} />
                  </div>
                  <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>Composite score from 5 Operational Categories</p>
                </div>
                <span style={{ fontSize: '11px', fontWeight: 500, color: C.warning[600] }}>Baseline: Dip @ 1300</span>
              </div>
              
              {/* Chart - Accessible version with distinct patterns and markers */}
              <div style={{ flex: 1, minHeight: 140, position: 'relative' }}>
                <svg 
                  width="100%" 
                  height="140" 
                  viewBox="0 0 450 120" 
                  preserveAspectRatio="xMidYMid meet" 
                  style={{ overflow: 'visible' }}
                  role="img"
                  aria-labelledby="chartTitle chartDesc"
                >
                  {/* Accessibility: Title and description for screen readers */}
                  <title id="chartTitle">Health Score Trajectory Chart</title>
                  <desc id="chartDesc">
                    Line chart comparing baseline and scenario predictions. 
                    Baseline prediction shows health score declining from 84 to 80 by end of day.
                    Scenario prediction shows health score improving from 84 to 88 by end of day.
                    Target threshold is 85.
                  </desc>
                  
                  <defs>
                    {/* Confidence band gradient - slightly more saturated for better contrast */}
                    <linearGradient id="confidenceBandAccessible" x1="0%" y1="0%" x2="0%" y2="100%">
                      <stop offset="0%" stopColor="#8B5CF6" stopOpacity="0.25" />
                      <stop offset="100%" stopColor="#8B5CF6" stopOpacity="0.08" />
                    </linearGradient>
                    
                    {/* Diamond marker for scenario line */}
                    <marker id="diamondMarker" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="8" markerHeight="8">
                      <polygon points="5,0 10,5 5,10 0,5" fill={C.purple[500]} stroke="white" strokeWidth="1" />
                    </marker>
                    
                    {/* Circle marker for baseline line */}
                    <marker id="circleMarker" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="8" markerHeight="8">
                      <circle cx="5" cy="5" r="4" fill={C.brand[500]} stroke="white" strokeWidth="1" />
                    </marker>
                  </defs>
                  
                  {/* Y-axis labels */}
                  <text x="15" y="15" fontSize="9" fill={C.neutral[400]} textAnchor="end">95</text>
                  <text x="15" y="40" fontSize="9" fill={C.success[600]} fontWeight="500" textAnchor="end">85</text>
                  <text x="15" y="70" fontSize="9" fill={C.neutral[400]} textAnchor="end">80</text>
                  <text x="15" y="100" fontSize="9" fill={C.neutral[400]} textAnchor="end">75</text>
                  
                  {/* Horizontal grid lines */}
                  <line x1="25" y1="12" x2="440" y2="12" stroke={C.neutral[200]} strokeWidth="1" />
                  <line x1="25" y1="37" x2="440" y2="37" stroke={C.neutral[200]} strokeWidth="1" />
                  <line x1="25" y1="67" x2="440" y2="67" stroke={C.neutral[200]} strokeWidth="1" />
                  <line x1="25" y1="97" x2="440" y2="97" stroke={C.neutral[200]} strokeWidth="1" />
                  
                  {/* Warning zone */}
                  <rect x="25" y="67" width="415" height="30" fill={C.warning[100]} opacity="0.4" />
                  
                  {/* Critical zone */}
                  <rect x="25" y="97" width="415" height="23" fill={C.error[100]} opacity="0.3" />
                  
                  {/* TARGET LINE - Long dash pattern (distinct from others) */}
                  <line 
                    x1="25" y1="37" x2="440" y2="37" 
                    stroke={C.success[500]} 
                    strokeWidth="2" 
                    strokeDasharray="12,6"
                    strokeLinecap="round"
                  />
                  {/* Direct label for target */}
                  <text x="442" y="40" fontSize="8" fill={C.success[600]} fontWeight="500">Target</text>
                  
                  {/* Confidence band - slightly more saturated purple */}
                  <path 
                    d="M 120 47 Q 180 55 240 52 Q 300 48 360 42 Q 400 38 440 35 
                       L 440 60 Q 400 65 360 68 Q 300 75 240 80 Q 180 85 120 75 Z" 
                    fill="url(#confidenceBandAccessible)"
                  />
                  
                  {/* BASELINE ACTUAL - Solid line with circle markers */}
                  <path 
                    d="M 25 32 L 70 35 L 120 42" 
                    fill="none" 
                    stroke={C.brand[600]} 
                    strokeWidth="2.5"
                    strokeLinecap="round"
                  />
                  {/* Circle markers for baseline actual */}
                  <circle cx="25" cy="32" r="4" fill={C.brand[600]} stroke="white" strokeWidth="1.5" />
                  <circle cx="70" cy="35" r="3" fill={C.brand[600]} stroke="white" strokeWidth="1" />
                  
                  {/* BASELINE PREDICTED - Short dash pattern with circle markers */}
                  <path 
                    d="M 120 42 Q 180 65 240 60 Q 300 55 360 50 Q 400 47 440 45" 
                    fill="none" 
                    stroke={C.brand[500]} 
                    strokeWidth="2"
                    strokeDasharray="6,4"
                    strokeLinecap="round"
                  />
                  {/* Circle markers at key points for baseline */}
                  <circle cx="240" cy="60" r="3" fill={C.brand[500]} stroke="white" strokeWidth="1" />
                  <circle cx="360" cy="50" r="3" fill={C.brand[500]} stroke="white" strokeWidth="1" />
                  <circle cx="440" cy="45" r="4" fill={C.brand[500]} stroke="white" strokeWidth="1.5" />
                  {/* Direct label for baseline at end */}
                  <text x="442" y="52" fontSize="8" fill={C.brand[600]} fontWeight="500">Baseline</text>
                  
                  {/* SCENARIO PREDICTED - Dot-dash pattern with diamond markers */}
                  <path 
                    d="M 120 42 Q 180 35 240 28 Q 300 22 360 18 Q 400 15 440 12" 
                    fill="none" 
                    stroke={C.purple[500]} 
                    strokeWidth="2"
                    strokeDasharray="2,4,8,4"
                    strokeLinecap="round"
                  />
                  {/* Diamond markers at key points for scenario */}
                  <polygon points="240,28 244,32 240,36 236,32" fill={C.purple[500]} stroke="white" strokeWidth="1" />
                  <polygon points="360,18 364,22 360,26 356,22" fill={C.purple[500]} stroke="white" strokeWidth="1" />
                  <polygon points="440,12 445,17 440,22 435,17" fill={C.purple[500]} stroke="white" strokeWidth="1.5" />
                  {/* Direct label for scenario at end */}
                  <text x="442" y="8" fontSize="8" fill={C.purple[600]} fontWeight="500">Scenario</text>
                  
                  {/* NOW marker */}
                  <line x1="120" y1="5" x2="120" y2="105" stroke={C.neutral[700]} strokeWidth="1.5" />
                  <rect x="102" y="2" width="36" height="14" rx="3" fill={C.neutral[700]} />
                  <text x="120" y="12" fontSize="8" fill="white" textAnchor="middle" fontWeight="500">NOW</text>
                  {/* Current data point - shared by both lines */}
                  <circle cx="120" cy="42" r="5" fill={C.neutral[700]} stroke="white" strokeWidth="2" />
                  
                  {/* Contextual time marker */}
                  {isContextualDifferent && (
                    <>
                      <line x1="280" y1="5" x2="280" y2="105" stroke={C.brand[500]} strokeWidth="1.5" />
                      <rect x="260" y="2" width="40" height="14" rx="3" fill={C.brand[500]} />
                      <text x="280" y="12" fontSize="8" fill="white" textAnchor="middle" fontWeight="500">{contextualTime}</text>
                      {/* Baseline point - circle */}
                      <circle cx="280" cy="58" r="5" fill={C.brand[500]} stroke="white" strokeWidth="2" />
                      {/* Scenario point - diamond */}
                      <polygon points="280,20 285,25 280,30 275,25" fill={C.purple[500]} stroke="white" strokeWidth="2" />
                    </>
                  )}
                </svg>
                
                {/* X-axis labels */}
                <div style={{ display: 'flex', justifyContent: 'space-between', paddingLeft: 25, paddingRight: 10, marginTop: 2 }}>
                  {['06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'].map((t, i) => (
                    <span key={i} style={{ fontSize: '9px', color: C.neutral[400] }}>{t}</span>
                  ))}
                </div>
              </div>
              
              {/* Accessible legend - shows both line pattern AND marker shape */}
              <div style={{ display: 'flex', gap: sp.md, marginTop: sp.sm, justifyContent: 'center', flexWrap: 'wrap' }}>
                {/* Baseline with circle marker */}
                <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                  <svg width="28" height="12" style={{ overflow: 'visible' }}>
                    <line x1="0" y1="6" x2="20" y2="6" stroke={C.brand[500]} strokeWidth="2" strokeDasharray="4,3" />
                    <circle cx="24" cy="6" r="4" fill={C.brand[500]} stroke="white" strokeWidth="1" />
                  </svg>
                  <span style={{ fontSize: '9px', color: C.neutral[600] }}>Baseline</span>
                </div>
                {/* Scenario with diamond marker */}
                <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                  <svg width="28" height="12" style={{ overflow: 'visible' }}>
                    <line x1="0" y1="6" x2="18" y2="6" stroke={C.purple[500]} strokeWidth="2" strokeDasharray="2,3,6,3" />
                    <polygon points="24,6 28,10 24,14 20,10" transform="translate(0,-4)" fill={C.purple[500]} stroke="white" strokeWidth="1" />
                  </svg>
                  <span style={{ fontSize: '9px', color: C.neutral[600] }}>Scenario</span>
                </div>
                {/* Confidence band */}
                <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                  <div style={{ width: 12, height: 8, background: '#8B5CF6', opacity: 0.25, borderRadius: 1 }} />
                  <span style={{ fontSize: '9px', color: C.neutral[600] }}>Confidence</span>
                </div>
                {/* Target with long dash */}
                <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                  <svg width="20" height="12">
                    <line x1="0" y1="6" x2="20" y2="6" stroke={C.success[500]} strokeWidth="2" strokeDasharray="8,4" />
                  </svg>
                  <span style={{ fontSize: '9px', color: C.neutral[600] }}>Target</span>
                </div>
                {/* Warning zone */}
                <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                  <div style={{ width: 12, height: 8, background: C.warning[200], borderRadius: 1 }} />
                  <span style={{ fontSize: '9px', color: C.neutral[600] }}>Warning</span>
                </div>
                {/* Critical zone */}
                <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                  <div style={{ width: 12, height: 8, background: C.error[200], borderRadius: 1 }} />
                  <span style={{ fontSize: '9px', color: C.neutral[600] }}>Critical</span>
                </div>
              </div>
            </div>
          </div>
        ) : (
          /* Standard Mode: Dual/Multi-Time Display */
          <>
            <div style={{ display: 'flex', gap: sp.md }}>
              {/* Left side: Compact health display */}
              <div style={{ flex: '0 0 auto', width: 200, borderRight: `1px solid ${C.neutral[200]}`, paddingRight: sp.md }}>
                <p style={{ fontSize: '11px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: sp.md, textAlign: 'center' }}>Warehouse Health</p>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <DonutChart value={health} size={64} stroke={6} color={scoreColor(health)} />
                  <div style={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                    <div style={{ display: 'flex', alignItems: 'baseline', gap: 4 }}>
                      <span style={{ fontSize: '20px', fontWeight: 300 }}>{health}</span>
                      <span style={{ fontSize: '9px', color: C.neutral[500] }}>NOW</span>
                      <span style={{ fontSize: '12px', color: C.neutral[400] }}>→</span>
                      {isContextualDifferent && contextualHealth && (
                        <div style={{ padding: '2px 8px', background: C.brand[100], borderRadius: 4 }}>
                          <span style={{ fontSize: '14px', fontWeight: 500, color: C.brand[700] }}>{contextualHealth}</span>
                          <sub style={{ fontSize: '8px', color: C.brand[600], marginLeft: 2 }}>@{contextualTime}</sub>
                        </div>
                      )}
                    </div>
                    <div style={{ display: 'flex', alignItems: 'baseline', gap: 4, marginLeft: 36 }}>
                      <span style={{ fontSize: '12px', color: C.neutral[400] }}>→</span>
                      <span style={{ fontSize: '14px', fontWeight: 500, color: scoreColor(endTimeHealthBaseline) }}>{endTimeHealthBaseline}</span>
                      <sub style={{ fontSize: '8px', color: C.neutral[500] }}>@{endTimeLabel}</sub>
                    </div>
                    <Badge status={scoreStatus(health)} label={health >= 85 ? 'Healthy' : 'Needs Attention'} />
                  </div>
                </div>
              </div>
              
              {/* Right side: Chart - Accessible version */}
              <div style={{ flex: 1, minWidth: 0, display: 'flex', flexDirection: 'column' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                  <div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 2 }}>
                      <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Health Score Trajectory</h3>
                      <ContributingFactorsLink onClick={() => setContributingFactorsModal({ 
                        isOpen: true, 
                        title: 'Health Score', 
                        data: healthScoreContributingFactors 
                      })} />
                    </div>
                    <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>Composite score from 5 Operational Categories</p>
                  </div>
                  <span style={{ fontSize: '11px', fontWeight: 500, color: C.warning[600] }}>Dip @ 1300</span>
                </div>
                
                {/* Chart - Accessible version */}
                <div style={{ flex: 1, minHeight: 100, position: 'relative' }}>
                  <svg 
                    width="100%" 
                    height="100" 
                    viewBox="0 0 450 90" 
                    preserveAspectRatio="xMidYMid meet" 
                    style={{ overflow: 'visible' }}
                    role="img"
                    aria-labelledby="chartTitleStd chartDescStd"
                  >
                    {/* Accessibility: Title and description for screen readers */}
                    <title id="chartTitleStd">Health Score Trajectory Chart</title>
                    <desc id="chartDescStd">
                      Line chart showing health score prediction. 
                      Current score is 84, predicted to decline to 80 by end of day.
                      Target threshold is 85.
                    </desc>
                    
                    <defs>
                      <linearGradient id="confidenceBandSingleAccessible" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stopColor="#8B5CF6" stopOpacity="0.25" />
                        <stop offset="100%" stopColor="#8B5CF6" stopOpacity="0.08" />
                      </linearGradient>
                    </defs>
                    
                    {/* Y-axis labels */}
                    <text x="15" y="12" fontSize="9" fill={C.neutral[400]} textAnchor="end">95</text>
                    <text x="15" y="32" fontSize="9" fill={C.success[600]} fontWeight="500" textAnchor="end">85</text>
                    <text x="15" y="55" fontSize="9" fill={C.neutral[400]} textAnchor="end">80</text>
                    <text x="15" y="78" fontSize="9" fill={C.neutral[400]} textAnchor="end">75</text>
                    
                    {/* Grid lines */}
                    <line x1="25" y1="10" x2="440" y2="10" stroke={C.neutral[200]} strokeWidth="1" />
                    <line x1="25" y1="30" x2="440" y2="30" stroke={C.neutral[200]} strokeWidth="1" />
                    <line x1="25" y1="53" x2="440" y2="53" stroke={C.neutral[200]} strokeWidth="1" />
                    <line x1="25" y1="76" x2="440" y2="76" stroke={C.neutral[200]} strokeWidth="1" />
                    
                    {/* Warning zone */}
                    <rect x="25" y="53" width="415" height="23" fill={C.warning[100]} opacity="0.4" />
                    
                    {/* Critical zone */}
                    <rect x="25" y="76" width="415" height="14" fill={C.error[100]} opacity="0.3" />
                    
                    {/* TARGET LINE - Long dash pattern */}
                    <line x1="25" y1="30" x2="440" y2="30" stroke={C.success[500]} strokeWidth="2" strokeDasharray="12,6" strokeLinecap="round" />
                    <text x="442" y="33" fontSize="8" fill={C.success[600]} fontWeight="500">Target</text>
                    
                    {/* Confidence band - improved contrast */}
                    <path 
                      d="M 120 35 Q 180 42 240 40 Q 300 38 360 35 Q 400 32 440 30 
                         L 440 50 Q 400 55 360 58 Q 300 62 240 60 Q 180 58 120 50 Z" 
                      fill="url(#confidenceBandSingleAccessible)"
                    />
                    
                    {/* ACTUAL LINE - Solid with circle markers */}
                    <path 
                      d="M 25 25 L 70 28 L 120 32" 
                      fill="none" 
                      stroke={C.brand[600]} 
                      strokeWidth="2.5"
                      strokeLinecap="round"
                    />
                    <circle cx="25" cy="25" r="4" fill={C.brand[600]} stroke="white" strokeWidth="1.5" />
                    <circle cx="70" cy="28" r="3" fill={C.brand[600]} stroke="white" strokeWidth="1" />
                    
                    {/* PREDICTED LINE - Short dash with circle markers */}
                    <path 
                      d="M 120 32 Q 180 50 240 45 Q 300 40 360 37 Q 400 35 440 33" 
                      fill="none" 
                      stroke={C.brand[500]} 
                      strokeWidth="2"
                      strokeDasharray="6,4"
                      strokeLinecap="round"
                    />
                    {/* Circle markers at key points */}
                    <circle cx="240" cy="45" r="3" fill={C.brand[500]} stroke="white" strokeWidth="1" />
                    <circle cx="360" cy="37" r="3" fill={C.brand[500]} stroke="white" strokeWidth="1" />
                    <circle cx="440" cy="33" r="4" fill={C.brand[500]} stroke="white" strokeWidth="1.5" />
                    
                    {/* NOW marker */}
                    <line x1="120" y1="3" x2="120" y2="80" stroke={C.neutral[700]} strokeWidth="1.5" />
                    <rect x="102" y="0" width="36" height="14" rx="3" fill={C.neutral[700]} />
                    <text x="120" y="10" fontSize="8" fill="white" textAnchor="middle" fontWeight="500">NOW</text>
                    <circle cx="120" cy="32" r="5" fill={C.neutral[700]} stroke="white" strokeWidth="2" />
                    
                    {/* Contextual marker */}
                    {isContextualDifferent && (
                      <>
                        <line x1="280" y1="3" x2="280" y2="80" stroke={C.brand[500]} strokeWidth="1.5" />
                        <rect x="260" y="0" width="40" height="14" rx="3" fill={C.brand[500]} />
                        <text x="280" y="10" fontSize="8" fill="white" textAnchor="middle" fontWeight="500">{contextualTime}</text>
                        <circle cx="280" cy="43" r="5" fill={C.brand[500]} stroke="white" strokeWidth="2" />
                      </>
                    )}
                  </svg>
                  
                  {/* X-axis */}
                  <div style={{ display: 'flex', justifyContent: 'space-between', paddingLeft: 25, paddingRight: 10, marginTop: 2 }}>
                    {['06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'].map((t, i) => (
                      <span key={i} style={{ fontSize: '9px', color: C.neutral[400] }}>{t}</span>
                    ))}
                  </div>
                </div>
                
                {/* Legend - Accessible with markers */}
                <div style={{ display: 'flex', gap: sp.md, marginTop: sp.xs, justifyContent: 'center' }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                    <svg width="24" height="12" style={{ overflow: 'visible' }}>
                      <line x1="0" y1="6" x2="16" y2="6" stroke={C.brand[600]} strokeWidth="2.5" />
                      <circle cx="20" cy="6" r="4" fill={C.brand[600]} stroke="white" strokeWidth="1" />
                    </svg>
                    <span style={{ fontSize: '9px', color: C.neutral[600] }}>Actual</span>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                    <svg width="24" height="12" style={{ overflow: 'visible' }}>
                      <line x1="0" y1="6" x2="16" y2="6" stroke={C.brand[500]} strokeWidth="2" strokeDasharray="4,3" />
                      <circle cx="20" cy="6" r="3" fill={C.brand[500]} stroke="white" strokeWidth="1" />
                    </svg>
                    <span style={{ fontSize: '9px', color: C.neutral[600] }}>Predicted</span>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                    <div style={{ width: 12, height: 8, background: '#8B5CF6', opacity: 0.25, borderRadius: 1 }} />
                    <span style={{ fontSize: '9px', color: C.neutral[600] }}>Confidence</span>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                    <svg width="20" height="12">
                      <line x1="0" y1="6" x2="20" y2="6" stroke={C.success[500]} strokeWidth="2" strokeDasharray="8,4" />
                    </svg>
                    <span style={{ fontSize: '9px', color: C.neutral[600] }}>Target</span>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                    <div style={{ width: 12, height: 8, background: C.warning[200], borderRadius: 1 }} />
                    <span style={{ fontSize: '9px', color: C.neutral[600] }}>Warning</span>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                    <div style={{ width: 12, height: 8, background: C.error[200], borderRadius: 1 }} />
                    <span style={{ fontSize: '9px', color: C.neutral[600] }}>Critical</span>
                  </div>
                </div>
              </div>
            </div>
          </>
        )}
      </Card>
      
      {/* Operational Categories - Navigation hub for human-driven exploration */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>
            Operational Categories 
            {scenarioMode && <span style={{ fontSize: '12px', color: C.purple[500], fontWeight: 400, marginLeft: sp.sm }}>(Baseline vs Scenario)</span>}
          </h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>
            Current {isContextualDifferent && <span style={{ color: C.brand[600] }}>→ @{contextualTime}</span>} → Predicted • Click to explore
          </p>
        </div>
        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(3, 1fr)', 
          gap: sp.md 
        }}>
          {cats.map((cat, i) => {
            const Icon = cat.icon;
            const improving = cat.pred > cat.score;
            const contextualScore = isContextualDifferent ? interpolateValue(cat.timeline, contextualTime) : null;
            
            // Scenario mode calculations
            const scenarioDelta = cat.predScenario - cat.pred;
            const scenarioImproving = scenarioDelta > 0;
            const scenarioNoChange = scenarioDelta === 0;
            const contextualScoreScenario = isContextualDifferent 
              ? Math.round(contextualScore + (cat.predScenario - cat.pred) * 0.5) 
              : null;
            
            // Get trend icon for scenario
            const getTrendIcon = (delta, size = 12) => {
              if (delta > 0) return <TrendingUp style={{ width: size, height: size, color: C.success[500] }} />;
              if (delta < 0) return <TrendingDown style={{ width: size, height: size, color: C.error[500] }} />;
              return <Minus style={{ width: size, height: size, color: C.neutral[400] }} />;
            };
            
            return (
              <div 
                key={i} 
                onClick={() => {
                  const tabMap = { staff: 'staff', zones: 'zones', work: 'work', sched: 'schedule', fin: 'dashboard' };
                  setActiveTab(tabMap[cat.id] || 'dashboard');
                }} 
                className="card-click" 
                style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, borderTop: `3px solid ${cat.color}`, cursor: 'pointer', transition: 'all 0.15s' }}
                onMouseEnter={(e) => { e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)'; e.currentTarget.style.transform = 'translateY(-2px)'; }}
                onMouseLeave={(e) => { e.currentTarget.style.boxShadow = 'none'; e.currentTarget.style.transform = 'translateY(0)'; }}
              >
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.sm }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <div style={{ width: 28, height: 28, borderRadius: 6, background: `${cat.color}15`, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                      <Icon style={{ width: 14, height: 14, color: cat.color }} />
                    </div>
                    <span style={{ fontSize: '13px', fontWeight: 500 }}>{cat.label}</span>
                  </div>
                  {!scenarioMode && cat.alerts > 0 && <Badge status={scoreStatus(cat.score)} label={cat.alerts} />}
                </div>
                
                {scenarioMode ? (
                  /* Scenario Mode: Double donut layout */
                  <div>
                    {/* BASELINE ROW */}
                    <div style={{ marginBottom: sp.sm }}>
                      <p style={{ fontSize: '9px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', marginBottom: sp.xs }}>Baseline</p>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                        <DonutChart value={cat.score} size={44} stroke={4} color={scoreColor(cat.pred)} />
                        <div style={{ display: 'flex', alignItems: 'center', gap: 4, flexWrap: 'wrap' }}>
                          {isContextualDifferent && contextualScore !== null && (
                            <div style={{ padding: '2px 8px', background: C.brand[100], borderRadius: 4 }}>
                              <span style={{ fontSize: '12px', fontWeight: 500, color: C.brand[700] }}>{contextualScore}</span>
                              <sub style={{ fontSize: '8px', color: C.brand[600], marginLeft: 2 }}>@{contextualTime}</sub>
                            </div>
                          )}
                          <span style={{ fontSize: '12px', color: C.neutral[400] }}>→</span>
                          <span style={{ fontSize: '16px', fontWeight: 500, color: C.purple[600] }}>{cat.pred}</span>
                          <sub style={{ fontSize: '9px', color: C.neutral[500] }}>@{endTimeLabel}</sub>
                          {improving ? 
                            <ArrowUpRight style={{ width: 14, height: 14, color: C.success[500] }} /> : 
                            <ArrowDownRight style={{ width: 14, height: 14, color: C.warning[500] }} />
                          }
                        </div>
                      </div>
                    </div>
                    
                    {/* SCENARIO ROW */}
                    <div>
                      <p style={{ fontSize: '9px', fontWeight: 600, color: C.purple[500], textTransform: 'uppercase', marginBottom: sp.xs }}>Scenario</p>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                        <div style={{ position: 'relative' }}>
                          <DonutChart value={cat.predScenario} size={44} stroke={4} color={scoreColor(cat.predScenario)} />
                          {scenarioImproving && (
                            <div style={{ 
                              position: 'absolute', top: -2, right: -2, 
                              background: C.success[500], borderRadius: '50%', 
                              width: 16, height: 16,
                              display: 'flex', alignItems: 'center', justifyContent: 'center',
                              boxShadow: '0 1px 3px rgba(0,0,0,0.2)'
                            }}>
                              <TrendingUp style={{ width: 9, height: 9, color: 'white' }} />
                            </div>
                          )}
                        </div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 4, flexWrap: 'wrap' }}>
                          {isContextualDifferent && contextualScoreScenario !== null && (
                            <div style={{ padding: '2px 8px', background: C.brand[100], borderRadius: 4 }}>
                              <span style={{ fontSize: '12px', fontWeight: 500, color: C.brand[700] }}>{contextualScoreScenario}</span>
                              <sub style={{ fontSize: '8px', color: C.brand[600], marginLeft: 2 }}>@{contextualTime}</sub>
                              {contextualScoreScenario > contextualScore && (
                                <span style={{ fontSize: '9px', color: C.success[600], marginLeft: 4, fontWeight: 600 }}>+{contextualScoreScenario - contextualScore}</span>
                              )}
                            </div>
                          )}
                          <span style={{ fontSize: '12px', color: C.neutral[400] }}>→</span>
                          <span style={{ fontSize: '16px', fontWeight: 500, color: C.purple[600] }}>{cat.predScenario}</span>
                          <sub style={{ fontSize: '9px', color: C.neutral[500] }}>@{endTimeLabel}</sub>
                          {getTrendIcon(scenarioDelta, 14)}
                          {!scenarioNoChange && (
                            <span style={{ 
                              fontSize: '11px', 
                              fontWeight: 600, 
                              color: scenarioImproving ? C.success[600] : C.error[600] 
                            }}>
                              {scenarioImproving ? '+' : ''}{scenarioDelta}
                            </span>
                          )}
                        </div>
                      </div>
                    </div>
                    
                    {/* Footer */}
                    <p style={{ fontSize: '10px', color: C.neutral[600], lineHeight: 1.3, marginTop: sp.sm }}>
                      {cat.sumScenario}
                    </p>
                  </div>
                ) : (
                  /* Standard Mode: Dual/Multi-Time Display */
                  <>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.sm }}>
                      <DonutChart value={cat.score} size={48} stroke={5} color={scoreColor(cat.score)} />
                      <div style={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                        <div style={{ display: 'flex', alignItems: 'baseline', gap: 4 }}>
                          <span style={{ fontSize: '20px', fontWeight: 500, color: scoreColor(cat.score) }}>{cat.score}</span>
                          <sub style={{ fontSize: '9px', color: C.neutral[500] }}>NOW</sub>
                        </div>
                        <div style={{ display: 'flex', alignItems: 'baseline', gap: 4 }}>
                          <span style={{ fontSize: '10px', color: C.neutral[400] }}>→</span>
                          <span style={{ fontSize: '16px', fontWeight: 500, color: C.purple[600] }}>{cat.pred}</span>
                          <sub style={{ fontSize: '8px', color: C.neutral[500] }}>@{endTimeLabel}</sub>
                          {improving ? <ArrowUpRight style={{ width: 12, height: 12, color: C.success[500] }} /> : <ArrowDownRight style={{ width: 12, height: 12, color: C.warning[500] }} />}
                        </div>
                      </div>
                    </div>
                    <p style={{ fontSize: '10px', color: C.neutral[600], lineHeight: 1.3 }}>
                      {cat.sum}
                    </p>
                    <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: sp.xs }}>
                      <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
                    </div>
                  </>
                )}
              </div>
            );
          })}
        </div>
        
        {/* Simple link to Analysis - categories ARE the navigation */}
        <div style={{ 
          marginTop: sp.md, 
          padding: sp.sm, 
          background: C.neutral[50], 
          borderRadius: 6,
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center'
        }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <Lightbulb style={{ width: 14, height: 14, color: C.purple[500] }} />
            <span style={{ fontSize: '12px', color: C.neutral[600] }}>
              {activePlans.length > 0 
                ? `Active plan addressing 2 root causes • ${alerts.filter(a => ['alert-1', 'alert-3'].includes(a.id)).length} alerts resolved`
                : `${[...new Set(alerts.filter(a => a.rootCause).map(a => a.rootCause.id))].length} root causes identified across categories`
              }
            </span>
          </div>
          <button
            onClick={() => {
              // Scroll to Analysis card
              const analysisCard = document.querySelector('[data-analysis-card]');
              if (analysisCard) {
                analysisCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
              }
            }}
            style={{
              padding: '4px 10px',
              fontSize: '11px',
              fontWeight: 500,
              color: C.purple[600],
              background: 'white',
              border: `1px solid ${C.purple[200]}`,
              borderRadius: 4,
              cursor: 'pointer',
              display: 'flex',
              alignItems: 'center',
              gap: 4
            }}
          >
            View Analysis <ChevronRight style={{ width: 12, height: 12 }} />
          </button>
        </div>
      </Card>
      
      {/* Throughput Forecast - with contextual marker, scenario comparison, and alerts */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500, margin: 0 }}>
                Throughput Forecast
                {scenarioMode && <span style={{ fontSize: '12px', color: C.purple[500], fontWeight: 400, marginLeft: sp.sm }}>(Baseline vs Scenario)</span>}
              </h3>
              <ContributingFactorsLink onClick={() => setContributingFactorsModal({ 
                isOpen: true, 
                title: 'Throughput Forecast', 
                data: getThroughputContributingFactors() 
              })} />
            </div>
            {!scenarioMode && <Badge status="success" label="On track" />}
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>
            {scenarioMode 
              ? 'Comparing baseline projection vs scenario with +4 FTE pickers • Target: 13,000 orders'
              : 'Cumulative orders processed today • Target: 13,000 orders by end of day'
            }
          </p>
        </div>
        
        {/* Chart - conditional on scenario mode */}
        {scenarioMode ? (
          <ScenarioPredictiveTimeline 
            data={throughputTimeline} 
            scenarioData={throughputTimelineScenario}
            height={160} 
            target={13000} 
            contextualTime={contextualTime} 
          />
        ) : (
          <PredictiveTimeline data={throughputTimeline} height={140} target={13000} contextualTime={contextualTime} />
        )}
        
        {/* Metrics row - below chart */}
        <div style={{ 
          display: 'flex', 
          justifyContent: 'space-between', 
          alignItems: 'center',
          marginTop: sp.md,
          padding: sp.sm,
          background: C.neutral[50],
          borderRadius: 6
        }}>
          {/* Contextual time metric */}
          {isContextualDifferent && contextualThroughput ? (
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, padding: '4px 10px', background: C.brand[100], borderRadius: 6 }}>
              <span style={{ fontSize: '13px', color: C.brand[600] }}>
                @{contextualTime}: <strong>{contextualThroughput.toLocaleString()}</strong> orders
                {isContextualPast && <span style={{ fontSize: '11px', color: C.brand[500], marginLeft: 4 }}>(past)</span>}
              </span>
            </div>
          ) : (
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>Now:</span>
              <span style={{ fontSize: '14px', fontWeight: 600, color: C.neutral[800] }}>4,200</span>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>orders</span>
            </div>
          )}
          
          {/* EOD metric */}
          {scenarioMode ? (
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>EOD:</span>
              <span style={{ fontSize: '12px', color: C.neutral[500], textDecoration: 'line-through' }}>12,850</span>
              <ArrowRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
              <span style={{ fontSize: '14px', fontWeight: 600, color: C.purple[600] }}>13,850</span>
              <span style={{ fontSize: '11px', fontWeight: 600, color: C.success[600], background: C.success[50], padding: '2px 6px', borderRadius: 4 }}>+1,000</span>
            </div>
          ) : (
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>EOD:</span>
              <span style={{ fontSize: '14px', fontWeight: 600, color: C.purple[600] }}>12,850</span>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>orders</span>
              <span style={{ fontSize: '11px', color: C.neutral[400] }}>/ Target: 13,000</span>
            </div>
          )}
        </div>
        
        {/* Alerts - Original InlineAlert style with state badges */}
        <Accordion 
          title="Alerts" 
          alerts={baselineAlerts}
          defaultOpen={false}
          customHeader={(
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', flex: 1 }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <span style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[800] }}>Alerts</span>
                {activePlans.length > 0 ? (
                  <>
                    <span style={{ fontSize: '11px', fontWeight: 500, color: C.success[700], background: C.success[50], padding: '2px 8px', borderRadius: 4 }}>
                      {baselineAlerts.filter(a => ['alert-1', 'alert-3'].includes(a.id)).length} resolved
                    </span>
                    <span style={{ fontSize: '11px', fontWeight: 500, color: C.brand[700], background: C.brand[50], padding: '2px 8px', borderRadius: 4 }}>
                      {baselineAlerts.filter(a => a.id === 'alert-2').length} targeted
                    </span>
                  </>
                ) : scenarioMode ? (
                  <>
                    <span style={{ fontSize: '11px', fontWeight: 500, color: C.success[700], background: C.success[50], padding: '2px 8px', borderRadius: 4 }}>
                      {scenarioAlerts.filter(a => a.state === 'mitigated').length} mitigated
                    </span>
                    <span style={{ fontSize: '11px', fontWeight: 500, color: C.warning[700], background: C.warning[50], padding: '2px 8px', borderRadius: 4 }}>
                      {scenarioAlerts.filter(a => a.state === 'persists').length} persist
                    </span>
                  </>
                ) : null}
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                {baselineAlerts.filter(a => a.sev === 'critical').length > 0 && (
                  <span style={{ fontSize: '11px', fontWeight: 500, color: C.error[700], background: C.error[50], padding: '2px 8px', borderRadius: 4 }}>
                    {baselineAlerts.filter(a => a.sev === 'critical').length} critical
                  </span>
                )}
                {baselineAlerts.filter(a => a.sev === 'warning').length > 0 && (
                  <span style={{ fontSize: '11px', fontWeight: 500, color: C.warning[700], background: C.warning[50], padding: '2px 8px', borderRadius: 4 }}>
                    {baselineAlerts.filter(a => a.sev === 'warning').length} warning
                  </span>
                )}
              </div>
            </div>
          )}
        >
          {(scenarioMode ? scenarioAlerts : baselineAlerts).map((alert, i) => {
            // Determine state for Live + Plan mode
            const getAlertState = () => {
              if (scenarioMode) return alert.state;
              if (activePlans.length === 0) return 'active';
              if (['alert-1', 'alert-3'].includes(alert.id)) return 'resolved';
              if (alert.id === 'alert-2') return 'targeted';
              return 'persists';
            };
            
            const alertState = getAlertState();
            const stateConfig = {
              resolved: { label: '✓ Resolved', bg: C.success[100], color: C.success[700] },
              mitigated: { label: '✓ Mitigated', bg: C.success[100], color: C.success[700] },
              targeted: { label: '◐ Targeted', bg: C.brand[100], color: C.brand[700] },
              persists: { label: 'Persists', bg: C.neutral[100], color: C.neutral[600] },
              active: { label: null, bg: null, color: null }
            };
            const config = stateConfig[alertState] || stateConfig.active;
            const isResolved = ['resolved', 'mitigated'].includes(alertState);
            
            // Color config based on severity
            const sevConfig = { 
              critical: [C.error[50], C.error[100], C.error[700], AlertOctagon], 
              warning: [C.warning[50], C.warning[100], C.warning[700], AlertTriangle], 
              info: [C.brand[50], C.brand[100], C.brand[600], Info] 
            };
            const [bg, bdr, txt, Icon] = sevConfig[alert.sev] || sevConfig.warning;
            
            return (
              <div 
                key={alert.id}
                onClick={() => navigateToAlert(alert.id, 'overall')}
                style={{ 
                  background: isResolved ? C.neutral[50] : bg, 
                  borderTop: `1px solid ${isResolved ? C.neutral[200] : bdr}`,
                  borderRight: `1px solid ${isResolved ? C.neutral[200] : bdr}`,
                  borderBottom: `1px solid ${isResolved ? C.neutral[200] : bdr}`,
                  borderLeft: `4px solid ${isResolved ? C.success[400] : txt}`,
                  borderRadius: '0 6px 6px 0', 
                  padding: `${sp.sm} ${sp.md}`,
                  marginBottom: sp.sm,
                  cursor: 'pointer',
                  transition: 'all 0.15s',
                  opacity: isResolved ? 0.7 : 1
                }}
                onMouseEnter={(e) => { e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)'; }}
                onMouseLeave={(e) => { e.currentTarget.style.boxShadow = 'none'; }}
              >
                <div style={{ display: 'flex', gap: sp.sm, alignItems: 'flex-start' }}>
                  <Icon style={{ width: 14, height: 14, color: isResolved ? C.neutral[400] : txt, flexShrink: 0, marginTop: 2 }} />
                  <div style={{ flex: 1, minWidth: 0 }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                      <span style={{ 
                        fontSize: '13px', 
                        fontWeight: 500, 
                        color: isResolved ? C.neutral[400] : txt,
                        textDecoration: isResolved ? 'line-through' : 'none'
                      }}>{alert.title}</span>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, flexShrink: 0 }}>
                        {alert.time && (
                          <span style={{ fontSize: '11px', color: isResolved ? C.neutral[400] : C.neutral[500] }}>{alert.time}</span>
                        )}
                        {config.label && (
                          <span style={{ 
                            fontSize: '10px', 
                            fontWeight: 600, 
                            padding: '2px 6px', 
                            background: config.bg, 
                            color: config.color, 
                            borderRadius: 3 
                          }}>
                            {config.label}
                          </span>
                        )}
                        <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
                      </div>
                    </div>
                    <p style={{ 
                      fontSize: '12px', 
                      color: isResolved ? C.neutral[400] : C.neutral[600], 
                      margin: `${sp.xs} 0 0 0`,
                      textDecoration: isResolved ? 'line-through' : 'none'
                    }}>{alert.msg}</p>
                    {alert.conf && (
                      <p style={{ fontSize: '11px', color: isResolved ? C.neutral[300] : C.neutral[400], margin: `${sp.xs} 0 0 0` }}>
                        Confidence: {alert.conf}%
                      </p>
                    )}
                  </div>
                </div>
              </div>
            );
          })}
          
          {/* Link to full Analysis */}
          <div style={{ 
            marginTop: sp.xs, 
            paddingTop: sp.sm, 
            borderTop: `1px solid ${C.neutral[200]}`,
            display: 'flex',
            justifyContent: 'flex-end'
          }}>
            <button
              onClick={() => {
                const analysisCard = document.querySelector('[data-analysis-card]');
                if (analysisCard) {
                  analysisCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
              }}
              style={{
                padding: '4px 10px',
                fontSize: '11px',
                fontWeight: 500,
                color: C.purple[600],
                background: 'transparent',
                border: 'none',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: 4
              }}
            >
              View root causes & actions <ChevronRight style={{ width: 12, height: 12 }} />
            </button>
          </div>
        </Accordion>
      </Card>
      
      {/* Key Metrics with Predictions - with tri-temporal display and scenario support */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Today's Performance</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>
                Current metrics → {isContextualDifferent && <span style={{ color: C.brand[600] }}>@{contextualTime} → </span>}end-of-day predictions
                {scenarioMode && <span style={{ color: C.purple[600], marginLeft: sp.sm }}>(Baseline vs Scenario)</span>}
              </p>
            </div>
            {scenarioMode && (
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, padding: '4px 8px', background: C.purple[50], borderRadius: 6, border: `1px solid ${C.purple[200]}` }}>
                <span style={{ fontSize: '11px', color: C.purple[700] }}>Scenario: +4 FTEs</span>
              </div>
            )}
          </div>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.md }}>
          {metrics.map((m, i) => {
            const contextualVal = isContextualDifferent ? interpolateValue(m.timeline, contextualTime) : null;
            // Scenario contextual value (slightly higher than baseline contextual)
            const contextualValScenario = contextualVal ? contextualVal * 1.02 + (m.l.includes('Cost') ? -0.15 : 0) : null;
            
            // Calculate deltas
            const eodDelta = m.predScenarioNum - m.predNum;
            const contextualDelta = contextualValScenario && contextualVal ? contextualValScenario - contextualVal : 0;
            
            // Format delta based on metric type
            const formatDelta = (delta, metric) => {
              if (metric.l.includes('%')) return (delta > 0 ? '+' : '') + delta.toFixed(1) + '%';
              if (metric.l.includes('$')) return (delta < 0 ? '-$' : '+$') + Math.abs(delta).toFixed(2);
              return (delta > 0 ? '+' : '') + Math.round(delta).toLocaleString();
            };
            
            const eodDeltaFormatted = formatDelta(eodDelta, m);
            const contextualDeltaFormatted = formatDelta(contextualDelta, m);
            
            // Target calculations
            const baselineDiff = m.predNum - m.tNum;
            const scenarioDiff = m.predScenarioNum - m.tNum;
            const baselineHits = m.higherIsBetter ? baselineDiff >= 0 : baselineDiff <= 0;
            const scenarioHits = m.higherIsBetter ? scenarioDiff >= 0 : scenarioDiff <= 0;
            
            const formatTargetDiff = (diff, metric) => {
              if (metric.l.includes('%')) return (diff >= 0 ? '+' : '') + diff.toFixed(1) + '%';
              if (metric.l.includes('$')) return (diff >= 0 ? '+$' : '-$') + Math.abs(diff).toFixed(2);
              return (diff >= 0 ? '+' : '') + Math.round(diff).toLocaleString();
            };
            
            return (
              <div 
                key={i} 
                onClick={() => setActiveTab(m.tab)}
                style={{ 
                  padding: sp.md, 
                  background: C.neutral[50], 
                  borderRadius: '8px', 
                  borderLeft: `3px solid ${m.ok ? C.success[500] : C.warning[500]}`,
                  cursor: 'pointer',
                  transition: 'all 0.15s',
                  position: 'relative'
                }}
                onMouseEnter={(e) => { 
                  e.currentTarget.style.background = C.neutral[100]; 
                  e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                }}
                onMouseLeave={(e) => { 
                  e.currentTarget.style.background = C.neutral[50]; 
                  e.currentTarget.style.boxShadow = 'none';
                }}
              >
                {/* Header */}
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.md }}>
                  <p style={{ fontSize: '11px', fontWeight: 500, color: C.neutral[500], textTransform: 'uppercase' }}>{m.l}</p>
                  <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
                </div>
                
                {/* Column headers - only in scenario mode */}
                {scenarioMode && (
                  <div style={{ display: 'flex', marginBottom: sp.xs }}>
                    <span style={{ width: 52 }}></span>
                    <span style={{ flex: 1, fontSize: '9px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase' }}>Baseline</span>
                    <span style={{ flex: 1, fontSize: '9px', fontWeight: 600, color: C.purple[600], textTransform: 'uppercase' }}>Scenario</span>
                    <span style={{ width: 44, fontSize: '9px', fontWeight: 600, color: C.neutral[400], textTransform: 'uppercase', textAlign: 'right' }}>Δ</span>
                  </div>
                )}
                
                {/* NOW row */}
                <div style={{ display: 'flex', alignItems: 'center', marginBottom: sp.xs }}>
                  <span style={{ width: 52, fontSize: '11px', color: C.neutral[500], fontWeight: 500 }}>Now</span>
                  {scenarioMode ? (
                    <>
                      <span style={{ flex: 1, fontSize: '16px', fontWeight: 500, color: C.neutral[800] }}>{m.v}</span>
                      <span style={{ flex: 1, fontSize: '16px', fontWeight: 500, color: C.purple[600] }}>{m.v}</span>
                      <span style={{ width: 44, fontSize: '11px', color: C.neutral[400], textAlign: 'right' }}>—</span>
                    </>
                  ) : (
                    <span style={{ fontSize: '20px', fontWeight: 400, color: C.neutral[800] }}>{m.v}</span>
                  )}
                </div>
                
                {/* Contextual row - only when scrubber moved */}
                {isContextualDifferent && contextualVal !== null && (
                  <div style={{ 
                    display: 'flex', 
                    alignItems: 'center',
                    marginBottom: sp.xs,
                    padding: `${sp.xs} 0`,
                    background: C.brand[50],
                    borderRadius: 4,
                    marginLeft: -8,
                    marginRight: -8,
                    paddingLeft: 8,
                    paddingRight: 8
                  }}>
                    <span style={{ width: 52, fontSize: '11px', color: C.brand[600], fontWeight: 500 }}>@{contextualTime}</span>
                    {scenarioMode ? (
                      <>
                        <span style={{ flex: 1, fontSize: '13px', color: C.neutral[700] }}>{m.format(contextualVal)}</span>
                        <span style={{ flex: 1, fontSize: '13px', fontWeight: 500, color: C.purple[600] }}>{m.format(contextualValScenario)}</span>
                        <span style={{ width: 44, fontSize: '11px', fontWeight: 600, color: C.success[600], textAlign: 'right' }}>{contextualDeltaFormatted}</span>
                      </>
                    ) : (
                      <span style={{ fontSize: '14px', fontWeight: 500, color: C.brand[700] }}>{m.format(contextualVal)}</span>
                    )}
                  </div>
                )}
                
                {/* EOD row */}
                <div style={{ display: 'flex', alignItems: 'center', marginBottom: sp.md }}>
                  <span style={{ width: 52, fontSize: '11px', color: C.neutral[500], fontWeight: 500 }}>EOD</span>
                  {scenarioMode ? (
                    <>
                      <span style={{ flex: 1, fontSize: '13px', color: C.neutral[600] }}>{m.pred}</span>
                      <span style={{ flex: 1, fontSize: '13px', fontWeight: 500, color: C.purple[600] }}>{m.predScenario}</span>
                      <span style={{ 
                        width: 44, 
                        fontSize: '11px', 
                        fontWeight: 600, 
                        color: C.success[600], 
                        textAlign: 'right' 
                      }}>{eodDeltaFormatted}</span>
                    </>
                  ) : (
                    <span style={{ fontSize: '14px', fontWeight: 500, color: C.purple[600] }}>{m.pred}</span>
                  )}
                </div>
                
                {/* Target comparison */}
                <div style={{ 
                  borderTop: `1px solid ${C.neutral[200]}`,
                  paddingTop: sp.sm
                }}>
                  <div style={{ display: 'flex', alignItems: 'center' }}>
                    <span style={{ width: 52, fontSize: '11px', color: C.neutral[500] }}>Target</span>
                    {scenarioMode ? (
                      <>
                        <span style={{ flex: 1, fontSize: '11px', color: C.neutral[500] }}>{m.t}</span>
                        <span style={{ flex: 1 }}></span>
                        <span style={{ width: 44 }}></span>
                      </>
                    ) : (
                      <span style={{ fontSize: '12px', color: C.neutral[600] }}>{m.t}</span>
                    )}
                  </div>
                  {scenarioMode ? (
                    <div style={{ display: 'flex', alignItems: 'center', marginTop: sp.xs }}>
                      <span style={{ width: 52 }}></span>
                      <span style={{ flex: 1, fontSize: '11px', fontWeight: 600, color: baselineHits ? C.success[600] : C.error[600] }}>
                        {baselineHits ? '✓' : '✗'} {formatTargetDiff(baselineDiff, m)}
                      </span>
                      <span style={{ flex: 1, fontSize: '11px', fontWeight: 600, color: scenarioHits ? C.success[600] : C.error[600] }}>
                        {scenarioHits ? '✓' : '✗'} {formatTargetDiff(scenarioDiff, m)}
                      </span>
                      <span style={{ width: 44 }}></span>
                    </div>
                  ) : (
                    <div style={{ marginTop: sp.xs }}>
                      <span style={{ fontSize: '11px', fontWeight: 600, color: baselineHits ? C.success[600] : C.error[600] }}>
                        {baselineHits ? '✓' : '✗'} {formatTargetDiff(baselineDiff, m)} vs target
                      </span>
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* Shift Overview */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.xs }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>
              Shift Overview
              {scenarioMode && <span style={{ fontSize: '12px', color: C.purple[500], fontWeight: 400, marginLeft: sp.sm }}>(Baseline vs Scenario)</span>}
            </h3>
            <Badge status="info" label="Day Active" dot />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>
            Cross-shift performance and predictions • Click to view details
            {isContextualDifferent && !scenarioMode && (
              <span style={{ marginLeft: sp.sm }}>
                • <span style={{ padding: '1px 6px', background: C.brand[100], color: C.brand[600], borderRadius: 3, fontSize: '11px' }}>Blue</span> = @{contextualTime}
              </span>
            )}
            {scenarioMode && (
              <span style={{ marginLeft: sp.sm }}>• Scenario: +4 FTE pickers</span>
            )}
          </p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {shifts.map((s, i) => {
            const act = s.status === 'active', up = s.status === 'upcoming', done = s.status === 'completed';
            
            // Get contextual values for active shift only
            const ctxThroughput = act && isContextualDifferent && s.timelines ? interpolateValue(s.timelines.throughput, contextualTime) : null;
            const ctxCompletion = act && isContextualDifferent && s.timelines ? interpolateValue(s.timelines.completion, contextualTime) : null;
            const ctxStaffing = act && isContextualDifferent && s.timelines ? interpolateValue(s.timelines.staffing, contextualTime) : null;
            
            // Scenario deltas
            const tpDelta = s.tpPredScenario && s.tpPred ? s.tpPredScenario - s.tpPred : null;
            const compDelta = s.compPredScenario && s.compPred ? s.compPredScenario - s.compPred : null;
            const staffDelta = s.staffScenario && s.staff ? s.staffScenario - s.staff : null;
            const otDelta = s.otScenario && s.ot ? s.otScenario - s.ot : null;
            
            // Check if shift has any scenario impact
            const hasScenarioImpact = tpDelta || compDelta || staffDelta || otDelta;
            
            return (
              <div 
                key={i} 
                onClick={() => onShift(s.id)} 
                className="card-click" 
                style={{ 
                  padding: sp.md, 
                  background: act ? (scenarioMode ? C.purple[50] : C.brand[100]) : C.neutral[50], 
                  borderRadius: '8px', 
                  border: `1px solid ${act ? (scenarioMode ? C.purple[200] : C.brand[300]) : C.neutral[200]}`, 
                  cursor: 'pointer', 
                  transition: 'all 0.15s' 
                }}
                onMouseEnter={(e) => { e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)'; e.currentTarget.style.transform = 'translateY(-2px)'; }}
                onMouseLeave={(e) => { e.currentTarget.style.boxShadow = 'none'; e.currentTarget.style.transform = 'translateY(0)'; }}
              >
                {/* Shift header row */}
                <div style={{ display: 'flex', alignItems: 'center', marginBottom: scenarioMode && (act || up) ? sp.sm : 0 }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, minWidth: 140 }}>
                    <div style={{ width: 36, height: 36, borderRadius: 8, background: act ? (scenarioMode ? C.purple[500] : C.brand[500]) : up ? C.purple[100] : C.success[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                      {act ? <Sun style={{ width: 18, height: 18, color: 'white' }} /> : up ? <Moon style={{ width: 18, height: 18, color: C.purple[600] }} /> : <CheckCircle style={{ width: 18, height: 18, color: C.success[600] }} />}
                    </div>
                    <div><p style={{ fontSize: '14px', fontWeight: 500 }}>{s.name}</p><p style={{ fontSize: '11px', color: C.neutral[500] }}>{s.time}</p></div>
                  </div>
                  <Badge status={act ? (scenarioMode ? 'purple' : 'info') : up ? 'purple' : 'success'} label={act ? 'LIVE' : up ? 'Next' : 'Done'} dot={act} />
                  
                  {/* Standard mode metrics OR completed shift metrics */}
                  {(!scenarioMode || done) && (
                    <>
                      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md, flex: 1, marginLeft: sp.lg }}>
                        {/* Throughput */}
                        <div style={{ textAlign: 'center' }}>
                          <p style={{ fontSize: '10px', color: C.neutral[500] }}>Throughput</p>
                          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 3, flexWrap: 'wrap' }}>
                            <span style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[900] }}>{s.tp ? `${(s.tp/1000).toFixed(1)}K` : '—'}</span>
                            {ctxThroughput !== null && (
                              <>
                                <ArrowRight style={{ width: 8, height: 8, color: C.neutral[400] }} />
                                <span style={{ fontSize: '12px', fontWeight: 500, color: C.brand[600], padding: '1px 4px', background: C.brand[100], borderRadius: 3 }}>{(ctxThroughput/1000).toFixed(1)}K</span>
                              </>
                            )}
                            {s.tpPred && (
                              <>
                                <ArrowRight style={{ width: 8, height: 8, color: C.neutral[400] }} />
                                <span style={{ fontSize: '12px', color: C.purple[600] }}>{(s.tpPred/1000).toFixed(1)}K</span>
                              </>
                            )}
                          </div>
                        </div>
                        
                        {/* Completion */}
                        <div style={{ textAlign: 'center' }}>
                          <p style={{ fontSize: '10px', color: C.neutral[500] }}>Completion</p>
                          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 3, flexWrap: 'wrap' }}>
                            <span style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[900] }}>{s.comp !== null ? `${s.comp}%` : '—'}</span>
                            {ctxCompletion !== null && (
                              <>
                                <ArrowRight style={{ width: 8, height: 8, color: C.neutral[400] }} />
                                <span style={{ fontSize: '12px', fontWeight: 500, color: C.brand[600], padding: '1px 4px', background: C.brand[100], borderRadius: 3 }}>{ctxCompletion}%</span>
                              </>
                            )}
                            {s.compPred && (
                              <>
                                <ArrowRight style={{ width: 8, height: 8, color: C.neutral[400] }} />
                                <span style={{ fontSize: '12px', color: C.purple[600] }}>{s.compPred}%</span>
                              </>
                            )}
                          </div>
                        </div>
                        
                        {/* Staffing */}
                        <div style={{ textAlign: 'center' }}>
                          <p style={{ fontSize: '10px', color: C.neutral[500] }}>Staffing</p>
                          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 3, flexWrap: 'wrap' }}>
                            <span style={{ fontSize: '14px', fontWeight: 500, color: s.staff < 90 ? C.warning[600] : C.neutral[900] }}>{s.staff}%</span>
                            {ctxStaffing !== null && (
                              <>
                                <ArrowRight style={{ width: 8, height: 8, color: C.neutral[400] }} />
                                <span style={{ fontSize: '12px', fontWeight: 500, color: C.brand[600], padding: '1px 4px', background: C.brand[100], borderRadius: 3 }}>{ctxStaffing}%</span>
                              </>
                            )}
                          </div>
                        </div>
                        
                        {/* On-Time */}
                        <div style={{ textAlign: 'center' }}>
                          <p style={{ fontSize: '10px', color: C.neutral[500] }}>On-Time</p>
                          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 3 }}>
                            <span style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[900] }}>{s.ot ? `${s.ot}%` : '—'}</span>
                          </div>
                        </div>
                      </div>
                      <ChevronRight style={{ width: 20, height: 20, color: C.neutral[400] }} />
                    </>
                  )}
                  
                  {/* Scenario mode - just show chevron in header for active/upcoming */}
                  {scenarioMode && !done && (
                    <div style={{ flex: 1, display: 'flex', justifyContent: 'flex-end' }}>
                      <ChevronRight style={{ width: 20, height: 20, color: C.neutral[400] }} />
                    </div>
                  )}
                </div>
                
                {/* Scenario Mode: Card-based metrics for active/upcoming shifts */}
                {scenarioMode && (act || up) && hasScenarioImpact && (
                  <div style={{ marginTop: sp.sm }}>
                    {/* Metric cards grid */}
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
                      {/* Throughput Card */}
                      <div style={{ background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.neutral[200]}` }}>
                        <div style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.xs, textAlign: 'center' }}>Throughput</div>
                        <div style={{ display: 'flex', justifyContent: 'center', gap: sp.md, marginBottom: sp.xs }}>
                          <span style={{ fontSize: '9px', color: C.neutral[400] }}>BASE</span>
                          <span style={{ fontSize: '9px', color: C.purple[500] }}>SCEN</span>
                        </div>
                        {/* Now row */}
                        {act && (
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 0`, borderTop: `1px solid ${C.neutral[100]}` }}>
                            <span style={{ fontSize: '10px', color: C.neutral[500] }}>Now</span>
                            <div style={{ display: 'flex', gap: sp.sm }}>
                              <span style={{ fontSize: '11px', color: C.neutral[700] }}>{s.tp ? `${(s.tp/1000).toFixed(1)}K` : '—'}</span>
                              <span style={{ fontSize: '11px', color: C.purple[600] }}>{s.tp ? `${(s.tp/1000).toFixed(1)}K` : '—'}</span>
                            </div>
                          </div>
                        )}
                        {/* Contextual row */}
                        {act && isContextualDifferent && ctxThroughput && (
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 4px`, background: C.brand[50], borderRadius: 3, margin: '2px -4px' }}>
                            <span style={{ fontSize: '10px', color: C.brand[600] }}>@{contextualTime}</span>
                            <div style={{ display: 'flex', gap: sp.sm }}>
                              <span style={{ fontSize: '11px', color: C.neutral[700] }}>{`${(ctxThroughput/1000).toFixed(1)}K`}</span>
                              <span style={{ fontSize: '11px', fontWeight: 500, color: C.purple[600] }}>{`${((ctxThroughput * 1.08)/1000).toFixed(1)}K`}</span>
                            </div>
                          </div>
                        )}
                        {/* EOS row */}
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 0`, borderTop: `1px solid ${C.neutral[100]}` }}>
                          <span style={{ fontSize: '10px', color: C.neutral[500] }}>{act ? 'EOS' : 'Pred'}</span>
                          <div style={{ display: 'flex', gap: sp.sm }}>
                            <span style={{ fontSize: '11px', color: C.neutral[700] }}>{s.tpPred ? `${(s.tpPred/1000).toFixed(1)}K` : '—'}</span>
                            <span style={{ fontSize: '11px', fontWeight: 500, color: C.purple[600] }}>{s.tpPredScenario ? `${(s.tpPredScenario/1000).toFixed(1)}K` : '—'}</span>
                          </div>
                        </div>
                        {/* Delta */}
                        {tpDelta ? (
                          <div style={{ textAlign: 'center', marginTop: sp.xs }}>
                            <span style={{ fontSize: '10px', fontWeight: 600, color: C.success[600], background: C.success[50], padding: '2px 8px', borderRadius: 3 }}>
                              +{(tpDelta/1000).toFixed(1)}K
                            </span>
                          </div>
                        ) : null}
                      </div>
                      
                      {/* Completion Card */}
                      <div style={{ background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.neutral[200]}` }}>
                        <div style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.xs, textAlign: 'center' }}>Completion</div>
                        <div style={{ display: 'flex', justifyContent: 'center', gap: sp.md, marginBottom: sp.xs }}>
                          <span style={{ fontSize: '9px', color: C.neutral[400] }}>BASE</span>
                          <span style={{ fontSize: '9px', color: C.purple[500] }}>SCEN</span>
                        </div>
                        {/* Now row */}
                        {act && (
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 0`, borderTop: `1px solid ${C.neutral[100]}` }}>
                            <span style={{ fontSize: '10px', color: C.neutral[500] }}>Now</span>
                            <div style={{ display: 'flex', gap: sp.sm }}>
                              <span style={{ fontSize: '11px', color: C.neutral[700] }}>{s.comp !== null ? `${s.comp}%` : '—'}</span>
                              <span style={{ fontSize: '11px', color: C.purple[600] }}>{s.comp !== null ? `${s.comp}%` : '—'}</span>
                            </div>
                          </div>
                        )}
                        {/* Contextual row */}
                        {act && isContextualDifferent && ctxCompletion && (
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 4px`, background: C.brand[50], borderRadius: 3, margin: '2px -4px' }}>
                            <span style={{ fontSize: '10px', color: C.brand[600] }}>@{contextualTime}</span>
                            <div style={{ display: 'flex', gap: sp.sm }}>
                              <span style={{ fontSize: '11px', color: C.neutral[700] }}>{`${ctxCompletion}%`}</span>
                              <span style={{ fontSize: '11px', fontWeight: 500, color: C.purple[600] }}>{`${Math.min(ctxCompletion + 5, 100)}%`}</span>
                            </div>
                          </div>
                        )}
                        {/* EOS row */}
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 0`, borderTop: `1px solid ${C.neutral[100]}` }}>
                          <span style={{ fontSize: '10px', color: C.neutral[500] }}>{act ? 'EOS' : 'Pred'}</span>
                          <div style={{ display: 'flex', gap: sp.sm }}>
                            <span style={{ fontSize: '11px', color: C.neutral[700] }}>{s.compPred ? `${s.compPred}%` : '—'}</span>
                            <span style={{ fontSize: '11px', fontWeight: 500, color: C.purple[600] }}>{s.compPredScenario ? `${s.compPredScenario}%` : '—'}</span>
                          </div>
                        </div>
                        {/* Delta */}
                        {compDelta ? (
                          <div style={{ textAlign: 'center', marginTop: sp.xs }}>
                            <span style={{ fontSize: '10px', fontWeight: 600, color: C.success[600], background: C.success[50], padding: '2px 8px', borderRadius: 3 }}>
                              +{compDelta}%
                            </span>
                          </div>
                        ) : null}
                      </div>
                      
                      {/* Staffing Card */}
                      <div style={{ background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.neutral[200]}` }}>
                        <div style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.xs, textAlign: 'center' }}>Staffing</div>
                        <div style={{ display: 'flex', justifyContent: 'center', gap: sp.md, marginBottom: sp.xs }}>
                          <span style={{ fontSize: '9px', color: C.neutral[400] }}>BASE</span>
                          <span style={{ fontSize: '9px', color: C.purple[500] }}>SCEN</span>
                        </div>
                        {/* Now row */}
                        {act && (
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 0`, borderTop: `1px solid ${C.neutral[100]}` }}>
                            <span style={{ fontSize: '10px', color: C.neutral[500] }}>Now</span>
                            <div style={{ display: 'flex', gap: sp.sm }}>
                              <span style={{ fontSize: '11px', color: C.neutral[700] }}>{s.staff}%</span>
                              <span style={{ fontSize: '11px', color: C.purple[600] }}>{s.staffScenario || s.staff}%</span>
                            </div>
                          </div>
                        )}
                        {/* Contextual row */}
                        {act && isContextualDifferent && ctxStaffing && (
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 4px`, background: C.brand[50], borderRadius: 3, margin: '2px -4px' }}>
                            <span style={{ fontSize: '10px', color: C.brand[600] }}>@{contextualTime}</span>
                            <div style={{ display: 'flex', gap: sp.sm }}>
                              <span style={{ fontSize: '11px', color: C.neutral[700] }}>{`${ctxStaffing}%`}</span>
                              <span style={{ fontSize: '11px', fontWeight: 500, color: C.purple[600] }}>{`${ctxStaffing + 4}%`}</span>
                            </div>
                          </div>
                        )}
                        {/* EOS row - staffing doesn't have prediction */}
                        {!act && (
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 0`, borderTop: `1px solid ${C.neutral[100]}` }}>
                            <span style={{ fontSize: '10px', color: C.neutral[500] }}>Planned</span>
                            <div style={{ display: 'flex', gap: sp.sm }}>
                              <span style={{ fontSize: '11px', color: C.neutral[700] }}>{s.staff}%</span>
                              <span style={{ fontSize: '11px', fontWeight: 500, color: C.purple[600] }}>{s.staffScenario || s.staff}%</span>
                            </div>
                          </div>
                        )}
                        {/* Delta */}
                        {staffDelta ? (
                          <div style={{ textAlign: 'center', marginTop: sp.xs }}>
                            <span style={{ fontSize: '10px', fontWeight: 600, color: C.success[600], background: C.success[50], padding: '2px 8px', borderRadius: 3 }}>
                              +{staffDelta}%
                            </span>
                          </div>
                        ) : null}
                      </div>
                      
                      {/* On-Time Card */}
                      <div style={{ background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.neutral[200]}` }}>
                        <div style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.xs, textAlign: 'center' }}>On-Time</div>
                        <div style={{ display: 'flex', justifyContent: 'center', gap: sp.md, marginBottom: sp.xs }}>
                          <span style={{ fontSize: '9px', color: C.neutral[400] }}>BASE</span>
                          <span style={{ fontSize: '9px', color: C.purple[500] }}>SCEN</span>
                        </div>
                        {/* Now row */}
                        {act && (
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 0`, borderTop: `1px solid ${C.neutral[100]}` }}>
                            <span style={{ fontSize: '10px', color: C.neutral[500] }}>Now</span>
                            <div style={{ display: 'flex', gap: sp.sm }}>
                              <span style={{ fontSize: '11px', color: C.neutral[700] }}>{s.ot ? `${s.ot}%` : '—'}</span>
                              <span style={{ fontSize: '11px', color: C.purple[600] }}>{s.ot ? `${s.ot}%` : '—'}</span>
                            </div>
                          </div>
                        )}
                        {/* EOS row */}
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: `3px 0`, borderTop: `1px solid ${C.neutral[100]}` }}>
                          <span style={{ fontSize: '10px', color: C.neutral[500] }}>{act ? 'EOS' : 'Pred'}</span>
                          <div style={{ display: 'flex', gap: sp.sm }}>
                            <span style={{ fontSize: '11px', color: C.neutral[700] }}>{s.ot ? `${s.ot}%` : '—'}</span>
                            <span style={{ fontSize: '11px', fontWeight: 500, color: C.purple[600] }}>{s.otScenario ? `${s.otScenario}%` : '—'}</span>
                          </div>
                        </div>
                        {/* Delta */}
                        {otDelta ? (
                          <div style={{ textAlign: 'center', marginTop: sp.xs }}>
                            <span style={{ fontSize: '10px', fontWeight: 600, color: C.success[600], background: C.success[50], padding: '2px 8px', borderRadius: 3 }}>
                              +{otDelta}%
                            </span>
                          </div>
                        ) : null}
                      </div>
                    </div>
                    
                    {/* Cascade note for upcoming shift */}
                    {up && (
                      <div style={{ marginTop: sp.sm, padding: sp.sm, background: C.purple[50], borderRadius: 4 }}>
                        <p style={{ fontSize: '11px', color: C.purple[700], margin: 0 }}>
                          <Info style={{ width: 12, height: 12, display: 'inline', verticalAlign: 'middle', marginRight: 4 }} />
                          Projected improvement from reduced backlog carried over from Day shift
                        </p>
                      </div>
                    )}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* Financial Health - Bottom line metrics with tri-temporal */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Financial Health</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>
                Labor costs and budget performance
                {isContextualDifferent && <span style={{ color: C.brand[600] }}> • @{contextualTime}</span>}
              </p>
            </div>
            <Badge status="warning" label="5.6% over" />
          </div>
        </div>
        {(() => {
          const financialMetrics = [
            { 
              label: 'Labor Cost', 
              unit: '$',
              prefix: true,
              target: 12400,
              timeline: [
                { time: '06:00', actual: 1200 },
                { time: '08:00', actual: 3800 },
                { time: '10:00', actual: 6420 },
                { time: '12:00', predicted: 9200 },
                { time: '14:00', predicted: 13100 }
              ]
            },
            { 
              label: 'Cost/Order', 
              unit: '$',
              prefix: true,
              decimals: 2,
              target: 1.50,
              timeline: [
                { time: '06:00', actual: 1.48 },
                { time: '08:00', actual: 1.51 },
                { time: '10:00', actual: 1.53 },
                { time: '12:00', predicted: 1.55 },
                { time: '14:00', predicted: 1.58 }
              ]
            },
            { 
              label: 'OT Hours', 
              unit: ' hrs',
              target: 40,
              timeline: [
                { time: '06:00', actual: 6 },
                { time: '08:00', actual: 14 },
                { time: '10:00', actual: 24 },
                { time: '12:00', predicted: 36 },
                { time: '14:00', predicted: 52 }
              ]
            },
            { 
              label: 'Temp Labor', 
              unit: ' FTE',
              target: 4,
              timeline: [
                { time: '06:00', actual: 2 },
                { time: '08:00', actual: 4 },
                { time: '10:00', actual: 4 },
                { time: '12:00', predicted: 5 },
                { time: '14:00', predicted: 6 }
              ]
            }
          ];
          
          return (
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
              {financialMetrics.map((metric, i) => {
                const currentVal = metric.timeline.find(t => t.time === '10:00')?.actual || 0;
                const contextualVal = isContextualDifferent ? interpolateValue(metric.timeline, contextualTime) : null;
                const predictedVal = metric.timeline[metric.timeline.length - 1]?.predicted || 0;
                
                const formatVal = (v) => {
                  const num = metric.decimals ? v.toFixed(metric.decimals) : Math.round(v).toLocaleString();
                  return metric.prefix ? `${metric.unit}${num}` : `${num}${metric.unit}`;
                };
                
                const evalVal = contextualVal !== null ? contextualVal : currentVal;
                const isOk = evalVal <= metric.target * 1.05; // within 5% of target
                
                return (
                  <div key={i} style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, borderLeft: `3px solid ${isOk ? C.success[500] : C.warning[500]}` }}>
                    <p style={{ fontSize: '11px', color: C.neutral[500], textTransform: 'uppercase', marginBottom: sp.xs }}>{metric.label}</p>
                    <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs, marginBottom: sp.xs, flexWrap: 'wrap' }}>
                      <span style={{ fontSize: '20px', fontWeight: 500 }}>{formatVal(currentVal)}</span>
                      {isContextualDifferent && contextualVal !== null && (
                        <>
                          <ArrowRight style={{ width: 10, height: 10, color: C.neutral[400] }} />
                          <span style={{ fontSize: '14px', fontWeight: 500, color: C.brand[600], padding: '1px 4px', background: C.brand[100], borderRadius: 3 }}>
                            {formatVal(contextualVal)}
                          </span>
                        </>
                      )}
                      <ArrowRight style={{ width: 10, height: 10, color: C.neutral[400] }} />
                      <span style={{ fontSize: '14px', color: C.purple[600] }}>{formatVal(predictedVal)}</span>
                    </div>
                    <span style={{ fontSize: '11px', color: C.neutral[500] }}>Target: {formatVal(metric.target)}</span>
                  </div>
                );
              })}
            </div>
          );
        })()}
        <Accordion title="Analysis" alerts={[{ sev: 'warning', title: 'Labor over budget' }]} defaultOpen={true}>
          <InlineAlert 
            sev="warning" 
            title="Labor over budget" 
            msg="+5.6% predicted at shift end due to OT and temp labor" 
            time="+4hr" 
            conf={95} 
            state={activePlans.length > 0 ? 'persists' : 'active'}
            onClick={() => navigateToAlert('alert-4', 'overall', true)} 
          />
        </Accordion>
      </Card>
      
      {/* Asset Health - Equipment fleet status */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Asset Health</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>
                Equipment fleet availability and maintenance status
              </p>
            </div>
            <Badge status={93.8 >= 95 ? 'success' : 'warning'} label="93.8% Available" />
          </div>
        </div>
        
        {/* Fleet Summary Metrics */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md, marginBottom: sp.md }}>
          {[
            { label: 'Active', value: 24, total: 32, color: C.success, icon: CheckCircle },
            { label: 'Maintenance', value: 2, total: 32, color: C.warning, icon: Wrench },
            { label: 'Charging', value: 2, total: 32, color: C.brand, icon: Zap },
            { label: 'Offline', value: 1, total: 32, color: C.error, icon: AlertTriangle }
          ].map((item, i) => {
            const Icon = item.icon;
            return (
              <div key={i} style={{ 
                padding: sp.sm, 
                background: item.color[50], 
                borderRadius: 8, 
                borderLeft: `3px solid ${item.color[500]}`,
                display: 'flex',
                alignItems: 'center',
                gap: sp.sm
              }}>
                <Icon style={{ width: 16, height: 16, color: item.color[600] }} />
                <div>
                  <p style={{ fontSize: '18px', fontWeight: 500, color: item.color[700], lineHeight: 1 }}>{item.value}</p>
                  <p style={{ fontSize: '10px', color: item.color[600] }}>{item.label}</p>
                </div>
              </div>
            );
          })}
        </div>
        
        {/* Equipment Type Breakdown - Mini version */}
        <div style={{ display: 'flex', gap: sp.sm, marginBottom: sp.md, flexWrap: 'wrap' }}>
          {[
            { type: 'Forklifts', active: 6, total: 8 },
            { type: 'Reach Trucks', active: 5, total: 6 },
            { type: 'Pallet Jacks', active: 8, total: 10 },
            { type: 'Order Pickers', active: 3, total: 4 },
            { type: 'Tuggers', active: 3, total: 4 }
          ].map((eq, i) => {
            const pct = Math.round((eq.active / eq.total) * 100);
            return (
              <div key={i} style={{ 
                flex: '1 1 auto',
                minWidth: 100,
                padding: sp.xs + ' ' + sp.sm, 
                background: C.neutral[50], 
                borderRadius: 6,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                gap: sp.sm
              }}>
                <span style={{ fontSize: '11px', color: C.neutral[600] }}>{eq.type}</span>
                <span style={{ 
                  fontSize: '11px', 
                  fontWeight: 500, 
                  color: pct >= 90 ? C.success[600] : pct >= 75 ? C.warning[600] : C.error[600] 
                }}>
                  {eq.active}/{eq.total}
                </span>
              </div>
            );
          })}
        </div>
        
        {/* Link to Equipment Tab */}
        <div style={{ display: 'flex', justifyContent: 'flex-end', marginBottom: sp.md }}>
          <button
            onClick={() => setActiveTab('equipment')}
            style={{
              padding: `${sp.sm} ${sp.md}`,
              fontSize: '13px',
              fontWeight: 500,
              color: C.neutral[600],
              background: C.neutral[50],
              border: `1px solid ${C.neutral[200]}`,
              borderRadius: 6,
              cursor: 'pointer',
              transition: 'all 0.15s',
              display: 'flex',
              alignItems: 'center',
              gap: sp.sm
            }}
            onMouseEnter={(e) => { e.currentTarget.style.background = C.neutral[100]; }}
            onMouseLeave={(e) => { e.currentTarget.style.background = C.neutral[50]; }}
          >
            View Full Fleet Status
            <ChevronRight style={{ width: 14, height: 14 }} />
          </button>
        </div>
        
        {/* Equipment Alerts */}
        <Accordion 
          title="Analysis" 
          alerts={[
            { sev: 'critical', title: 'FL-06 PM overdue' },
            { sev: 'critical', title: 'TT-03 offline' }
          ]} 
          defaultOpen={true}
        >
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
            <InlineAlert 
              sev="critical" 
              title="FL-06 PM overdue" 
              msg="25 hours past scheduled maintenance - unit pulled from service" 
              time="Now" 
              conf={95} 
              state={activePlans.length > 0 ? 'persists' : 'active'}
              onClick={() => navigateToAlert('equip-pm-overdue', 'equipment', true)} 
            />
            <InlineAlert 
              sev="critical" 
              title="TT-03 offline" 
              msg="Tugger requires major repair - parts ETA 12/20" 
              time="Now" 
              conf={100}
              state={activePlans.length > 0 ? 'targeted' : 'active'}
              onClick={() => navigateToAlert('equip-tt03-offline', 'equipment', true)} 
            />
            <InlineAlert 
              sev="warning" 
              title="3 units low battery" 
              msg="RT-04, EPJ-06 charging; OP-02 needs rotation soon" 
              time="Now" 
              conf={90}
              state={activePlans.length > 0 ? 'resolved' : 'active'}
              onClick={() => navigateToAlert('equip-battery-low', 'equipment', true)} 
            />
          </div>
        </Accordion>
      </Card>
      
      {/* Customer Impact - SLA and delivery performance with tri-temporal */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Customer Impact</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>
                SLA performance and delivery metrics
                {isContextualDifferent && <span style={{ color: C.brand[600] }}> • @{contextualTime}</span>}
              </p>
            </div>
            <Badge status="warning" label="1 SLA at risk" />
          </div>
        </div>
        {(() => {
          const customerMetrics = [
            { 
              label: 'On-Time Rate', 
              unit: '%',
              suffix: true,
              decimals: 1,
              target: 95,
              inverse: false, // higher is better
              timeline: [
                { time: '06:00', actual: 98.5 },
                { time: '08:00', actual: 96.2 },
                { time: '10:00', actual: 94.2 },
                { time: '12:00', predicted: 92.8 },
                { time: '14:00', predicted: 91.8 }
              ]
            },
            { 
              label: 'Orders at Risk', 
              unit: '',
              target: 0,
              inverse: true, // lower is better
              timeline: [
                { time: '06:00', actual: 0 },
                { time: '08:00', actual: 12 },
                { time: '10:00', actual: 40 },
                { time: '12:00', predicted: 52 },
                { time: '14:00', predicted: 65 }
              ]
            },
            { 
              label: 'Avg Ship Time', 
              unit: ' hrs',
              suffix: true,
              decimals: 1,
              target: 2.5,
              inverse: true, // lower is better
              timeline: [
                { time: '06:00', actual: 1.8 },
                { time: '08:00', actual: 2.1 },
                { time: '10:00', actual: 2.4 },
                { time: '12:00', predicted: 2.6 },
                { time: '14:00', predicted: 2.8 }
              ]
            },
            { 
              label: 'Perfect Orders', 
              unit: '%',
              suffix: true,
              decimals: 1,
              target: 98,
              inverse: false, // higher is better
              timeline: [
                { time: '06:00', actual: 99.2 },
                { time: '08:00', actual: 98.6 },
                { time: '10:00', actual: 98.1 },
                { time: '12:00', predicted: 97.8 },
                { time: '14:00', predicted: 97.6 }
              ]
            }
          ];
          
          return (
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
              {customerMetrics.map((metric, i) => {
                const currentVal = metric.timeline.find(t => t.time === '10:00')?.actual || 0;
                const contextualVal = isContextualDifferent ? interpolateValue(metric.timeline, contextualTime) : null;
                const predictedVal = metric.timeline[metric.timeline.length - 1]?.predicted || 0;
                
                const formatVal = (v) => {
                  const num = metric.decimals ? v.toFixed(metric.decimals) : Math.round(v);
                  return metric.suffix ? `${num}${metric.unit}` : `${metric.unit}${num}`;
                };
                
                const evalVal = contextualVal !== null ? contextualVal : currentVal;
                const isOk = metric.inverse 
                  ? evalVal <= metric.target * 1.1 
                  : evalVal >= metric.target * 0.95;
                
                return (
                  <div key={i} style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, borderLeft: `3px solid ${isOk ? C.success[500] : C.warning[500]}` }}>
                    <p style={{ fontSize: '11px', color: C.neutral[500], textTransform: 'uppercase', marginBottom: sp.xs }}>{metric.label}</p>
                    <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs, marginBottom: sp.xs, flexWrap: 'wrap' }}>
                      <span style={{ fontSize: '20px', fontWeight: 500 }}>{formatVal(currentVal)}</span>
                      {isContextualDifferent && contextualVal !== null && (
                        <>
                          <ArrowRight style={{ width: 10, height: 10, color: C.neutral[400] }} />
                          <span style={{ fontSize: '14px', fontWeight: 500, color: C.brand[600], padding: '1px 4px', background: C.brand[100], borderRadius: 3 }}>
                            {formatVal(contextualVal)}
                          </span>
                        </>
                      )}
                      <ArrowRight style={{ width: 10, height: 10, color: C.neutral[400] }} />
                      <span style={{ fontSize: '14px', color: C.purple[600] }}>{formatVal(predictedVal)}</span>
                    </div>
                    <span style={{ fontSize: '11px', color: C.neutral[500] }}>Target: {formatVal(metric.target)}</span>
                  </div>
                );
              })}
            </div>
          );
        })()}
        <Accordion title="Analysis" alerts={[{ sev: 'critical', title: 'UPS cutoff at risk' }]} defaultOpen={true}>
          <InlineAlert 
            sev="critical" 
            title="UPS cutoff at risk" 
            msg="~40 orders may miss 15:30 cutoff based on current velocity" 
            time="+5.5hr" 
            conf={72}
            state={activePlans.length > 0 ? 'resolved' : 'active'}
            onClick={() => setActiveTab('insights')} 
          />
        </Accordion>
      </Card>
      
      {/* Analysis - Context-aware: Live, Live+Plan, or Scenario */}
      <Card>
        {(() => {
          // Determine context: live vs live+plan vs scenario
          const hasActivePlan = activePlans.length > 0;
          const isInScenario = scenarioMode;
          const context = isInScenario ? 'scenario' : hasActivePlan ? 'live-plan' : 'live';
          
          // Map alerts to active plan tasks for state determination
          const getAlertState = (alert) => {
            if (isInScenario) {
              if (alert.id === 'alert-1' || alert.id === 'alert-3') return { state: 'mitigated', task: null };
              if (alert.id === 'alert-4') return { state: 'new', task: null };
              return { state: 'persists', task: null };
            }
            
            if (hasActivePlan) {
              const activePlan = activePlans[0];
              
              if (alert.title.includes('UPS cutoff') || alert.title.includes('Picking') || alert.title.includes('picking')) {
                const task = activePlan.tasks?.find(t => t.status === 'done' && (t.title.includes('Reassign') || t.title.includes('FTE')));
                if (task) return { state: 'resolved', task: task.title };
              }
              
              if (alert.title.includes('capacity') || alert.title.includes('Zone Z')) {
                const task = activePlan.tasks?.find(t => t.status === 'in-progress' && (t.title.includes('Zone') || t.title.includes('overflow')));
                if (task) return { state: 'targeted', task: task.title };
              }
              
              if (alert.title.includes('Receiving') || alert.title.includes('inbound')) {
                return { state: 'tradeoff', task: 'Reassign 2 FTEs from Receiving' };
              }
              
              return { state: 'persists', task: null };
            }
            
            return { state: 'active', task: null };
          };
          
          const processedAlerts = alerts.map(a => ({ ...a, ...getAlertState(a) }));
          
          const sortedAlerts = [...processedAlerts].sort((a, b) => {
            const stateOrder = { targeted: 0, persists: 1, tradeoff: 2, active: 3, new: 4, resolved: 5, mitigated: 6 };
            const sevOrder = { critical: 0, warning: 1, info: 2 };
            const stateA = stateOrder[a.state] ?? 4;
            const stateB = stateOrder[b.state] ?? 4;
            if (stateA !== stateB) return stateA - stateB;
            return (sevOrder[a.sev] ?? 3) - (sevOrder[b.sev] ?? 3);
          });
          
          const resolvedCount = processedAlerts.filter(a => a.state === 'resolved' || a.state === 'mitigated').length;
          const targetedCount = processedAlerts.filter(a => a.state === 'targeted').length;
          const tradeoffCount = processedAlerts.filter(a => a.state === 'tradeoff' || a.state === 'new').length;
          const activeCount = processedAlerts.filter(a => !['resolved', 'mitigated'].includes(a.state)).length;
          const unmitigatedCount = processedAlerts.filter(a => ['active', 'persists'].includes(a.state)).length;
          const topAlerts = sortedAlerts.slice(0, 6);
          const remainingCount = alerts.length - 6;
          
          // Root causes summary
          const rootCauseIds = [...new Set(alerts.filter(a => a.rootCause).map(a => a.rootCause.id))];
          const rootCauseCount = rootCauseIds.length;
          
          return (
            <>
              <div style={{ marginBottom: sp.md }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                  <div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 4 }}>
                      <div style={{ width: 28, height: 28, borderRadius: 6, background: C.purple[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                        <Lightbulb style={{ width: 16, height: 16, color: C.purple[600] }} />
                      </div>
                      <h3 style={{ fontSize: '16px', fontWeight: 500, margin: 0 }}>Analysis</h3>
                      {(hasActivePlan || isInScenario) && (
                        <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                          <span style={{ fontSize: '11px', padding: '2px 6px', background: C.neutral[100], color: C.neutral[600], borderRadius: 10, textDecoration: 'line-through' }}>{alerts.length}</span>
                          <ArrowRight style={{ width: 10, height: 10, color: C.neutral[400] }} />
                          <span style={{ fontSize: '11px', padding: '2px 6px', background: activeCount > 0 ? C.warning[100] : C.success[100], color: activeCount > 0 ? C.warning[700] : C.success[700], borderRadius: 10, fontWeight: 600 }}>{activeCount} remaining</span>
                        </div>
                      )}
                    </div>
                    <p style={{ fontSize: '12px', color: C.neutral[500], margin: 0 }}>
                      {hasActivePlan 
                        ? `${rootCauseCount} root causes • ${resolvedCount} resolved, ${targetedCount} in progress${tradeoffCount > 0 ? `, ${tradeoffCount} tradeoffs` : ''}`
                        : isInScenario 
                          ? `Projected impact: ${resolvedCount} would be mitigated, ${unmitigatedCount} persist` 
                          : `${rootCauseCount} root causes identified • ${alerts.length} predicted issues without intervention`}
                    </p>
                  </div>
                  {!hasActivePlan && !isInScenario && <SeverityPills alerts={alerts} />}
                </div>
                
                {/* No Plan Warning Banner */}
                {!hasActivePlan && !isInScenario && (
                  <div style={{ 
                    display: 'flex', 
                    alignItems: 'center', 
                    gap: sp.sm, 
                    padding: sp.sm, 
                    background: C.warning[50], 
                    borderRadius: 6, 
                    marginTop: sp.md,
                    border: `1px solid ${C.warning[200]}`
                  }}>
                    <AlertTriangle style={{ width: 16, height: 16, color: C.warning[600] }} />
                    <span style={{ fontSize: '12px', color: C.warning[700], flex: 1 }}>
                      <strong>No active interventions</strong> — All {alerts.length} predicted issues will occur without action
                    </span>
                    <button 
                      onClick={() => setActiveTab('insights')}
                      style={{ 
                        padding: '4px 10px', 
                        fontSize: '11px', 
                        fontWeight: 500, 
                        background: C.warning[500], 
                        color: 'white', 
                        border: 'none', 
                        borderRadius: 4, 
                        cursor: 'pointer' 
                      }}
                    >
                      View Recommendations
                    </button>
                  </div>
                )}
              </div>
              
              <div style={{ display: 'flex', flexDirection: 'column', gap: 0, marginBottom: sp.md }}>
                {topAlerts.map((a, i) => (
                  (hasActivePlan || isInScenario) ? (
                    <ScenarioInlineAlert key={i} sev={a.sev} title={a.title} msg={a.msg} time={a.time} conf={a.conf} state={a.state} context={context} linkedTask={a.task} onClick={() => navigateToAlert(a.id, a.category, true)} />
                  ) : (
                    <Alert key={i} {...a} onClick={() => navigateToAlert(a.id, a.category, true)} />
                  )
                ))}
              </div>
              
              {remainingCount > 0 && (
                <div onClick={() => { setSelectedAlert(null); setInsightsSubTab('overall'); setActiveTab('insights'); setTimeout(() => window.scrollTo({ top: 0, behavior: 'smooth' }), 50); }} style={{ padding: `${sp.sm} ${sp.md}`, background: C.neutral[50], borderRadius: 6, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.xs, cursor: 'pointer', color: C.neutral[600], fontSize: '13px', fontWeight: 500, marginBottom: sp.md, border: `1px solid ${C.neutral[200]}` }} onMouseEnter={(e) => { e.currentTarget.style.background = C.neutral[100]; e.currentTarget.style.color = C.neutral[800]; }} onMouseLeave={(e) => { e.currentTarget.style.background = C.neutral[50]; e.currentTarget.style.color = C.neutral[600]; }}>
                  View all {alerts.length} alerts <ChevronRight style={{ width: 14, height: 14 }} />
                </div>
              )}
            </>
          );
        })()}
        
        {/* Insights Summary */}
        <div style={{ borderTop: `1px solid ${C.neutral[200]}`, paddingTop: sp.md }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <div style={{ width: 28, height: 28, borderRadius: 6, background: C.purple[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                <Lightbulb style={{ width: 16, height: 16, color: C.purple[600] }} />
              </div>
              <div>
                <h4 style={{ fontSize: '14px', fontWeight: 600, color: C.purple[700] }}>Insights</h4>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>{(() => {
                  const rootCauses = [...new Set(alerts.filter(a => a.rootCause).map(a => a.rootCause.id))];
                  return `${rootCauses.length} root causes identified from ${alerts.length} alerts`;
                })()}</p>
              </div>
            </div>
            <button
              onClick={() => { 
                setSelectedAlert(null); 
                setActiveTab('insights'); 
                setTimeout(() => window.scrollTo({ top: 0, behavior: 'smooth' }), 50);
              }}
              style={{
                padding: `${sp.sm} ${sp.md}`,
                fontSize: '13px',
                fontWeight: 500,
                color: C.purple[600],
                background: C.purple[50],
                border: `1px solid ${C.purple[200]}`,
                borderRadius: 6,
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: sp.xs
              }}
            >
              View Full Analysis
              <ChevronRight style={{ width: 14, height: 14 }} />
            </button>
          </div>
        </div>
      </Card>
          </>
        )}
        
        {/* Plans Tab Content */}
        {isAtFacilityLevel && activeTab === 'plans' && (
          <PlansTabContent 
            onViewInsights={() => setActiveTab('insights')}
            onNavigateToAlert={(alertId, category, showDetail) => navigateToAlert(alertId, category, showDetail)}
            allPlans={allPlans}
            setAllPlans={setAllPlans}
          />
        )}
        
        {/* Financial Tab Content */}
        {isAtFacilityLevel && activeTab === 'financial' && (
          <FinancialTabContent 
            onViewInsights={() => { setInsightsSubTab('financial'); setActiveTab('insights'); }}
            onNavigateToAlert={(alertId, category, showDetail) => navigateToAlert(alertId, category, showDetail)}
            onNavigateToCostCategory={(category) => {
              // Future: Navigate to cost category detail view
              console.log('Navigate to cost category:', category);
            }}
          />
        )}
        
        {/* Zones Tab Content */}
        {isAtFacilityLevel && activeTab === 'zones' && (
          <ZonesTabContent 
            onZone={onZone} 
            onViewInsights={() => { setInsightsSubTab('zones'); setActiveTab('insights'); }} 
            onNavigateToAlert={(alertId, category, showDetail) => navigateToAlert(alertId, category, showDetail)}
            onNavigateToZone={(zoneId, zoneName) => navigateTo('zone', zoneId, zoneName)}
          />
        )}
        
        {/* Staff Tab Content */}
        {isAtFacilityLevel && activeTab === 'staff' && (
          <StaffTabContent 
            onViewInsights={() => { setInsightsSubTab('staffing'); setActiveTab('insights'); }} 
            initialShiftFilter={staffShiftFilter}
            onNavigateToAlert={(alertId, category, showDetail) => navigateToAlert(alertId, category, showDetail)}
            onNavigateToStaff={(staffId, staffName) => navigateTo('staff', staffId, staffName)}
          />
        )}
        
        {/* Work Content Tab */}
        {isAtFacilityLevel && activeTab === 'work' && (
          <WorkTabContent 
            onNavigateToZones={(queueId, zones) => {
              // TODO: Wire up to Zones tab with filter state
              console.log('Navigate to zones:', queueId, zones);
              setActiveTab('zones');
            }} 
            onViewInsights={() => { setInsightsSubTab('work'); setActiveTab('insights'); }}
            onNavigateToAlert={(alertId, category, showDetail) => navigateToAlert(alertId, category, showDetail)}
          />
        )}
        
        {/* Schedule Tab Content */}
        {isAtFacilityLevel && activeTab === 'schedule' && (
          <ScheduleTabContent 
            onViewInsights={() => { setInsightsSubTab('schedules'); setActiveTab('insights'); }}
            onNavigateToStaff={(shiftId) => {
              setStaffShiftFilter(shiftId);
              setActiveTab('staff');
            }}
            onNavigateToWork={() => setActiveTab('work')}
            onNavigateToEquipment={() => setActiveTab('equipment')}
            onNavigateToAlert={(alertId, category, showDetail) => navigateToAlert(alertId, category, showDetail)}
          />
        )}
        
        {/* Equipment Tab Content */}
        {isAtFacilityLevel && activeTab === 'equipment' && (
          <EquipmentTabContent 
            onViewInsights={() => { setInsightsSubTab('equipment'); setActiveTab('insights'); }}
            onNavigateToAlert={(alertId, category, showDetail) => navigateToAlert(alertId, category, showDetail)}
            onSelectEquipment={(equipId, equipLabel) => navigateTo('equipment', equipId, equipLabel || equipId)}
          />
        )}
        
        {/* Insights Tab Content */}
        {isAtFacilityLevel && activeTab === 'insights' && (
          <div data-analysis-card>
            <Header icon={Lightbulb} title="Analysis" sub="AI-generated alerts, root cause analysis, and recommended actions" color={C.purple[500]} />
            
            {/* State-Aware Summary Panel */}
            {(() => {
              const hasActivePlan = activePlans.length > 0;
              const plan = activePlans[0];
              const tasksComplete = plan?.tasks?.filter(t => t.status === 'done').length || 0;
              const tasksTotal = plan?.tasks?.length || 0;
              
              return (
                <Card style={{ marginBottom: sp.md, background: hasActivePlan ? C.success[50] : C.neutral[50], border: `1px solid ${hasActivePlan ? C.success[200] : C.neutral[200]}` }}>
                  {hasActivePlan ? (
                    <>
                      {/* Active Plan Summary - with link to Plan */}
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.md }}>
                        <div style={{ flex: 1 }}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.xs }}>
                            <Zap style={{ width: 16, height: 16, color: C.success[600] }} />
                            <span style={{ fontSize: '14px', fontWeight: 500, color: C.success[700] }}>Active Plan: {plan.name}</span>
                            <span style={{ 
                              padding: '2px 6px', 
                              fontSize: '10px', 
                              fontWeight: 600, 
                              background: plan.priority === 'critical' ? C.error[100] : plan.priority === 'high' ? C.warning[100] : C.neutral[100], 
                              color: plan.priority === 'critical' ? C.error[700] : plan.priority === 'high' ? C.warning[700] : C.neutral[600], 
                              borderRadius: 4,
                              textTransform: 'uppercase'
                            }}>{plan.priority}</span>
                          </div>
                          <p style={{ fontSize: '12px', color: C.neutral[600], margin: 0 }}>
                            {tasksComplete}/{tasksTotal} tasks complete • Target: {plan.targetCompletion}
                          </p>
                        </div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                            <div style={{ width: 100, height: 6, background: C.success[100], borderRadius: 3, overflow: 'hidden' }}>
                              <div style={{ height: '100%', width: `${plan.progress}%`, background: C.success[500], borderRadius: 3 }} />
                            </div>
                            <span style={{ fontSize: '12px', fontWeight: 600, color: C.success[700] }}>{plan.progress}%</span>
                          </div>
                          <button
                            onClick={() => setActiveTab('plans')}
                            style={{
                              padding: '6px 12px',
                              fontSize: '11px',
                              fontWeight: 500,
                              color: C.success[700],
                              background: 'white',
                              border: `1px solid ${C.success[300]}`,
                              borderRadius: 4,
                              cursor: 'pointer',
                              display: 'flex',
                              alignItems: 'center',
                              gap: 4
                            }}
                          >
                            View Plan <ChevronRight style={{ width: 12, height: 12 }} />
                          </button>
                        </div>
                      </div>
                      
                      {/* Stacked: Root Causes */}
                      <div style={{ padding: sp.sm, background: 'white', borderRadius: 6, border: `1px solid ${C.neutral[200]}`, marginBottom: sp.sm }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.xs }}>
                          <p style={{ fontSize: '11px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', margin: 0 }}>Root Causes</p>
                          <span style={{ fontSize: '10px', color: C.neutral[400] }}>4 identified</span>
                        </div>
                        <div style={{ display: 'flex', gap: sp.sm, flexWrap: 'wrap' }}>
                          <span style={{ fontSize: '11px', fontWeight: 500, color: C.success[700], background: C.success[100], padding: '2px 8px', borderRadius: 4 }}>1 Resolved</span>
                          <span style={{ fontSize: '11px', fontWeight: 500, color: C.brand[700], background: C.brand[100], padding: '2px 8px', borderRadius: 4 }}>1 Targeted</span>
                          <span style={{ fontSize: '11px', fontWeight: 500, color: C.warning[700], background: C.warning[100], padding: '2px 8px', borderRadius: 4 }}>1 Tradeoff</span>
                          <span style={{ fontSize: '11px', fontWeight: 500, color: C.neutral[600], background: C.neutral[100], padding: '2px 8px', borderRadius: 4 }}>1 Persists</span>
                        </div>
                      </div>
                      
                      {/* Stacked: Alerts */}
                      <div style={{ padding: sp.sm, background: 'white', borderRadius: 6, border: `1px solid ${C.neutral[200]}`, marginBottom: sp.md }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.xs }}>
                          <p style={{ fontSize: '11px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', margin: 0 }}>Alerts</p>
                          <span style={{ fontSize: '10px', color: C.neutral[400] }}>{alerts.length} total</span>
                        </div>
                        <div style={{ display: 'flex', gap: sp.sm, flexWrap: 'wrap' }}>
                          <span style={{ fontSize: '11px', fontWeight: 500, color: C.success[700], background: C.success[100], padding: '2px 8px', borderRadius: 4 }}>2 Resolved</span>
                          <span style={{ fontSize: '11px', fontWeight: 500, color: C.brand[700], background: C.brand[100], padding: '2px 8px', borderRadius: 4 }}>1 Targeted</span>
                          <span style={{ fontSize: '11px', fontWeight: 500, color: C.warning[700], background: C.warning[100], padding: '2px 8px', borderRadius: 4 }}>1 Tradeoff</span>
                          <span style={{ fontSize: '11px', fontWeight: 500, color: C.neutral[600], background: C.neutral[100], padding: '2px 8px', borderRadius: 4 }}>2 Persist</span>
                        </div>
                      </div>
                      
                      {/* Emerging Tradeoffs Analysis - Grouped like Root Cause Analysis */}
                      <div style={{ marginBottom: sp.sm }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
                          <p style={{ fontSize: '11px', fontWeight: 600, color: C.warning[700], textTransform: 'uppercase', margin: 0, display: 'flex', alignItems: 'center', gap: sp.xs }}>
                            <AlertTriangle style={{ width: 12, height: 12 }} />
                            Emerging Tradeoffs Analysis
                          </p>
                          <span style={{ fontSize: '10px', color: C.neutral[400] }}>1 intervention • 3 issues</span>
                        </div>
                        
                        {/* Tradeoff Group Card - similar structure to Root Cause cards */}
                        <div style={{ 
                          background: 'white', 
                          border: `1px solid ${C.warning[200]}`,
                          borderLeft: `4px solid ${C.warning[500]}`,
                          borderRadius: '0 8px 8px 0',
                          overflow: 'hidden'
                        }}>
                          {/* Group Header */}
                          <div style={{ 
                            padding: sp.md, 
                            background: C.warning[50],
                            borderBottom: `1px solid ${C.warning[200]}`
                          }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                              <div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.xs }}>
                                  <span style={{ fontSize: '14px', fontWeight: 600, color: C.warning[800] }}>FTE Reallocation Impact</span>
                                  <span style={{ 
                                    fontSize: '10px', 
                                    fontWeight: 600, 
                                    padding: '2px 6px', 
                                    background: C.warning[100], 
                                    color: C.warning[700], 
                                    borderRadius: 3,
                                    textTransform: 'uppercase'
                                  }}>
                                    Tradeoff
                                  </span>
                                </div>
                                <p style={{ fontSize: '12px', color: C.neutral[600], margin: 0 }}>
                                  From: <span style={{ fontWeight: 500 }}>"Reassign 2 FTEs from Receiving to Picking"</span>
                                </p>
                              </div>
                              <div style={{ 
                                padding: '4px 8px', 
                                background: C.success[100], 
                                borderRadius: 4,
                                display: 'flex',
                                alignItems: 'center',
                                gap: 4
                              }}>
                                <div style={{ width: 6, height: 6, borderRadius: '50%', background: C.success[500] }} />
                                <span style={{ fontSize: '10px', fontWeight: 600, color: C.success[700] }}>Within tolerance</span>
                              </div>
                            </div>
                          </div>
                          
                          {/* Narrative Sections */}
                          <div style={{ padding: sp.md, borderBottom: `1px solid ${C.neutral[200]}` }}>
                            {/* What's Happening */}
                            <div style={{ marginBottom: sp.md }}>
                              <p style={{ fontSize: '11px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', marginBottom: sp.xs }}>
                                What's Happening
                              </p>
                              <p style={{ fontSize: '13px', color: C.neutral[700], margin: 0, lineHeight: 1.5 }}>
                                Moving 2 FTEs from Receiving to Picking resolved the UPS cutoff risk but reduced inbound processing capacity. This was an expected tradeoff when the plan was created.
                              </p>
                            </div>
                            
                            {/* Why It's Important */}
                            <div style={{ marginBottom: sp.md }}>
                              <p style={{ fontSize: '11px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', marginBottom: sp.xs }}>
                                Why It's Important
                              </p>
                              <p style={{ fontSize: '13px', color: C.neutral[700], margin: 0, lineHeight: 1.5 }}>
                                Receiving is currently running 30 min behind target. If the delay exceeds 45 min, dock congestion will cascade into afternoon shifts and impact outbound capacity.
                              </p>
                            </div>
                            
                            {/* Potential Outcome */}
                            <div style={{ 
                              padding: sp.sm, 
                              background: C.error[50], 
                              borderRadius: 6,
                              border: `1px solid ${C.error[200]}`
                            }}>
                              <p style={{ fontSize: '11px', fontWeight: 600, color: C.error[700], textTransform: 'uppercase', marginBottom: sp.xs }}>
                                Potential Outcome (if unaddressed)
                              </p>
                              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                                  <span style={{ fontSize: '12px', color: C.error[700] }}>•</span>
                                  <span style={{ fontSize: '13px', color: C.error[700] }}>2 trucks delayed → <strong>$400 detention fees</strong></span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                                  <span style={{ fontSize: '12px', color: C.error[700] }}>•</span>
                                  <span style={{ fontSize: '13px', color: C.error[700] }}>Putaway backlog spills into Shift 2</span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                                  <span style={{ fontSize: '12px', color: C.error[700] }}>•</span>
                                  <span style={{ fontSize: '13px', color: C.error[700] }}>Receiving SLA breach risk increases to 65%</span>
                                </div>
                              </div>
                            </div>
                          </div>
                          
                          {/* Contributing Issues - Alert card style */}
                          <div style={{ padding: sp.md }}>
                            <p style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', marginBottom: sp.sm }}>
                              Contributing Issues (3)
                            </p>
                            
                            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm, marginBottom: sp.md }}>
                              {/* Issue 1 - Warning severity */}
                              <div style={{ 
                                display: 'flex',
                                alignItems: 'flex-start',
                                gap: sp.sm,
                                padding: sp.sm,
                                background: C.warning[50], 
                                borderLeft: `3px solid ${C.warning[700]}`,
                                borderRadius: '0 6px 6px 0'
                              }}>
                                <AlertTriangle style={{ width: 14, height: 14, color: C.warning[700], flexShrink: 0, marginTop: 2 }} />
                                <div style={{ flex: 1, minWidth: 0 }}>
                                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: sp.sm }}>
                                    <span style={{ fontSize: '13px', fontWeight: 500, color: C.warning[700] }}>Receiving Throughput Degraded</span>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, flexShrink: 0 }}>
                                      <span style={{ fontSize: '11px', color: C.neutral[500] }}>+1.5hr</span>
                                    </div>
                                  </div>
                                  <p style={{ fontSize: '12px', color: C.neutral[600], margin: `${sp.xs} 0 0 0` }}>
                                    Inbound running 30 min behind target due to reduced staffing
                                  </p>
                                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginTop: sp.xs }}>
                                    <span style={{ fontSize: '11px', color: C.neutral[400] }}>Confidence: 78%</span>
                                    <span style={{ fontSize: '11px', color: C.neutral[400] }}>•</span>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                                      <span style={{ fontSize: '10px', color: C.neutral[500] }}>30/45 min</span>
                                      <div style={{ width: 40, height: 4, background: C.neutral[200], borderRadius: 2, overflow: 'hidden' }}>
                                        <div style={{ width: '66%', height: '100%', background: C.warning[400], borderRadius: 2 }} />
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              
                              {/* Issue 2 - Warning severity */}
                              <div style={{ 
                                display: 'flex',
                                alignItems: 'flex-start',
                                gap: sp.sm,
                                padding: sp.sm,
                                background: C.warning[50], 
                                borderLeft: `3px solid ${C.warning[700]}`,
                                borderRadius: '0 6px 6px 0'
                              }}>
                                <AlertTriangle style={{ width: 14, height: 14, color: C.warning[700], flexShrink: 0, marginTop: 2 }} />
                                <div style={{ flex: 1, minWidth: 0 }}>
                                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: sp.sm }}>
                                    <span style={{ fontSize: '13px', fontWeight: 500, color: C.warning[700] }}>Inbound Queue Building</span>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, flexShrink: 0 }}>
                                      <span style={{ fontSize: '11px', color: C.neutral[500] }}>+2hr</span>
                                    </div>
                                  </div>
                                  <p style={{ fontSize: '12px', color: C.neutral[600], margin: `${sp.xs} 0 0 0` }}>
                                    2 trucks waiting, dock turnaround slowing
                                  </p>
                                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginTop: sp.xs }}>
                                    <span style={{ fontSize: '11px', color: C.neutral[400] }}>Confidence: 82%</span>
                                    <span style={{ fontSize: '11px', color: C.neutral[400] }}>•</span>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                                      <span style={{ fontSize: '10px', color: C.neutral[500] }}>2/4 trucks</span>
                                      <div style={{ width: 40, height: 4, background: C.neutral[200], borderRadius: 2, overflow: 'hidden' }}>
                                        <div style={{ width: '50%', height: '100%', background: C.success[400], borderRadius: 2 }} />
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              
                              {/* Issue 3 - Info severity (lower concern) */}
                              <div style={{ 
                                display: 'flex',
                                alignItems: 'flex-start',
                                gap: sp.sm,
                                padding: sp.sm,
                                background: C.brand[50], 
                                borderLeft: `3px solid ${C.brand[600]}`,
                                borderRadius: '0 6px 6px 0'
                              }}>
                                <Info style={{ width: 14, height: 14, color: C.brand[600], flexShrink: 0, marginTop: 2 }} />
                                <div style={{ flex: 1, minWidth: 0 }}>
                                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: sp.sm }}>
                                    <span style={{ fontSize: '13px', fontWeight: 500, color: C.brand[600] }}>Putaway Backlog Growing</span>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, flexShrink: 0 }}>
                                      <span style={{ fontSize: '11px', color: C.neutral[500] }}>+1hr</span>
                                    </div>
                                  </div>
                                  <p style={{ fontSize: '12px', color: C.neutral[600], margin: `${sp.xs} 0 0 0` }}>
                                    Staged pallets waiting for storage assignment
                                  </p>
                                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginTop: sp.xs }}>
                                    <span style={{ fontSize: '11px', color: C.neutral[400] }}>Confidence: 65%</span>
                                    <span style={{ fontSize: '11px', color: C.neutral[400] }}>•</span>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                                      <span style={{ fontSize: '10px', color: C.neutral[500] }}>15/25 pallets</span>
                                      <div style={{ width: 40, height: 4, background: C.neutral[200], borderRadius: 2, overflow: 'hidden' }}>
                                        <div style={{ width: '60%', height: '100%', background: C.warning[400], borderRadius: 2 }} />
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            
                            {/* Suggested Resolution - Action Card style (matches Recommended Actions in Insights) */}
                            <p style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textTransform: 'uppercase', marginBottom: sp.sm }}>
                              Suggested Resolution
                            </p>
                            
                            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm, marginBottom: sp.md }}>
                              {/* Action 1 - Primary recommendation (green border = positive impact) */}
                              <div style={{ 
                                background: 'white', 
                                borderRadius: 6, 
                                border: `1px solid ${C.neutral[200]}`,
                                borderLeft: `4px solid ${C.success[500]}`,
                                padding: sp.md
                              }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                                  <span style={{ fontSize: '15px', fontWeight: 600, color: C.neutral[900] }}>Add 1 temp worker to Receiving</span>
                                  <span style={{ 
                                    fontSize: '12px', 
                                    fontWeight: 500, 
                                    color: C.neutral[600],
                                    background: C.neutral[100],
                                    padding: '4px 10px',
                                    borderRadius: 4
                                  }}>
                                    Shift Lead
                                  </span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: sp.lg, marginBottom: sp.xs }}>
                                  <span style={{ fontSize: '13px' }}>
                                    <span style={{ color: C.success[600] }}>Impact:</span>{' '}
                                    <span style={{ color: C.success[600] }}>Addresses all 3 issues</span>
                                  </span>
                                  <span style={{ fontSize: '13px' }}>
                                    <span style={{ color: C.warning[600] }}>Trade-off:</span>{' '}
                                    <span style={{ color: C.warning[600] }}>+$160 labor cost</span>
                                  </span>
                                </div>
                                <span style={{ fontSize: '12px', color: C.neutral[400] }}>Confidence: 85%</span>
                              </div>
                              
                              {/* Action 2 - Alternative (orange border = has significant tradeoff) */}
                              <div style={{ 
                                background: 'white', 
                                borderRadius: 6, 
                                border: `1px solid ${C.neutral[200]}`,
                                borderLeft: `4px solid ${C.warning[500]}`,
                                padding: sp.md
                              }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                                  <span style={{ fontSize: '15px', fontWeight: 600, color: C.neutral[900] }}>Pull 1 FTE back from Picking</span>
                                  <span style={{ 
                                    fontSize: '12px', 
                                    fontWeight: 500, 
                                    color: C.neutral[600],
                                    background: C.neutral[100],
                                    padding: '4px 10px',
                                    borderRadius: 4
                                  }}>
                                    Shift Lead
                                  </span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: sp.lg, marginBottom: sp.xs }}>
                                  <span style={{ fontSize: '13px' }}>
                                    <span style={{ color: C.success[600] }}>Impact:</span>{' '}
                                    <span style={{ color: C.success[600] }}>Immediate, no cost</span>
                                  </span>
                                  <span style={{ fontSize: '13px' }}>
                                    <span style={{ color: C.warning[600] }}>Trade-off:</span>{' '}
                                    <span style={{ color: C.warning[600] }}>Reduces picking gains ~12%</span>
                                  </span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                  <span style={{ fontSize: '12px', color: C.neutral[400] }}>Confidence: 78%</span>
                                  <span style={{ fontSize: '12px', color: C.warning[600], display: 'flex', alignItems: 'center', gap: 4 }}>
                                    <AlertTriangle style={{ width: 12, height: 12 }} />
                                    Conflicts with original plan goal
                                  </span>
                                </div>
                              </div>
                              
                              {/* Action 3 - Alternative (gray border = partial/minor) */}
                              <div style={{ 
                                background: 'white', 
                                borderRadius: 6, 
                                border: `1px solid ${C.neutral[200]}`,
                                borderLeft: `4px solid ${C.neutral[400]}`,
                                padding: sp.md
                              }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                                  <span style={{ fontSize: '15px', fontWeight: 600, color: C.neutral[900] }}>Delay low-priority putaway tasks</span>
                                  <span style={{ 
                                    fontSize: '12px', 
                                    fontWeight: 500, 
                                    color: C.neutral[600],
                                    background: C.neutral[100],
                                    padding: '4px 10px',
                                    borderRadius: 4
                                  }}>
                                    Ops Manager
                                  </span>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: sp.lg, marginBottom: sp.xs }}>
                                  <span style={{ fontSize: '13px' }}>
                                    <span style={{ color: C.success[600] }}>Impact:</span>{' '}
                                    <span style={{ color: C.success[600] }}>Frees receiving capacity</span>
                                  </span>
                                  <span style={{ fontSize: '13px' }}>
                                    <span style={{ color: C.warning[600] }}>Trade-off:</span>{' '}
                                    <span style={{ color: C.warning[600] }}>Only addresses 1 of 3 issues</span>
                                  </span>
                                </div>
                                <span style={{ fontSize: '12px', color: C.neutral[400] }}>Confidence: 91%</span>
                              </div>
                            </div>
                            
                            {/* Action Buttons */}
                            <div style={{ display: 'flex', gap: sp.sm }}>
                              <button style={{ 
                                flex: 1,
                                padding: `${sp.sm} ${sp.md}`, 
                                fontSize: '12px', 
                                fontWeight: 500, 
                                background: 'white', 
                                color: C.neutral[600], 
                                border: `1px solid ${C.neutral[300]}`, 
                                borderRadius: 6, 
                                cursor: 'pointer', 
                                display: 'flex', 
                                alignItems: 'center', 
                                justifyContent: 'center',
                                gap: sp.xs 
                              }}>
                                <Eye style={{ width: 14, height: 14 }} /> Monitor All
                              </button>
                              <button style={{ 
                                flex: 1,
                                padding: `${sp.sm} ${sp.md}`, 
                                fontSize: '12px', 
                                fontWeight: 500, 
                                background: C.success[500], 
                                color: 'white', 
                                border: 'none', 
                                borderRadius: 6, 
                                cursor: 'pointer', 
                                display: 'flex', 
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: sp.xs 
                              }}>
                                <Plus style={{ width: 14, height: 14 }} /> Add to Plan
                              </button>
                              <button style={{ 
                                flex: 1,
                                padding: `${sp.sm} ${sp.md}`, 
                                fontSize: '12px', 
                                fontWeight: 500, 
                                background: 'white', 
                                color: C.purple[600], 
                                border: `1px solid ${C.purple[300]}`, 
                                borderRadius: 6, 
                                cursor: 'pointer', 
                                display: 'flex', 
                                alignItems: 'center',
                                justifyContent: 'center',
                                gap: sp.xs 
                              }}>
                                <Zap style={{ width: 14, height: 14 }} /> Create Plan
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </>
                  ) : (
                    /* No Active Plan - Show summary of issues */
                    <div>
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.sm }}>
                        <div>
                          <p style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[700], marginBottom: sp.xs }}>No Active Plan</p>
                          <p style={{ fontSize: '12px', color: C.neutral[500], margin: 0 }}>
                            2 root causes identified driving {alerts.length} alerts across categories
                          </p>
                        </div>
                        <button
                          onClick={() => setActiveTab('plans')}
                          style={{
                            padding: `${sp.xs} ${sp.sm}`,
                            fontSize: '11px',
                            fontWeight: 500,
                            color: 'white',
                            background: C.purple[500],
                            border: 'none',
                            borderRadius: 4,
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            gap: 4
                          }}
                        >
                          <Zap style={{ width: 12, height: 12 }} />
                          Create Plan
                        </button>
                      </div>
                      <div style={{ display: 'flex', gap: sp.sm }}>
                        <span style={{ fontSize: '11px', fontWeight: 500, color: C.error[700], background: C.error[50], padding: '2px 8px', borderRadius: 4 }}>
                          {[...new Set(alerts.filter(a => a.rootCause).map(a => a.rootCause.id))].length} Root Causes
                        </span>
                        <span style={{ fontSize: '11px', fontWeight: 500, color: C.warning[700], background: C.warning[50], padding: '2px 8px', borderRadius: 4 }}>
                          {alerts.filter(a => a.sev === 'critical').length} Critical
                        </span>
                        <span style={{ fontSize: '11px', fontWeight: 500, color: C.neutral[600], background: C.neutral[100], padding: '2px 8px', borderRadius: 4 }}>
                          {alerts.filter(a => a.sev === 'warning').length} Warning
                        </span>
                      </div>
                    </div>
                  )}
                </Card>
              );
            })()}
            
            {/* Category Sub-tabs */}
            <div style={{ 
              display: 'flex', 
              gap: 0, 
              marginBottom: sp.md,
              borderBottom: `1px solid ${C.neutral[200]}`
            }}>
              {[
                { id: 'overall', label: 'Overall', count: alerts.length },
                { id: 'staffing', label: 'Staffing', count: alerts.filter(a => a.rootCause?.name?.toLowerCase().includes('staff') || a.title?.toLowerCase().includes('staff') || a.title?.toLowerCase().includes('fte') || a.title?.toLowerCase().includes('break') || a.title?.toLowerCase().includes('swing')).length },
                { id: 'work', label: 'Work Content', count: alerts.filter(a => a.title?.toLowerCase().includes('ups') || a.title?.toLowerCase().includes('fedex') || a.title?.toLowerCase().includes('queue') || a.title?.toLowerCase().includes('velocity')).length },
                { id: 'zones', label: 'Zones', count: alerts.filter(a => a.title?.toLowerCase().includes('zone') || a.title?.toLowerCase().includes('capacity') || a.title?.toLowerCase().includes('z0')).length },
                { id: 'equipment', label: 'Equipment', count: alerts.filter(a => a.category === 'equipment' || a.title?.toLowerCase().includes('pm') || a.title?.toLowerCase().includes('fl-') || a.title?.toLowerCase().includes('epj-') || a.title?.toLowerCase().includes('battery')).length },
                { id: 'schedules', label: 'Schedules', count: alerts.filter(a => a.title?.toLowerCase().includes('shift') || a.title?.toLowerCase().includes('cutoff') || a.title?.toLowerCase().includes('handoff')).length }
              ].map((tab) => (
                <div
                  key={tab.id}
                  onClick={() => { setInsightsSubTab(tab.id); setSelectedAlert(null); }}
                  style={{
                    padding: `${sp.sm} ${sp.md}`,
                    fontSize: '13px',
                    fontWeight: 500,
                    color: insightsSubTab === tab.id ? C.neutral[900] : C.neutral[500],
                    borderBottom: insightsSubTab === tab.id ? `2px solid ${C.neutral[900]}` : '2px solid transparent',
                    marginBottom: '-1px',
                    cursor: 'pointer',
                    transition: 'all 0.15s',
                    display: 'flex',
                    alignItems: 'center',
                    gap: sp.xs
                  }}
                  onMouseEnter={(e) => { if (insightsSubTab !== tab.id) e.currentTarget.style.color = C.neutral[700]; }}
                  onMouseLeave={(e) => { if (insightsSubTab !== tab.id) e.currentTarget.style.color = C.neutral[500]; }}
                >
                  {tab.label}
                  {tab.count > 0 && (
                    <span style={{
                      fontSize: '10px',
                      fontWeight: 600,
                      padding: '2px 6px',
                      borderRadius: 10,
                      background: insightsSubTab === tab.id ? C.neutral[900] : C.neutral[200],
                      color: insightsSubTab === tab.id ? 'white' : C.neutral[600]
                    }}>
                      {tab.count}
                    </span>
                  )}
                </div>
              ))}
            </div>
            
            {/* Alert Detail View - shown when an alert is selected */}
            {selectedAlert ? (
              <Card>
                {/* Back navigation */}
                <div 
                  onClick={() => setSelectedAlert(null)}
                  style={{ 
                    display: 'flex', 
                    alignItems: 'center', 
                    gap: sp.xs, 
                    cursor: 'pointer', 
                    marginBottom: sp.lg,
                    color: C.brand[600],
                    fontSize: '13px',
                    fontWeight: 500
                  }}
                >
                  <ChevronLeft style={{ width: 16, height: 16 }} />
                  Back to {insightsSubTab === 'overall' ? 'All Alerts' : `${({ staffing: 'Staffing', work: 'Work Content', zones: 'Zones', equipment: 'Equipment', schedules: 'Schedules' })[insightsSubTab]} Alerts`}
                </div>
                
                {/* Alert Header */}
                {(() => {
                  const cfg = { 
                    critical: [C.error[50], C.error[100], C.error[700], AlertOctagon], 
                    warning: [C.warning[50], C.warning[100], C.warning[700], AlertTriangle], 
                    info: [C.brand[100], C.brand[100], C.brand[600], Info] 
                  };
                  const [bg, bdr, txt, Icon] = cfg[selectedAlert.sev] || cfg.info;
                  return (
                    <div style={{ 
                      background: bg, 
                      borderTop: `1px solid ${bdr}`,
                      borderRight: `1px solid ${bdr}`,
                      borderBottom: `1px solid ${bdr}`,
                      borderLeft: `4px solid ${txt}`,
                      borderRadius: '0 6px 6px 0', 
                      padding: `${sp.sm} ${sp.md}`,
                      marginBottom: sp.md 
                    }}>
                      <div style={{ display: 'flex', gap: sp.sm, alignItems: 'flex-start' }}>
                        <Icon style={{ width: 14, height: 14, color: txt, flexShrink: 0, marginTop: 2 }} />
                        <div style={{ flex: 1, minWidth: 0 }}>
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                            <span style={{ fontSize: '13px', fontWeight: 500, color: txt }}>{selectedAlert.title}</span>
                            <span style={{ fontSize: '11px', color: txt, opacity: 0.8, marginLeft: sp.sm, flexShrink: 0 }}>{selectedAlert.sev} • {selectedAlert.time} • {selectedAlert.conf}% conf</span>
                          </div>
                          <p style={{ fontSize: '11px', color: txt, marginTop: '2px', opacity: 0.9 }}>{selectedAlert.msg}</p>
                        </div>
                      </div>
                    </div>
                  );
                })()}
                
                {/* Root Cause Context Link */}
                <div 
                  style={{ 
                    display: 'flex', 
                    alignItems: 'center', 
                    justifyContent: 'space-between',
                    padding: sp.sm, 
                    background: C.purple[50], 
                    borderRadius: 6, 
                    marginBottom: sp.md,
                    border: `1px solid ${C.purple[200]}`,
                    cursor: 'pointer'
                  }}
                  onClick={() => setSelectedAlert(null)}
                >
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <Lightbulb style={{ width: 16, height: 16, color: C.purple[600] }} />
                    <span style={{ fontSize: '13px', color: C.purple[700] }}>
                      Part of: <strong>{selectedAlert.rootCause?.name || 'Unknown Root Cause'}</strong>
                    </span>
                    <Badge status={selectedAlert.rootCause?.alertCount > 2 ? 'error' : 'warning'} label={`${selectedAlert.rootCause?.alertCount || 1} alert${selectedAlert.rootCause?.alertCount > 1 ? 's' : ''} share this root cause`} />
                  </div>
                  <ChevronRight style={{ width: 16, height: 16, color: C.purple[500] }} />
                </div>
                
                {/* What's Happening */}
                <Accordion title="What's Happening" defaultOpen={true}>
                  <p style={{ fontSize: '13px', color: C.neutral[700], lineHeight: 1.6 }}>
                    {selectedAlert.whatsHappening || 'Details not available.'}
                  </p>
                  <AlertVisualization alertId={selectedAlert.id} type="whatsHappening" />
                </Accordion>
                
                {/* Why It Matters */}
                <Accordion title="Why It Matters" defaultOpen={true}>
                  <p style={{ fontSize: '13px', color: C.neutral[700], lineHeight: 1.6 }}>
                    {selectedAlert.whyItMatters || 'Impact details not available.'}
                  </p>
                  <AlertVisualization alertId={selectedAlert.id} type="whyItMatters" />
                </Accordion>
                
                {/* Recommended Actions */}
                <Accordion title={`Recommended Actions (${selectedAlert.actions?.length || 0})`} defaultOpen={true}>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                    {(selectedAlert.actions || []).map((item, i) => (
                      <div key={i} style={{ 
                        padding: sp.sm, 
                        background: 'white', 
                        borderRadius: 6, 
                        border: `1px solid ${item.conflict ? C.warning[300] : C.neutral[200]}`,
                        borderLeft: `3px solid ${item.conflict ? C.warning[500] : C.success[500]}`
                      }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                          <span style={{ fontSize: '13px', fontWeight: 500 }}>{item.action}</span>
                          <span style={{ fontSize: '10px', color: C.neutral[500], background: C.neutral[100], padding: '2px 6px', borderRadius: 4 }}>{item.owner}</span>
                        </div>
                        <div style={{ display: 'flex', gap: sp.md, fontSize: '11px', marginBottom: sp.xs }}>
                          <span style={{ color: C.success[600] }}>Impact: {item.impact}</span>
                          <span style={{ color: C.warning[600] }}>Trade-off: {item.tradeoff}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                          <span style={{ fontSize: '10px', color: C.neutral[500] }}>Confidence: {item.confidence}%</span>
                          {item.conflict && (
                            <span style={{ fontSize: '10px', color: C.warning[600], display: 'flex', alignItems: 'center', gap: 4 }}>
                              <AlertTriangle style={{ width: 12, height: 12 }} /> Conflicts with another root cause
                            </span>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </Accordion>
                
                {/* Trade-offs */}
                <Accordion title="Trade-offs" defaultOpen={true}>
                  <div style={{ background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.neutral[200]}` }}>
                    <p style={{ fontSize: '13px', color: C.neutral[700], lineHeight: 1.6, marginBottom: sp.sm }}>
                      <strong>If recommended actions are applied:</strong>
                    </p>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs, marginBottom: sp.md }}>
                      {(selectedAlert.actions || []).map((item, i) => (
                        <div key={i} style={{ display: 'flex', alignItems: 'flex-start', gap: sp.sm }}>
                          <ArrowDownRight style={{ width: 14, height: 14, color: C.warning[500], flexShrink: 0, marginTop: 2 }} />
                          <span style={{ fontSize: '12px', color: C.neutral[600] }}>{item.tradeoff}</span>
                        </div>
                      ))}
                    </div>
                    
                    {/* Root Cause Scope Warning */}
                    {selectedAlert.rootCause?.alertCount > 1 && (
                      <div style={{ background: C.purple[50], borderRadius: 6, padding: sp.sm, border: `1px solid ${C.purple[200]}` }}>
                        <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.sm }}>
                          <Lightbulb style={{ width: 14, height: 14, color: C.purple[600], flexShrink: 0, marginTop: 2 }} />
                          <div>
                            <p style={{ fontSize: '12px', color: C.purple[700], lineHeight: 1.5 }}>
                              This alert shares a root cause with <strong>{selectedAlert.rootCause.alertCount - 1} other alert{selectedAlert.rootCause.alertCount > 2 ? 's' : ''}</strong>. 
                              Fixing this alert individually may leave related issues unresolved.
                            </p>
                            <button 
                              onClick={() => setSelectedAlert(null)}
                              style={{ 
                                marginTop: sp.xs, 
                                fontSize: '12px', 
                                fontWeight: 500, 
                                color: C.purple[600], 
                                background: 'none', 
                                border: 'none', 
                                padding: 0, 
                                cursor: 'pointer',
                                display: 'flex',
                                alignItems: 'center',
                                gap: 4
                              }}
                            >
                              View Root Cause: {selectedAlert.rootCause.name} <ChevronRight style={{ width: 14, height: 14 }} />
                            </button>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                </Accordion>
                
                {/* Action Buttons */}
                <div style={{ display: 'flex', gap: sp.sm, marginTop: sp.lg, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}` }}>
                  <button style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, color: 'white', background: C.purple[600], border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <Zap style={{ width: 14, height: 14 }} /> Explore in Scenario Mode
                  </button>
                  <button style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, color: C.brand[600], background: C.brand[50], border: `1px solid ${C.brand[200]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <Users style={{ width: 14, height: 14 }} /> Delegate to Shift Lead
                  </button>
                  <button style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, color: C.success[600], background: C.success[50], border: `1px solid ${C.success[200]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <CheckCircle style={{ width: 14, height: 14 }} /> Apply Now & Notify Staff
                  </button>
                </div>
              </Card>
            ) : (
            <>
            {/* All Alerts */}
            {(() => {
              // Filter alerts based on selected sub-tab
              const filterAlert = (a) => {
                if (insightsSubTab === 'overall') return true;
                if (insightsSubTab === 'staffing') {
                  return a.rootCause?.name?.toLowerCase().includes('staff') || 
                         a.title?.toLowerCase().includes('staff') || 
                         a.title?.toLowerCase().includes('fte') || 
                         a.title?.toLowerCase().includes('break') ||
                         a.title?.toLowerCase().includes('understaffed') ||
                         a.title?.toLowerCase().includes('swing');
                }
                if (insightsSubTab === 'work') {
                  return a.title?.toLowerCase().includes('ups') || 
                         a.title?.toLowerCase().includes('fedex') || 
                         a.title?.toLowerCase().includes('queue') ||
                         a.title?.toLowerCase().includes('velocity') ||
                         a.title?.toLowerCase().includes('carryover');
                }
                if (insightsSubTab === 'zones') {
                  return a.title?.toLowerCase().includes('zone') || 
                         a.title?.toLowerCase().includes('capacity') || 
                         a.title?.toLowerCase().includes('z0');
                }
                if (insightsSubTab === 'equipment') {
                  return a.category === 'equipment' ||
                         a.title?.toLowerCase().includes('pm ') || 
                         a.title?.toLowerCase().includes('fl-') ||
                         a.title?.toLowerCase().includes('epj-') ||
                         a.title?.toLowerCase().includes('rt-') ||
                         a.title?.toLowerCase().includes('tt-') ||
                         a.title?.toLowerCase().includes('battery') ||
                         a.title?.toLowerCase().includes('offline') ||
                         a.title?.toLowerCase().includes('repair');
                }
                if (insightsSubTab === 'schedules') {
                  return a.title?.toLowerCase().includes('shift') || 
                         a.title?.toLowerCase().includes('cutoff') ||
                         a.title?.toLowerCase().includes('handoff') ||
                         a.title?.toLowerCase().includes('break');
                }
                return true;
              };
              
              const filteredAlerts = alerts.filter(filterAlert);
              const subTabLabels = { overall: 'All', staffing: 'Staffing', work: 'Work Content', zones: 'Zones', equipment: 'Equipment', schedules: 'Schedules' };
              
              return (
                <Card>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
                    <h3 style={{ fontSize: '16px', fontWeight: 500 }}>
                      {insightsSubTab === 'overall' ? 'All Alerts' : `${subTabLabels[insightsSubTab]} Alerts`}
                    </h3>
                    <SeverityPills alerts={filteredAlerts} />
                  </div>
                  {filteredAlerts.length > 0 ? (
                    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                      {filteredAlerts.map((a, i) => (
                        <Alert 
                          key={i} 
                          {...a} 
                          id={`insight-${a.id}`}
                          isHighlighted={highlightedAlert === a.id}
                          onClick={() => setSelectedAlert(a)} 
                        />
                      ))}
                    </div>
                  ) : (
                    <div style={{ padding: sp.lg, textAlign: 'center', color: C.neutral[500] }}>
                      <p style={{ fontSize: '13px' }}>No {subTabLabels[insightsSubTab].toLowerCase()} alerts at this time</p>
                    </div>
                  )}
                </Card>
              );
            })()}
            
            {/* Root Causes Section */}
            <Card id="root-cause-analysis">
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.lg }}>
                <div style={{ width: 32, height: 32, borderRadius: 8, background: C.purple[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  <Lightbulb style={{ width: 18, height: 18, color: C.purple[600] }} />
                </div>
                <div>
                  <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Root Cause Analysis</h3>
                  <p style={{ fontSize: '12px', color: C.neutral[500] }}>2 root causes identified from 4 alerts</p>
                </div>
              </div>
              
              {/* Root Cause 1: Staffing-Capacity Mismatch */}
              <div style={{ background: C.neutral[50], borderRadius: 8, padding: sp.md, marginBottom: sp.md, border: `1px solid ${C.neutral[200]}` }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.sm }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <div style={{ width: 10, height: 10, borderRadius: '50%', background: C.error[500] }} />
                    <span style={{ fontSize: '16px', fontWeight: 600 }}>Staffing-Capacity Mismatch</span>
                  </div>
                  <Badge status="error" label="Affects 3 alerts" />
                </div>
                
                <Accordion title="What's Happening" defaultOpen={true}>
                  <p style={{ fontSize: '13px', color: C.neutral[700], lineHeight: 1.6 }}>
                    Insufficient staffing in high-velocity zones (Z03 Picking, Z04 Storage) is creating capacity pressure. 
                    Z04 is at 83% and projected to hit 91% by 12:00. Meanwhile, picking velocity has dropped to 520/hr 
                    (target: 600/hr) due to 4 FTE gap in Day Shift.
                  </p>
                  <AlertVisualization alertId="alert-1" type="whatsHappening" />
                </Accordion>
                
                <Accordion title="Why It Matters" defaultOpen={true}>
                  <p style={{ fontSize: '13px', color: C.neutral[700], lineHeight: 1.6 }}>
                    If unaddressed, this cascade will cause ~40 UPS orders to miss the 15:30 cutoff, resulting in 
                    <strong> $4,800 in SLA penalties</strong> and <strong>customer impact to 12 accounts</strong>. 
                    Z04 capacity breach will also block inbound receiving, creating upstream delays.
                  </p>
                  <AlertVisualization alertId="alert-2" type="whyItMatters" />
                </Accordion>
                
                <Accordion title="Recommended Actions (3)" defaultOpen={true}>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                    {[
                      { action: 'Reassign 2 FTEs from Z02 Putaway → Z03 Picking', impact: '+18% pick velocity', tradeoff: 'Z02 putaway slows ~12%', confidence: 89, owner: 'Shift Lead' },
                      { action: 'Authorize 4 hrs OT for Pack team (2 FTEs)', impact: '+200 orders/hr capacity', tradeoff: '+$180 labor cost', confidence: 94, conflict: true, owner: 'Ops Manager' },
                      { action: 'Prioritize UPS orders in pick queue', impact: 'UPS on-time ↑15%', tradeoff: 'FedEx orders may slip 8%', confidence: 78, owner: 'System' }
                    ].map((item, i) => (
                      <div key={i} style={{ padding: sp.sm, background: 'white', borderRadius: 6, border: `1px solid ${item.conflict ? C.warning[300] : C.neutral[200]}`, borderLeft: `3px solid ${item.conflict ? C.warning[500] : C.success[500]}` }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                          <span style={{ fontSize: '13px', fontWeight: 500 }}>{item.action}</span>
                          <span style={{ fontSize: '10px', color: C.neutral[500], background: C.neutral[100], padding: '2px 6px', borderRadius: 4 }}>{item.owner}</span>
                        </div>
                        <div style={{ display: 'flex', gap: sp.md, fontSize: '11px', marginBottom: sp.xs }}>
                          <span style={{ color: C.success[600] }}>Impact: {item.impact}</span>
                          <span style={{ color: C.warning[600] }}>Trade-off: {item.tradeoff}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                          <span style={{ fontSize: '10px', color: C.neutral[500] }}>Confidence: {item.confidence}%</span>
                          {item.conflict && (
                            <span style={{ fontSize: '10px', color: C.warning[600], display: 'flex', alignItems: 'center', gap: 4 }}>
                              <AlertTriangle style={{ width: 12, height: 12 }} /> Conflicts with Root Cause 2
                            </span>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </Accordion>
                
                <Accordion title="Trade-offs Summary" defaultOpen={false}>
                  <div style={{ background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.neutral[200]}` }}>
                    <p style={{ fontSize: '13px', color: C.neutral[700], lineHeight: 1.6, marginBottom: sp.sm }}>
                      <strong>If all actions are applied:</strong>
                    </p>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                        <ArrowUpRight style={{ width: 14, height: 14, color: C.success[500] }} />
                        <span style={{ fontSize: '12px', color: C.neutral[600] }}>Pick velocity increases ~18%, UPS on-time improves 15%</span>
                      </div>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                        <ArrowDownRight style={{ width: 14, height: 14, color: C.warning[500] }} />
                        <span style={{ fontSize: '12px', color: C.neutral[600] }}>Z02 putaway slows 12%, FedEx orders may slip 8%</span>
                      </div>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                        <DollarSign style={{ width: 14, height: 14, color: C.warning[500] }} />
                        <span style={{ fontSize: '12px', color: C.neutral[600] }}>+$180 labor cost from OT authorization</span>
                      </div>
                    </div>
                    <p style={{ fontSize: '11px', color: C.neutral[500], marginTop: sp.sm, fontStyle: 'italic' }}>
                      Net impact: Protects $4,800 in SLA penalties at cost of $180 + temporary slowdowns
                    </p>
                  </div>
                </Accordion>
                
                {/* Root Cause 1 Action Buttons */}
                <div style={{ display: 'flex', gap: sp.sm, marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}` }}>
                  <button style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '12px', fontWeight: 500, color: 'white', background: C.purple[600], border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <Zap style={{ width: 14, height: 14 }} /> Explore in Scenario
                  </button>
                  <button style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '12px', fontWeight: 500, color: C.brand[600], background: C.brand[50], border: `1px solid ${C.brand[200]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <Users style={{ width: 14, height: 14 }} /> Delegate
                  </button>
                  <button style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '12px', fontWeight: 500, color: C.success[600], background: C.success[50], border: `1px solid ${C.success[200]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <CheckCircle style={{ width: 14, height: 14 }} /> Apply Now & Notify
                  </button>
                </div>
              </div>
              
              {/* Root Cause 2: Labor Cost Overrun */}
              <div style={{ background: C.neutral[50], borderRadius: 8, padding: sp.md, marginBottom: sp.md, border: `1px solid ${C.neutral[200]}` }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.sm }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <div style={{ width: 10, height: 10, borderRadius: '50%', background: C.warning[500] }} />
                    <span style={{ fontSize: '16px', fontWeight: 600 }}>Labor Cost Overrun</span>
                  </div>
                  <Badge status="warning" label="Affects 1 alert" />
                </div>
                
                <Accordion title="What's Happening" defaultOpen={true}>
                  <p style={{ fontSize: '13px', color: C.neutral[700], lineHeight: 1.6 }}>
                    Current labor spend is tracking 5.6% over budget ($6,420 actual vs $6,080 planned at this hour). 
                    OT hours are at 24 (target: 18 by this point) and temp labor is at 4 FTEs. 
                    Projected EOD spend is $13,100 vs $12,400 budget.
                  </p>
                  <AlertVisualization alertId="alert-4" type="whatsHappening" />
                </Accordion>
                
                <Accordion title="Why It Matters" defaultOpen={true}>
                  <p style={{ fontSize: '13px', color: C.neutral[700], lineHeight: 1.6 }}>
                    Continued trajectory will result in <strong>$700 budget overrun</strong> for the day. 
                    If pattern continues through week, monthly impact could reach <strong>$15,000+</strong>. 
                    Finance has flagged labor efficiency as a Q4 focus area.
                  </p>
                  <AlertVisualization alertId="alert-4" type="whyItMatters" />
                </Accordion>
                
                <Accordion title="Recommended Actions (2)" defaultOpen={true}>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                    {[
                      { action: 'Reduce temp labor by 1 FTE after 12:00', impact: '-$95 labor cost', tradeoff: 'Slightly slower pack rate', confidence: 82, owner: 'Shift Lead' },
                      { action: 'Cap OT at 40 hrs total for shift', impact: 'Stay within budget', tradeoff: 'May need to deprioritize non-critical work', confidence: 91, conflict: true, owner: 'Ops Manager' }
                    ].map((item, i) => (
                      <div key={i} style={{ padding: sp.sm, background: 'white', borderRadius: 6, border: `1px solid ${item.conflict ? C.warning[300] : C.neutral[200]}`, borderLeft: `3px solid ${item.conflict ? C.warning[500] : C.success[500]}` }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                          <span style={{ fontSize: '13px', fontWeight: 500 }}>{item.action}</span>
                          <span style={{ fontSize: '10px', color: C.neutral[500], background: C.neutral[100], padding: '2px 6px', borderRadius: 4 }}>{item.owner}</span>
                        </div>
                        <div style={{ display: 'flex', gap: sp.md, fontSize: '11px', marginBottom: sp.xs }}>
                          <span style={{ color: C.success[600] }}>Impact: {item.impact}</span>
                          <span style={{ color: C.warning[600] }}>Trade-off: {item.tradeoff}</span>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                          <span style={{ fontSize: '10px', color: C.neutral[500] }}>Confidence: {item.confidence}%</span>
                          {item.conflict && (
                            <span style={{ fontSize: '10px', color: C.warning[600], display: 'flex', alignItems: 'center', gap: 4 }}>
                              <AlertTriangle style={{ width: 12, height: 12 }} /> Conflicts with Root Cause 1
                            </span>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </Accordion>
                
                <Accordion title="Trade-offs Summary" defaultOpen={false}>
                  <div style={{ background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.neutral[200]}` }}>
                    <p style={{ fontSize: '13px', color: C.neutral[700], lineHeight: 1.6, marginBottom: sp.sm }}>
                      <strong>If all actions are applied:</strong>
                    </p>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                        <ArrowUpRight style={{ width: 14, height: 14, color: C.success[500] }} />
                        <span style={{ fontSize: '12px', color: C.neutral[600] }}>Labor cost reduced by ~$95, stays within budget ceiling</span>
                      </div>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                        <ArrowDownRight style={{ width: 14, height: 14, color: C.warning[500] }} />
                        <span style={{ fontSize: '12px', color: C.neutral[600] }}>Pack rate may slow, some non-critical work deprioritized</span>
                      </div>
                    </div>
                    <p style={{ fontSize: '11px', color: C.neutral[500], marginTop: sp.sm, fontStyle: 'italic' }}>
                      Net impact: Maintains budget compliance but may impact throughput capacity
                    </p>
                  </div>
                </Accordion>
                
                {/* Root Cause 2 Action Buttons */}
                <div style={{ display: 'flex', gap: sp.sm, marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}` }}>
                  <button style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '12px', fontWeight: 500, color: 'white', background: C.purple[600], border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <Zap style={{ width: 14, height: 14 }} /> Explore in Scenario
                  </button>
                  <button style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '12px', fontWeight: 500, color: C.brand[600], background: C.brand[50], border: `1px solid ${C.brand[200]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <Users style={{ width: 14, height: 14 }} /> Delegate
                  </button>
                  <button style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '12px', fontWeight: 500, color: C.success[600], background: C.success[50], border: `1px solid ${C.success[200]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <CheckCircle style={{ width: 14, height: 14 }} /> Apply Now & Notify
                  </button>
                </div>
              </div>
              
              {/* Conflict Warning */}
              <div style={{ background: C.warning[50], border: `1px solid ${C.warning[200]}`, borderRadius: 8, padding: sp.md, marginBottom: sp.md, display: 'flex', alignItems: 'flex-start', gap: sp.sm }}>
                <AlertTriangle style={{ width: 20, height: 20, color: C.warning[600], flexShrink: 0, marginTop: 2 }} />
                <div>
                  <p style={{ fontSize: '14px', fontWeight: 600, color: C.warning[700], marginBottom: sp.xs }}>Conflict Detected Between Root Causes</p>
                  <p style={{ fontSize: '13px', color: C.warning[700], lineHeight: 1.5 }}>
                    "Authorize 4 hrs OT" (Root Cause 1) directly worsens "Labor Cost Overrun" (Root Cause 2). 
                    Consider prioritizing FTE reassignment before authorizing overtime, or accept the cost trade-off to protect SLAs.
                  </p>
                </div>
              </div>
              
              {/* Bulk Actions - Apply All */}
              <div style={{ background: C.purple[50], border: `1px solid ${C.purple[200]}`, borderRadius: 8, padding: sp.md }}>
                <div style={{ marginBottom: sp.sm }}>
                  <p style={{ fontSize: '14px', fontWeight: 600, color: C.purple[700] }}>Bulk Actions</p>
                  <p style={{ fontSize: '12px', color: C.purple[600] }}>Apply all recommended solutions across both root causes (accepts all trade-offs and conflicts)</p>
                </div>
                <div style={{ display: 'flex', gap: sp.sm }}>
                  <button style={{ padding: `${sp.sm} ${sp.lg}`, fontSize: '13px', fontWeight: 500, color: 'white', background: C.purple[600], border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <Zap style={{ width: 16, height: 16 }} /> Explore All in Scenario Mode
                  </button>
                  <button style={{ padding: `${sp.sm} ${sp.lg}`, fontSize: '13px', fontWeight: 500, color: C.brand[600], background: 'white', border: `1px solid ${C.brand[300]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <Users style={{ width: 16, height: 16 }} /> Delegate All to Shift Lead
                  </button>
                  <button style={{ padding: `${sp.sm} ${sp.lg}`, fontSize: '13px', fontWeight: 500, color: C.success[700], background: C.success[100], border: `1px solid ${C.success[300]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <CheckCircle style={{ width: 16, height: 16 }} /> Apply All Now & Notify Staff
                  </button>
                </div>
              </div>
            </Card>
            </>
            )}
          </div>
        )}
        
        {/* Placeholder for other facility-level tabs */}
        {isAtFacilityLevel && !['dashboard', 'zones', 'staff', 'work', 'schedule', 'equipment', 'insights'].includes(activeTab) && (
          <div style={{ padding: sp.xl, textAlign: 'center' }}>
            <div style={{ width: 48, height: 48, borderRadius: 12, background: C.neutral[100], display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto', marginBottom: sp.md }}>
              {React.createElement(facilityTabs.find(t => t.id === activeTab)?.icon || LayoutDashboard, { style: { width: 24, height: 24, color: C.neutral[400] } })}
            </div>
            <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[600], marginBottom: sp.sm }}>{facilityTabs.find(t => t.id === activeTab)?.label} Overview</h3>
            <p style={{ fontSize: '13px', color: C.neutral[400] }}>Facility-level {facilityTabs.find(t => t.id === activeTab)?.label.toLowerCase()} content will appear here</p>
          </div>
        )}
        
        {/* ===== ENTITY DETAIL VIEWS ===== */}
        
        {/* Equipment Detail View */}
        {currentView.type === 'equipment' && (
          <EquipmentDetailContent 
            equipmentId={currentView.id}
            activeTab={detailSubTab}
            onNavigateToStaff={(staffId, staffName) => navigateTo('staff', staffId, staffName)}
            onNavigateToZone={(zoneId, zoneName) => navigateTo('zone', zoneId, zoneName)}
            onNavigateToEquipment={(equipId, equipName) => navigateTo('equipment', equipId, equipName)}
            onNavigateToAlert={(alertId, category, showDetail) => navigateToAlert(alertId, category, showDetail)}
          />
        )}
        
        {/* Staff Detail View */}
        {currentView.type === 'staff' && (
          <StaffDetailContent 
            staffId={currentView.id}
            activeTab={detailSubTab}
            onNavigateToStaff={(staffId, staffName) => navigateTo('staff', staffId, staffName)}
            onNavigateToZone={(zoneId, zoneName) => navigateTo('zone', zoneId, zoneName)}
            onNavigateToEquipment={(equipId, equipName) => navigateTo('equipment', equipId, equipName)}
            onNavigateToAlert={(alertId, category, showDetail) => navigateToAlert(alertId, category, showDetail)}
          />
        )}
        
        {/* Zone Detail View */}
        {currentView.type === 'zone' && (
          <ZoneDetailContent 
            zoneId={currentView.id}
            activeTab={detailSubTab}
            onNavigateToStaff={(staffId, staffName) => navigateTo('staff', staffId, staffName)}
            onNavigateToZone={(zoneId, zoneName) => navigateTo('zone', zoneId, zoneName)}
            onNavigateToEquipment={(equipId, equipName) => navigateTo('equipment', equipId, equipName)}
            onNavigateToAlert={(alertId, category, showDetail) => navigateToAlert(alertId, category, showDetail)}
          />
        )}
      </div>
    </div>
  );
};

// ===== PLANS TAB CONTENT =====
// Plan Execution view with list/detail pattern, Kanban, activity feed, and shift handoff
const PlansTabContent = ({ onViewInsights, onNavigateToAlert, allPlans, setAllPlans }) => {
  // Get scenario mode functions from context
  const { activateDraftPlanScenario, scenarioMode, scenarioSource, draftPlanScenario, exitDraftPlanScenario } = useTimeContext();
  
  // View state: 'list' or 'detail'
  const [viewMode, setViewMode] = React.useState('list');
  const [selectedPlanId, setSelectedPlanId] = React.useState(null);
  const [statusFilter, setStatusFilter] = React.useState('all');
  const [searchQuery, setSearchQuery] = React.useState('');
  const [showCreateModal, setShowCreateModal] = React.useState(false);
  
  // Completion feedback banner
  const [completionBanner, setCompletionBanner] = React.useState({ show: false, planName: '', action: '', followOnPlanId: null });
  
  // Activity Feed for selected plan
  const [activities, setActivities] = React.useState([
    { id: 'a1', type: 'status', user: 'Mike Chen', action: 'marked task as complete', target: 'Add 4 FTE pickers', time: '10:52 AM' },
    { id: 'a2', type: 'comment', user: 'Sarah Kim', content: 'Receiving will be short for ~30 min, heads up to dock team', time: '11:05 AM' },
    { id: 'a3', type: 'status', user: 'Sarah Kim', action: 'marked task as complete', target: 'Reassign 2 FTEs', time: '11:08 AM' },
    { id: 'a4', type: 'status', user: 'James Liu', action: 'started task', target: 'Activate overflow Zone Z07', time: '11:12 AM' },
    { id: 'a5', type: 'metric', content: 'Staff score improved: 76 → 82', time: '11:15 AM' },
    { id: 'a6', type: 'comment', user: 'James Liu', content: 'Z07 equipment staging 50% complete, on track', time: '11:22 AM' }
  ]);
  
  const [newComment, setNewComment] = React.useState('');
  const [showHandoff, setShowHandoff] = React.useState(false);
  const [handoffAccepted, setHandoffAccepted] = React.useState(false);
  
  // Stop Plan modal state
  const [stopPlanModal, setStopPlanModal] = React.useState({ isOpen: false, planId: null });
  const [taskModal, setTaskModal] = React.useState({ isOpen: false, task: null, planId: null });
  const [stopReason, setStopReason] = React.useState('');
  const [stopNotes, setStopNotes] = React.useState('');
  
  // Complete Plan modal state
  const [completePlanModal, setCompletePlanModal] = React.useState({ isOpen: false, planId: null });
  const [completionNotes, setCompletionNotes] = React.useState('');
  const [showExploratoryPreview, setShowExploratoryPreview] = React.useState(false);
  
  // Get all active plans for conflict detection
  const activePlans = allPlans.filter(p => p.status === 'active');
  const hasMultipleActivePlans = activePlans.length > 1;
  
  // Stats calculation
  const stats = React.useMemo(() => {
    const completed = allPlans.filter(p => p.status === 'completed');
    const successful = completed.filter(p => p.outcome === 'success');
    const thisWeek = allPlans.filter(p => ['Dec 16', 'Dec 17', 'Dec 18', 'Dec 19'].includes(p.date));
    const avgDuration = completed.filter(p => p.duration).map(p => {
      const match = p.duration.match(/(\d+)h\s*(\d+)?m?/);
      if (match) return parseInt(match[1]) * 60 + (parseInt(match[2]) || 0);
      return 0;
    });
    const avgMins = avgDuration.length ? Math.round(avgDuration.reduce((a, b) => a + b, 0) / avgDuration.length) : 0;
    
    return {
      totalThisWeek: thisWeek.length,
      successRate: completed.length ? Math.round((successful.length / completed.length) * 100) : 0,
      avgDuration: avgMins ? `${Math.floor(avgMins / 60)}h ${avgMins % 60}m` : '—',
      active: allPlans.filter(p => p.status === 'active').length,
      drafts: allPlans.filter(p => p.status === 'draft').length,
      pending: allPlans.filter(p => p.status === 'pending-approval').length
    };
  }, [allPlans]);
  
  // Filtered plans
  const filteredPlans = React.useMemo(() => {
    let result = allPlans;
    
    // Status filter
    if (statusFilter !== 'all') {
      result = result.filter(p => p.status === statusFilter);
    }
    
    // Search filter
    if (searchQuery) {
      const query = searchQuery.toLowerCase();
      result = result.filter(p => 
        p.name.toLowerCase().includes(query) ||
        p.createdBy.name.toLowerCase().includes(query) ||
        p.shiftContext.toLowerCase().includes(query)
      );
    }
    
    return result;
  }, [allPlans, statusFilter, searchQuery]);
  
  // Get selected plan
  const selectedPlan = selectedPlanId ? allPlans.find(p => p.id === selectedPlanId) : null;
  const activePlan = allPlans.find(p => p.status === 'active');
  
  // Navigate to plan detail
  const viewPlan = (planId) => {
    setSelectedPlanId(planId);
    setViewMode('detail');
  };
  
  // Task status helpers
  const getTasksByStatus = (tasks, status) => tasks?.filter(t => t.status === status) || [];
  
  // Update task status
  const updateTaskStatus = (planId, taskId, newStatus) => {
    setAllPlans(allPlans.map(plan => {
      if (plan.id === planId) {
        return {
          ...plan,
          tasks: plan.tasks.map(task => {
            if (task.id === taskId) {
              const updates = { status: newStatus };
              if (newStatus === 'in-progress') updates.startedAt = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
              if (newStatus === 'done') updates.completedAt = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
              return { ...task, ...updates };
            }
            return task;
          }),
          progress: Math.round(
            (plan.tasks.filter(t => t.id === taskId ? newStatus === 'done' : t.status === 'done').length / plan.tasks.length) * 100
          )
        };
      }
      return plan;
    }));
    
    const task = selectedPlan?.tasks.find(t => t.id === taskId);
    const action = newStatus === 'in-progress' ? 'started task' : newStatus === 'done' ? 'marked task as complete' : 'moved task to todo';
    setActivities([
      { id: `a${Date.now()}`, type: 'status', user: 'You', action, target: task?.title, time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) },
      ...activities
    ]);
  };
  
  // Add comment
  const addComment = () => {
    if (newComment.trim()) {
      setActivities([
        { id: `a${Date.now()}`, type: 'comment', user: 'You', content: newComment, time: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) },
        ...activities
      ]);
      setNewComment('');
    }
  };
  
  // Status config
  const statusConfig = {
    'active': { label: 'Active', color: C.success, bg: C.success[100], text: C.success[700] },
    'draft': { label: 'Draft', color: C.neutral, bg: C.neutral[100], text: C.neutral[600] },
    'pending-approval': { label: 'Pending', color: C.warning, bg: C.warning[100], text: C.warning[700] },
    'completed': { label: 'Completed', color: C.brand, bg: C.brand[100], text: C.brand[700] },
    'partial': { label: 'Partial', color: C.warning, bg: C.warning[100], text: C.warning[700] },
    'abandoned': { label: 'Abandoned', color: C.error, bg: C.error[100], text: C.error[700] }
  };
  
  const outcomeConfig = {
    'success': { icon: CheckCircle, label: 'Success', color: C.success[600] },
    'partial': { icon: AlertTriangle, label: 'Partial', color: C.warning[600] },
    'abandoned': { icon: X, label: 'Abandoned', color: C.error[600] },
    'superseded': { icon: Minus, label: 'Superseded', color: C.neutral[500] }
  };
  
  // Task Card Component (click to open detail modal)
  const TaskCard = ({ task, planId, showActions = true }) => {
    const statusColors = {
      todo: C.neutral,
      'in-progress': C.brand,
      done: C.success,
      incomplete: C.warning
    };
    const colors = statusColors[task.status] || C.neutral;
    const hasActions = task.actions && task.actions.length > 0;
    const appliedCount = hasActions ? task.actions.filter(a => a.status === 'applied').length : 0;
    const totalCount = hasActions ? task.actions.length : 0;
    
    return (
      <div 
        onClick={() => setTaskModal({ isOpen: true, task, planId })}
        style={{
          background: 'white',
          border: `1px solid ${C.neutral[200]}`,
          borderRadius: 8,
          marginBottom: sp.sm,
          borderLeft: `3px solid ${colors[500]}`,
          padding: sp.sm,
          cursor: 'pointer',
          transition: 'box-shadow 0.15s, border-color 0.15s'
        }}
        onMouseEnter={(e) => { e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)'; e.currentTarget.style.borderColor = colors[300]; }}
        onMouseLeave={(e) => { e.currentTarget.style.boxShadow = 'none'; e.currentTarget.style.borderColor = C.neutral[200]; }}
      >
        {/* Title Row */}
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
          <span style={{ fontSize: '13px', fontWeight: 500, color: C.neutral[800], flex: 1, lineHeight: 1.3 }}>{task.title}</span>
          {hasActions && (
            <span style={{ 
              padding: '2px 6px', 
              fontSize: '10px', 
              fontWeight: 600,
              background: appliedCount === totalCount ? C.success[100] : appliedCount > 0 ? C.warning[100] : C.neutral[100],
              color: appliedCount === totalCount ? C.success[700] : appliedCount > 0 ? C.warning[700] : C.neutral[600],
              borderRadius: 10,
              marginLeft: sp.xs,
              whiteSpace: 'nowrap'
            }}>
              {appliedCount}/{totalCount}
            </span>
          )}
        </div>
        
        {/* Tradeoff Warning */}
        {task.tradeoff && (
          <div style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: '11px', color: C.warning[600], marginBottom: sp.xs }}>
            <AlertTriangle style={{ width: 12, height: 12 }} />
            {task.tradeoff}
          </div>
        )}
        
        {/* Meta Row */}
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, fontSize: '11px', color: C.neutral[500], flexWrap: 'wrap' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
            <Users style={{ width: 11, height: 11 }} />
            {task.assignee?.name || 'Unassigned'}
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
            <Clock style={{ width: 11, height: 11 }} />
            {task.status === 'done' ? `Done ${task.completedAt}` : task.status === 'in-progress' ? `Started ${task.startedAt}` : `Due ${task.dueTime}`}
          </div>
        </div>
      </div>
    );
  };
  
  // Task Detail Modal with Actions
  const TaskDetailModal = () => {
    if (!taskModal.isOpen || !taskModal.task) return null;
    
    const task = taskModal.task;
    const planId = taskModal.planId;
    const statusColors = { todo: C.neutral, 'in-progress': C.brand, done: C.success, incomplete: C.warning };
    const colors = statusColors[task.status] || C.neutral;
    const canEdit = task.status === 'in-progress' || task.status === 'todo';
    
    const getActionIcon = (type) => {
      if (type.includes('staff')) return Users;
      if (type.includes('equipment')) return Wrench;
      if (type.includes('zone')) return MapPin;
      if (type.includes('metric')) return TrendingUp;
      return Settings;
    };
    
    const getActionDescription = (action) => {
      switch (action.type) {
        case 'staff-assign':
          return `Assign to ${action.target.function} in ${action.target.zone}`;
        case 'staff-move':
          return `Move from ${action.target.fromFunction} → ${action.target.toFunction}`;
        case 'equipment-stage':
          return `Stage in ${action.target.zone}`;
        case 'zone-status':
          return `Set status to ${action.target.status}`;
        case 'metric-watch':
          return `Monitor ≥ ${action.target.value} ${action.target.unit}`;
        default:
          return JSON.stringify(action.target);
      }
    };
    
    const toggleActionStatus = (actionId) => {
      if (!canEdit) return;
      setAllPlans(allPlans.map(p => {
        if (p.id !== planId) return p;
        return {
          ...p,
          tasks: p.tasks.map(t => {
            if (t.id !== task.id) return t;
            return {
              ...t,
              actions: t.actions.map(a => {
                if (a.id !== actionId) return a;
                const newStatus = a.status === 'applied' ? 'pending' : 'applied';
                return {
                  ...a,
                  status: newStatus,
                  actual: newStatus === 'applied' ? a.target : null,
                  appliedAt: newStatus === 'applied' ? new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) : null
                };
              })
            };
          })
        };
      }));
      // Update the task in the modal
      setTaskModal(prev => ({
        ...prev,
        task: {
          ...prev.task,
          actions: prev.task.actions.map(a => {
            if (a.id !== actionId) return a;
            const newStatus = a.status === 'applied' ? 'pending' : 'applied';
            return { ...a, status: newStatus, actual: newStatus === 'applied' ? a.target : null, appliedAt: newStatus === 'applied' ? new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) : null };
          })
        }
      }));
    };
    
    // Group actions by entity type
    const actionsByType = (task.actions || []).reduce((acc, action) => {
      const type = action.entity?.type || 'other';
      if (!acc[type]) acc[type] = [];
      acc[type].push(action);
      return acc;
    }, {});
    
    const entityTypeLabels = { staff: 'Staff', equipment: 'Equipment', zone: 'Zones', metric: 'Metrics' };
    const entityTypeIcons = { staff: Users, equipment: Wrench, zone: MapPin, metric: TrendingUp };
    
    return (
      <div style={{ position: 'fixed', inset: 0, zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'rgba(0,0,0,0.5)' }} onClick={() => setTaskModal({ isOpen: false, task: null, planId: null })}>
        <div style={{ width: 600, maxHeight: '90vh', background: 'white', borderRadius: 12, boxShadow: '0 8px 32px rgba(0,0,0,0.2)', display: 'flex', flexDirection: 'column', overflow: 'hidden' }} onClick={e => e.stopPropagation()}>
          {/* Header */}
          <div style={{ padding: sp.md, borderBottom: `1px solid ${C.neutral[200]}`, background: colors[50] }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
              <div style={{ flex: 1 }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.xs }}>
                  <span style={{ 
                    padding: '4px 10px', 
                    fontSize: '11px', 
                    fontWeight: 600, 
                    background: colors[100], 
                    color: colors[700], 
                    borderRadius: 4, 
                    textTransform: 'uppercase' 
                  }}>
                    {task.status.replace('-', ' ')}
                  </span>
                  {task.type && (
                    <span style={{ fontSize: '11px', color: C.neutral[500] }}>
                      {task.type.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}
                    </span>
                  )}
                </div>
                <h2 style={{ fontSize: '18px', fontWeight: 500, color: C.neutral[800], margin: 0 }}>{task.title}</h2>
              </div>
              <button onClick={() => setTaskModal({ isOpen: false, task: null, planId: null })} style={{ width: 32, height: 32, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'transparent', border: 'none', borderRadius: 6, cursor: 'pointer' }}>
                <X style={{ width: 18, height: 18, color: C.neutral[600] }} />
              </button>
            </div>
            
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.lg, marginTop: sp.sm, fontSize: '13px', color: C.neutral[600] }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                <Users style={{ width: 14, height: 14 }} />
                {task.assignee?.name} {task.assignee?.role && <span style={{ color: C.neutral[400] }}>({task.assignee.role})</span>}
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                <Clock style={{ width: 14, height: 14 }} />
                {task.status === 'done' ? `Completed ${task.completedAt}` : task.status === 'in-progress' ? `Started ${task.startedAt}` : `Due ${task.dueTime}`}
              </div>
              {task.duration && <span>{task.duration} min</span>}
            </div>
            
            {task.tradeoff && (
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, marginTop: sp.sm, padding: sp.xs, background: C.warning[100], borderRadius: 4 }}>
                <AlertTriangle style={{ width: 14, height: 14, color: C.warning[600] }} />
                <span style={{ fontSize: '12px', color: C.warning[700] }}>{task.tradeoff}</span>
              </div>
            )}
            
            {task.notes && (
              <div style={{ marginTop: sp.sm, padding: sp.sm, background: 'white', borderRadius: 6, border: `1px solid ${C.neutral[200]}` }}>
                <span style={{ fontSize: '12px', color: C.neutral[600] }}>{task.notes}</span>
              </div>
            )}
          </div>
          
          {/* Content - Actions */}
          <div style={{ flex: 1, overflowY: 'auto', padding: sp.md }}>
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: sp.md }}>
              <h3 style={{ fontSize: '14px', fontWeight: 600, color: C.neutral[800], margin: 0 }}>
                Actions ({task.actions?.filter(a => a.status === 'applied').length || 0}/{task.actions?.length || 0} applied)
              </h3>
              {canEdit && (
                <span style={{ fontSize: '11px', color: C.neutral[500] }}>Click to toggle status</span>
              )}
            </div>
            
            {Object.entries(actionsByType).map(([type, actions]) => {
              const TypeIcon = entityTypeIcons[type] || Settings;
              return (
                <div key={type} style={{ marginBottom: sp.md }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, marginBottom: sp.sm }}>
                    <TypeIcon style={{ width: 14, height: 14, color: C.neutral[500] }} />
                    <span style={{ fontSize: '12px', fontWeight: 600, color: C.neutral[600], textTransform: 'uppercase', letterSpacing: '0.5px' }}>
                      {entityTypeLabels[type] || type} ({actions.filter(a => a.status === 'applied').length}/{actions.length})
                    </span>
                  </div>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                    {actions.map(action => {
                      const isApplied = action.status === 'applied';
                      return (
                        <div 
                          key={action.id}
                          onClick={() => toggleActionStatus(action.id)}
                          style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: sp.sm,
                            padding: sp.sm,
                            background: isApplied ? C.success[50] : 'white',
                            border: `1px solid ${isApplied ? C.success[300] : C.neutral[200]}`,
                            borderRadius: 8,
                            cursor: canEdit ? 'pointer' : 'default',
                            transition: 'all 0.15s'
                          }}
                        >
                          {/* Checkbox */}
                          <div style={{
                            width: 20, height: 20,
                            borderRadius: 4,
                            border: `2px solid ${isApplied ? C.success[500] : C.neutral[300]}`,
                            background: isApplied ? C.success[500] : 'white',
                            display: 'flex', alignItems: 'center', justifyContent: 'center',
                            flexShrink: 0
                          }}>
                            {isApplied && <CheckCircle style={{ width: 12, height: 12, color: 'white' }} />}
                          </div>
                          
                          {/* Entity Info */}
                          <div style={{ flex: 1 }}>
                            <div style={{ fontSize: '13px', fontWeight: 500, color: isApplied ? C.success[800] : C.neutral[800] }}>
                              {action.entity.name}
                            </div>
                            <div style={{ fontSize: '11px', color: isApplied ? C.success[600] : C.neutral[500] }}>
                              {getActionDescription(action)}
                            </div>
                          </div>
                          
                          {/* Timestamp */}
                          {action.appliedAt && (
                            <span style={{ fontSize: '11px', color: C.success[600], whiteSpace: 'nowrap' }}>
                              {action.appliedAt}
                            </span>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>
              );
            })}
            
            {(!task.actions || task.actions.length === 0) && (
              <div style={{ padding: sp.lg, textAlign: 'center', color: C.neutral[400], background: C.neutral[50], borderRadius: 8 }}>
                No actions defined for this task
              </div>
            )}
            
            {/* System Impact */}
            {task.systemImpact && (
              <div style={{ marginTop: sp.md, padding: sp.sm, background: C.brand[50], borderRadius: 8, border: `1px solid ${C.brand[200]}` }}>
                <h4 style={{ fontSize: '12px', fontWeight: 600, color: C.brand[700], margin: 0, marginBottom: sp.sm, display: 'flex', alignItems: 'center', gap: 4 }}>
                  <TrendingUp style={{ width: 14, height: 14 }} />
                  System Impact
                </h4>
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: sp.sm }}>
                  {Object.entries(task.systemImpact.after || {}).map(([key, afterValue]) => {
                    const beforeValue = task.systemImpact.before?.[key];
                    const delta = typeof afterValue === 'number' && typeof beforeValue === 'number' ? afterValue - beforeValue : null;
                    return (
                      <div key={key} style={{ padding: sp.xs, background: 'white', borderRadius: 4, border: `1px solid ${C.brand[200]}` }}>
                        <div style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{key.replace(/([A-Z])/g, ' $1').trim()}</div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: '12px' }}>
                          <span style={{ color: C.neutral[400] }}>{beforeValue}</span>
                          <ArrowRight style={{ width: 10, height: 10, color: C.neutral[300] }} />
                          <span style={{ fontWeight: 600, color: delta > 0 ? C.success[600] : delta < 0 ? C.warning[600] : C.neutral[700] }}>{afterValue}</span>
                          {delta !== null && <span style={{ fontSize: '10px', color: delta > 0 ? C.success[600] : delta < 0 ? C.warning[600] : C.neutral[500] }}>({delta > 0 ? '+' : ''}{delta})</span>}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </div>
          
          {/* Footer */}
          <div style={{ padding: sp.md, borderTop: `1px solid ${C.neutral[200]}`, background: C.neutral[50], display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <button onClick={() => setTaskModal({ isOpen: false, task: null, planId: null })} style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, background: 'white', color: C.neutral[700], border: `1px solid ${C.neutral[300]}`, borderRadius: 6, cursor: 'pointer' }}>
              Close
            </button>
            {canEdit && (
              <div style={{ display: 'flex', gap: sp.sm }}>
                {task.status === 'todo' && (
                  <button onClick={() => { updateTaskStatus(planId, task.id, 'in-progress'); setTaskModal(prev => ({ ...prev, task: { ...prev.task, status: 'in-progress', startedAt: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) } })); }} style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, background: C.brand[500], color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer' }}>
                    Start Task
                  </button>
                )}
                {task.status === 'in-progress' && (
                  <button onClick={() => { updateTaskStatus(planId, task.id, 'done'); setTaskModal({ isOpen: false, task: null, planId: null }); }} style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, background: C.success[500], color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer' }}>
                    Mark Complete
                  </button>
                )}
              </div>
            )}
          </div>
        </div>
      </div>
    );
  };

  // ===== LIST VIEW =====
  if (viewMode === 'list') {
    return (
      <>
        <Header icon={ClipboardList} title="Plan Execution" sub="Track active plans, review history, and manage operational interventions" color={C.success[600]} />
        
        {/* Completion Banner */}
        {completionBanner.show && (
          <div style={{ 
            display: 'flex', 
            alignItems: 'center', 
            justifyContent: 'space-between',
            gap: sp.md, 
            padding: sp.md, 
            marginBottom: sp.md,
            background: completionBanner.action === 'completed' || completionBanner.action === 'executed' ? C.success[50] : completionBanner.action === 'handoff' ? C.purple[50] : C.brand[50], 
            borderRadius: 8, 
            border: `1px solid ${completionBanner.action === 'completed' || completionBanner.action === 'executed' ? C.success[200] : completionBanner.action === 'handoff' ? C.purple[200] : C.brand[200]}`
          }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              {completionBanner.action === 'completed' || completionBanner.action === 'executed' ? (
                <CheckCircle style={{ width: 20, height: 20, color: C.success[600] }} />
              ) : completionBanner.action === 'handoff' ? (
                <RefreshCw style={{ width: 20, height: 20, color: C.purple[600] }} />
              ) : completionBanner.action === 'follow-on' ? (
                <ClipboardList style={{ width: 20, height: 20, color: C.brand[600] }} />
              ) : (
                <CheckCircle style={{ width: 20, height: 20, color: C.neutral[500] }} />
              )}
              <div>
                <span style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[800] }}>
                  {completionBanner.action === 'completed' && `"${completionBanner.planName}" completed successfully`}
                  {completionBanner.action === 'executed' && `"${completionBanner.planName}" is now live`}
                  {completionBanner.action === 'handoff' && `"${completionBanner.planName}" handed off to next shift`}
                  {completionBanner.action === 'follow-on' && `"${completionBanner.planName}" completed — follow-on plan created`}
                  {completionBanner.action === 'closed' && `"${completionBanner.planName}" closed and archived`}
                </span>
                {completionBanner.followOnPlanName && (
                  <span style={{ fontSize: '13px', color: C.neutral[600], display: 'block', marginTop: 2 }}>
                    Now viewing: {completionBanner.followOnPlanName}
                  </span>
                )}
              </div>
            </div>
            <button 
              onClick={() => setCompletionBanner({ show: false, planName: '', action: '', followOnPlanId: null })}
              style={{ padding: 4, background: 'transparent', border: 'none', cursor: 'pointer', borderRadius: 4 }}
            >
              <X style={{ width: 16, height: 16, color: C.neutral[400] }} />
            </button>
          </div>
        )}
        
        {/* Draft Plan Scenario Mode Banner */}
        {scenarioMode && scenarioSource === 'draft-plan' && draftPlanScenario && (
          <div style={{ 
            display: 'flex', 
            alignItems: 'center', 
            justifyContent: 'space-between',
            gap: sp.md, 
            padding: sp.md, 
            marginBottom: sp.md,
            background: C.purple[50], 
            borderRadius: 8, 
            border: `1px solid ${C.purple[300]}`
          }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <div style={{ 
                width: 32, height: 32, borderRadius: 8, 
                background: C.purple[100], 
                display: 'flex', alignItems: 'center', justifyContent: 'center' 
              }}>
                <Lightbulb style={{ width: 18, height: 18, color: C.purple[600] }} />
              </div>
              <div>
                <span style={{ fontSize: '14px', fontWeight: 500, color: C.purple[800] }}>
                  Scenario Mode: Viewing projected impact
                </span>
                <span style={{ fontSize: '12px', color: C.purple[600], display: 'block' }}>
                  Draft plan "{draftPlanScenario.planName}" — System shows projected state if plan succeeds
                </span>
              </div>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <button 
                onClick={() => onViewInsights()}
                style={{ 
                  padding: `${sp.xs} ${sp.sm}`, 
                  fontSize: '12px', 
                  fontWeight: 500, 
                  background: C.purple[500], 
                  color: 'white', 
                  border: 'none', 
                  borderRadius: 4, 
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 4
                }}
              >
                View Insights <ChevronRight style={{ width: 12, height: 12 }} />
              </button>
              <button 
                onClick={() => exitDraftPlanScenario && exitDraftPlanScenario()}
                style={{ 
                  padding: `${sp.xs} ${sp.sm}`, 
                  fontSize: '12px', 
                  fontWeight: 500, 
                  background: 'white', 
                  color: C.purple[700], 
                  border: `1px solid ${C.purple[300]}`, 
                  borderRadius: 4, 
                  cursor: 'pointer' 
                }}
              >
                Exit Scenario
              </button>
            </div>
          </div>
        )}
        
        {/* Stats Summary */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md, marginBottom: sp.md }}>
          {[
            { label: 'Plans This Week', value: stats.totalThisWeek, icon: ClipboardList, color: C.brand },
            { label: 'Success Rate', value: `${stats.successRate}%`, icon: CheckCircle, color: C.success },
            { label: 'Avg Duration', value: stats.avgDuration, icon: Clock, color: C.purple },
            { label: 'Active Now', value: stats.active, icon: Zap, color: C.warning }
          ].map((stat, idx) => {
            const Icon = stat.icon;
            return (
              <Card key={idx} style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                <div style={{
                  width: 48, height: 48,
                  borderRadius: 12,
                  background: stat.color[100],
                  display: 'flex', alignItems: 'center', justifyContent: 'center'
                }}>
                  <Icon style={{ width: 24, height: 24, color: stat.color[600] }} />
                </div>
                <div>
                  <div style={{ fontSize: '24px', fontWeight: 300, color: C.neutral[800] }}>{stat.value}</div>
                  <div style={{ fontSize: '12px', color: C.neutral[500] }}>{stat.label}</div>
                </div>
              </Card>
            );
          })}
        </div>
        
        {/* Current Active Plans (if any exist) */}
        {activePlans.length > 0 && (
          <Card style={{ marginBottom: sp.md, background: C.success[50], border: `2px solid ${C.success[300]}` }}>
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: sp.sm }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <Zap style={{ width: 18, height: 18, color: C.success[600] }} />
                <span style={{ fontSize: '11px', fontWeight: 600, color: C.success[700], textTransform: 'uppercase' }}>
                  Active Plan{activePlans.length > 1 ? 's' : ''} ({activePlans.length})
                </span>
              </div>
              {activePlans.length > 1 && (
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, padding: '4px 8px', background: C.warning[100], borderRadius: 4 }}>
                  <AlertTriangle style={{ width: 12, height: 12, color: C.warning[600] }} />
                  <span style={{ fontSize: '11px', color: C.warning[700] }}>Multiple plans active - monitor for conflicts</span>
                </div>
              )}
            </div>
            
            {/* List all active plans */}
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {activePlans.map((plan, idx) => (
                <div key={plan.id} style={{ 
                  display: 'flex', 
                  justifyContent: 'space-between', 
                  alignItems: 'center',
                  padding: sp.sm,
                  background: 'white',
                  borderRadius: 8,
                  border: `1px solid ${C.success[200]}`
                }}>
                  <div style={{ flex: 1 }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.xs }}>
                      <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], margin: 0 }}>{plan.name}</h3>
                      <span style={{
                        padding: '3px 8px',
                        fontSize: '10px',
                        fontWeight: 600,
                        background: plan.priority === 'critical' ? C.error[100] : plan.priority === 'high' ? C.warning[100] : C.neutral[100],
                        color: plan.priority === 'critical' ? C.error[700] : plan.priority === 'high' ? C.warning[700] : C.neutral[600],
                        borderRadius: 4,
                        textTransform: 'uppercase'
                      }}>
                        {plan.priority}
                      </span>
                    </div>
                    
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.lg, fontSize: '12px', color: C.neutral[500] }}>
                      <span>👤 {plan.createdBy.name}</span>
                      <span>📅 {plan.shiftContext} Shift</span>
                      <span>🕐 Target: {plan.targetCompletion}</span>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                        <div style={{ width: 80, height: 6, background: C.neutral[200], borderRadius: 3, overflow: 'hidden' }}>
                          <div style={{ height: '100%', width: `${plan.progress}%`, background: C.success[500], borderRadius: 3 }} />
                        </div>
                        <span style={{ fontSize: '11px', fontWeight: 600, color: C.success[700] }}>{plan.progress}%</span>
                      </div>
                    </div>
                  </div>
                  
                  <button
                    onClick={() => viewPlan(plan.id)}
                    style={{
                      padding: `${sp.xs} ${sp.md}`,
                      fontSize: '12px',
                      fontWeight: 500,
                      background: C.success[600],
                      color: 'white',
                      border: 'none',
                      borderRadius: 6,
                      cursor: 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      gap: 4
                    }}
                  >
                    View
                    <ChevronRight style={{ width: 12, height: 12 }} />
                  </button>
                </div>
              ))}
            </div>
          </Card>
        )}
        
        {/* No Active Plan - Empty State */}
        {activePlans.length === 0 && (
          <Card style={{ marginBottom: sp.md, background: C.neutral[50], border: `2px dashed ${C.neutral[300]}`, textAlign: 'center', padding: sp.xl }}>
            <div style={{
              width: 64, height: 64,
              borderRadius: '50%',
              background: C.neutral[100],
              display: 'flex', alignItems: 'center', justifyContent: 'center',
              margin: '0 auto',
              marginBottom: sp.md
            }}>
              <ClipboardList style={{ width: 32, height: 32, color: C.neutral[400] }} />
            </div>
            <h3 style={{ fontSize: '18px', fontWeight: 500, color: C.neutral[700], margin: 0, marginBottom: sp.xs }}>
              No Active Plan
            </h3>
            <p style={{ fontSize: '14px', color: C.neutral[500], margin: 0, marginBottom: sp.lg }}>
              Create a new plan or apply one from your Playbook to get started
            </p>
            <div style={{ display: 'flex', gap: sp.md, justifyContent: 'center' }}>
              <button
                onClick={() => setShowCreateModal(true)}
                style={{
                  padding: `${sp.sm} ${sp.lg}`,
                  fontSize: '13px',
                  fontWeight: 500,
                  background: C.success[500],
                  color: 'white',
                  border: 'none',
                  borderRadius: 6,
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: sp.xs
                }}
              >
                <Zap style={{ width: 14, height: 14 }} />
                Create New Plan
              </button>
              <button
                style={{
                  padding: `${sp.sm} ${sp.lg}`,
                  fontSize: '13px',
                  fontWeight: 500,
                  background: 'white',
                  color: C.purple[600],
                  border: `1px solid ${C.purple[200]}`,
                  borderRadius: 6,
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: sp.xs
                }}
              >
                <Lightbulb style={{ width: 14, height: 14 }} />
                Apply from Playbook
              </button>
            </div>
          </Card>
        )}
        
        {/* Plans List */}
        <Card>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], margin: 0 }}>All Plans</h3>
            
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              {/* Search */}
              <div style={{ position: 'relative' }}>
                <Search style={{ position: 'absolute', left: 10, top: '50%', transform: 'translateY(-50%)', width: 14, height: 14, color: C.neutral[400] }} />
                <input
                  type="text"
                  placeholder="Search plans..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  style={{
                    padding: '8px 12px 8px 32px',
                    fontSize: '12px',
                    border: `1px solid ${C.neutral[200]}`,
                    borderRadius: 6,
                    width: 200
                  }}
                />
              </div>
              
              {/* Create button */}
              <button
                onClick={() => setShowCreateModal(true)}
                style={{
                  padding: '8px 14px',
                  fontSize: '12px',
                  fontWeight: 500,
                  background: C.brand[500],
                  color: 'white',
                  border: 'none',
                  borderRadius: 6,
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 4
                }}
              >
                <span style={{ fontSize: '14px' }}>+</span>
                Create Plan
              </button>
            </div>
          </div>
          
          {/* Status Filter Tabs */}
          <div style={{ display: 'flex', gap: 0, marginBottom: sp.md, borderBottom: `1px solid ${C.neutral[200]}` }}>
            {[
              { id: 'all', label: 'All', count: allPlans.length },
              { id: 'active', label: 'Active', count: stats.active },
              { id: 'draft', label: 'Drafts', count: stats.drafts },
              { id: 'pending-approval', label: 'Pending', count: stats.pending },
              { id: 'completed', label: 'Completed', count: allPlans.filter(p => p.status === 'completed').length },
              { id: 'partial', label: 'Partial', count: allPlans.filter(p => p.status === 'partial').length },
              { id: 'abandoned', label: 'Abandoned', count: allPlans.filter(p => p.status === 'abandoned').length }
            ].map(tab => (
              <button
                key={tab.id}
                onClick={() => setStatusFilter(tab.id)}
                style={{
                  padding: `${sp.sm} ${sp.md}`,
                  fontSize: '12px',
                  fontWeight: 500,
                  color: statusFilter === tab.id ? C.neutral[900] : C.neutral[500],
                  background: 'transparent',
                  border: 'none',
                  borderBottom: statusFilter === tab.id ? `2px solid ${C.neutral[900]}` : '2px solid transparent',
                  marginBottom: '-1px',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 6
                }}
              >
                {tab.label}
                <span style={{
                  padding: '2px 6px',
                  fontSize: '10px',
                  background: statusFilter === tab.id ? C.neutral[200] : C.neutral[100],
                  color: C.neutral[600],
                  borderRadius: 10
                }}>
                  {tab.count}
                </span>
              </button>
            ))}
          </div>
          
          {/* Plans Table */}
          <div style={{ border: `1px solid ${C.neutral[200]}`, borderRadius: 8, overflow: 'hidden' }}>
            {/* Table Header */}
            <div style={{
              display: 'grid',
              gridTemplateColumns: '2fr 100px 90px 80px 70px 70px 50px',
              gap: sp.sm,
              padding: `${sp.sm} ${sp.md}`,
              background: C.neutral[50],
              borderBottom: `1px solid ${C.neutral[200]}`,
              fontSize: '11px',
              fontWeight: 600,
              color: C.neutral[500],
              textTransform: 'uppercase'
            }}>
              <span>Plan Name</span>
              <span>Status</span>
              <span>Outcome</span>
              <span>Duration</span>
              <span>Shift</span>
              <span>Date</span>
              <span></span>
            </div>
            
            {/* Table Rows */}
            {filteredPlans.length === 0 ? (
              <div style={{ padding: sp.xl, textAlign: 'center', color: C.neutral[500] }}>
                No plans found matching your criteria
              </div>
            ) : (
              filteredPlans.map(plan => {
                const status = statusConfig[plan.status];
                const outcome = plan.outcome ? outcomeConfig[plan.outcome] : null;
                const OutcomeIcon = outcome?.icon;
                
                return (
                  <div
                    key={plan.id}
                    onClick={() => viewPlan(plan.id)}
                    style={{
                      display: 'grid',
                      gridTemplateColumns: '2fr 100px 90px 80px 70px 70px 50px',
                      gap: sp.sm,
                      padding: `${sp.sm} ${sp.md}`,
                      borderBottom: `1px solid ${C.neutral[100]}`,
                      fontSize: '13px',
                      color: C.neutral[700],
                      cursor: 'pointer',
                      transition: 'background 0.15s',
                      alignItems: 'center'
                    }}
                    onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[50]}
                    onMouseLeave={(e) => e.currentTarget.style.background = 'white'}
                  >
                    {/* Plan Name */}
                    <div>
                      <div style={{ fontWeight: 500, color: C.neutral[800], marginBottom: 2 }}>{plan.name}</div>
                      <div style={{ fontSize: '11px', color: C.neutral[500] }}>{plan.createdBy.name}</div>
                    </div>
                    
                    {/* Status */}
                    <span style={{
                      padding: '4px 8px',
                      fontSize: '10px',
                      fontWeight: 600,
                      background: status.bg,
                      color: status.text,
                      borderRadius: 4,
                      textTransform: 'uppercase',
                      display: 'inline-block',
                      width: 'fit-content'
                    }}>
                      {status.label}
                    </span>
                    
                    {/* Outcome */}
                    {outcome ? (
                      <div style={{ display: 'flex', alignItems: 'center', gap: 4, color: outcome.color }}>
                        <OutcomeIcon style={{ width: 14, height: 14 }} />
                        <span style={{ fontSize: '12px' }}>{outcome.label}</span>
                      </div>
                    ) : (
                      <span style={{ color: C.neutral[400] }}>—</span>
                    )}
                    
                    {/* Duration */}
                    <span style={{ color: plan.duration ? C.neutral[600] : C.neutral[400] }}>
                      {plan.duration || '—'}
                    </span>
                    
                    {/* Shift */}
                    <span>{plan.shiftContext}</span>
                    
                    {/* Date */}
                    <span>{plan.date}</span>
                    
                    {/* Action */}
                    <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
                  </div>
                );
              })
            )}
          </div>
        </Card>
        
        {/* Create Plan Modal */}
        {showCreateModal && (
          <div style={{ position: 'fixed', inset: 0, zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'rgba(0,0,0,0.5)' }}>
            <div style={{ width: 640, maxHeight: '90vh', background: 'white', borderRadius: 12, boxShadow: '0 8px 32px rgba(0,0,0,0.2)', display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
              {/* Header */}
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: sp.md, borderBottom: `1px solid ${C.neutral[200]}` }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <div style={{ width: 36, height: 36, borderRadius: 8, background: C.success[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                    <Zap style={{ width: 20, height: 20, color: C.success[600] }} />
                  </div>
                  <div>
                    <span style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], display: 'block' }}>Create New Plan</span>
                    <span style={{ fontSize: '12px', color: C.neutral[500] }}>Define tasks and assign resources</span>
                  </div>
                </div>
                <button onClick={() => setShowCreateModal(false)} style={{ width: 32, height: 32, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'transparent', border: 'none', borderRadius: 6, cursor: 'pointer' }}>
                  <X style={{ width: 18, height: 18, color: C.neutral[600] }} />
                </button>
              </div>
              
              {/* Conflict Warning (if active plans exist) */}
              {activePlans.length > 0 && (
                <div style={{ padding: sp.md, background: C.warning[50], borderBottom: `1px solid ${C.warning[200]}` }}>
                  <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.sm }}>
                    <AlertTriangle style={{ width: 20, height: 20, color: C.warning[600], flexShrink: 0, marginTop: 2 }} />
                    <div style={{ flex: 1 }}>
                      <h4 style={{ fontSize: '14px', fontWeight: 500, color: C.warning[800], margin: 0, marginBottom: sp.xs }}>
                        {activePlans.length} Active Plan{activePlans.length > 1 ? 's' : ''} in Progress
                      </h4>
                      <p style={{ fontSize: '12px', color: C.warning[700], margin: 0, marginBottom: sp.sm }}>
                        Creating a new plan may cause resource conflicts. Review active plans below and ensure tasks don't overlap.
                      </p>
                      <div style={{ background: 'white', border: `1px solid ${C.warning[200]}`, borderRadius: 6, overflow: 'hidden' }}>
                        {activePlans.map(plan => (
                          <div key={plan.id} style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: sp.sm, borderBottom: `1px solid ${C.warning[100]}` }}>
                            <div>
                              <span style={{ fontSize: '13px', fontWeight: 500, color: C.neutral[800] }}>{plan.name}</span>
                              <div style={{ fontSize: '11px', color: C.neutral[500], marginTop: 2 }}>
                                {plan.tasks.length} tasks • {plan.shiftContext} Shift • Target: {plan.targetCompletion}
                              </div>
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                              <div style={{ width: 60, height: 6, background: C.neutral[200], borderRadius: 3, overflow: 'hidden' }}>
                                <div style={{ height: '100%', width: `${plan.progress}%`, background: C.success[500] }} />
                              </div>
                              <span style={{ fontSize: '11px', color: C.neutral[600], width: 35 }}>{plan.progress}%</span>
                            </div>
                          </div>
                        ))}
                      </div>
                      <p style={{ fontSize: '11px', color: C.warning[600], margin: 0, marginTop: sp.sm, fontStyle: 'italic' }}>
                        Potential conflicts will be flagged when you assign overlapping resources.
                      </p>
                    </div>
                  </div>
                </div>
              )}
              
              {/* Content */}
              <div style={{ flex: 1, overflowY: 'auto', padding: sp.md }}>
                {/* Plan Details */}
                <div style={{ marginBottom: sp.lg }}>
                  <h4 style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[800], margin: 0, marginBottom: sp.sm }}>Plan Details</h4>
                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: sp.md }}>
                    <div>
                      <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: 4 }}>Plan Name</label>
                      <input type="text" placeholder="e.g., Peak Hour Staffing Adjustment" style={{ width: '100%', padding: '10px 12px', fontSize: '13px', border: `1px solid ${C.neutral[300]}`, borderRadius: 6, boxSizing: 'border-box' }} />
                    </div>
                    <div>
                      <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: 4 }}>Priority</label>
                      <select style={{ width: '100%', padding: '10px 12px', fontSize: '13px', border: `1px solid ${C.neutral[300]}`, borderRadius: 6, background: 'white' }}>
                        <option>Normal</option>
                        <option>High</option>
                        <option>Critical</option>
                      </select>
                    </div>
                    <div>
                      <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: 4 }}>Target Completion</label>
                      <select style={{ width: '100%', padding: '10px 12px', fontSize: '13px', border: `1px solid ${C.neutral[300]}`, borderRadius: 6, background: 'white' }}>
                        <option>11:00 AM</option>
                        <option>11:30 AM</option>
                        <option>12:00 PM</option>
                        <option>12:30 PM</option>
                        <option>1:00 PM</option>
                        <option>1:30 PM</option>
                        <option>2:00 PM</option>
                      </select>
                    </div>
                    <div>
                      <label style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], display: 'block', marginBottom: 4 }}>Shift Context</label>
                      <select style={{ width: '100%', padding: '10px 12px', fontSize: '13px', border: `1px solid ${C.neutral[300]}`, borderRadius: 6, background: 'white' }}>
                        <option>Day Shift</option>
                        <option>Swing Shift</option>
                        <option>Night Shift</option>
                      </select>
                    </div>
                  </div>
                </div>
                
                {/* Tasks */}
                <div style={{ marginBottom: sp.lg }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
                    <h4 style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[800], margin: 0 }}>Tasks</h4>
                    <button style={{ padding: '6px 12px', fontSize: '12px', fontWeight: 500, background: C.brand[50], color: C.brand[600], border: `1px solid ${C.brand[200]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 4 }}>
                      <span>+</span> Add Task
                    </button>
                  </div>
                  
                  {/* Empty task placeholder */}
                  <div style={{ background: C.neutral[50], border: `2px dashed ${C.neutral[300]}`, borderRadius: 8, padding: sp.lg, textAlign: 'center' }}>
                    <ClipboardList style={{ width: 32, height: 32, color: C.neutral[400], margin: '0 auto 8px' }} />
                    <p style={{ fontSize: '13px', color: C.neutral[500], margin: 0, marginBottom: sp.sm }}>No tasks added yet</p>
                    <p style={{ fontSize: '12px', color: C.neutral[400], margin: 0 }}>
                      Add tasks to define what needs to be done
                    </p>
                  </div>
                </div>
                
                {/* Success Criteria */}
                <div>
                  <h4 style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[800], margin: 0, marginBottom: sp.sm }}>Success Criteria (Optional)</h4>
                  <div style={{ display: 'flex', gap: sp.sm }}>
                    <input type="text" placeholder="e.g., Throughput reaches 850 orders/hr" style={{ flex: 1, padding: '10px 12px', fontSize: '13px', border: `1px solid ${C.neutral[300]}`, borderRadius: 6 }} />
                    <button style={{ padding: '10px 16px', fontSize: '12px', fontWeight: 500, background: C.neutral[100], color: C.neutral[600], border: `1px solid ${C.neutral[300]}`, borderRadius: 6, cursor: 'pointer' }}>
                      Add
                    </button>
                  </div>
                </div>
              </div>
              
              {/* Footer */}
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: sp.md, borderTop: `1px solid ${C.neutral[200]}`, background: C.neutral[50] }}>
                <button onClick={() => setShowCreateModal(false)} style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, background: 'white', color: C.neutral[700], border: `1px solid ${C.neutral[300]}`, borderRadius: 6, cursor: 'pointer' }}>
                  Cancel
                </button>
                <div style={{ display: 'flex', gap: sp.sm }}>
                  <button style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, background: 'white', color: C.neutral[600], border: `1px solid ${C.neutral[300]}`, borderRadius: 6, cursor: 'pointer' }}>
                    Save as Draft
                  </button>
                  <button style={{ padding: `${sp.sm} ${sp.lg}`, fontSize: '13px', fontWeight: 500, background: C.success[500], color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <Zap style={{ width: 14, height: 14 }} />
                    Create & Activate
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </>
    );
  }
  
  // ===== DETAIL VIEW =====
  if (viewMode === 'detail' && selectedPlan) {
    const todoTasks = getTasksByStatus(selectedPlan.tasks, 'todo');
    const inProgressTasks = getTasksByStatus(selectedPlan.tasks, 'in-progress');
    const doneTasks = getTasksByStatus(selectedPlan.tasks, 'done');
    const incompleteTasks = getTasksByStatus(selectedPlan.tasks, 'incomplete');
    const isActivePlan = selectedPlan.status === 'active';
    const isDraftPlan = selectedPlan.status === 'draft';
    const status = statusConfig[selectedPlan.status];
    
    return (
      <div style={{ maxWidth: 960, margin: '0 auto' }}>
        {/* Breadcrumb */}
        <div style={{ marginBottom: sp.md }}>
          <button
            onClick={() => { setViewMode('list'); setSelectedPlanId(null); }}
            style={{
              display: 'flex',
              alignItems: 'center',
              gap: sp.xs,
              padding: `${sp.xs} ${sp.sm}`,
              fontSize: '13px',
              color: C.neutral[600],
              background: 'transparent',
              border: 'none',
              cursor: 'pointer',
              borderRadius: 4
            }}
            onMouseEnter={(e) => e.currentTarget.style.color = C.brand[600]}
            onMouseLeave={(e) => e.currentTarget.style.color = C.neutral[600]}
          >
            <ChevronLeft style={{ width: 16, height: 16 }} />
            All Plans
          </button>
        </div>
        
        {/* Draft Plan Scenario Mode Banner */}
        {isDraftPlan && scenarioMode && scenarioSource === 'draft-plan' && draftPlanScenario?.planId === selectedPlan.id && (
          <div style={{ 
            display: 'flex', 
            alignItems: 'center', 
            justifyContent: 'space-between',
            gap: sp.md, 
            padding: sp.md, 
            marginBottom: sp.md,
            background: C.purple[50], 
            borderRadius: 8, 
            border: `1px solid ${C.purple[300]}`
          }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <div style={{ 
                width: 32, height: 32, borderRadius: 8, 
                background: C.purple[100], 
                display: 'flex', alignItems: 'center', justifyContent: 'center' 
              }}>
                <Lightbulb style={{ width: 18, height: 18, color: C.purple[600] }} />
              </div>
              <div>
                <span style={{ fontSize: '14px', fontWeight: 500, color: C.purple[800] }}>
                  Scenario Mode Active
                </span>
                <span style={{ fontSize: '12px', color: C.purple[600], display: 'block' }}>
                  Dashboard shows projected system state if this plan succeeds. Execute to go live.
                </span>
              </div>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <button 
                onClick={() => onViewInsights()}
                style={{ 
                  padding: `${sp.xs} ${sp.sm}`, 
                  fontSize: '12px', 
                  fontWeight: 500, 
                  background: C.purple[500], 
                  color: 'white', 
                  border: 'none', 
                  borderRadius: 4, 
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: 4
                }}
              >
                View Insights <ChevronRight style={{ width: 12, height: 12 }} />
              </button>
              <button 
                onClick={() => exitDraftPlanScenario && exitDraftPlanScenario()}
                style={{ 
                  padding: `${sp.xs} ${sp.sm}`, 
                  fontSize: '12px', 
                  fontWeight: 500, 
                  background: 'white', 
                  color: C.purple[700], 
                  border: `1px solid ${C.purple[300]}`, 
                  borderRadius: 4, 
                  cursor: 'pointer' 
                }}
              >
                Exit Scenario
              </button>
            </div>
          </div>
        )}
        
        {/* 1. HERO CARD */}
        <Card style={{ marginBottom: sp.md }}>
          {/* Header Row */}
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.sm }}>
            <h2 style={{ fontSize: '20px', fontWeight: 500, color: C.neutral[800], margin: 0 }}>
              {selectedPlan.name}
            </h2>
            <span style={{
              padding: '4px 10px',
              fontSize: '11px',
              fontWeight: 600,
              background: status.bg,
              color: status.text,
              borderRadius: 12,
              textTransform: 'uppercase'
            }}>
              {status.label}
            </span>
            <span style={{
              padding: '4px 8px',
              fontSize: '11px',
              fontWeight: 500,
              background: selectedPlan.priority === 'critical' ? C.error[100] : selectedPlan.priority === 'high' ? C.warning[100] : C.neutral[100],
              color: selectedPlan.priority === 'critical' ? C.error[700] : selectedPlan.priority === 'high' ? C.warning[700] : C.neutral[600],
              borderRadius: 4
            }}>
              {selectedPlan.priority.charAt(0).toUpperCase() + selectedPlan.priority.slice(1)} Priority
            </span>
          </div>
          
          {/* Meta Row */}
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.lg, fontSize: '13px', color: C.neutral[600], marginBottom: sp.md }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
              <Users style={{ width: 14, height: 14 }} />
              Created by {selectedPlan.createdBy.name} at {selectedPlan.createdAt}
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
              <Calendar style={{ width: 14, height: 14 }} />
              {selectedPlan.shiftContext} Shift
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
              <Clock style={{ width: 14, height: 14 }} />
              Target: {selectedPlan.targetCompletion}
            </div>
            {selectedPlan.duration && (
              <span>Duration: {selectedPlan.duration}</span>
            )}
          </div>
          
          {/* Progress Bar */}
          <div style={{ marginBottom: sp.md }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.xs }}>
              <span style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600] }}>Progress</span>
              <span style={{ fontSize: '12px', fontWeight: 600, color: C.neutral[800] }}>
                {doneTasks.length} of {selectedPlan.tasks.length} tasks complete ({selectedPlan.progress}%)
              </span>
            </div>
            <div style={{ height: 8, background: C.neutral[100], borderRadius: 4, overflow: 'hidden' }}>
              <div style={{ 
                height: '100%', 
                width: `${selectedPlan.progress}%`, 
                background: `linear-gradient(90deg, ${status.color[400]}, ${status.color[500]})`,
                borderRadius: 4,
                transition: 'width 0.3s ease'
              }} />
            </div>
          </div>
          
          {/* Success Criteria */}
          {selectedPlan.successCriteria && (
            <div style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6, border: `1px solid ${C.neutral[200]}`, marginBottom: sp.md }}>
              <h4 style={{ fontSize: '12px', fontWeight: 600, color: C.neutral[600], margin: 0, marginBottom: sp.sm }}>
                Success Criteria — By {selectedPlan.targetCompletion}
              </h4>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                {selectedPlan.successCriteria.map(criterion => (
                  <div key={criterion.id} style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <div style={{
                      width: 18, height: 18, borderRadius: '50%',
                      background: criterion.met ? C.success[500] : C.neutral[200],
                      display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0
                    }}>
                      {criterion.met && <CheckCircle style={{ width: 12, height: 12, color: 'white' }} />}
                    </div>
                    <span style={{ fontSize: '13px', color: criterion.met ? C.success[700] : C.neutral[600], textDecoration: criterion.met ? 'line-through' : 'none' }}>
                      {criterion.text}
                    </span>
                  </div>
                ))}
              </div>
            </div>
          )}
          
          {/* Origin Link */}
          {selectedPlan.origin && (
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, padding: sp.sm, background: C.purple[50], borderRadius: 6, border: `1px solid ${C.purple[200]}`, marginBottom: sp.md }}>
              <Lightbulb style={{ width: 16, height: 16, color: C.purple[500], flexShrink: 0 }} />
              <div style={{ flex: 1 }}>
                <span style={{ fontSize: '11px', color: C.purple[600], display: 'block' }}>INITIATED FROM</span>
                <span style={{ fontSize: '13px', color: C.purple[700] }}>{selectedPlan.origin.title || selectedPlan.origin.alertTitle}</span>
              </div>
              <button onClick={() => onNavigateToAlert?.(selectedPlan.origin.alertId)} style={{ padding: '4px 10px', fontSize: '11px', fontWeight: 500, background: 'white', color: C.purple[600], border: `1px solid ${C.purple[200]}`, borderRadius: 4, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 4 }}>
                View Context <ChevronRight style={{ width: 12, height: 12 }} />
              </button>
            </div>
          )}
          
          {/* Plan Actions (only for active plans) */}
          {isActivePlan && (
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}` }}>
              <button 
                onClick={() => setStopPlanModal({ isOpen: true, planId: selectedPlan.id })}
                style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, background: 'white', color: C.error[600], border: `1px solid ${C.error[200]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}
              >
                <X style={{ width: 14, height: 14 }} />
                Stop Plan
              </button>
              <button 
                onClick={() => { setCompletePlanModal({ isOpen: true, planId: selectedPlan.id }); setCompletionNotes(''); setShowExploratoryPreview(false); }}
                style={{ padding: `${sp.sm} ${sp.lg}`, fontSize: '13px', fontWeight: 500, background: C.success[500], color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}
              >
                <CheckCircle style={{ width: 14, height: 14 }} />
                Mark Plan Complete
              </button>
            </div>
          )}
          
          {/* Draft Plan Actions */}
          {isDraftPlan && (
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}` }}>
              <button 
                onClick={() => {
                  // Delete draft plan
                  setAllPlans(allPlans.filter(p => p.id !== selectedPlan.id));
                  if (exitDraftPlanScenario) exitDraftPlanScenario();
                  setViewMode('list');
                  setSelectedPlanId(null);
                }}
                style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, background: 'white', color: C.error[600], border: `1px solid ${C.error[200]}`, borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}
              >
                <Trash2 style={{ width: 14, height: 14 }} />
                Discard Draft
              </button>
              <button 
                onClick={() => {
                  // Execute the draft plan (make it active)
                  setAllPlans(allPlans.map(p => p.id === selectedPlan.id ? {
                    ...p,
                    status: 'active',
                    targetCompletion: new Date(Date.now() + 2 * 60 * 60 * 1000).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })
                  } : p));
                  if (exitDraftPlanScenario) exitDraftPlanScenario();
                  // Show success message
                  setCompletionBanner({
                    show: true,
                    planName: selectedPlan.name,
                    action: 'executed',
                    followOnPlanId: null
                  });
                  setTimeout(() => setCompletionBanner({ show: false, planName: '', action: '', followOnPlanId: null }), 5000);
                }}
                style={{ padding: `${sp.sm} ${sp.lg}`, fontSize: '13px', fontWeight: 500, background: C.success[500], color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}
              >
                <Play style={{ width: 14, height: 14 }} />
                Execute Plan Live
              </button>
            </div>
          )}
        </Card>
        
        {/* 2. PROJECTED IMPACT */}
        {selectedPlan.projectedImpact && (
          <Card style={{ marginBottom: sp.md }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], margin: 0, marginBottom: sp.md }}>
              Projected Impact
            </h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.sm }}>
              {[
                { key: 'staff', label: 'Staff Score', icon: Users },
                { key: 'zones', label: 'Zone Score', icon: MapPin },
                { key: 'schedule', label: 'Schedule', icon: Calendar },
                { key: 'equip', label: 'Equipment', icon: Wrench }
              ].map(cat => {
                const data = selectedPlan.projectedImpact[cat.key];
                const Icon = cat.icon;
                const isPositive = data.delta > 0;
                const isNegative = data.delta < 0;
                
                return (
                  <div key={cat.key} style={{
                    padding: sp.sm,
                    background: isPositive ? C.success[50] : isNegative ? C.warning[50] : C.neutral[50],
                    border: `1px solid ${isPositive ? C.success[200] : isNegative ? C.warning[200] : C.neutral[200]}`,
                    borderRadius: 8,
                    display: 'flex',
                    alignItems: 'center',
                    gap: sp.md
                  }}>
                    <div style={{ width: 40, height: 40, borderRadius: 8, background: isPositive ? C.success[100] : isNegative ? C.warning[100] : C.neutral[100], display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}>
                      <Icon style={{ width: 20, height: 20, color: isPositive ? C.success[600] : isNegative ? C.warning[600] : C.neutral[500] }} />
                    </div>
                    <div style={{ flex: 1 }}>
                      <div style={{ fontSize: '12px', color: C.neutral[500], marginBottom: 2 }}>{cat.label}</div>
                      <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs }}>
                        <span style={{ fontSize: '20px', fontWeight: 500, color: isPositive ? C.success[700] : isNegative ? C.warning[700] : C.neutral[700] }}>{data.projected}</span>
                        <span style={{ fontSize: '12px', color: C.neutral[400] }}>from {data.base}</span>
                        <span style={{ fontSize: '11px', fontWeight: 600, color: isPositive ? C.success[600] : isNegative ? C.warning[600] : C.neutral[500] }}>
                          ({data.delta > 0 ? '+' : ''}{data.delta})
                        </span>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </Card>
        )}
        
        {/* 3. TASKS */}
        <Card style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], margin: 0, marginBottom: sp.md }}>
            Tasks
            <span style={{ fontSize: '14px', fontWeight: 400, color: C.neutral[500], marginLeft: sp.sm }}>
              ({selectedPlan.tasks.length})
            </span>
          </h3>
          
          {/* Kanban Board */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm }}>
            {/* To Do Column */}
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, marginBottom: sp.sm, padding: sp.xs, background: C.neutral[100], borderRadius: 6 }}>
                <div style={{ width: 8, height: 8, borderRadius: '50%', background: C.neutral[400] }} />
                <span style={{ fontSize: '12px', fontWeight: 600, color: C.neutral[600] }}>To Do</span>
                <span style={{ fontSize: '11px', fontWeight: 500, color: C.neutral[500], background: C.neutral[200], padding: '2px 6px', borderRadius: 10, marginLeft: 'auto' }}>{todoTasks.length}</span>
              </div>
              {todoTasks.map(task => <TaskCard key={task.id} task={task} planId={selectedPlan.id} showActions={isActivePlan} />)}
              {todoTasks.length === 0 && <div style={{ padding: sp.sm, textAlign: 'center', color: C.neutral[400], fontSize: '12px', background: C.neutral[50], borderRadius: 6, border: `1px dashed ${C.neutral[200]}` }}>No pending tasks</div>}
            </div>
            
            {/* In Progress Column */}
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, marginBottom: sp.sm, padding: sp.xs, background: C.brand[50], borderRadius: 6 }}>
                <div style={{ width: 8, height: 8, borderRadius: '50%', background: C.brand[500] }} />
                <span style={{ fontSize: '12px', fontWeight: 600, color: C.brand[700] }}>In Progress</span>
                <span style={{ fontSize: '11px', fontWeight: 500, color: C.brand[600], background: C.brand[100], padding: '2px 6px', borderRadius: 10, marginLeft: 'auto' }}>{inProgressTasks.length}</span>
              </div>
              {inProgressTasks.map(task => <TaskCard key={task.id} task={task} planId={selectedPlan.id} showActions={isActivePlan} />)}
              {inProgressTasks.length === 0 && <div style={{ padding: sp.sm, textAlign: 'center', color: C.neutral[400], fontSize: '12px', background: C.neutral[50], borderRadius: 6, border: `1px dashed ${C.neutral[200]}` }}>No active tasks</div>}
            </div>
            
            {/* Done Column */}
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, marginBottom: sp.sm, padding: sp.xs, background: C.success[50], borderRadius: 6 }}>
                <div style={{ width: 8, height: 8, borderRadius: '50%', background: C.success[500] }} />
                <span style={{ fontSize: '12px', fontWeight: 600, color: C.success[700] }}>Done</span>
                <span style={{ fontSize: '11px', fontWeight: 500, color: C.success[600], background: C.success[100], padding: '2px 6px', borderRadius: 10, marginLeft: 'auto' }}>{doneTasks.length + incompleteTasks.length}</span>
              </div>
              {doneTasks.map(task => <TaskCard key={task.id} task={task} planId={selectedPlan.id} showActions={false} />)}
              {incompleteTasks.map(task => <TaskCard key={task.id} task={task} planId={selectedPlan.id} showActions={false} />)}
              {doneTasks.length === 0 && incompleteTasks.length === 0 && <div style={{ padding: sp.sm, textAlign: 'center', color: C.neutral[400], fontSize: '12px', background: C.neutral[50], borderRadius: 6, border: `1px dashed ${C.neutral[200]}` }}>No completed tasks</div>}
            </div>
          </div>
        </Card>
        
        {/* Task Detail Modal */}
        <TaskDetailModal />
        
        {/* 4. ACTIVITY */}
        <Card style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], margin: 0, marginBottom: sp.md }}>
            Activity
          </h3>
          
          {/* Comment Input (active plans only) */}
          {isActivePlan && (
            <div style={{ display: 'flex', gap: sp.sm, marginBottom: sp.md }}>
              <input
                type="text"
                value={newComment}
                onChange={(e) => setNewComment(e.target.value)}
                onKeyDown={(e) => e.key === 'Enter' && addComment()}
                placeholder="Add a comment or update..."
                style={{ flex: 1, padding: '10px 14px', fontSize: '13px', border: `1px solid ${C.neutral[200]}`, borderRadius: 6 }}
              />
              <button
                onClick={addComment}
                style={{ padding: '10px 16px', fontSize: '13px', fontWeight: 500, background: C.brand[500], color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer' }}
              >
                Post
              </button>
            </div>
          )}
          
          {/* Activity Timeline */}
          <div style={{ borderLeft: `2px solid ${C.neutral[200]}`, marginLeft: sp.sm, paddingLeft: sp.md }}>
            {activities.map((activity, idx) => (
              <div key={activity.id} style={{ 
                position: 'relative',
                paddingBottom: idx < activities.length - 1 ? sp.md : 0,
                marginBottom: idx < activities.length - 1 ? sp.sm : 0
              }}>
                {/* Timeline dot */}
                <div style={{
                  position: 'absolute',
                  left: -22,
                  top: 4,
                  width: 10,
                  height: 10,
                  borderRadius: '50%',
                  background: activity.type === 'metric' ? C.success[500] : activity.type === 'comment' ? C.brand[500] : C.neutral[400],
                  border: '2px solid white'
                }} />
                
                {activity.type === 'comment' ? (
                  <div style={{ background: C.neutral[50], padding: sp.sm, borderRadius: 6 }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                      <span style={{ fontSize: '13px', fontWeight: 500, color: C.neutral[700] }}>{activity.user}</span>
                      <span style={{ fontSize: '11px', color: C.neutral[400] }}>{activity.time}</span>
                    </div>
                    <p style={{ margin: 0, fontSize: '13px', color: C.neutral[600] }}>{activity.content}</p>
                  </div>
                ) : activity.type === 'status' ? (
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                    <span style={{ fontSize: '13px', color: C.neutral[600] }}>
                      <strong>{activity.user}</strong> {activity.action} <strong>{activity.target}</strong>
                    </span>
                    <span style={{ fontSize: '11px', color: C.neutral[400] }}>{activity.time}</span>
                  </div>
                ) : (
                  <div style={{ 
                    display: 'flex', 
                    justifyContent: 'space-between', 
                    alignItems: 'center',
                    background: C.success[50],
                    padding: sp.sm,
                    borderRadius: 6
                  }}>
                    <span style={{ fontSize: '13px', color: C.success[700], fontWeight: 500, display: 'flex', alignItems: 'center', gap: 4 }}>
                      <TrendingUp style={{ width: 14, height: 14 }} />
                      {activity.content}
                    </span>
                    <span style={{ fontSize: '11px', color: C.success[600] }}>{activity.time}</span>
                  </div>
                )}
              </div>
            ))}
          </div>
        </Card>
        
        {/* Shift Handoff Panel (only for active plans) */}
        {isActivePlan && (
          <Card style={{ marginBottom: sp.md, background: C.purple[50], border: `1px solid ${C.purple[200]}` }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <RefreshCw style={{ width: 18, height: 18, color: C.purple[600] }} />
                <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.purple[800], margin: 0 }}>Shift Handoff</h3>
              </div>
              <span style={{ fontSize: '12px', color: C.purple[600], fontWeight: 500 }}>Day → Swing</span>
            </div>
            
            {!showHandoff ? (
              <button
                onClick={() => setShowHandoff(true)}
                style={{ width: '100%', padding: sp.md, fontSize: '14px', fontWeight: 500, background: C.purple[500], color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.sm }}
              >
                <Clock style={{ width: 16, height: 16 }} />
                Prepare Handoff (in 45 min)
              </button>
            ) : handoffAccepted ? (
              <div style={{ padding: sp.md, background: C.success[100], borderRadius: 6, textAlign: 'center' }}>
                <CheckCircle style={{ width: 24, height: 24, color: C.success[600], margin: '0 auto 8px' }} />
                <p style={{ fontSize: '14px', fontWeight: 500, color: C.success[700], margin: 0 }}>Handoff Submitted</p>
                <p style={{ fontSize: '12px', color: C.success[600], margin: 0, marginTop: 4 }}>Swing shift lead notified</p>
              </div>
            ) : (
              <div>
                <div style={{ background: 'white', borderRadius: 6, padding: sp.md, marginBottom: sp.sm }}>
                  <p style={{ fontSize: '11px', fontWeight: 600, color: C.neutral[500], margin: 0, marginBottom: sp.xs, textTransform: 'uppercase' }}>Handoff Notes</p>
                  <textarea
                    defaultValue="Throughput recovering well. Z07 still ramping up - should hit target by 15:30. Watch for equipment availability in Z04."
                    style={{ width: '100%', padding: sp.sm, fontSize: '13px', border: `1px solid ${C.neutral[200]}`, borderRadius: 6, resize: 'vertical', minHeight: 80, fontFamily: 'inherit', boxSizing: 'border-box' }}
                  />
                </div>
                <div style={{ display: 'flex', gap: sp.sm }}>
                  <button onClick={() => setShowHandoff(false)} style={{ flex: 1, padding: sp.md, fontSize: '13px', fontWeight: 500, background: 'white', color: C.neutral[600], border: `1px solid ${C.neutral[300]}`, borderRadius: 6, cursor: 'pointer' }}>
                    Cancel
                  </button>
                  <button onClick={() => setHandoffAccepted(true)} style={{ flex: 1, padding: sp.md, fontSize: '13px', fontWeight: 500, background: C.success[500], color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 4 }}>
                    Submit Handoff
                    <ChevronRight style={{ width: 14, height: 14 }} />
                  </button>
                </div>
              </div>
            )}
          </Card>
        )}
        
        {/* Stop Plan Modal */}
        {stopPlanModal.isOpen && selectedPlan && (
          <div style={{ position: 'fixed', inset: 0, zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'rgba(0,0,0,0.5)' }}>
            <div style={{ width: 560, maxHeight: '90vh', background: 'white', borderRadius: 12, boxShadow: '0 8px 32px rgba(0,0,0,0.2)', display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
              {/* Header */}
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: sp.md, background: C.error[50], borderBottom: `1px solid ${C.error[200]}` }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <div style={{ width: 36, height: 36, borderRadius: 8, background: C.error[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                    <X style={{ width: 20, height: 20, color: C.error[600] }} />
                  </div>
                  <div>
                    <span style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800], display: 'block' }}>Stop Plan</span>
                    <span style={{ fontSize: '12px', color: C.neutral[500] }}>{selectedPlan.name}</span>
                  </div>
                </div>
                <button onClick={() => setStopPlanModal({ isOpen: false, planId: null })} style={{ width: 32, height: 32, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'transparent', border: 'none', borderRadius: 6, cursor: 'pointer' }}>
                  <X style={{ width: 18, height: 18, color: C.neutral[600] }} />
                </button>
              </div>
              
              {/* Content */}
              <div style={{ flex: 1, overflowY: 'auto', padding: sp.md }}>
                {/* Tasks Status Summary */}
                <div style={{ marginBottom: sp.md }}>
                  <h4 style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[800], margin: 0, marginBottom: sp.sm }}>Tasks Status</h4>
                  <div style={{ background: C.neutral[50], border: `1px solid ${C.neutral[200]}`, borderRadius: 8, padding: sp.sm }}>
                    {selectedPlan.tasks.map(task => {
                      const isDone = task.status === 'done';
                      const isInProgress = task.status === 'in-progress';
                      return (
                        <div key={task.id} style={{ display: 'flex', alignItems: 'center', gap: sp.sm, padding: sp.xs, borderBottom: `1px solid ${C.neutral[100]}` }}>
                          <div style={{ width: 20, height: 20, borderRadius: '50%', background: isDone ? C.success[500] : isInProgress ? C.brand[500] : C.neutral[300], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                            {isDone && <CheckCircle style={{ width: 12, height: 12, color: 'white' }} />}
                            {isInProgress && <Clock style={{ width: 12, height: 12, color: 'white' }} />}
                          </div>
                          <div style={{ flex: 1 }}>
                            <span style={{ fontSize: '13px', color: C.neutral[700] }}>{task.title}</span>
                          </div>
                          <span style={{ fontSize: '11px', color: isDone ? C.success[600] : isInProgress ? C.brand[600] : C.neutral[500], fontWeight: 500 }}>
                            {isDone ? 'Completed' : isInProgress ? 'In Progress' : 'Not Started'}
                          </span>
                        </div>
                      );
                    })}
                  </div>
                  <p style={{ fontSize: '12px', color: C.neutral[500], margin: 0, marginTop: sp.xs }}>
                    Changes from completed tasks will remain in effect.
                  </p>
                </div>
                
                {/* Reason */}
                <div style={{ marginBottom: sp.md }}>
                  <h4 style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[800], margin: 0, marginBottom: sp.sm }}>Reason for Stopping</h4>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                    {[
                      { id: 'changed', label: 'Situation changed (no longer needed)' },
                      { id: 'not-working', label: 'Plan not achieving desired outcome' },
                      { id: 'priority', label: 'Higher priority emerged' },
                      { id: 'conflict', label: 'Resource conflict' },
                      { id: 'other', label: 'Other' }
                    ].map(opt => (
                      <label key={opt.id} style={{ display: 'flex', alignItems: 'center', gap: sp.sm, padding: sp.xs, cursor: 'pointer', borderRadius: 4 }} onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[50]} onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}>
                        <input type="radio" name="stopReason" checked={stopReason === opt.id} onChange={() => setStopReason(opt.id)} />
                        <span style={{ fontSize: '13px', color: C.neutral[700] }}>{opt.label}</span>
                      </label>
                    ))}
                  </div>
                </div>
                
                {/* Notes */}
                <div style={{ marginBottom: sp.md }}>
                  <h4 style={{ fontSize: '14px', fontWeight: 500, color: C.neutral[800], margin: 0, marginBottom: sp.sm }}>Notes (for next plan)</h4>
                  <textarea
                    value={stopNotes}
                    onChange={(e) => setStopNotes(e.target.value)}
                    placeholder="Describe what happened and any recommendations for the next plan..."
                    style={{ width: '100%', padding: sp.sm, fontSize: '13px', border: `1px solid ${C.neutral[300]}`, borderRadius: 6, resize: 'vertical', minHeight: 80, fontFamily: 'inherit', boxSizing: 'border-box' }}
                  />
                </div>
                
                {/* Suggested Next Steps */}
                <div style={{ background: C.brand[50], border: `1px solid ${C.brand[200]}`, borderRadius: 8, padding: sp.md }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.sm }}>
                    <Lightbulb style={{ width: 16, height: 16, color: C.brand[600] }} />
                    <h4 style={{ fontSize: '13px', fontWeight: 500, color: C.brand[800], margin: 0 }}>Suggested Next Steps</h4>
                  </div>
                  <p style={{ fontSize: '12px', color: C.brand[700], margin: 0, marginBottom: sp.sm }}>
                    Based on current state, you may want to:
                  </p>
                  <ul style={{ margin: 0, paddingLeft: 20, fontSize: '12px', color: C.brand[700] }}>
                    <li>Review incomplete tasks and current system state</li>
                    <li>Create a new plan addressing the updated situation</li>
                    <li>Check Insights for new recommendations</li>
                  </ul>
                </div>
              </div>
              
              {/* Footer */}
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: sp.md, borderTop: `1px solid ${C.neutral[200]}`, background: C.neutral[50] }}>
                <button onClick={() => setStopPlanModal({ isOpen: false, planId: null })} style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, background: 'white', color: C.neutral[700], border: `1px solid ${C.neutral[300]}`, borderRadius: 6, cursor: 'pointer' }}>
                  Cancel
                </button>
                <button
                  onClick={() => {
                    const completedTasks = selectedPlan.tasks.filter(t => t.status === 'done').length;
                    const newStatus = completedTasks > 0 ? 'partial' : 'abandoned';
                    setAllPlans(allPlans.map(p => p.id === selectedPlan.id ? { ...p, status: newStatus, outcome: newStatus, stopReason: stopReason, notes: stopNotes, duration: '—' } : p));
                    setStopPlanModal({ isOpen: false, planId: null });
                    setStopReason('');
                    setStopNotes('');
                    setViewMode('list');
                    setSelectedPlanId(null);
                  }}
                  disabled={!stopReason}
                  style={{ padding: `${sp.sm} ${sp.lg}`, fontSize: '13px', fontWeight: 500, background: stopReason ? C.error[500] : C.neutral[300], color: 'white', border: 'none', borderRadius: 6, cursor: stopReason ? 'pointer' : 'not-allowed', display: 'flex', alignItems: 'center', gap: sp.xs }}
                >
                  Stop Plan
                </button>
              </div>
            </div>
          </div>
        )}
        
        {/* Complete Plan Modal */}
        {completePlanModal.isOpen && selectedPlan && (() => {
          // Calculate task completion stats
          const tasks = selectedPlan.tasks || [];
          const doneTasks = tasks.filter(t => t.status === 'done');
          const inProgressTasks = tasks.filter(t => t.status === 'in-progress');
          const todoTasks = tasks.filter(t => t.status === 'todo');
          
          // Calculate action stats per task
          const getTaskActionStats = (task) => {
            const actions = task.actions || [];
            const applied = actions.filter(a => a.status === 'applied').length;
            const total = actions.length;
            return { applied, total, pending: total - applied };
          };
          
          // Total actions across all tasks
          const totalActions = tasks.reduce((sum, t) => sum + (t.actions?.length || 0), 0);
          const appliedActions = tasks.reduce((sum, t) => sum + (t.actions?.filter(a => a.status === 'applied').length || 0), 0);
          const pendingActions = totalActions - appliedActions;
          
          // Success criteria stats
          const criteria = selectedPlan.successCriteria || [];
          const metCriteria = criteria.filter(c => c.met).length;
          const unmetCriteria = criteria.length - metCriteria;
          
          // Determine completion state
          const hasIncompleteWork = pendingActions > 0 || todoTasks.length > 0 || inProgressTasks.length > 0 || unmetCriteria > 0;
          const isFullSuccess = !hasIncompleteWork && criteria.length > 0 && metCriteria === criteria.length;
          
          // Exploratory scenario preview data (would be computed from actual system state)
          const exploratoryPreview = {
            before: { staff: 76, zones: 74, schedule: 91, equip: 94 },
            after: { staff: 82, zones: 78, schedule: 89, equip: 92 },
            alertsResolved: 2,
            alertsNew: 1,
            remainingRootCauses: [
              { id: 'rc1', title: 'Z04 putaway bottleneck', severity: 'medium' },
              { id: 'rc2', title: 'Z07 partial activation', severity: 'low' }
            ]
          };
          
          const handleCompletePlan = (followOnAction) => {
            // Determine outcome based on criteria
            const outcome = isFullSuccess ? 'success' : 'partial';
            
            // Update the plan
            setAllPlans(allPlans.map(p => p.id === selectedPlan.id ? {
              ...p,
              status: 'completed',
              outcome,
              completionNotes,
              duration: '2h 15m',
              completedAt: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })
            } : p));
            
            let newPlanId = null;
            
            if (followOnAction === 'follow-on' || followOnAction === 'handoff') {
              // Create follow-on plan with incomplete work
              const incompleteTasksCopy = [...inProgressTasks, ...todoTasks].map(t => ({
                ...t,
                id: `followon-${t.id}`,
                status: 'todo',
                startedAt: null,
                completedAt: null,
                actions: (t.actions || []).filter(a => a.status !== 'applied').map(a => ({
                  ...a,
                  id: `followon-${a.id}`,
                  status: 'pending',
                  actual: null,
                  appliedAt: null
                }))
              }));
              
              // Add tasks for unmet criteria
              const criteriaTasksCopy = criteria.filter(c => !c.met).map((c, idx) => ({
                id: `followon-criteria-${idx}`,
                title: `Address: ${c.text}`,
                status: 'todo',
                assignee: { name: 'TBD' },
                type: 'follow-up',
                actions: []
              }));
              
              const isHandoff = followOnAction === 'handoff';
              const nextShift = 'Swing'; // Would be calculated based on current shift
              
              const newPlan = {
                id: `plan-${isHandoff ? 'handoff' : 'followon'}-${Date.now()}`,
                name: isHandoff ? `[Handoff] ${selectedPlan.name}` : `Follow-on: ${selectedPlan.name}`,
                status: 'draft',
                priority: selectedPlan.priority,
                progress: 0,
                createdAt: new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }),
                createdBy: isHandoff ? { name: `${nextShift} Shift Lead`, role: 'Shift Lead' } : selectedPlan.createdBy,
                targetCompletion: '—',
                shiftContext: isHandoff ? nextShift : 'Day',
                date: 'Dec 19',
                duration: null,
                outcome: null,
                origin: {
                  type: isHandoff ? 'handoff' : 'follow-on',
                  title: isHandoff ? `Handed off from: ${selectedPlan.name}` : `Follow-on from: ${selectedPlan.name}`,
                  parentPlanId: selectedPlan.id,
                  fromShift: isHandoff ? 'Day' : undefined
                },
                successCriteria: criteria.filter(c => !c.met).map(c => ({ ...c, id: `followon-${c.id}`, met: false })),
                tasks: [...incompleteTasksCopy, ...criteriaTasksCopy],
                projectedImpact: selectedPlan.projectedImpact
              };
              
              newPlanId = newPlan.id;
              setAllPlans(prev => [newPlan, ...prev]);
              setSelectedPlanId(newPlan.id);
              
              // Activate scenario mode for draft plan
              if (activateDraftPlanScenario) {
                activateDraftPlanScenario(newPlan.id, newPlan.name, newPlan.projectedImpact);
              }
              
              // Show completion banner
              setCompletionBanner({
                show: true,
                planName: selectedPlan.name,
                action: isHandoff ? 'handoff' : 'follow-on',
                followOnPlanId: newPlan.id,
                followOnPlanName: newPlan.name
              });
              
              // Auto-hide banner after 8 seconds
              setTimeout(() => setCompletionBanner({ show: false, planName: '', action: '', followOnPlanId: null }), 8000);
            } else {
              // Close anyway or complete (full success)
              setCompletionBanner({
                show: true,
                planName: selectedPlan.name,
                action: followOnAction === 'close' ? 'closed' : 'completed',
                followOnPlanId: null
              });
              setTimeout(() => setCompletionBanner({ show: false, planName: '', action: '', followOnPlanId: null }), 5000);
            }
            
            setCompletePlanModal({ isOpen: false, planId: null });
            setCompletionNotes('');
            setShowExploratoryPreview(false);
            
            if (followOnAction !== 'follow-on' && followOnAction !== 'handoff') {
              setViewMode('list');
              setSelectedPlanId(null);
            }
          };
          
          return (
            <div style={{ position: 'fixed', inset: 0, zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'rgba(0,0,0,0.5)' }} onClick={() => setCompletePlanModal({ isOpen: false, planId: null })}>
              <div style={{ width: 640, maxHeight: '90vh', background: 'white', borderRadius: 12, boxShadow: '0 8px 32px rgba(0,0,0,0.2)', display: 'flex', flexDirection: 'column', overflow: 'hidden' }} onClick={e => e.stopPropagation()}>
                {/* Header */}
                <div style={{ padding: sp.md, borderBottom: `1px solid ${C.neutral[200]}`, background: C.success[50] }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                    <div>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.xs }}>
                        <CheckCircle style={{ width: 20, height: 20, color: C.success[600] }} />
                        <span style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[800] }}>Complete Plan</span>
                      </div>
                      <p style={{ fontSize: '14px', color: C.neutral[600], margin: 0 }}>{selectedPlan.name}</p>
                    </div>
                    <button onClick={() => setCompletePlanModal({ isOpen: false, planId: null })} style={{ width: 32, height: 32, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'transparent', border: 'none', borderRadius: 6, cursor: 'pointer' }}>
                      <X style={{ width: 18, height: 18, color: C.neutral[500] }} />
                    </button>
                  </div>
                </div>
                
                {/* Content */}
                <div style={{ flex: 1, overflowY: 'auto', padding: sp.md }}>
                  {/* Tasks Summary */}
                  <div style={{ marginBottom: sp.md, padding: sp.md, background: C.neutral[50], borderRadius: 8, border: `1px solid ${C.neutral[200]}` }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
                      <h4 style={{ fontSize: '13px', fontWeight: 600, color: C.neutral[700], margin: 0, textTransform: 'uppercase', letterSpacing: '0.5px' }}>Tasks Summary</h4>
                      <span style={{ fontSize: '13px', fontWeight: 600, color: doneTasks.length === tasks.length ? C.success[600] : C.warning[600] }}>
                        {doneTasks.length}/{tasks.length} ({tasks.length > 0 ? Math.round((doneTasks.length / tasks.length) * 100) : 0}%)
                      </span>
                    </div>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                      {tasks.map(task => {
                        const stats = getTaskActionStats(task);
                        const statusIcon = task.status === 'done' ? CheckCircle : task.status === 'in-progress' ? Clock : task.status === 'incomplete' ? X : Circle;
                        const StatusIcon = statusIcon;
                        const statusColor = task.status === 'done' ? C.success : task.status === 'in-progress' ? C.brand : task.status === 'incomplete' ? C.error : C.neutral;
                        
                        return (
                          <div key={task.id} style={{ display: 'flex', alignItems: 'flex-start', gap: sp.sm, padding: sp.sm, background: 'white', borderRadius: 6, border: `1px solid ${C.neutral[200]}` }}>
                            <StatusIcon style={{ width: 16, height: 16, color: statusColor[500], marginTop: 2, flexShrink: 0 }} />
                            <div style={{ flex: 1 }}>
                              <div style={{ fontSize: '13px', fontWeight: 500, color: C.neutral[800] }}>{task.title}</div>
                              <div style={{ fontSize: '11px', color: C.neutral[500], marginTop: 2 }}>
                                {stats.total > 0 ? (
                                  <span style={{ color: stats.applied === stats.total ? C.success[600] : stats.applied > 0 ? C.warning[600] : C.neutral[500] }}>
                                    {stats.applied}/{stats.total} actions applied
                                    {stats.pending > 0 && <span style={{ color: C.warning[600] }}> · {stats.pending} pending</span>}
                                  </span>
                                ) : (
                                  <span>No actions defined</span>
                                )}
                              </div>
                            </div>
                            <span style={{ fontSize: '11px', fontWeight: 500, color: statusColor[600], textTransform: 'capitalize' }}>
                              {task.status.replace('-', ' ')}
                            </span>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                  
                  {/* Success Criteria */}
                  {criteria.length > 0 && (
                    <div style={{ marginBottom: sp.md, padding: sp.md, background: C.neutral[50], borderRadius: 8, border: `1px solid ${C.neutral[200]}` }}>
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
                        <h4 style={{ fontSize: '13px', fontWeight: 600, color: C.neutral[700], margin: 0, textTransform: 'uppercase', letterSpacing: '0.5px' }}>Success Criteria</h4>
                        <span style={{ fontSize: '13px', fontWeight: 600, color: metCriteria === criteria.length ? C.success[600] : C.warning[600] }}>
                          {metCriteria}/{criteria.length} met
                        </span>
                      </div>
                      <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                        {criteria.map(c => (
                          <div key={c.id} style={{ display: 'flex', alignItems: 'center', gap: sp.sm, padding: sp.sm, background: 'white', borderRadius: 6, border: `1px solid ${c.met ? C.success[200] : C.warning[200]}` }}>
                            {c.met ? (
                              <CheckCircle style={{ width: 16, height: 16, color: C.success[500], flexShrink: 0 }} />
                            ) : (
                              <X style={{ width: 16, height: 16, color: C.warning[500], flexShrink: 0 }} />
                            )}
                            <span style={{ fontSize: '13px', color: c.met ? C.success[700] : C.warning[700], flex: 1 }}>{c.text}</span>
                            <span style={{ fontSize: '11px', fontWeight: 500, color: c.met ? C.success[600] : C.warning[600] }}>
                              {c.met ? 'Met' : 'Not Met'}
                            </span>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                  
                  {/* Completion Notes */}
                  <div style={{ marginBottom: sp.md }}>
                    <label style={{ display: 'block', fontSize: '13px', fontWeight: 600, color: C.neutral[700], marginBottom: sp.xs }}>Completion Notes</label>
                    <textarea
                      value={completionNotes}
                      onChange={(e) => setCompletionNotes(e.target.value)}
                      placeholder="Add any notes about the plan execution, lessons learned, or context for future reference..."
                      rows={3}
                      style={{ width: '100%', padding: sp.sm, fontSize: '13px', border: `1px solid ${C.neutral[300]}`, borderRadius: 6, resize: 'vertical', fontFamily: 'inherit' }}
                    />
                  </div>
                  
                  {/* Incomplete Work Warning */}
                  {hasIncompleteWork && (
                    <div style={{ marginBottom: sp.md, padding: sp.md, background: C.warning[50], borderRadius: 8, border: `1px solid ${C.warning[200]}` }}>
                      <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.sm, marginBottom: sp.md }}>
                        <AlertTriangle style={{ width: 20, height: 20, color: C.warning[600], flexShrink: 0 }} />
                        <div>
                          <h4 style={{ fontSize: '14px', fontWeight: 600, color: C.warning[800], margin: 0, marginBottom: 4 }}>Incomplete Work Detected</h4>
                          <p style={{ fontSize: '12px', color: C.warning[700], margin: 0 }}>
                            {pendingActions > 0 && `${pendingActions} actions pending`}
                            {pendingActions > 0 && (todoTasks.length > 0 || inProgressTasks.length > 0) && ' · '}
                            {(todoTasks.length + inProgressTasks.length) > 0 && `${todoTasks.length + inProgressTasks.length} tasks not completed`}
                            {((pendingActions > 0) || (todoTasks.length + inProgressTasks.length > 0)) && unmetCriteria > 0 && ' · '}
                            {unmetCriteria > 0 && `${unmetCriteria} criteria unmet`}
                          </p>
                        </div>
                      </div>
                      
                      <p style={{ fontSize: '13px', color: C.neutral[700], marginBottom: sp.sm }}>What would you like to do with the remaining work?</p>
                      
                      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm }}>
                        <button
                          onClick={() => handleCompletePlan('follow-on')}
                          style={{ padding: sp.sm, background: 'white', border: `1px solid ${C.brand[300]}`, borderRadius: 6, cursor: 'pointer', textAlign: 'center' }}
                        >
                          <ClipboardList style={{ width: 20, height: 20, color: C.brand[600], margin: '0 auto 4px' }} />
                          <div style={{ fontSize: '12px', fontWeight: 600, color: C.brand[700] }}>Create Follow-On</div>
                          <div style={{ fontSize: '10px', color: C.neutral[500] }}>New plan with remaining work</div>
                        </button>
                        <button
                          onClick={() => handleCompletePlan('handoff')}
                          style={{ padding: sp.sm, background: 'white', border: `1px solid ${C.purple[300]}`, borderRadius: 6, cursor: 'pointer', textAlign: 'center' }}
                        >
                          <RefreshCw style={{ width: 20, height: 20, color: C.purple[600], margin: '0 auto 4px' }} />
                          <div style={{ fontSize: '12px', fontWeight: 600, color: C.purple[700] }}>Hand Off</div>
                          <div style={{ fontSize: '10px', color: C.neutral[500] }}>Transfer to next shift</div>
                        </button>
                        <button
                          onClick={() => handleCompletePlan('close')}
                          style={{ padding: sp.sm, background: 'white', border: `1px solid ${C.neutral[300]}`, borderRadius: 6, cursor: 'pointer', textAlign: 'center' }}
                        >
                          <CheckCircle style={{ width: 20, height: 20, color: C.neutral[500], margin: '0 auto 4px' }} />
                          <div style={{ fontSize: '12px', fontWeight: 600, color: C.neutral[700] }}>Close Anyway</div>
                          <div style={{ fontSize: '10px', color: C.neutral[500] }}>Document and archive</div>
                        </button>
                      </div>
                    </div>
                  )}
                  
                  {/* Exploratory Scenario Section */}
                  <div style={{ padding: sp.md, background: C.purple[50], borderRadius: 8, border: `1px solid ${C.purple[200]}` }}>
                    <div 
                      onClick={() => setShowExploratoryPreview(!showExploratoryPreview)}
                      style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', cursor: 'pointer' }}
                    >
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                        <Lightbulb style={{ width: 20, height: 20, color: C.purple[600] }} />
                        <div>
                          <h4 style={{ fontSize: '14px', fontWeight: 600, color: C.purple[800], margin: 0 }}>Run Exploratory Scenario</h4>
                          <p style={{ fontSize: '12px', color: C.purple[600], margin: 0 }}>See updated system state and new Insights based on changes made</p>
                        </div>
                      </div>
                      <ChevronRight style={{ width: 18, height: 18, color: C.purple[500], transform: showExploratoryPreview ? 'rotate(90deg)' : 'none', transition: 'transform 0.15s' }} />
                    </div>
                    
                    {showExploratoryPreview && (
                      <div style={{ marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.purple[200]}` }}>
                        {/* Score Changes */}
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm, marginBottom: sp.md }}>
                          {[
                            { key: 'staff', label: 'Staff', icon: Users },
                            { key: 'zones', label: 'Zones', icon: MapPin },
                            { key: 'schedule', label: 'Schedule', icon: Calendar },
                            { key: 'equip', label: 'Equipment', icon: Wrench }
                          ].map(cat => {
                            const before = exploratoryPreview.before[cat.key];
                            const after = exploratoryPreview.after[cat.key];
                            const delta = after - before;
                            const Icon = cat.icon;
                            
                            return (
                              <div key={cat.key} style={{ padding: sp.sm, background: 'white', borderRadius: 6, border: `1px solid ${C.purple[200]}`, textAlign: 'center' }}>
                                <Icon style={{ width: 14, height: 14, color: C.purple[500], marginBottom: 4 }} />
                                <div style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{cat.label}</div>
                                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 4 }}>
                                  <span style={{ fontSize: '12px', color: C.neutral[400] }}>{before}</span>
                                  <ArrowRight style={{ width: 10, height: 10, color: C.neutral[300] }} />
                                  <span style={{ fontSize: '14px', fontWeight: 600, color: delta > 0 ? C.success[600] : delta < 0 ? C.warning[600] : C.neutral[700] }}>{after}</span>
                                </div>
                                {delta !== 0 && (
                                  <span style={{ fontSize: '10px', color: delta > 0 ? C.success[600] : C.warning[600] }}>
                                    ({delta > 0 ? '+' : ''}{delta})
                                  </span>
                                )}
                              </div>
                            );
                          })}
                        </div>
                        
                        {/* Alerts Summary */}
                        <div style={{ display: 'flex', gap: sp.md, marginBottom: sp.md }}>
                          <div style={{ flex: 1, padding: sp.sm, background: C.success[50], borderRadius: 6, border: `1px solid ${C.success[200]}` }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                              <CheckCircle style={{ width: 14, height: 14, color: C.success[600] }} />
                              <span style={{ fontSize: '12px', color: C.success[700] }}><strong>{exploratoryPreview.alertsResolved}</strong> alerts resolved</span>
                            </div>
                          </div>
                          <div style={{ flex: 1, padding: sp.sm, background: C.warning[50], borderRadius: 6, border: `1px solid ${C.warning[200]}` }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                              <AlertTriangle style={{ width: 14, height: 14, color: C.warning[600] }} />
                              <span style={{ fontSize: '12px', color: C.warning[700] }}><strong>{exploratoryPreview.alertsNew}</strong> new alert emerged</span>
                            </div>
                          </div>
                        </div>
                        
                        {/* Remaining Root Causes */}
                        {exploratoryPreview.remainingRootCauses.length > 0 && (
                          <div style={{ marginBottom: sp.md }}>
                            <div style={{ fontSize: '11px', fontWeight: 600, color: C.neutral[600], marginBottom: sp.xs, textTransform: 'uppercase', letterSpacing: '0.5px' }}>Remaining Root Causes</div>
                            {exploratoryPreview.remainingRootCauses.map(rc => (
                              <div key={rc.id} style={{ display: 'flex', alignItems: 'center', gap: sp.xs, padding: sp.xs, background: 'white', borderRadius: 4, border: `1px solid ${C.neutral[200]}`, marginBottom: 4 }}>
                                <div style={{ width: 6, height: 6, borderRadius: '50%', background: rc.severity === 'high' ? C.error[500] : rc.severity === 'medium' ? C.warning[500] : C.neutral[400] }} />
                                <span style={{ fontSize: '12px', color: C.neutral[700] }}>{rc.title}</span>
                              </div>
                            ))}
                          </div>
                        )}
                        
                        <button
                          onClick={() => {
                            setCompletePlanModal({ isOpen: false, planId: null });
                            onViewInsights();
                          }}
                          style={{ width: '100%', padding: sp.sm, fontSize: '13px', fontWeight: 500, background: C.purple[500], color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.xs }}
                        >
                          View Full Analysis
                          <ChevronRight style={{ width: 14, height: 14 }} />
                        </button>
                      </div>
                    )}
                  </div>
                </div>
                
                {/* Footer */}
                <div style={{ padding: sp.md, borderTop: `1px solid ${C.neutral[200]}`, background: C.neutral[50], display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <button
                    onClick={() => setCompletePlanModal({ isOpen: false, planId: null })}
                    style={{ padding: `${sp.sm} ${sp.md}`, fontSize: '13px', fontWeight: 500, background: 'white', color: C.neutral[700], border: `1px solid ${C.neutral[300]}`, borderRadius: 6, cursor: 'pointer' }}
                  >
                    Cancel
                  </button>
                  {!hasIncompleteWork && (
                    <button
                      onClick={() => handleCompletePlan('complete')}
                      style={{ padding: `${sp.sm} ${sp.lg}`, fontSize: '13px', fontWeight: 500, background: C.success[500], color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}
                    >
                      <CheckCircle style={{ width: 14, height: 14 }} />
                      Complete Plan
                    </button>
                  )}
                </div>
              </div>
            </div>
          );
        })()}
      </div>
    );
  }
  
  return null;
};

// Financial Tab Content - Facility level financial overview
const FinancialTabContent = ({ onViewInsights, onNavigateToAlert, onNavigateToCostCategory }) => {
  const [financialPeriod, setFinancialPeriod] = React.useState('mtd');
  const [financialComparison, setFinancialComparison] = React.useState('budget');
  
  // Financial Mock Data
  const financialData = {
    periods: {
      mtd: { label: 'Month to Date', days: 17, totalDays: 31 },
      qtd: { label: 'Quarter to Date', days: 78, totalDays: 92 },
      ytd: { label: 'Year to Date', days: 352, totalDays: 365 }
    },
    summary: {
      mtd: {
        totalOpEx: 847500,
        budget: 830000,
        priorPeriod: 812000,
        costPerOrder: 4.23,
        costPerOrderBudget: 4.00,
        costPerOrderPrior: 4.15,
        costPerUnit: 1.68,
        ordersProcessed: 200354,
        unitsHandled: 504464,
        laborCostPct: 58,
        fulfillmentPctRevenue: 12.4,
        forecast: 1540000,
        forecastBudget: 1500000
      },
      qtd: {
        totalOpEx: 2485000,
        budget: 2450000,
        priorPeriod: 2380000,
        costPerOrder: 4.18,
        costPerOrderBudget: 4.00,
        costPerOrderPrior: 4.10,
        costPerUnit: 1.65,
        ordersProcessed: 594498,
        unitsHandled: 1506061,
        laborCostPct: 57,
        fulfillmentPctRevenue: 12.2,
        forecast: 2920000,
        forecastBudget: 2900000
      },
      ytd: {
        totalOpEx: 9234000,
        budget: 9100000,
        priorPeriod: 8750000,
        costPerOrder: 4.12,
        costPerOrderBudget: 4.00,
        costPerOrderPrior: 4.05,
        costPerUnit: 1.62,
        ordersProcessed: 2241262,
        unitsHandled: 5699383,
        laborCostPct: 56,
        fulfillmentPctRevenue: 12.1,
        forecast: 9580000,
        forecastBudget: 9400000
      }
    },
    costBreakdown: {
      mtd: [
        { category: 'Direct Labor', amount: 389550, pct: 46, budget: 375000, prior: 368000, icon: Users },
        { category: 'Indirect Labor', amount: 101700, pct: 12, budget: 100000, prior: 97000, icon: Users },
        { category: 'Facility', amount: 169500, pct: 20, budget: 170000, prior: 168000, icon: MapPin },
        { category: 'Equipment', amount: 84750, pct: 10, budget: 82000, prior: 80000, icon: Truck },
        { category: 'Materials', amount: 59325, pct: 7, budget: 60000, prior: 58000, icon: Package },
        { category: 'Technology', amount: 25425, pct: 3, budget: 25000, prior: 24000, icon: Settings },
        { category: 'Other', amount: 17250, pct: 2, budget: 18000, prior: 17000, icon: MoreHorizontal }
      ]
    },
    monthlyTrend: [
      { month: 'Jul', actual: 795000, budget: 800000, prior: 760000 },
      { month: 'Aug', actual: 810000, budget: 810000, prior: 775000 },
      { month: 'Sep', actual: 825000, budget: 815000, prior: 790000 },
      { month: 'Oct', actual: 838000, budget: 820000, prior: 802000 },
      { month: 'Nov', actual: 855000, budget: 825000, prior: 815000 },
      { month: 'Dec', actual: 847500, budget: 830000, prior: 812000, current: true }
    ],
    alerts: [
      { id: 'fin-1', type: 'warning', message: 'Labor costs 3.9% over budget', category: 'Direct Labor', amount: 14550 },
      { id: 'fin-2', type: 'info', message: 'Equipment maintenance trending up', category: 'Equipment', amount: 2750 },
      { id: 'fin-3', type: 'success', message: 'Materials costs under budget', category: 'Materials', amount: -675 }
    ],
    costPerOrderTrend: [
      { month: 'Jul', value: 4.05, budget: 4.00 },
      { month: 'Aug', value: 4.08, budget: 4.00 },
      { month: 'Sep', value: 4.12, budget: 4.00 },
      { month: 'Oct', value: 4.15, budget: 4.00 },
      { month: 'Nov', value: 4.20, budget: 4.00 },
      { month: 'Dec', value: 4.23, budget: 4.00, current: true }
    ]
  };
  
  const periodData = financialData.summary[financialPeriod];
  const periodInfo = financialData.periods[financialPeriod];
  const breakdown = financialData.costBreakdown.mtd;
  
  const getVariance = (actual, compare) => actual - compare;
  const getVariancePct = (actual, compare) => ((actual - compare) / compare * 100).toFixed(1);
  const formatCurrency = (val) => val >= 1000000 ? `$${(val/1000000).toFixed(2)}M` : `$${(val/1000).toFixed(0)}K`;
  
  const comparisonValue = financialComparison === 'budget' ? periodData.budget : periodData.priorPeriod;
  const comparisonLabel = financialComparison === 'budget' ? 'Budget' : 'Prior Period';
  const variance = getVariance(periodData.totalOpEx, comparisonValue);
  const variancePct = getVariancePct(periodData.totalOpEx, comparisonValue);
  const isUnfavorable = variance > 0;
  
  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.md }}>
      {/* Header */}
      <div style={{ display: 'flex', alignItems: 'center', gap: sp.md, marginBottom: sp.sm }}>
        <div style={{ width: 36, height: 36, borderRadius: 8, background: C.success[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
          <DollarSign style={{ width: 20, height: 20, color: C.success[600] }} />
        </div>
        <div style={{ flex: 1 }}>
          <h2 style={{ fontSize: '18px', fontWeight: 500, margin: 0 }}>Financial Overview</h2>
          <p style={{ fontSize: '12px', color: C.neutral[500], margin: 0 }}>Operating costs, budget variance, and financial trends</p>
        </div>
        <div style={{ display: 'flex', gap: sp.sm }}>
          {/* Time Period Selector */}
          <div style={{ display: 'flex', background: C.neutral[100], borderRadius: 6, padding: 2 }}>
            {['mtd', 'qtd', 'ytd'].map(period => (
              <button
                key={period}
                onClick={() => setFinancialPeriod(period)}
                style={{
                  padding: '6px 12px',
                  fontSize: '12px',
                  fontWeight: 500,
                  border: 'none',
                  borderRadius: 4,
                  cursor: 'pointer',
                  background: financialPeriod === period ? 'white' : 'transparent',
                  color: financialPeriod === period ? C.brand[600] : C.neutral[600],
                  boxShadow: financialPeriod === period ? '0 1px 3px rgba(0,0,0,0.1)' : 'none',
                  transition: 'all 0.15s'
                }}
              >
                {period.toUpperCase()}
              </button>
            ))}
          </div>
          {/* Comparison Selector */}
          <select
            value={financialComparison}
            onChange={(e) => setFinancialComparison(e.target.value)}
            style={{
              padding: '6px 10px',
              fontSize: '12px',
              border: `1px solid ${C.neutral[300]}`,
              borderRadius: 6,
              background: 'white',
              color: C.neutral[700],
              cursor: 'pointer'
            }}
          >
            <option value="budget">vs Budget</option>
            <option value="prior">vs Prior Period</option>
          </select>
        </div>
      </div>
      
      {/* Summary Cards Row */}
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
        {/* Total OpEx */}
        <Card>
          <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Total Operating Costs</p>
          <p style={{ fontSize: '22px', fontWeight: 500, margin: 0 }}>{formatCurrency(periodData.totalOpEx)}</p>
          <div style={{ display: 'flex', alignItems: 'center', gap: 4, marginTop: 4 }}>
            {isUnfavorable ? 
              <TrendingUp style={{ width: 12, height: 12, color: C.error[500] }} /> :
              <TrendingDown style={{ width: 12, height: 12, color: C.success[500] }} />
            }
            <span style={{ fontSize: '11px', color: isUnfavorable ? C.error[600] : C.success[600] }}>
              {isUnfavorable ? '+' : ''}{variancePct}% vs {comparisonLabel.toLowerCase()}
            </span>
          </div>
        </Card>
        
        {/* Cost Per Order */}
        <Card>
          <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Cost Per Order</p>
          <p style={{ fontSize: '22px', fontWeight: 500, margin: 0, color: periodData.costPerOrder > periodData.costPerOrderBudget ? C.warning[600] : C.success[600] }}>
            ${periodData.costPerOrder.toFixed(2)}
          </p>
          <p style={{ fontSize: '10px', color: C.neutral[400] }}>Target: ${periodData.costPerOrderBudget.toFixed(2)}</p>
        </Card>
        
        {/* Budget Variance */}
        <Card style={{ borderLeft: `4px solid ${isUnfavorable ? C.error[500] : C.success[500]}` }}>
          <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Budget Variance</p>
          <p style={{ fontSize: '22px', fontWeight: 500, margin: 0, color: isUnfavorable ? C.error[600] : C.success[600] }}>
            {isUnfavorable ? '+' : ''}{formatCurrency(Math.abs(variance))}
          </p>
          <p style={{ fontSize: '10px', color: isUnfavorable ? C.error[500] : C.success[500] }}>
            {isUnfavorable ? 'Over budget' : 'Under budget'}
          </p>
        </Card>
        
        {/* Forecast */}
        <Card>
          <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>EOM Forecast</p>
          <p style={{ fontSize: '22px', fontWeight: 500, margin: 0 }}>{formatCurrency(periodData.forecast)}</p>
          <p style={{ fontSize: '10px', color: periodData.forecast > periodData.forecastBudget ? C.warning[500] : C.success[500] }}>
            Budget: {formatCurrency(periodData.forecastBudget)}
          </p>
        </Card>
      </div>
      
      {/* Cost Breakdown */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
          <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Cost Breakdown</h3>
          <span style={{ fontSize: '11px', color: C.neutral[500] }}>{periodInfo.label}</span>
        </div>
        
        {/* Donut Chart + Legend */}
        <div style={{ display: 'flex', gap: sp.lg, marginBottom: sp.md }}>
          <div style={{ width: 140, height: 140, position: 'relative' }}>
            <svg width="140" height="140" viewBox="0 0 140 140">
              {(() => {
                let cumulative = 0;
                const colors = [C.purple[500], C.purple[300], C.brand[500], C.warning[500], C.success[500], C.blueLight[500], C.neutral[400]];
                return breakdown.map((item, i) => {
                  const start = cumulative;
                  cumulative += item.pct;
                  const startAngle = (start / 100) * 360 - 90;
                  const endAngle = (cumulative / 100) * 360 - 90;
                  const largeArc = item.pct > 50 ? 1 : 0;
                  const startX = 70 + 50 * Math.cos(startAngle * Math.PI / 180);
                  const startY = 70 + 50 * Math.sin(startAngle * Math.PI / 180);
                  const endX = 70 + 50 * Math.cos(endAngle * Math.PI / 180);
                  const endY = 70 + 50 * Math.sin(endAngle * Math.PI / 180);
                  return (
                    <path
                      key={i}
                      d={`M 70 70 L ${startX} ${startY} A 50 50 0 ${largeArc} 1 ${endX} ${endY} Z`}
                      fill={colors[i % colors.length]}
                      style={{ cursor: 'pointer', transition: 'opacity 0.15s' }}
                    />
                  );
                });
              })()}
              <circle cx="70" cy="70" r="30" fill="white" />
            </svg>
            <div style={{ position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', textAlign: 'center' }}>
              <p style={{ fontSize: '14px', fontWeight: 600, margin: 0 }}>{formatCurrency(periodData.totalOpEx)}</p>
              <p style={{ fontSize: '9px', color: C.neutral[500] }}>Total</p>
            </div>
          </div>
          
          {/* Legend */}
          <div style={{ flex: 1, display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.xs }}>
            {(() => {
              const colors = [C.purple[500], C.purple[300], C.brand[500], C.warning[500], C.success[500], C.blueLight[500], C.neutral[400]];
              return breakdown.map((item, i) => (
                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                  <div style={{ width: 10, height: 10, borderRadius: 2, background: colors[i % colors.length] }} />
                  <span style={{ fontSize: '11px', color: C.neutral[600] }}>{item.category} ({item.pct}%)</span>
                </div>
              ));
            })()}
          </div>
        </div>
        
        {/* Breakdown Table */}
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
          <div style={{ display: 'grid', gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr', gap: sp.sm, padding: `${sp.xs} ${sp.sm}`, background: C.neutral[50], borderRadius: 4 }}>
            <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500] }}>CATEGORY</span>
            <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textAlign: 'right' }}>ACTUAL</span>
            <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textAlign: 'right' }}>{comparisonLabel.toUpperCase()}</span>
            <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textAlign: 'right' }}>VARIANCE</span>
            <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textAlign: 'right' }}>VAR %</span>
          </div>
          {breakdown.map((item, i) => {
            const compareVal = financialComparison === 'budget' ? item.budget : item.prior;
            const itemVariance = item.amount - compareVal;
            const itemVariancePct = ((itemVariance / compareVal) * 100).toFixed(1);
            const Icon = item.icon;
            return (
              <div 
                key={i} 
                onClick={() => onNavigateToCostCategory && onNavigateToCostCategory(item.category)}
                style={{ 
                  display: 'grid', 
                  gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr', 
                  gap: sp.sm, 
                  padding: sp.sm,
                  background: 'white',
                  borderRadius: 6,
                  cursor: 'pointer',
                  transition: 'all 0.15s'
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.background = C.neutral[50];
                  e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.05)';
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.background = 'white';
                  e.currentTarget.style.boxShadow = 'none';
                }}
              >
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <Icon style={{ width: 14, height: 14, color: C.neutral[400] }} />
                  <span style={{ fontSize: '12px', fontWeight: 500 }}>{item.category}</span>
                </div>
                <span style={{ fontSize: '12px', textAlign: 'right' }}>{formatCurrency(item.amount)}</span>
                <span style={{ fontSize: '12px', textAlign: 'right', color: C.neutral[500] }}>{formatCurrency(compareVal)}</span>
                <span style={{ fontSize: '12px', textAlign: 'right', color: itemVariance > 0 ? C.error[600] : C.success[600] }}>
                  {itemVariance > 0 ? '+' : ''}{formatCurrency(Math.abs(itemVariance))}
                </span>
                <span style={{ fontSize: '12px', textAlign: 'right', color: itemVariance > 0 ? C.error[600] : C.success[600] }}>
                  {itemVariance > 0 ? '+' : ''}{itemVariancePct}%
                </span>
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* Cost Trends */}
      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: sp.md }}>
        {/* Monthly OpEx Trend */}
        <Card>
          <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Monthly Operating Costs</h3>
          <div style={{ height: 120, display: 'flex', alignItems: 'flex-end', gap: sp.xs }}>
            {financialData.monthlyTrend.map((month, i) => {
              const maxVal = Math.max(...financialData.monthlyTrend.map(m => Math.max(m.actual, m.budget)));
              const actualHeight = (month.actual / maxVal) * 100;
              const budgetHeight = (month.budget / maxVal) * 100;
              return (
                <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                  <div style={{ width: '100%', height: 100, display: 'flex', alignItems: 'flex-end', justifyContent: 'center', gap: 2 }}>
                    <div style={{ 
                      width: '35%', 
                      height: `${actualHeight}%`, 
                      background: month.current ? C.brand[500] : C.brand[300],
                      borderRadius: '3px 3px 0 0'
                    }} />
                    <div style={{ 
                      width: '35%', 
                      height: `${budgetHeight}%`, 
                      background: C.neutral[300],
                      borderRadius: '3px 3px 0 0'
                    }} />
                  </div>
                  <span style={{ fontSize: '9px', color: C.neutral[500], marginTop: 4 }}>{month.month}</span>
                </div>
              );
            })}
          </div>
          <div style={{ display: 'flex', gap: sp.md, marginTop: sp.sm, justifyContent: 'center' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
              <div style={{ width: 10, height: 10, background: C.brand[500], borderRadius: 2 }} />
              <span style={{ fontSize: '10px', color: C.neutral[500] }}>Actual</span>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
              <div style={{ width: 10, height: 10, background: C.neutral[300], borderRadius: 2 }} />
              <span style={{ fontSize: '10px', color: C.neutral[500] }}>Budget</span>
            </div>
          </div>
        </Card>
        
        {/* Cost Per Order Trend */}
        <Card>
          <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Cost Per Order Trend</h3>
          <div style={{ height: 120, position: 'relative' }}>
            {/* Target line */}
            <div style={{ 
              position: 'absolute', 
              left: 0, right: 0, 
              top: `${100 - ((4.00 / 4.30) * 100)}%`,
              borderTop: `2px dashed ${C.success[400]}`,
              zIndex: 1
            }}>
              <span style={{ 
                position: 'absolute', 
                right: 0, 
                top: -14, 
                fontSize: '9px', 
                color: C.success[600],
                background: 'white',
                padding: '0 4px'
              }}>
                Target $4.00
              </span>
            </div>
            
            {/* Line chart */}
            <svg width="100%" height="100" viewBox="0 0 300 100" preserveAspectRatio="none">
              <polyline
                fill="none"
                stroke={C.brand[500]}
                strokeWidth="2"
                points={financialData.costPerOrderTrend.map((d, i) => {
                  const x = (i / (financialData.costPerOrderTrend.length - 1)) * 280 + 10;
                  const y = 100 - ((d.value - 3.90) / 0.40) * 100;
                  return `${x},${y}`;
                }).join(' ')}
              />
              {financialData.costPerOrderTrend.map((d, i) => {
                const x = (i / (financialData.costPerOrderTrend.length - 1)) * 280 + 10;
                const y = 100 - ((d.value - 3.90) / 0.40) * 100;
                return (
                  <circle
                    key={i}
                    cx={x}
                    cy={y}
                    r={d.current ? 5 : 3}
                    fill={d.current ? C.brand[600] : C.brand[400]}
                  />
                );
              })}
            </svg>
            
            {/* X-axis labels */}
            <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: 4 }}>
              {financialData.costPerOrderTrend.map((d, i) => (
                <span key={i} style={{ fontSize: '9px', color: C.neutral[500] }}>{d.month}</span>
              ))}
            </div>
          </div>
        </Card>
      </div>
      
      {/* Financial Alerts */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
          <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Alerts & Insights</h3>
          <button
            onClick={() => onViewInsights && onViewInsights()}
            style={{
              padding: '4px 10px',
              fontSize: '11px',
              background: C.purple[50],
              color: C.purple[600],
              border: 'none',
              borderRadius: 4,
              cursor: 'pointer'
            }}
          >
            View All Insights
          </button>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {financialData.alerts.map((alert, i) => (
            <div 
              key={i}
              onClick={() => onNavigateToAlert && onNavigateToAlert(alert.id, 'financial', true)}
              style={{ 
                display: 'flex', 
                alignItems: 'center', 
                gap: sp.sm,
                padding: sp.sm,
                background: alert.type === 'warning' ? C.warning[50] : alert.type === 'success' ? C.success[50] : C.brand[50],
                borderRadius: 6,
                borderLeft: `4px solid ${alert.type === 'warning' ? C.warning[500] : alert.type === 'success' ? C.success[500] : C.brand[500]}`,
                cursor: 'pointer',
                transition: 'all 0.15s'
              }}
              onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)'}
              onMouseLeave={(e) => e.currentTarget.style.boxShadow = 'none'}
            >
              {alert.type === 'warning' && <AlertTriangle style={{ width: 16, height: 16, color: C.warning[600] }} />}
              {alert.type === 'success' && <CheckCircle style={{ width: 16, height: 16, color: C.success[600] }} />}
              {alert.type === 'info' && <TrendingUp style={{ width: 16, height: 16, color: C.brand[600] }} />}
              <div style={{ flex: 1 }}>
                <p style={{ fontSize: '13px', fontWeight: 500, margin: 0 }}>{alert.message}</p>
                <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>{alert.category}</p>
              </div>
              <span style={{ 
                fontSize: '12px', 
                fontWeight: 600,
                color: alert.amount > 0 ? C.error[600] : C.success[600]
              }}>
                {alert.amount > 0 ? '+' : ''}{formatCurrency(Math.abs(alert.amount))}
              </span>
              <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
            </div>
          ))}
        </div>
      </Card>
      
      {/* Additional Metrics Row */}
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm }}>
        <Card>
          <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Orders Processed</p>
          <p style={{ fontSize: '20px', fontWeight: 500, margin: 0 }}>{periodData.ordersProcessed.toLocaleString()}</p>
          <p style={{ fontSize: '10px', color: C.neutral[400] }}>{periodInfo.label}</p>
        </Card>
        <Card>
          <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Units Handled</p>
          <p style={{ fontSize: '20px', fontWeight: 500, margin: 0 }}>{periodData.unitsHandled.toLocaleString()}</p>
          <p style={{ fontSize: '10px', color: C.neutral[400] }}>{periodInfo.label}</p>
        </Card>
        <Card>
          <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Fulfillment % of Revenue</p>
          <p style={{ fontSize: '20px', fontWeight: 500, margin: 0, color: periodData.fulfillmentPctRevenue > 14 ? C.warning[600] : C.success[600] }}>
            {periodData.fulfillmentPctRevenue}%
          </p>
          <p style={{ fontSize: '10px', color: C.neutral[400] }}>Target: &lt;14%</p>
        </Card>
      </div>
    </div>
  );
};

// Zones Tab Content - extracted from ZonesView for use in Executive tabs
const ZonesTabContent = ({ onZone, onViewInsights, onNavigateToAlert }) => {
  const { contextualTime, isContextualDifferent, interpolateValue } = useTimeContext();
  
  // ===== COMPOSITE SCORE DATA =====
  // These weights and values calculate the 82 shown on Exec dashboard Zones card
  const scoreComponents = [
    { label: 'Space Utilization', value: 78, target: 100, weight: 30, detail: '71% avg (target 70-85%)', status: 'success' },
    { label: 'Throughput per Zone', value: 85, target: 100, weight: 25, detail: '14 of 16 zones on target', status: 'warning' },
    { label: 'Congestion Index', value: 72, target: 100, weight: 20, detail: '2 zones >85% capacity', status: 'warning' },
    { label: 'Dock Utilization', value: 88, target: 100, weight: 15, detail: '7 of 8 docks active', status: 'success' },
    { label: 'Pick Path Efficiency', value: 91, target: 100, weight: 10, detail: 'Avg 12.3 min/route', status: 'success' }
  ];
  const compositeScore = Math.round(scoreComponents.reduce((sum, c) => sum + (c.value * c.weight / 100), 0));
  
  // ===== ZONE DATA BY CATEGORY =====
  // Scenario: Inbound A is over-encumbered, Shipping Dock B has slack
  const zoneCategories = [
    {
      id: 'receiving',
      name: 'Receiving',
      icon: Package,
      color: C.blueLight[500],
      status: 'warning',
      zones: [
        { id: 'Z01', name: 'Inbound A', capacity: 87, capacityTrend: 'up', staffActual: 4, staffPlanned: 6, throughput: 82, throughputTarget: 100, status: 'critical', hotspot: true, alert: 'Putaway backlog building — 45 pallets staged' },
        { id: 'Z02', name: 'Inbound B', capacity: 68, capacityTrend: 'stable', staffActual: 3, staffPlanned: 3, throughput: 95, throughputTarget: 100, status: 'success', hotspot: false },
        { id: 'Z03', name: 'QA Station', capacity: 54, capacityTrend: 'stable', staffActual: 2, staffPlanned: 2, throughput: 100, throughputTarget: 100, status: 'success', hotspot: false },
        { id: 'Z04', name: 'Dock Staging', capacity: 76, capacityTrend: 'up', staffActual: 2, staffPlanned: 2, throughput: 88, throughputTarget: 100, status: 'warning', hotspot: false }
      ]
    },
    {
      id: 'storage',
      name: 'Storage',
      icon: Grid3X3,
      color: C.purple[500],
      status: 'warning',
      zones: [
        { id: 'Z05', name: 'Bulk Storage', capacity: 83, capacityTrend: 'up', staffActual: 3, staffPlanned: 4, throughput: 78, throughputTarget: 100, status: 'warning', hotspot: true, alert: 'Approaching 85% threshold — overflow risk' },
        { id: 'Z06', name: 'Reserve 1', capacity: 72, capacityTrend: 'stable', staffActual: 2, staffPlanned: 2, throughput: 94, throughputTarget: 100, status: 'success', hotspot: false },
        { id: 'Z07', name: 'Reserve 2', capacity: 58, capacityTrend: 'down', staffActual: 1, staffPlanned: 1, throughput: 100, throughputTarget: 100, status: 'success', hotspot: false },
        { id: 'Z08', name: 'Cold Storage', capacity: 65, capacityTrend: 'stable', staffActual: 2, staffPlanned: 2, throughput: 96, throughputTarget: 100, status: 'success', hotspot: false }
      ]
    },
    {
      id: 'picking',
      name: 'Picking',
      icon: ClipboardList,
      color: C.orange[500],
      status: 'success',
      zones: [
        { id: 'Z09', name: 'Forward Pick A', capacity: 71, capacityTrend: 'stable', staffActual: 5, staffPlanned: 5, throughput: 95, throughputTarget: 100, status: 'success', hotspot: false },
        { id: 'Z10', name: 'Forward Pick B', capacity: 68, capacityTrend: 'stable', staffActual: 4, staffPlanned: 5, throughput: 92, throughputTarget: 100, status: 'warning', hotspot: false },
        { id: 'Z11', name: 'Forward Pick C', capacity: 74, capacityTrend: 'up', staffActual: 4, staffPlanned: 4, throughput: 98, throughputTarget: 100, status: 'success', hotspot: false },
        { id: 'Z12', name: 'Replen Staging', capacity: 62, capacityTrend: 'down', staffActual: 2, staffPlanned: 2, throughput: 100, throughputTarget: 100, status: 'success', hotspot: false }
      ]
    },
    {
      id: 'outbound',
      name: 'Outbound',
      icon: Truck,
      color: C.success[500],
      status: 'success',
      zones: [
        { id: 'Z13', name: 'Pack Station 1', capacity: 78, capacityTrend: 'stable', staffActual: 5, staffPlanned: 4, throughput: 105, throughputTarget: 100, status: 'success', hotspot: false },
        { id: 'Z14', name: 'Pack Station 2', capacity: 72, capacityTrend: 'stable', staffActual: 4, staffPlanned: 4, throughput: 98, throughputTarget: 100, status: 'success', hotspot: false },
        { id: 'Z15', name: 'Shipping Dock A', capacity: 69, capacityTrend: 'stable', staffActual: 4, staffPlanned: 4, throughput: 102, throughputTarget: 100, status: 'success', hotspot: false },
        { id: 'Z16', name: 'Shipping Dock B', capacity: 45, capacityTrend: 'down', staffActual: 5, staffPlanned: 3, throughput: 115, throughputTarget: 100, status: 'success', hotspot: false, slack: true, slackNote: '+2 FTE available — ahead of schedule' }
      ]
    }
  ];
  
  // ===== ON-TIME SHIPPING DATA =====
  const shippingPerformance = {
    onTimeRate: 94.2,
    onTimeRatePredicted: 93.8,
    target: 95,
    ordersShipped: 1566,
    ordersRemaining: 2914,
    carriers: [
      { name: 'FedEx Ground', cutoff: '14:00', progress: 67, predicted: 104, status: 'success' },
      { name: 'UPS', cutoff: '15:30', progress: 48, predicted: 97, status: 'warning' },
      { name: 'USPS', cutoff: '16:00', progress: 50, predicted: 102, status: 'success' },
      { name: 'FedEx Express', cutoff: '17:00', progress: 39, predicted: 106, status: 'success' }
    ]
  };
  
  // ===== CAPACITY TIMELINE =====
  const capacityTimeline = [
    { time: '06:00', actual: 58 },
    { time: '08:00', actual: 65 },
    { time: '10:00', actual: 71, predicted: 71, now: true },
    { time: '12:00', predicted: 76, upper: 80, lower: 72 },
    { time: '14:00', predicted: 72, upper: 76, lower: 68 }
  ];
  
  // ===== ALERTS =====
  const zoneAlerts = [
    { sev: 'critical', title: 'Inbound A capacity critical — 87%', msg: 'Putaway backlog at 45 pallets. Staffing gap: 4/6 FTE. Recommend reassigning 2 FTE from Outbound.', time: '+2hr', conf: 91 },
    { sev: 'warning', title: 'Bulk Storage approaching threshold', msg: 'Projected 91% by 12:00 if Inbound A backlog not cleared. Overflow to Reserve 2 available.', time: '+2hr', conf: 84 },
    { sev: 'info', title: 'Shipping Dock B under-utilized', msg: 'Ahead of schedule with +2 FTE slack. Maria Santos (forklift cert, putaway exp) available for reassignment.', time: 'Now', conf: 95 },
    { sev: 'success', title: 'Pick zones healthy', msg: 'All forward pick zones operating at 92-98% efficiency. No action needed.', time: 'Now', conf: 98 }
  ];

  const getCapacityColor = (cap) => {
    if (cap >= 85) return { bg: C.error[500], text: 'white' };
    if (cap >= 75) return { bg: C.warning[500], text: 'white' };
    if (cap >= 60) return { bg: C.warning[100], text: C.warning[700] };
    return { bg: C.success[100], text: C.success[700] };
  };

  return (
    <>
      <Header icon={MapPin} title="Zones Overview" sub="Physical space utilization, capacity, and throughput across facility" color={C.blueLight[500]} />
      
      {/* ===== COMPOSITE SCORE BREAKDOWN ===== */}
      <Card>
        <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.lg, marginBottom: sp.md }}>
          {/* Score Circle */}
          <div style={{ 
            width: 100, height: 100, borderRadius: '50%', 
            background: `conic-gradient(${compositeScore >= 85 ? C.success[500] : compositeScore >= 70 ? C.warning[500] : C.error[500]} ${compositeScore * 3.6}deg, ${C.neutral[100]} 0deg)`,
            display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0
          }}>
            <div style={{ width: 80, height: 80, borderRadius: '50%', background: 'white', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>
              <span style={{ fontSize: '28px', fontWeight: 600, color: compositeScore >= 85 ? C.success[600] : compositeScore >= 70 ? C.warning[600] : C.error[600] }}>{compositeScore}</span>
              <span style={{ fontSize: '10px', color: C.neutral[500] }}>ZONES SCORE</span>
            </div>
          </div>
          
          {/* Score Components */}
          <div style={{ flex: 1 }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Score Breakdown</h3>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>Weighted composite of 5 factors</span>
            </div>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
              {scoreComponents.map((comp, i) => (
                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <span style={{ fontSize: '12px', color: C.neutral[600], width: 130, flexShrink: 0 }}>{comp.label}</span>
                  <div style={{ flex: 1, height: 8, background: C.neutral[100], borderRadius: 4, overflow: 'hidden' }}>
                    <div style={{ 
                      width: `${comp.value}%`, height: '100%', borderRadius: 4,
                      background: comp.status === 'error' ? C.error[500] : comp.status === 'warning' ? C.warning[500] : C.success[500]
                    }} />
                  </div>
                  <span style={{ fontSize: '12px', fontWeight: 500, width: 32, textAlign: 'right', color: comp.status === 'error' ? C.error[600] : comp.status === 'warning' ? C.warning[600] : C.success[600] }}>{comp.value}%</span>
                  <span style={{ fontSize: '10px', color: C.neutral[400], width: 16, textAlign: 'right' }}>{comp.weight}%</span>
                  <span style={{ fontSize: '11px', color: C.neutral[500], width: 140 }}>{comp.detail}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
        
        {/* Lowest factors callout */}
        <div style={{ background: C.warning[50], borderRadius: 6, padding: sp.sm, display: 'flex', alignItems: 'center', gap: sp.sm }}>
          <AlertTriangle style={{ width: 16, height: 16, color: C.warning[600] }} />
          <span style={{ fontSize: '12px', color: C.warning[700] }}>
            <strong>Watch:</strong> Congestion Index (72%) pulled down by Inbound A and Bulk Storage. 
            Address staffing gap in Receiving to improve flow.
          </span>
        </div>
      </Card>
      
      {/* ===== ZONE CATEGORIES ===== */}
      {zoneCategories.map((cat, catIdx) => (
        <Card key={cat.id}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
            <div style={{ width: 32, height: 32, borderRadius: 6, background: `${cat.color}15`, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
              <cat.icon style={{ width: 16, height: 16, color: cat.color }} />
            </div>
            <div style={{ flex: 1 }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>{cat.name}</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>{cat.zones.length} zones</p>
            </div>
            <Badge status={cat.status} label={cat.status === 'success' ? 'Healthy' : cat.status === 'warning' ? 'Attention' : 'Critical'} />
          </div>
          
          {/* Zone rows */}
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
            {cat.zones.map((zone, zIdx) => {
              const capColor = getCapacityColor(zone.capacity);
              const staffStatus = zone.staffActual >= zone.staffPlanned ? 'success' : zone.staffActual >= zone.staffPlanned - 1 ? 'warning' : 'error';
              const tpPct = Math.round((zone.throughput / zone.throughputTarget) * 100);
              
              return (
                <div 
                  key={zone.id}
                  onClick={() => onZone && onZone(zone.id)}
                  style={{ 
                    display: 'flex', 
                    alignItems: 'center', 
                    padding: sp.md, 
                    background: zone.hotspot ? C.error[50] : zone.slack ? C.success[50] : C.neutral[50], 
                    borderRadius: 8,
                    border: `1px solid ${zone.hotspot ? C.error[200] : zone.slack ? C.success[200] : C.neutral[200]}`,
                    cursor: 'pointer',
                    transition: 'all 0.15s'
                  }}
                  onMouseEnter={(e) => { 
                    e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                    e.currentTarget.style.transform = 'translateY(-1px)';
                  }}
                  onMouseLeave={(e) => { 
                    e.currentTarget.style.boxShadow = 'none';
                    e.currentTarget.style.transform = 'translateY(0)';
                  }}
                >
                  {/* Zone ID + Name */}
                  <div style={{ width: 130, flexShrink: 0 }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                      <span style={{ fontSize: '12px', fontWeight: 600, color: C.neutral[500] }}>{zone.id}</span>
                      {zone.hotspot && <AlertTriangle style={{ width: 12, height: 12, color: C.error[500] }} />}
                      {zone.slack && <CheckCircle style={{ width: 12, height: 12, color: C.success[500] }} />}
                    </div>
                    <p style={{ fontSize: '13px', fontWeight: 500 }}>{zone.name}</p>
                  </div>
                  
                  {/* Capacity */}
                  <div style={{ width: 80, textAlign: 'center' }}>
                    <p style={{ fontSize: '10px', color: C.neutral[500] }}>Capacity</p>
                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 4 }}>
                      <span style={{ 
                        fontSize: '16px', fontWeight: 600, 
                        padding: '2px 6px', borderRadius: 4,
                        background: capColor.bg, color: capColor.text
                      }}>{zone.capacity}%</span>
                      {zone.capacityTrend === 'up' && <ArrowUpRight style={{ width: 12, height: 12, color: C.error[500] }} />}
                      {zone.capacityTrend === 'down' && <ArrowDownRight style={{ width: 12, height: 12, color: C.success[500] }} />}
                    </div>
                  </div>
                  
                  {/* Staffing */}
                  <div style={{ width: 80, textAlign: 'center' }}>
                    <p style={{ fontSize: '10px', color: C.neutral[500] }}>Staffing</p>
                    <p style={{ fontSize: '14px', fontWeight: 500, color: staffStatus === 'error' ? C.error[600] : staffStatus === 'warning' ? C.warning[600] : C.neutral[700] }}>
                      {zone.staffActual}/{zone.staffPlanned} <span style={{ fontSize: '10px', color: C.neutral[400] }}>FTE</span>
                    </p>
                  </div>
                  
                  {/* Throughput */}
                  <div style={{ width: 90, textAlign: 'center' }}>
                    <p style={{ fontSize: '10px', color: C.neutral[500] }}>Throughput</p>
                    <p style={{ fontSize: '14px', fontWeight: 500, color: tpPct >= 95 ? C.success[600] : tpPct >= 85 ? C.warning[600] : C.error[600] }}>
                      {tpPct}% <span style={{ fontSize: '10px', color: C.neutral[400] }}>of target</span>
                    </p>
                  </div>
                  
                  {/* Alert/Note */}
                  <div style={{ flex: 1, paddingLeft: sp.md }}>
                    {zone.alert && (
                      <p style={{ fontSize: '11px', color: C.error[600], display: 'flex', alignItems: 'center', gap: 4 }}>
                        <AlertTriangle style={{ width: 10, height: 10 }} /> {zone.alert}
                      </p>
                    )}
                    {zone.slackNote && (
                      <p style={{ fontSize: '11px', color: C.success[600], display: 'flex', alignItems: 'center', gap: 4 }}>
                        <CheckCircle style={{ width: 10, height: 10 }} /> {zone.slackNote}
                      </p>
                    )}
                  </div>
                  
                  {/* Chevron */}
                  <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
                </div>
              );
            })}
          </div>
        </Card>
      ))}
      
      {/* ===== ON-TIME SHIPPING PERFORMANCE ===== */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.md }}>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>On-Time Shipping Performance</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Outbound zone efficiency and carrier cutoff progress</p>
          </div>
          <div style={{ textAlign: 'right' }}>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs }}>
              <span style={{ fontSize: '24px', fontWeight: 300 }}>{shippingPerformance.onTimeRate}%</span>
              <ArrowRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
              <span style={{ fontSize: '16px', fontWeight: 500, color: C.purple[600] }}>{shippingPerformance.onTimeRatePredicted}%</span>
            </div>
            <p style={{ fontSize: '11px', color: C.neutral[500] }}>Target: {shippingPerformance.target}%</p>
          </div>
        </div>
        
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
          {shippingPerformance.carriers.map((carrier, i) => (
            <div key={i} style={{ 
              padding: sp.md, 
              background: carrier.status === 'warning' ? C.warning[50] : C.neutral[50], 
              borderRadius: 8,
              border: `1px solid ${carrier.status === 'warning' ? C.warning[200] : C.neutral[200]}`
            }}>
              <p style={{ fontSize: '12px', fontWeight: 500, marginBottom: sp.xs }}>{carrier.name}</p>
              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.sm }}>Cutoff: {carrier.cutoff}</p>
              <div style={{ height: 6, background: C.neutral[200], borderRadius: 3, overflow: 'hidden', marginBottom: sp.xs }}>
                <div style={{ 
                  width: `${carrier.progress}%`, 
                  height: '100%', 
                  background: carrier.status === 'success' ? C.success[500] : C.warning[500] 
                }} />
              </div>
              <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                <span style={{ fontSize: '10px', color: C.neutral[500] }}>{carrier.progress}% complete</span>
                <span style={{ fontSize: '10px', color: carrier.predicted >= 100 ? C.success[600] : C.warning[600] }}>
                  Pred: {carrier.predicted}%
                </span>
              </div>
            </div>
          ))}
        </div>
      </Card>
      
      {/* ===== CAPACITY TREND ===== */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.sm }}>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Overall Capacity Trend</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Average utilization across all 16 zones</p>
          </div>
          <Badge status="success" label="71% avg — Healthy" />
        </div>
        <div style={{ height: 140, overflow: 'hidden' }}>
          <PredictiveTimeline data={capacityTimeline} height={140} warning={75} critical={85} />
        </div>
        <div style={{ display: 'flex', gap: sp.lg, marginTop: sp.sm, padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Current</span><p style={{ fontSize: '14px', fontWeight: 500 }}>71%</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Peak Today</span><p style={{ fontSize: '14px', fontWeight: 500 }}>76% @ 12:00</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Shift End</span><p style={{ fontSize: '14px', fontWeight: 500, color: C.success[600] }}>72%</p></div>
        </div>
      </Card>
      
      {/* ===== PREDICTIVE ALERTS ===== */}
      <Card style={{ borderLeft: `4px solid ${C.blueLight[500]}` }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
          <div style={{ width: 32, height: 32, borderRadius: 6, background: C.blueLight[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
            <Zap style={{ width: 16, height: 16, color: C.blueLight[600] }} />
          </div>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and recommendations for zone capacity and flow</p>
          </div>
          <Badge status="warning" label={`${zoneAlerts.filter(a => a.sev === 'critical' || a.sev === 'warning').length} Active`} style={{ marginLeft: 'auto' }} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {zoneAlerts.map((a, i) => <Alert key={i} {...a} />)}
        </div>
        <div 
          onClick={() => onViewInsights && onViewInsights()}
          style={{ 
            marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}`,
            display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.xs,
            cursor: 'pointer', color: C.blueLight[600], fontSize: '13px', fontWeight: 500
          }}
          onMouseEnter={(e) => e.currentTarget.style.color = C.blueLight[700]}
          onMouseLeave={(e) => e.currentTarget.style.color = C.blueLight[600]}
        >
          View Full Analysis <ChevronRight style={{ width: 16, height: 16 }} />
        </div>
      </Card>
    </>
  );
};

// Staff Tab Content - facility-level staff overview
const StaffTabContent = ({ onViewInsights, initialShiftFilter = null, onNavigateToAlert, onNavigateToStaff }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue } = useTimeContext();
  
  // Composite score breakdown - these weights and values calculate the 78 shown on Exec dashboard
  const scoreComponents = [
    { label: 'Headcount vs Plan', value: 87, target: 100, weight: 25, detail: '42/48 FTE', status: 'warning' },
    { label: 'Attendance Rate', value: 88, target: 95, weight: 20, detail: '88% present', status: 'warning' },
    { label: 'UPLH vs Target', value: 94, target: 100, weight: 25, detail: 'Avg 128 vs 136 target', status: 'warning' },
    { label: 'Overtime Compliance', value: 67, target: 100, weight: 15, detail: '24 hrs vs 18 planned', status: 'error' },
    { label: 'Zone Coverage', value: 72, target: 100, weight: 15, detail: '2 zones understaffed', status: 'error' }
  ];
  const compositeScore = Math.round(scoreComponents.reduce((sum, c) => sum + (c.value * c.weight / 100), 0));
  
  // Staff alerts using shared data
  const staffAlerts = [
    ALERTS_DATA['staff-break-coverage'],
    ALERTS_DATA['staff-swing-understaffed'],
    ALERTS_DATA['staff-receiving-uplh'],
    ALERTS_DATA['staff-handoff-optimal']
  ];
  
  // UPLH by function
  const uplhByFunction = [
    { function: 'Picking', actual: 142, target: 150, fteCount: 12, trend: 'down' },
    { function: 'Packing', actual: 115, target: 110, fteCount: 8, trend: 'up' },
    { function: 'Receiving', actual: 94, target: 95, fteCount: 6, trend: 'down' },
    { function: 'Shipping', actual: 134, target: 130, fteCount: 8, trend: 'stable' },
    { function: 'Putaway', actual: 88, target: 100, fteCount: 5, trend: 'down' },
    { function: 'Replenishment', actual: 76, target: 80, fteCount: 3, trend: 'stable' }
  ];
  
  // Zone allocation data
  const zoneAllocation = [
    { code: 'IB-A', zone: 'Inbound A', planned: 4, actual: 4, pred: 4, status: 'ok' },
    { code: 'IB-B', zone: 'Inbound B', planned: 4, actual: 2, pred: 3, status: 'under' },
    { code: 'QA', zone: 'QA Station', planned: 2, actual: 2, pred: 2, status: 'ok' },
    { code: 'BLK', zone: 'Bulk Storage', planned: 4, actual: 3, pred: 4, status: 'under' },
    { code: 'FP-A', zone: 'Forward Pick A', planned: 5, actual: 5, pred: 5, status: 'ok' },
    { code: 'FP-B', zone: 'Forward Pick B', planned: 5, actual: 4, pred: 5, status: 'under' },
    { code: 'FP-C', zone: 'Forward Pick C', planned: 4, actual: 4, pred: 4, status: 'ok' },
    { code: 'PK-1', zone: 'Pack Station 1', planned: 4, actual: 5, pred: 5, status: 'over' },
    { code: 'PK-2', zone: 'Pack Station 2', planned: 4, actual: 4, pred: 4, status: 'ok' },
    { code: 'SH-A', zone: 'Shipping Dock A', planned: 4, actual: 4, pred: 4, status: 'ok' },
    { code: 'SH-B', zone: 'Shipping Dock B', planned: 5, actual: 2, pred: 3, status: 'under' },
    { code: 'RTN', zone: 'Returns', planned: 2, actual: 2, pred: 2, status: 'ok' }
  ];
  
  // Workforce composition
  const workforceComp = { permanent: 38, temp: 4, overtime: 6, total: 48 };
  
  const staffData = [
    // Day Shift
    { id: 'E001', name: 'Maria Santos', role: 'Picker', shift: 'day', zone: 'Forward Pick A', status: 'Active', uplh: 158, clockIn: '06:00', certs: ['forklift', 'hazmat'] },
    { id: 'E002', name: 'James Wilson', role: 'Picker', shift: 'day', zone: 'Forward Pick B', status: 'Active', uplh: 162, clockIn: '06:00', certs: [] },
    { id: 'E003', name: 'Chen Wei', role: 'Packer', shift: 'day', zone: 'Pack Station 1', status: 'Active', uplh: 112, clockIn: '06:00', certs: [] },
    { id: 'E004', name: 'Sarah Johnson', role: 'Receiver', shift: 'day', zone: 'Inbound A', status: 'Active', uplh: 94, clockIn: '06:00', certs: ['forklift'] },
    { id: 'E005', name: 'Mike Brown', role: 'Forklift Op', shift: 'day', zone: 'Bulk Storage', status: 'Active', uplh: 88, clockIn: '06:00', certs: ['forklift'] },
    { id: 'E006', name: 'Ana Garcia', role: 'Picker', shift: 'day', zone: 'Forward Pick C', status: 'Break', uplh: 145, clockIn: '06:00', certs: [] },
    { id: 'E007', name: 'David Lee', role: 'Shipper', shift: 'day', zone: 'Shipping Dock A', status: 'Active', uplh: 134, clockIn: '06:00', certs: ['forklift'] },
    { id: 'E008', name: 'Emily Chen', role: 'Packer', shift: 'day', zone: 'Pack Station 2', status: 'Active', uplh: 118, clockIn: '06:00', certs: [] },
    { id: 'E009', name: 'Robert Kim', role: 'Putaway', shift: 'day', zone: 'Bulk Storage', status: 'Active', uplh: 92, clockIn: '06:00', certs: ['forklift'] },
    { id: 'E010', name: 'Lisa Wang', role: 'QA', shift: 'day', zone: 'QA Station', status: 'Active', uplh: 45, clockIn: '06:00', certs: [] },
    // Swing Shift
    { id: 'E011', name: 'Carlos Ruiz', role: 'Picker', shift: 'swing', zone: 'Forward Pick A', status: 'Scheduled', uplh: null, clockIn: '14:00', certs: [] },
    { id: 'E012', name: 'Jennifer Adams', role: 'Packer', shift: 'swing', zone: 'Pack Station 1', status: 'Scheduled', uplh: null, clockIn: '14:00', certs: [] },
    { id: 'E013', name: 'Kevin Nguyen', role: 'Shipper', shift: 'swing', zone: 'Shipping Dock B', status: 'Scheduled', uplh: null, clockIn: '14:00', certs: ['forklift'] },
    { id: 'E014', name: 'Amanda Foster', role: 'Receiver', shift: 'swing', zone: 'Inbound B', status: 'Scheduled', uplh: null, clockIn: '14:00', certs: [] },
    { id: 'E015', name: 'Marcus Johnson', role: 'Forklift Op', shift: 'swing', zone: 'Bulk Storage', status: 'Scheduled', uplh: null, clockIn: '14:00', certs: ['forklift', 'hazmat'] },
    // Night Shift
    { id: 'E016', name: 'Tom Bradley', role: 'Receiver', shift: 'night', zone: 'Inbound A', status: 'Off', uplh: null, clockIn: '22:00', certs: ['forklift'] },
    { id: 'E017', name: 'Rachel Green', role: 'Putaway', shift: 'night', zone: 'Reserve 1', status: 'Off', uplh: null, clockIn: '22:00', certs: ['forklift'] },
    { id: 'E018', name: 'Steve Miller', role: 'Replen', shift: 'night', zone: 'Forward Pick A', status: 'Off', uplh: null, clockIn: '22:00', certs: [] },
    // Call-outs / Issues
    { id: 'E019', name: 'Diana Ross', role: 'Picker', shift: 'day', zone: 'Forward Pick B', status: 'Call-out', uplh: null, clockIn: null, certs: [] },
    { id: 'E020', name: 'Frank Torres', role: 'Packer', shift: 'day', zone: 'Pack Station 1', status: 'Late', uplh: 98, clockIn: '06:45', certs: [] }
  ];
  
  const staffColumns = [
    { key: 'id', label: 'ID' },
    { key: 'name', label: 'Name' },
    { key: 'role', label: 'Role' },
    { key: 'zone', label: 'Zone' },
    { key: 'status', label: 'Status', render: (v) => <Badge status={v === 'Active' ? 'success' : v === 'Break' ? 'info' : v === 'Call-out' ? 'error' : v === 'Late' ? 'warning' : 'purple'} label={v} /> },
    { key: 'uplh', label: 'UPLH', align: 'right', render: (v) => v ? <span style={{ color: v >= 100 ? C.success[600] : v >= 90 ? C.warning[600] : C.error[600] }}>{v}</span> : '—' },
    { key: 'clockIn', label: 'Clock In', render: (v) => v || '—' }
  ];
  
  const staffFilters = [
    { key: 'role', label: 'Role', options: ['Picker', 'Packer', 'Receiver', 'Shipper', 'Forklift Op', 'Lead', 'QC Inspector'] },
    { key: 'status', label: 'Status', options: ['Active', 'Break', 'Call-out', 'Late', 'Overtime'] }
  ];
  
  const staffTimeline = [
    { time: '06:00', actual: 45 }, { time: '07:00', actual: 46 }, { time: '08:00', actual: 44 },
    { time: '09:00', actual: 43 }, { time: '10:00', actual: 42, predicted: 42, now: true },
    { time: '11:00', predicted: 40, upper: 42, lower: 38 }, { time: '12:00', predicted: 38, upper: 41, lower: 35 },
    { time: '13:00', predicted: 41, upper: 44, lower: 38 }, { time: '14:00', predicted: 44, upper: 47, lower: 41 }
  ];

  return (
    <>
      <Header icon={Users} title="Staff Overview" sub="Labor capacity, productivity, allocation across facility" color={C.purple[500]} />
      
      {/* ===== COMPOSITE SCORE BREAKDOWN ===== */}
      <Card>
        <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.lg, marginBottom: sp.md }}>
          {/* Score Circle */}
          <div style={{ 
            width: 100, height: 100, borderRadius: '50%', 
            background: `conic-gradient(${compositeScore >= 85 ? C.success[500] : compositeScore >= 70 ? C.warning[500] : C.error[500]} ${compositeScore * 3.6}deg, ${C.neutral[100]} 0deg)`,
            display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0
          }}>
            <div style={{ width: 80, height: 80, borderRadius: '50%', background: 'white', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>
              <span style={{ fontSize: '28px', fontWeight: 600, color: compositeScore >= 85 ? C.success[600] : compositeScore >= 70 ? C.warning[600] : C.error[600] }}>{compositeScore}</span>
              <span style={{ fontSize: '10px', color: C.neutral[500] }}>STAFF SCORE</span>
            </div>
          </div>
          
          {/* Score Components */}
          <div style={{ flex: 1 }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Score Breakdown</h3>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>Weighted composite of 5 factors</span>
            </div>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
              {scoreComponents.map((comp, i) => (
                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <span style={{ fontSize: '12px', color: C.neutral[600], width: 130, flexShrink: 0 }}>{comp.label}</span>
                  <div style={{ flex: 1, height: 8, background: C.neutral[100], borderRadius: 4, overflow: 'hidden' }}>
                    <div style={{ 
                      width: `${comp.value}%`, height: '100%', borderRadius: 4,
                      background: comp.status === 'error' ? C.error[500] : comp.status === 'warning' ? C.warning[500] : C.success[500]
                    }} />
                  </div>
                  <span style={{ fontSize: '12px', fontWeight: 500, width: 32, textAlign: 'right', color: comp.status === 'error' ? C.error[600] : comp.status === 'warning' ? C.warning[600] : C.success[600] }}>{comp.value}%</span>
                  <span style={{ fontSize: '10px', color: C.neutral[400], width: 16, textAlign: 'right' }}>{comp.weight}%</span>
                  <span style={{ fontSize: '11px', color: C.neutral[500], width: 110 }}>{comp.detail}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
        
        {/* Lowest factors callout */}
        <div style={{ background: C.error[50], borderRadius: 6, padding: sp.sm, display: 'flex', alignItems: 'center', gap: sp.sm }}>
          <AlertTriangle style={{ width: 16, height: 16, color: C.error[600] }} />
          <span style={{ fontSize: '12px', color: C.error[700] }}>
            <strong>Lowest factors:</strong> Overtime Compliance (67%) and Zone Coverage (72%) are pulling the score down. 
            Address OT hours and Inbound B / Bulk Storage gaps to improve.
          </span>
        </div>
      </Card>
      
      {/* ===== UPLH BY FUNCTION ===== */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Productivity by Function (UPLH)</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Units per labor hour by job function • Higher is better</p>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
          {uplhByFunction.map((f, i) => {
            const pct = Math.round((f.actual / f.target) * 100);
            const status = pct >= 100 ? 'success' : pct >= 90 ? 'warning' : 'error';
            return (
              <div key={i} style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, border: `1px solid ${C.neutral[200]}` }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                  <span style={{ fontSize: '13px', fontWeight: 500 }}>{f.function}</span>
                  <span style={{ fontSize: '10px', color: C.neutral[500] }}>{f.fteCount} FTE</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs, marginBottom: sp.xs }}>
                  <span style={{ fontSize: '24px', fontWeight: 600, color: status === 'success' ? C.success[600] : status === 'warning' ? C.warning[600] : C.error[600] }}>{f.actual}</span>
                  <span style={{ fontSize: '12px', color: C.neutral[500] }}>/ {f.target} target</span>
                </div>
                <div style={{ height: 4, background: C.neutral[200], borderRadius: 2, overflow: 'hidden' }}>
                  <div style={{ width: `${Math.min(pct, 100)}%`, height: '100%', background: status === 'success' ? C.success[500] : status === 'warning' ? C.warning[500] : C.error[500] }} />
                </div>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: sp.xs }}>
                  <span style={{ fontSize: '10px', color: status === 'success' ? C.success[600] : status === 'warning' ? C.warning[600] : C.error[600] }}>{pct}% of target</span>
                  {f.trend === 'down' && <span style={{ fontSize: '10px', color: C.error[500] }}>↓ declining</span>}
                  {f.trend === 'up' && <span style={{ fontSize: '10px', color: C.success[500] }}>↑ improving</span>}
                  {f.trend === 'stable' && <span style={{ fontSize: '10px', color: C.neutral[400] }}>→ stable</span>}
                </div>
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* ===== ZONE ALLOCATION HEATMAP ===== */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Zone Allocation Heatmap</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>FTE distribution by zone • Color indicates staffing coverage • Click on item to view details</p>
            </div>
            <div style={{ display: 'flex', gap: sp.md, fontSize: '11px' }}>
              <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 12, height: 12, borderRadius: 2, background: C.success[200] }} /> 100%+</span>
              <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 12, height: 12, borderRadius: 2, background: C.warning[200] }} /> 80-99%</span>
              <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 12, height: 12, borderRadius: 2, background: C.orange[200] }} /> 60-79%</span>
              <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 12, height: 12, borderRadius: 2, background: C.error[200] }} /> &lt;60%</span>
            </div>
          </div>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
          {zoneAllocation.map((z, i) => {
            const ratio = z.actual / z.planned;
            const pct = Math.round(ratio * 100);
            const delta = z.pred - z.actual;
            
            // Color based on staffing ratio - using available color shades
            const getHeatColor = (r) => {
              if (r >= 1) return { bg: C.success[100], border: C.success[500], text: C.success[700] };
              if (r >= 0.8) return { bg: C.warning[100], border: C.warning[500], text: C.warning[600] };
              if (r >= 0.6) return { bg: C.orange[50], border: C.orange[500], text: C.orange[500] };
              return { bg: C.error[100], border: C.error[500], text: C.error[700] };
            };
            const heat = getHeatColor(ratio);
            
            return (
              <div 
                key={i} 
                style={{ 
                  padding: sp.md, 
                  borderRadius: 8, 
                  background: heat.bg,
                  borderLeft: `4px solid ${heat.border}`,
                  cursor: 'pointer',
                  transition: 'all 0.15s'
                }}
                onMouseEnter={(e) => { 
                  e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)'; 
                  e.currentTarget.style.transform = 'translateY(-2px)'; 
                }}
                onMouseLeave={(e) => { 
                  e.currentTarget.style.boxShadow = 'none'; 
                  e.currentTarget.style.transform = 'translateY(0)'; 
                }}
              >
                {/* Header: Zone code + chevron */}
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.xs }}>
                  <span style={{ fontSize: '12px', fontWeight: 600, color: heat.text }}>{z.code}</span>
                  <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
                </div>
                
                {/* Percentage - scaled down */}
                <div style={{ marginBottom: sp.xs }}>
                  <span style={{ fontSize: '20px', fontWeight: 600, color: heat.text }}>{pct}%</span>
                </div>
                
                {/* Actual/Planned with prediction delta */}
                <div style={{ display: 'flex', alignItems: 'center', gap: 4, marginBottom: sp.xs }}>
                  <span style={{ fontSize: '11px', color: C.neutral[600] }}>{z.actual}/{z.planned}</span>
                  <span style={{ fontSize: '10px', color: C.neutral[400] }}>→</span>
                  <span style={{ 
                    fontSize: '10px', 
                    fontWeight: 500,
                    color: delta > 0 ? C.success[600] : delta < 0 ? C.error[600] : C.neutral[500]
                  }}>
                    {delta > 0 ? `+${delta}` : delta === 0 ? '+0' : delta}
                  </span>
                </div>
                
                {/* Zone name */}
                <p style={{ fontSize: '11px', color: C.neutral[600], lineHeight: 1.2 }}>{z.zone}</p>
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* ===== WORKFORCE MIX + HEADCOUNT FORECAST (single full-width card) ===== */}
      <Card>
        <div style={{ display: 'flex', gap: sp.lg }}>
          {/* Workforce Mix - Left side */}
          <div style={{ width: 220, flexShrink: 0, borderRight: `1px solid ${C.neutral[200]}`, paddingRight: sp.lg }}>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Workforce Mix</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span style={{ fontSize: '12px', color: C.neutral[600] }}>Permanent</span>
                <span style={{ fontSize: '14px', fontWeight: 500 }}>{workforceComp.permanent} <span style={{ fontSize: '10px', color: C.neutral[400] }}>({Math.round(workforceComp.permanent/workforceComp.total*100)}%)</span></span>
              </div>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span style={{ fontSize: '12px', color: C.neutral[600] }}>Temp Labor</span>
                <span style={{ fontSize: '14px', fontWeight: 500, color: C.warning[600] }}>{workforceComp.temp} <span style={{ fontSize: '10px', color: C.neutral[400] }}>({Math.round(workforceComp.temp/workforceComp.total*100)}%)</span></span>
              </div>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span style={{ fontSize: '12px', color: C.neutral[600] }}>On Overtime</span>
                <span style={{ fontSize: '14px', fontWeight: 500, color: C.error[600] }}>{workforceComp.overtime} <span style={{ fontSize: '10px', color: C.neutral[400] }}>({Math.round(workforceComp.overtime/workforceComp.total*100)}%)</span></span>
              </div>
              <div style={{ borderTop: `1px solid ${C.neutral[200]}`, paddingTop: sp.sm, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span style={{ fontSize: '12px', fontWeight: 500 }}>Total Scheduled</span>
                <span style={{ fontSize: '16px', fontWeight: 600 }}>{workforceComp.total}</span>
              </div>
            </div>
            <div style={{ marginTop: sp.sm, padding: sp.xs, background: C.error[50], borderRadius: 4 }}>
              <p style={{ fontSize: '10px', color: C.error[700] }}><strong>OT:</strong> 24 hrs vs 18 budget (+33%)</p>
            </div>
          </div>
          
          {/* Headcount Forecast - Right side */}
          <div style={{ flex: 1, minWidth: 0, overflow: 'hidden' }}>
            <div style={{ marginBottom: sp.xs }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                  <h3 style={{ fontSize: '14px', fontWeight: 500 }}>Headcount Forecast</h3>
                  {isContextualDifferent && interpolateValue(staffTimeline, contextualTime) && (
                    <span style={{ fontSize: '12px', padding: '2px 6px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                      @{contextualTime}: <strong>{interpolateValue(staffTimeline, contextualTime)} FTE</strong>
                    </span>
                  )}
                </div>
                <Badge status="warning" label="Gap 11-13:00" />
              </div>
              <p style={{ fontSize: '11px', color: C.neutral[500] }}>Active FTEs on floor • Now: 42 → Pred: 44 @ 14:00 • Target: 48 FTE</p>
            </div>
            <div style={{ height: 100, overflow: 'hidden' }}>
              <PredictiveTimeline data={staffTimeline} height={100} target={48} warning={44} critical={40} contextualTime={contextualTime} />
            </div>
          </div>
        </div>
      </Card>
      
      {/* ===== STAFF ROSTER WITH ATTENDANCE FILTERS ===== */}
      {/* Staff Roster - Using DataGrid */}
      <DataGrid 
        title="Staff Roster" 
        subtitle="All employees • Filter by shift, role, or status" 
        columns={staffColumns} 
        data={staffData} 
        color={C.purple[500]} 
        entityType="staff"
        filterOptions={[
          { key: 'shift', label: 'Shift', options: ['day', 'swing', 'night'] },
          { key: 'role', label: 'Role', options: [...new Set(staffData.map(s => s.role))] },
          { key: 'status', label: 'Status', options: ['Active', 'Break', 'Call-out', 'Late', 'Scheduled', 'Off'] }
        ]}
        onAction={(action, row) => {
          if (action === 'view' && onNavigateToStaff) {
            onNavigateToStaff(row.id, row.name);
          }
        }}
      />
      
      {/* ===== PREDICTIVE ALERTS ===== */}
      <Card style={{ borderLeft: `4px solid ${C.purple[500]}` }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
          <div style={{ width: 32, height: 32, borderRadius: 6, background: C.purple[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Zap style={{ width: 16, height: 16, color: C.purple[600] }} /></div>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and recommendations for staffing • Click for details</p></div>
          <Badge status="purple" label={`${staffAlerts.length} Active`} style={{ marginLeft: 'auto' }} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {staffAlerts.map((a, i) => (
            <Alert 
              key={i} 
              {...a} 
              onClick={() => onNavigateToAlert && onNavigateToAlert(a.id, a.category, true)}
            />
          ))}
        </div>
        <div 
          onClick={() => onViewInsights && onViewInsights()}
          style={{ 
            marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}`,
            display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.xs,
            cursor: 'pointer', color: C.purple[600], fontSize: '13px', fontWeight: 500
          }}
          onMouseEnter={(e) => e.currentTarget.style.color = C.purple[700]}
          onMouseLeave={(e) => e.currentTarget.style.color = C.purple[600]}
        >
          View Full Analysis <ChevronRight style={{ width: 16, height: 16 }} />
        </div>
      </Card>
    </>
  );
};

// Work Content Tab - facility-level work overview
const WorkTabContent = ({ onNavigateToZones, onViewInsights, onNavigateToAlert }) => {
  const { contextualTime, isContextualDifferent, interpolateValue } = useTimeContext();
  const [expandedCarrier, setExpandedCarrier] = useState(null);
  
  // ===== COMPOSITE SCORE DATA =====
  // These weights and values calculate the 88 shown on Exec dashboard Work Content card
  const scoreComponents = [
    { label: 'Throughput vs Plan', value: 92, target: 100, weight: 30, detail: '4,200/4,560 units', status: 'warning' },
    { label: 'Queue Health', value: 85, target: 100, weight: 25, detail: '~300 carryover predicted', status: 'warning' },
    { label: 'Pick Accuracy', value: 99, target: 99, weight: 20, detail: '99.2% (12 errors today)', status: 'success' },
    { label: 'Order Cycle Time', value: 88, target: 100, weight: 15, detail: '2.4 hrs avg vs 2.1 target', status: 'warning' },
    { label: 'Carryover Rate', value: 78, target: 100, weight: 10, detail: '~5% may carry to swing', status: 'warning' }
  ];
  const compositeScore = Math.round(scoreComponents.reduce((sum, c) => sum + (c.value * c.weight / 100), 0));
  
  // ===== ORDERS & UNITS DATA =====
  const ordersData = {
    current: 12450,
    predicted: 12850,
    target: 13000,
    pctOfTarget: 96,
    trend: '+4.2%',
    trendUp: true
  };
  
  const unitsData = {
    current: 48200,
    predicted: 51400,
    target: 52000,
    pctOfTarget: 93,
    trend: '+2.8%',
    trendUp: true
  };
  
  // ===== QUEUE HEALTH DATA =====
  const queueHealth = [
    { 
      id: 'pick', 
      name: 'Pick Queue', 
      zones: ['Forward Pick A', 'Forward Pick B', 'Forward Pick C'],
      current: 2310, 
      velocity: 520, 
      velocityTarget: 560,
      timeToClear: 4.4, 
      carryover: 100, 
      carryoverPct: 3,
      status: 'success',
      statusLabel: '97% by shift end'
    },
    { 
      id: 'pack', 
      name: 'Pack Queue', 
      zones: ['Pack Station 1', 'Pack Station 2'],
      current: 2350, 
      velocity: 480, 
      velocityTarget: 520,
      timeToClear: 4.9, 
      carryover: 200, 
      carryoverPct: 5,
      status: 'warning',
      statusLabel: '95% by shift end'
    },
    { 
      id: 'ship', 
      name: 'Ship Queue', 
      zones: ['Shipping Dock A', 'Shipping Dock B'],
      current: 1566, 
      velocity: 420, 
      velocityTarget: 400,
      timeToClear: 3.7, 
      carryover: 0, 
      carryoverPct: 0,
      status: 'success',
      statusLabel: '100% by shift end'
    }
  ];
  
  // ===== THROUGHPUT BY FUNCTION =====
  const throughputByFunction = [
    { function: 'Receiving', actual: 245, target: 260, unit: 'pallets/hr', fteCount: 6, status: 'warning', trend: 'stable' },
    { function: 'Putaway', actual: 198, target: 220, unit: 'pallets/hr', fteCount: 5, status: 'warning', trend: 'down' },
    { function: 'Picking', actual: 520, target: 560, unit: 'orders/hr', fteCount: 12, status: 'warning', trend: 'up' },
    { function: 'Packing', actual: 480, target: 520, unit: 'orders/hr', fteCount: 8, status: 'warning', trend: 'stable' },
    { function: 'Shipping', actual: 420, target: 400, unit: 'orders/hr', fteCount: 8, status: 'success', trend: 'up' }
  ];
  
  // ===== CARRIER CUTOFFS =====
  const carrierCutoffs = [
    { 
      id: 'fedex-ground',
      carrier: 'FedEx Ground', cutoff: '14:00', hoursOut: 4, target: 1850, current: 1247, predicted: 1920, status: 'success',
      velocity: { current: 168, needed: 151, trend: 'up' },
      queueBreakdown: { pick: 420, pack: 180, ship: 3 },
      atRiskOrders: [],
      factors: ['Strong pick velocity', 'Pack station fully staffed'],
      hourlyTrend: [140, 152, 158, 168]
    },
    { 
      id: 'ups',
      carrier: 'UPS', cutoff: '15:30', hoursOut: 5.5, target: 1420, current: 680, predicted: 1380, status: 'warning',
      velocity: { current: 127, needed: 135, trend: 'down' },
      queueBreakdown: { pick: 380, pack: 240, ship: 120 },
      atRiskOrders: [
        { order: 'ORD-4821', customer: 'Acme Corp', sla: 'Express', units: 12 },
        { order: 'ORD-4835', customer: 'TechStart Inc', sla: 'Priority', units: 8 },
        { order: 'ORD-4847', customer: 'Global Supplies', sla: 'Express', units: 24 }
      ],
      factors: ['Pack queue backlog (+40 orders)', 'Z03 Picking understaffed', 'High unit-count orders slowing pack'],
      hourlyTrend: [145, 138, 132, 127]
    },
    { 
      id: 'usps',
      carrier: 'USPS', cutoff: '16:00', hoursOut: 6, target: 890, current: 445, predicted: 910, status: 'success',
      velocity: { current: 74, needed: 74, trend: 'stable' },
      queueBreakdown: { pick: 180, pack: 145, ship: 120 },
      atRiskOrders: [],
      factors: ['On pace', 'Lightweight items processing quickly'],
      hourlyTrend: [70, 72, 73, 74]
    },
    { 
      id: 'fedex-express',
      carrier: 'FedEx Express', cutoff: '17:00', hoursOut: 7, target: 320, current: 124, predicted: 340, status: 'success',
      velocity: { current: 46, needed: 28, trend: 'up' },
      queueBreakdown: { pick: 85, pack: 71, ship: 40 },
      atRiskOrders: [],
      factors: ['Well ahead of schedule', 'Priority lane clear'],
      hourlyTrend: [38, 42, 44, 46]
    }
  ];
  
  // ===== ALERTS =====
  // Work alerts using shared data
  const workAlerts = [
    ALERTS_DATA['work-ups-velocity'],
    ALERTS_DATA['work-pick-queue-growing'],
    ALERTS_DATA['work-fedex-express-priority'],
    ALERTS_DATA['work-pack-station-balanced']
  ];

  return (
    <>
      <Header icon={ClipboardList} title="Work Content Overview" sub="Task volume, queues, completion across facility" color={C.orange[500]} />
      
      {/* ===== COMPOSITE SCORE BREAKDOWN ===== */}
      <Card>
        <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.lg, marginBottom: sp.md }}>
          {/* Score Circle */}
          <div style={{ 
            width: 100, height: 100, borderRadius: '50%', 
            background: `conic-gradient(${compositeScore >= 85 ? C.success[500] : compositeScore >= 70 ? C.warning[500] : C.error[500]} ${compositeScore * 3.6}deg, ${C.neutral[100]} 0deg)`,
            display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0
          }}>
            <div style={{ width: 80, height: 80, borderRadius: '50%', background: 'white', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>
              <span style={{ fontSize: '28px', fontWeight: 600, color: compositeScore >= 85 ? C.success[600] : compositeScore >= 70 ? C.warning[600] : C.error[600] }}>{compositeScore}</span>
              <span style={{ fontSize: '10px', color: C.neutral[500] }}>WORK SCORE</span>
            </div>
          </div>
          
          {/* Score Components */}
          <div style={{ flex: 1 }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Score Breakdown</h3>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>Weighted composite of 5 factors</span>
            </div>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
              {scoreComponents.map((comp, i) => (
                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <span style={{ fontSize: '12px', color: C.neutral[600], width: 130, flexShrink: 0 }}>{comp.label}</span>
                  <div style={{ flex: 1, height: 8, background: C.neutral[100], borderRadius: 4, overflow: 'hidden' }}>
                    <div style={{ 
                      width: `${comp.value}%`, height: '100%', borderRadius: 4,
                      background: comp.status === 'error' ? C.error[500] : comp.status === 'warning' ? C.warning[500] : C.success[500]
                    }} />
                  </div>
                  <span style={{ fontSize: '12px', fontWeight: 500, width: 32, textAlign: 'right', color: comp.status === 'error' ? C.error[600] : comp.status === 'warning' ? C.warning[600] : C.success[600] }}>{comp.value}%</span>
                  <span style={{ fontSize: '10px', color: C.neutral[400], width: 16, textAlign: 'right' }}>{comp.weight}%</span>
                  <span style={{ fontSize: '11px', color: C.neutral[500], width: 140 }}>{comp.detail}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
        
        {/* Lowest factors callout */}
        <div style={{ background: C.warning[50], borderRadius: 6, padding: sp.sm, display: 'flex', alignItems: 'center', gap: sp.sm }}>
          <AlertTriangle style={{ width: 16, height: 16, color: C.warning[600] }} />
          <span style={{ fontSize: '12px', color: C.warning[700] }}>
            <strong>Watch:</strong> Carryover Rate (78%) and Queue Health (85%) are the lowest factors. 
            Pack queue velocity needs +8% to clear by shift end.
          </span>
        </div>
      </Card>
      
      {/* ===== ORDERS & UNITS SUMMARY ===== */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Today's Volume</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Order and unit throughput • Current → End-of-day prediction</p>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: sp.lg }}>
          {/* Orders */}
          <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, borderLeft: `3px solid ${ordersData.pctOfTarget >= 95 ? C.success[500] : C.warning[500]}` }}>
            <p style={{ fontSize: '11px', fontWeight: 500, color: C.neutral[500], marginBottom: sp.sm, textTransform: 'uppercase' }}>Orders Today</p>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.sm, marginBottom: sp.xs }}>
              <span style={{ fontSize: '28px', fontWeight: 300 }}>{ordersData.current.toLocaleString()}</span>
              <ArrowRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
              <span style={{ fontSize: '18px', fontWeight: 500, color: C.purple[600] }}>{ordersData.predicted.toLocaleString()}</span>
            </div>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>Target: {ordersData.target.toLocaleString()}</span>
              <span style={{ display: 'flex', alignItems: 'center', fontSize: '12px', fontWeight: 500, color: ordersData.trendUp ? C.success[600] : C.warning[600] }}>
                {ordersData.trendUp ? <ArrowUpRight style={{ width: 14, height: 14 }} /> : <ArrowDownRight style={{ width: 14, height: 14 }} />}
                {ordersData.trend} vs yesterday
              </span>
            </div>
          </div>
          
          {/* Units */}
          <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, borderLeft: `3px solid ${unitsData.pctOfTarget >= 95 ? C.success[500] : C.warning[500]}` }}>
            <p style={{ fontSize: '11px', fontWeight: 500, color: C.neutral[500], marginBottom: sp.sm, textTransform: 'uppercase' }}>Units Processed</p>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.sm, marginBottom: sp.xs }}>
              <span style={{ fontSize: '28px', fontWeight: 300 }}>{unitsData.current.toLocaleString()}</span>
              <ArrowRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
              <span style={{ fontSize: '18px', fontWeight: 500, color: C.purple[600] }}>{unitsData.predicted.toLocaleString()}</span>
            </div>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>Target: {unitsData.target.toLocaleString()}</span>
              <span style={{ display: 'flex', alignItems: 'center', fontSize: '12px', fontWeight: 500, color: unitsData.trendUp ? C.success[600] : C.warning[600] }}>
                {unitsData.trendUp ? <ArrowUpRight style={{ width: 14, height: 14 }} /> : <ArrowDownRight style={{ width: 14, height: 14 }} />}
                {unitsData.trend} vs yesterday
              </span>
            </div>
          </div>
        </div>
      </Card>
      
      {/* ===== QUEUE HEALTH SUMMARY ===== */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.md }}>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Queue Health</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Current depth, velocity, and predicted carryover by function</p>
          </div>
          <div style={{ display: 'flex', gap: sp.md, fontSize: '11px' }}>
            <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 8, height: 8, borderRadius: 2, background: C.success[500] }} /> On track</span>
            <span style={{ display: 'flex', alignItems: 'center', gap: 4 }}><span style={{ width: 8, height: 8, borderRadius: 2, background: C.warning[500] }} /> At risk</span>
          </div>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {queueHealth.map((q, i) => {
            const velocityPct = Math.round((q.velocity / q.velocityTarget) * 100);
            return (
              <div 
                key={i}
                onClick={() => onNavigateToZones && onNavigateToZones(q.id, q.zones)}
                style={{ 
                  display: 'flex', 
                  alignItems: 'center', 
                  padding: sp.md, 
                  background: q.status === 'warning' ? C.warning[50] : C.neutral[50], 
                  borderRadius: 8,
                  border: `1px solid ${q.status === 'warning' ? C.warning[200] : C.neutral[200]}`,
                  cursor: 'pointer',
                  transition: 'all 0.15s'
                }}
                onMouseEnter={(e) => { 
                  e.currentTarget.style.background = q.status === 'warning' ? C.warning[100] : C.neutral[100];
                  e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                }}
                onMouseLeave={(e) => { 
                  e.currentTarget.style.background = q.status === 'warning' ? C.warning[50] : C.neutral[50];
                  e.currentTarget.style.boxShadow = 'none';
                }}
              >
                {/* Queue Name */}
                <div style={{ width: 120, flexShrink: 0 }}>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>{q.name}</p>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>{q.zones.length} zones</p>
                </div>
                
                {/* Current Depth */}
                <div style={{ width: 90, textAlign: 'center' }}>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>Depth</p>
                  <p style={{ fontSize: '16px', fontWeight: 500 }}>{q.current.toLocaleString()}</p>
                </div>
                
                {/* Velocity */}
                <div style={{ width: 100, textAlign: 'center' }}>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>Velocity</p>
                  <p style={{ fontSize: '14px', fontWeight: 500, color: velocityPct >= 95 ? C.success[600] : C.warning[600] }}>
                    {q.velocity}/hr <span style={{ fontSize: '10px', color: C.neutral[400] }}>({velocityPct}%)</span>
                  </p>
                </div>
                
                {/* Time to Clear */}
                <div style={{ width: 80, textAlign: 'center' }}>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>Clear in</p>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>{q.timeToClear}h</p>
                </div>
                
                {/* Carryover */}
                <div style={{ width: 90, textAlign: 'center' }}>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>Carryover</p>
                  <p style={{ fontSize: '14px', fontWeight: 500, color: q.carryover > 0 ? (q.carryoverPct > 3 ? C.warning[600] : C.neutral[600]) : C.success[600] }}>
                    {q.carryover > 0 ? `~${q.carryover}` : '0'} <span style={{ fontSize: '10px' }}>({q.carryoverPct}%)</span>
                  </p>
                </div>
                
                {/* Status + Chevron */}
                <div style={{ flex: 1, display: 'flex', justifyContent: 'flex-end', alignItems: 'center', gap: sp.sm }}>
                  <Badge status={q.status} label={q.statusLabel} />
                  <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
                </div>
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* ===== THROUGHPUT BY FUNCTION - Deviation Chart ===== */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Throughput by Function</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Deviation from target velocity • Left = under, Right = over</p>
        </div>
        
        {/* Legend */}
        <div style={{ display: 'flex', gap: sp.lg, marginBottom: sp.md, justifyContent: 'center' }}>
          <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: '11px', color: C.neutral[600] }}>
            <span style={{ width: 10, height: 10, borderRadius: '50%', background: C.error[500] }} /> Under target
          </span>
          <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: '11px', color: C.neutral[600] }}>
            <span style={{ width: 10, height: 10, borderRadius: '50%', background: C.success[500] }} /> At/Over target
          </span>
        </div>
        
        {/* Deviation Chart */}
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {throughputByFunction.map((f, i) => {
            const deviation = f.actual - f.target;
            const deviationPct = Math.round((deviation / f.target) * 100);
            const isOver = deviation >= 0;
            const maxDeviation = 30; // Max % deviation for scale
            const barWidth = Math.min(Math.abs(deviationPct), maxDeviation) / maxDeviation * 50; // 50% max width each side
            
            return (
              <div key={i} style={{ 
                display: 'flex', 
                alignItems: 'center', 
                padding: `${sp.sm} ${sp.md}`,
                background: C.neutral[50],
                borderRadius: 8,
                gap: sp.md
              }}>
                {/* Function name - fixed width */}
                <div style={{ width: 80, flexShrink: 0 }}>
                  <span style={{ fontSize: '13px', fontWeight: 500 }}>{f.function}</span>
                  <p style={{ fontSize: '9px', color: C.neutral[500] }}>{f.fteCount} FTE</p>
                </div>
                
                {/* Actual/Target values */}
                <div style={{ width: 70, flexShrink: 0, textAlign: 'right' }}>
                  <span style={{ fontSize: '14px', fontWeight: 600, color: isOver ? C.success[600] : C.error[600] }}>{f.actual}</span>
                  <span style={{ fontSize: '11px', color: C.neutral[400] }}>/{f.target}</span>
                </div>
                
                {/* Deviation bar chart */}
                <div style={{ flex: 1, display: 'flex', alignItems: 'center', position: 'relative', height: 32 }}>
                  {/* Center line (target) */}
                  <div style={{ 
                    position: 'absolute', 
                    left: '50%', 
                    top: 0, 
                    bottom: 0, 
                    width: 2, 
                    background: C.neutral[300],
                    zIndex: 1
                  }} />
                  
                  {/* Background track */}
                  <div style={{ 
                    position: 'absolute',
                    left: '10%',
                    right: '10%',
                    height: 8,
                    background: C.neutral[200],
                    borderRadius: 4
                  }} />
                  
                  {/* Deviation bar */}
                  <div style={{ 
                    position: 'absolute',
                    left: isOver ? '50%' : `${50 - barWidth}%`,
                    width: `${barWidth}%`,
                    height: 8,
                    background: isOver ? C.success[500] : C.error[500],
                    borderRadius: 4,
                    transition: 'all 0.3s ease'
                  }} />
                  
                  {/* Dot indicator */}
                  <div style={{ 
                    position: 'absolute',
                    left: `calc(${50 + (isOver ? barWidth : -barWidth)}% - 6px)`,
                    width: 12,
                    height: 12,
                    borderRadius: '50%',
                    background: isOver ? C.success[500] : C.error[500],
                    border: '2px solid white',
                    boxShadow: '0 1px 3px rgba(0,0,0,0.2)',
                    zIndex: 2,
                    transition: 'all 0.3s ease'
                  }} />
                </div>
                
                {/* Deviation value */}
                <div style={{ width: 60, flexShrink: 0, textAlign: 'right' }}>
                  <span style={{ 
                    fontSize: '13px', 
                    fontWeight: 600, 
                    color: isOver ? C.success[600] : C.error[600] 
                  }}>
                    {isOver ? '+' : ''}{deviation}
                  </span>
                  <p style={{ fontSize: '9px', color: C.neutral[500] }}>{isOver ? '+' : ''}{deviationPct}%</p>
                </div>
                
                {/* Trend indicator */}
                <div style={{ width: 20, flexShrink: 0, textAlign: 'center' }}>
                  {f.trend === 'up' && <TrendingUp style={{ width: 14, height: 14, color: C.success[500] }} />}
                  {f.trend === 'down' && <TrendingDown style={{ width: 14, height: 14, color: C.error[500] }} />}
                  {f.trend === 'stable' && <Minus style={{ width: 14, height: 14, color: C.neutral[400] }} />}
                </div>
              </div>
            );
          })}
        </div>
        
        {/* Scale labels */}
        <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: sp.sm, paddingLeft: 150, paddingRight: 80 }}>
          <span style={{ fontSize: '9px', color: C.neutral[400] }}>-30%</span>
          <span style={{ fontSize: '9px', color: C.neutral[500], fontWeight: 500 }}>Target</span>
          <span style={{ fontSize: '9px', color: C.neutral[400] }}>+30%</span>
        </div>
      </Card>
      
      {/* ===== CARRIER CUTOFF TRACKER ===== */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Carrier Cutoffs</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Progress toward carrier pickup deadlines • Click to expand details</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {carrierCutoffs.map((c, i) => {
            const currentPct = Math.round((c.current / c.target) * 100);
            const predictedPct = Math.round((c.predicted / c.target) * 100);
            const willMeet = c.predicted >= c.target;
            const isExpanded = expandedCarrier === c.id;
            
            return (
              <div key={i} style={{ 
                background: c.status === 'warning' ? C.warning[50] : C.neutral[50], 
                borderRadius: 8,
                border: `1px solid ${c.status === 'warning' ? C.warning[200] : C.neutral[200]}`,
                overflow: 'hidden'
              }}>
                {/* Main Row - Clickable */}
                <div 
                  onClick={() => setExpandedCarrier(isExpanded ? null : c.id)}
                  style={{ 
                    display: 'flex', 
                    alignItems: 'center', 
                    padding: sp.md,
                    cursor: 'pointer',
                    transition: 'background 0.15s'
                  }}
                  onMouseEnter={(e) => e.currentTarget.style.background = c.status === 'warning' ? C.warning[100] : C.neutral[100]}
                  onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                >
                  {/* Expand/Collapse Icon */}
                  <ChevronRight style={{ 
                    width: 16, height: 16, 
                    color: C.neutral[400], 
                    marginRight: sp.sm,
                    transform: isExpanded ? 'rotate(90deg)' : 'rotate(0deg)',
                    transition: 'transform 0.2s'
                  }} />
                  
                  {/* Carrier Info */}
                  <div style={{ width: 130, flexShrink: 0 }}>
                    <p style={{ fontSize: '14px', fontWeight: 500 }}>{c.carrier}</p>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>Cutoff: {c.cutoff} ({c.hoursOut}h out)</p>
                  </div>
                  
                  {/* Progress Bar */}
                  <div style={{ flex: 1, marginRight: sp.lg }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                      <span style={{ fontSize: '11px', color: C.neutral[500] }}>{c.current.toLocaleString()} now</span>
                      <span style={{ fontSize: '11px', color: C.purple[600] }}>{c.predicted.toLocaleString()} predicted</span>
                      <span style={{ fontSize: '11px', color: C.neutral[500] }}>{c.target.toLocaleString()} target</span>
                    </div>
                    <div style={{ height: 8, background: C.neutral[200], borderRadius: 4, overflow: 'hidden', position: 'relative' }}>
                      {/* Current progress */}
                      <div style={{ 
                        width: `${Math.min(currentPct, 100)}%`, 
                        height: '100%', 
                        background: c.status === 'success' ? C.success[500] : C.warning[500],
                        position: 'absolute',
                        left: 0,
                        top: 0
                      }} />
                      {/* Predicted marker */}
                      <div style={{
                        position: 'absolute',
                        left: `${Math.min(predictedPct, 100)}%`,
                        top: -2,
                        bottom: -2,
                        width: 3,
                        background: C.purple[500],
                        borderRadius: 2
                      }} />
                      {/* Target line */}
                      <div style={{
                        position: 'absolute',
                        left: '100%',
                        top: -4,
                        bottom: -4,
                        width: 2,
                        background: C.neutral[400],
                        marginLeft: -1
                      }} />
                    </div>
                  </div>
                  
                  {/* Status */}
                  <Badge 
                    status={willMeet ? 'success' : 'warning'} 
                    label={willMeet ? `+${c.predicted - c.target} buffer` : `-${c.target - c.predicted} short`} 
                  />
                </div>
                
                {/* Expanded Detail Section */}
                {isExpanded && (
                  <div style={{ 
                    padding: sp.md, 
                    paddingTop: 0,
                    borderTop: `1px solid ${c.status === 'warning' ? C.warning[200] : C.neutral[200]}`,
                    background: c.status === 'warning' ? C.warning[25] : C.neutral[25]
                  }}>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: sp.md, marginTop: sp.md }}>
                      
                      {/* Velocity */}
                      <div style={{ background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.neutral[200]}` }}>
                        <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.xs }}>VELOCITY</p>
                        <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs }}>
                          <span style={{ 
                            fontSize: '20px', 
                            fontWeight: 600, 
                            color: c.velocity.current >= c.velocity.needed ? C.success[600] : C.warning[600] 
                          }}>
                            {c.velocity.current}
                          </span>
                          <span style={{ fontSize: '12px', color: C.neutral[500] }}>/hr</span>
                          {c.velocity.trend === 'up' && <TrendingUp style={{ width: 14, height: 14, color: C.success[500] }} />}
                          {c.velocity.trend === 'down' && <TrendingDown style={{ width: 14, height: 14, color: C.error[500] }} />}
                        </div>
                        <p style={{ fontSize: '11px', color: C.neutral[500] }}>Need {c.velocity.needed}/hr to meet cutoff</p>
                        
                        {/* Mini trend */}
                        <div style={{ display: 'flex', alignItems: 'flex-end', gap: 2, marginTop: sp.xs, height: 24 }}>
                          {c.hourlyTrend.map((v, idx) => (
                            <div key={idx} style={{ 
                              flex: 1, 
                              height: `${(v / Math.max(...c.hourlyTrend)) * 100}%`,
                              background: idx === c.hourlyTrend.length - 1 
                                ? (c.velocity.current >= c.velocity.needed ? C.success[500] : C.warning[500])
                                : C.neutral[300],
                              borderRadius: 2
                            }} />
                          ))}
                        </div>
                        <p style={{ fontSize: '9px', color: C.neutral[400], marginTop: 2 }}>Last 4 hours</p>
                      </div>
                      
                      {/* Queue Breakdown */}
                      <div style={{ background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.neutral[200]}` }}>
                        <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.xs }}>QUEUE BREAKDOWN</p>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                          {[
                            { label: 'Pick', value: c.queueBreakdown.pick, color: C.blueLight[500] },
                            { label: 'Pack', value: c.queueBreakdown.pack, color: C.orange[500] },
                            { label: 'Ship', value: c.queueBreakdown.ship, color: C.success[500] }
                          ].map((q, idx) => (
                            <div key={idx} style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                              <span style={{ fontSize: '11px', color: C.neutral[600], width: 32 }}>{q.label}</span>
                              <div style={{ flex: 1, height: 6, background: C.neutral[100], borderRadius: 3 }}>
                                <div style={{ 
                                  width: `${(q.value / c.target) * 100}%`, 
                                  height: '100%', 
                                  background: q.color,
                                  borderRadius: 3
                                }} />
                              </div>
                              <span style={{ fontSize: '11px', fontWeight: 500, width: 36, textAlign: 'right' }}>{q.value}</span>
                            </div>
                          ))}
                        </div>
                        <p style={{ fontSize: '10px', color: C.neutral[500], marginTop: sp.xs }}>
                          {c.queueBreakdown.pick + c.queueBreakdown.pack + c.queueBreakdown.ship} orders in pipeline
                        </p>
                      </div>
                      
                      {/* Contributing Factors */}
                      <div style={{ background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.neutral[200]}` }}>
                        <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.xs }}>
                          {c.status === 'warning' ? 'CONTRIBUTING FACTORS' : 'STATUS FACTORS'}
                        </p>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                          {c.factors.map((f, idx) => (
                            <div key={idx} style={{ display: 'flex', alignItems: 'flex-start', gap: sp.xs }}>
                              {c.status === 'warning' 
                                ? <AlertTriangle style={{ width: 12, height: 12, color: C.warning[500], flexShrink: 0, marginTop: 1 }} />
                                : <CheckCircle style={{ width: 12, height: 12, color: C.success[500], flexShrink: 0, marginTop: 1 }} />
                              }
                              <span style={{ fontSize: '11px', color: C.neutral[600] }}>{f}</span>
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                    
                    {/* At-Risk Orders - only show if there are any */}
                    {c.atRiskOrders.length > 0 && (
                      <div style={{ marginTop: sp.md, background: 'white', borderRadius: 6, padding: sp.sm, border: `1px solid ${C.warning[200]}` }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, marginBottom: sp.sm }}>
                          <AlertTriangle style={{ width: 14, height: 14, color: C.warning[600] }} />
                          <span style={{ fontSize: '12px', fontWeight: 500, color: C.warning[700] }}>At-Risk Orders ({c.atRiskOrders.length})</span>
                        </div>
                        <table style={{ width: '100%', fontSize: '11px', borderCollapse: 'collapse' }}>
                          <thead>
                            <tr style={{ borderBottom: `1px solid ${C.neutral[200]}` }}>
                              <th style={{ textAlign: 'left', padding: '4px 8px', color: C.neutral[500], fontWeight: 500 }}>Order</th>
                              <th style={{ textAlign: 'left', padding: '4px 8px', color: C.neutral[500], fontWeight: 500 }}>Customer</th>
                              <th style={{ textAlign: 'left', padding: '4px 8px', color: C.neutral[500], fontWeight: 500 }}>SLA</th>
                              <th style={{ textAlign: 'right', padding: '4px 8px', color: C.neutral[500], fontWeight: 500 }}>Units</th>
                            </tr>
                          </thead>
                          <tbody>
                            {c.atRiskOrders.map((order, idx) => (
                              <tr key={idx} style={{ borderBottom: idx < c.atRiskOrders.length - 1 ? `1px solid ${C.neutral[100]}` : 'none' }}>
                                <td style={{ padding: '6px 8px', fontWeight: 500, color: C.brand[600] }}>{order.order}</td>
                                <td style={{ padding: '6px 8px', color: C.neutral[700] }}>{order.customer}</td>
                                <td style={{ padding: '6px 8px' }}>
                                  <Badge status={order.sla === 'Express' ? 'error' : 'warning'} label={order.sla} />
                                </td>
                                <td style={{ padding: '6px 8px', textAlign: 'right', color: C.neutral[600] }}>{order.units}</td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    )}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* ===== PREDICTIVE ALERTS ===== */}
      <Card style={{ borderLeft: `4px solid ${C.orange[500]}` }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
          <div style={{ width: 32, height: 32, borderRadius: 6, background: C.orange[50], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
            <Zap style={{ width: 16, height: 16, color: C.orange[500] }} />
          </div>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and recommendations for work content • Click for details</p>
          </div>
          <Badge status="warning" label={`${workAlerts.filter(a => a.sev !== 'success').length} Active`} style={{ marginLeft: 'auto' }} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {workAlerts.map((a, i) => (
            <Alert 
              key={i} 
              {...a} 
              onClick={() => onNavigateToAlert && onNavigateToAlert(a.id, a.category, true)}
            />
          ))}
        </div>
        <div 
          onClick={() => onViewInsights && onViewInsights()}
          style={{ 
            marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}`,
            display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.xs,
            cursor: 'pointer', color: C.orange[600], fontSize: '13px', fontWeight: 500
          }}
          onMouseEnter={(e) => e.currentTarget.style.color = C.orange[700]}
          onMouseLeave={(e) => e.currentTarget.style.color = C.orange[600]}
        >
          View Full Analysis <ChevronRight style={{ width: 16, height: 16 }} />
        </div>
      </Card>
    </>
  );
};

// Schedule Tab Content - facility-level schedule overview
const ScheduleTabContent = ({ onViewInsights, onNavigateToStaff, onNavigateToWork, onNavigateToEquipment, onNavigateToAlert }) => {
  const { contextualTime, isContextualDifferent, interpolateValue } = useTimeContext();
  const [scheduleSubTab, setScheduleSubTab] = useState('staffing');
  const [expandedInboundDock, setExpandedInboundDock] = useState(null);
  const [expandedAppointment, setExpandedAppointment] = useState(null);
  const [expandedOutboundDock, setExpandedOutboundDock] = useState(null);
  const [expandedCarrierPickup, setExpandedCarrierPickup] = useState(null);
  
  // ===== STAFFING TAB DATA =====
  const staffingScoreComponents = [
    { label: 'Shift Coverage', value: 88, target: 100, weight: 30, detail: '42/48 FTE on Day Shift', status: 'warning' },
    { label: 'Cutoff Compliance', value: 75, target: 100, weight: 25, detail: '3 of 4 carriers on track', status: 'warning' },
    { label: 'Break Compliance', value: 92, target: 100, weight: 15, detail: 'All breaks within window', status: 'success' },
    { label: 'Handoff Efficiency', value: 95, target: 100, weight: 15, detail: 'Night→Day was clean', status: 'success' },
    { label: 'Schedule Adherence', value: 87, target: 100, weight: 15, detail: '3 late arrivals today', status: 'warning' }
  ];
  const staffingCompositeScore = Math.round(staffingScoreComponents.reduce((sum, c) => sum + (c.value * c.weight / 100), 0));
  
  // ===== SHIFT DATA =====
  const shifts = [
    { 
      id: 'day', name: 'Day Shift', time: '06:00 - 14:00', status: 'active',
      staffPlanned: 48, staffActual: 42, callOuts: 4, late: 2,
      progress: 50, hoursRemaining: 4,
      throughput: 4200, throughputTarget: 4560,
      color: C.brand[500]
    },
    { 
      id: 'swing', name: 'Swing Shift', time: '14:00 - 22:00', status: 'upcoming',
      staffPlanned: 42, staffActual: 38, callOuts: 2, late: 0,
      progress: 0, hoursRemaining: 8,
      throughput: null, throughputTarget: 3800,
      color: C.purple[500]
    },
    { 
      id: 'night', name: 'Night Shift', time: '22:00 - 06:00', status: 'completed',
      staffPlanned: 28, staffActual: 26, callOuts: 1, late: 1,
      progress: 100, hoursRemaining: 0,
      throughput: 3850, throughputTarget: 3600,
      color: C.neutral[600]
    }
  ];
  
  // ===== UPCOMING EVENTS =====
  const upcomingEvents = [
    { time: '10:30', type: 'break', label: 'Break Wave 1', detail: '12 FTE rotating', status: 'upcoming', icon: Coffee },
    { time: '12:00', type: 'break', label: 'Lunch Break', detail: '20 FTE — coverage may drop', status: 'warning', icon: Coffee },
    { time: '14:00', type: 'cutoff', label: 'FedEx Ground Cutoff', detail: '1,920 predicted / 1,850 target', status: 'success', icon: Truck },
    { time: '14:00', type: 'handoff', label: 'Day → Swing Handoff', detail: 'Clean transition expected', status: 'success', icon: Users },
    { time: '15:30', type: 'cutoff', label: 'UPS Cutoff', detail: '1,380 predicted / 1,420 target', status: 'warning', icon: Truck },
    { time: '16:00', type: 'cutoff', label: 'USPS Cutoff', detail: '910 predicted / 890 target', status: 'success', icon: Truck }
  ];
  
  // ===== CARRIER CUTOFFS =====
  const carrierCutoffs = [
    { carrier: 'FedEx Ground', cutoff: '14:00', hoursOut: 4, target: 1850, current: 1247, predicted: 1920, velocity: 168, velocityNeeded: 151, status: 'success' },
    { carrier: 'UPS', cutoff: '15:30', hoursOut: 5.5, target: 1420, current: 680, predicted: 1380, velocity: 127, velocityNeeded: 135, status: 'warning' },
    { carrier: 'USPS', cutoff: '16:00', hoursOut: 6, target: 890, current: 445, predicted: 910, velocity: 74, velocityNeeded: 74, status: 'success' },
    { carrier: 'FedEx Express', cutoff: '17:00', hoursOut: 7, target: 320, current: 124, predicted: 340, velocity: 46, velocityNeeded: 28, status: 'success' }
  ];
  
  // ===== BREAK SCHEDULE =====
  const breakSchedule = [
    { time: '10:30', wave: 'Wave 1', fteCount: 12, coverage: 30, coverageMin: 28, status: 'success' },
    { time: '12:00', wave: 'Lunch', fteCount: 20, coverage: 22, coverageMin: 24, status: 'warning', alert: 'Coverage may drop below minimum' },
    { time: '13:30', wave: 'Wave 2', fteCount: 10, coverage: 32, coverageMin: 28, status: 'success' }
  ];
  
  // ===== ALERTS =====
  // Staffing alerts using shared data
  const staffingAlerts = [
    { ...ALERTS_DATA['staffing-break-coverage'], title: 'Lunch Break Coverage Gap — 12:00', msg: '22 FTE predicted vs 24 minimum. Consider staggering 4 breaks or extending 2 Day Shift workers.' },
    ALERTS_DATA['staffing-ups-cutoff'],
    { ...ALERTS_DATA['staffing-swing-callout'], title: 'Day → Swing Handoff @ 14:00', sev: 'info', msg: 'Clean transition expected. Swing shift fully staffed for volume.' },
    ALERTS_DATA['outbound-fedex-ground-ok']
  ];

  return (
    <>
      <Header icon={Calendar} title="Schedule Overview" sub="Staffing, dock appointments, carrier pickups, and maintenance windows" color={C.greenLight[500]} />
      
      {/* Schedule Sub-tabs */}
      <div style={{ 
        display: 'flex', 
        gap: 0, 
        marginBottom: sp.md,
        borderBottom: `1px solid ${C.neutral[200]}`
      }}>
        {[
          { id: 'staffing', label: 'Staffing', icon: Users, color: C.purple[500] },
          { id: 'inbound', label: 'Inbound', icon: Truck, color: C.blueLight[500] },
          { id: 'outbound', label: 'Outbound', icon: Package, color: C.orange[500] },
          { id: 'maintenance', label: 'Maintenance', icon: Wrench, color: C.neutral[600] }
        ].map((tab) => {
          const Icon = tab.icon;
          return (
            <div
              key={tab.id}
              onClick={() => setScheduleSubTab(tab.id)}
              style={{
                padding: `${sp.sm} ${sp.md}`,
                fontSize: '13px',
                fontWeight: 500,
                color: scheduleSubTab === tab.id ? C.neutral[900] : C.neutral[500],
                borderBottom: scheduleSubTab === tab.id ? `2px solid ${tab.color}` : '2px solid transparent',
                marginBottom: '-1px',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: sp.xs,
                transition: 'all 0.15s'
              }}
              onMouseEnter={(e) => { if (scheduleSubTab !== tab.id) e.currentTarget.style.color = C.neutral[700]; }}
              onMouseLeave={(e) => { if (scheduleSubTab !== tab.id) e.currentTarget.style.color = C.neutral[500]; }}
            >
              <Icon style={{ width: 14, height: 14 }} />
              {tab.label}
            </div>
          );
        })}
      </div>
      
      {/* ===== STAFFING SUB-TAB ===== */}
      {scheduleSubTab === 'staffing' && (
        <>
        {/* Composite Score Breakdown */}
        <Card>
          <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.lg, marginBottom: sp.md }}>
            <div style={{ 
              width: 100, height: 100, borderRadius: '50%', 
              background: `conic-gradient(${staffingCompositeScore >= 85 ? C.success[500] : staffingCompositeScore >= 70 ? C.warning[500] : C.error[500]} ${staffingCompositeScore * 3.6}deg, ${C.neutral[100]} 0deg)`,
              display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0
            }}>
              <div style={{ width: 80, height: 80, borderRadius: '50%', background: 'white', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>
                <span style={{ fontSize: '28px', fontWeight: 600, color: staffingCompositeScore >= 85 ? C.success[600] : staffingCompositeScore >= 70 ? C.warning[600] : C.error[600] }}>{staffingCompositeScore}</span>
                <span style={{ fontSize: '10px', color: C.neutral[500] }}>STAFFING</span>
              </div>
            </div>
            
            <div style={{ flex: 1 }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
                <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Score Breakdown</h3>
                <span style={{ fontSize: '12px', color: C.neutral[500] }}>Weighted composite of 5 factors</span>
              </div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                {staffingScoreComponents.map((comp, i) => (
                  <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <span style={{ fontSize: '12px', color: C.neutral[600], width: 120, flexShrink: 0 }}>{comp.label}</span>
                    <div style={{ flex: 1, height: 8, background: C.neutral[100], borderRadius: 4, overflow: 'hidden' }}>
                      <div style={{ 
                        width: `${comp.value}%`, height: '100%', borderRadius: 4,
                        background: comp.status === 'error' ? C.error[500] : comp.status === 'warning' ? C.warning[500] : C.success[500]
                      }} />
                    </div>
                    <span style={{ fontSize: '12px', fontWeight: 500, width: 32, textAlign: 'right', color: comp.status === 'error' ? C.error[600] : comp.status === 'warning' ? C.warning[600] : C.success[600] }}>{comp.value}%</span>
                    <span style={{ fontSize: '10px', color: C.neutral[400], width: 16, textAlign: 'right' }}>{comp.weight}%</span>
                    <span style={{ fontSize: '11px', color: C.neutral[500], width: 140 }}>{comp.detail}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>
          
          <div style={{ background: C.warning[50], borderRadius: 6, padding: sp.sm, display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <AlertTriangle style={{ width: 16, height: 16, color: C.warning[600] }} />
            <span style={{ fontSize: '12px', color: C.warning[700] }}>
              <strong>Watch:</strong> Cutoff Compliance (75%) at risk due to UPS trajectory. 
              Shift Coverage gap (6 FTE) contributing to velocity shortfall.
            </span>
          </div>
        </Card>
        
        {/* Today's Shifts */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Today's Shifts</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Shift progress, staffing, and throughput • Click to view staff</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {shifts.map((s, i) => {
            const staffPct = Math.round((s.staffActual / s.staffPlanned) * 100);
            const tpPct = s.throughput ? Math.round((s.throughput / s.throughputTarget) * 100) : null;
            return (
              <div 
                key={i} 
                onClick={() => onNavigateToStaff && onNavigateToStaff(s.id)}
                style={{ 
                  padding: sp.md, 
                  background: s.status === 'active' ? C.brand[50] : C.neutral[50], 
                  borderRadius: 8, 
                  border: `1px solid ${s.status === 'active' ? C.brand[200] : C.neutral[200]}`,
                  borderLeft: `4px solid ${s.color}`,
                  cursor: 'pointer',
                  transition: 'all 0.15s'
                }}
                onMouseEnter={(e) => { 
                  e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                  e.currentTarget.style.transform = 'translateY(-1px)';
                }}
                onMouseLeave={(e) => { 
                  e.currentTarget.style.boxShadow = 'none';
                  e.currentTarget.style.transform = 'translateY(0)';
                }}
              >
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.md, marginBottom: s.status === 'active' ? sp.sm : 0 }}>
                  <div style={{ flex: 1 }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                      <p style={{ fontSize: '14px', fontWeight: 500 }}>{s.name}</p>
                      <Badge status={s.status === 'active' ? 'success' : s.status === 'completed' ? 'neutral' : 'purple'} label={s.status === 'active' ? 'LIVE' : s.status === 'completed' ? 'Done' : 'Next'} dot={s.status === 'active'} />
                    </div>
                    <p style={{ fontSize: '12px', color: C.neutral[500] }}>{s.time}</p>
                  </div>
                  
                  {/* Staffing */}
                  <div style={{ textAlign: 'center', minWidth: 80 }}>
                    <p style={{ fontSize: '10px', color: C.neutral[500] }}>Staffing</p>
                    <p style={{ fontSize: '14px', fontWeight: 500, color: staffPct >= 90 ? C.success[600] : C.warning[600] }}>
                      {s.staffActual}/{s.staffPlanned}
                    </p>
                    {s.callOuts > 0 && <p style={{ fontSize: '10px', color: C.error[500] }}>{s.callOuts} call-outs</p>}
                  </div>
                  
                  {/* Throughput */}
                  <div style={{ textAlign: 'center', minWidth: 100 }}>
                    <p style={{ fontSize: '10px', color: C.neutral[500] }}>Throughput</p>
                    {s.throughput !== null ? (
                      <p style={{ fontSize: '14px', fontWeight: 500, color: tpPct >= 95 ? C.success[600] : tpPct >= 85 ? C.warning[600] : C.error[600] }}>
                        {s.throughput.toLocaleString()} <span style={{ fontSize: '10px', color: C.neutral[400] }}>({tpPct}%)</span>
                      </p>
                    ) : (
                      <p style={{ fontSize: '14px', color: C.neutral[400] }}>—</p>
                    )}
                  </div>
                  
                  {/* Progress/Time */}
                  <div style={{ textAlign: 'right', minWidth: 80 }}>
                    {s.status === 'active' && (
                      <>
                        <p style={{ fontSize: '10px', color: C.neutral[500] }}>{s.hoursRemaining}h remaining</p>
                        <p style={{ fontSize: '14px', fontWeight: 500 }}>{s.progress}%</p>
                      </>
                    )}
                    {s.status === 'completed' && <p style={{ fontSize: '12px', color: C.success[600] }}>✓ Complete</p>}
                    {s.status === 'upcoming' && <p style={{ fontSize: '12px', color: C.purple[600] }}>Starts in {s.hoursRemaining - 4}h</p>}
                  </div>
                  
                  {/* Chevron */}
                  <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
                </div>
                
                {/* Progress bar for active shift */}
                {s.status === 'active' && (
                  <div style={{ height: 6, background: C.neutral[200], borderRadius: 3, overflow: 'hidden' }}>
                    <div style={{ width: `${s.progress}%`, height: '100%', background: C.brand[500] }} />
                  </div>
                )}
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* ===== UPCOMING EVENTS TIMELINE ===== */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Upcoming Events</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Breaks, cutoffs, and handoffs for next 6 hours • Click for details</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
          {upcomingEvents.map((event, i) => {
            const Icon = event.icon;
            const colors = {
              break: { bg: C.blueLight[100], icon: C.blueLight[600], border: C.blueLight[200] },
              cutoff: { bg: C.orange[50], icon: C.orange[500], border: C.orange[200] },
              handoff: { bg: C.purple[50], icon: C.purple[500], border: C.purple[200] }
            };
            const c = colors[event.type];
            return (
              <div 
                key={i} 
                onClick={() => {
                  // Navigate based on event type
                  if (event.type === 'break') {
                    onNavigateToStaff && onNavigateToStaff(null); // Go to Staff tab
                  } else if (event.type === 'cutoff') {
                    onNavigateToWork && onNavigateToWork(); // Go to Work Content
                  } else if (event.type === 'handoff') {
                    onNavigateToStaff && onNavigateToStaff(null); // Go to Staff tab
                  }
                }}
                style={{ 
                  display: 'flex', 
                  alignItems: 'center', 
                  gap: sp.md, 
                  padding: sp.sm,
                  background: event.status === 'warning' ? C.warning[50] : C.neutral[50],
                  borderRadius: 6,
                  border: `1px solid ${event.status === 'warning' ? C.warning[200] : C.neutral[200]}`,
                  cursor: 'pointer',
                  transition: 'all 0.15s'
                }}
                onMouseEnter={(e) => { 
                  e.currentTarget.style.boxShadow = '0 2px 6px rgba(0,0,0,0.06)';
                  e.currentTarget.style.transform = 'translateX(2px)';
                }}
                onMouseLeave={(e) => { 
                  e.currentTarget.style.boxShadow = 'none';
                  e.currentTarget.style.transform = 'translateX(0)';
                }}
              >
                <span style={{ fontSize: '13px', fontWeight: 600, color: C.neutral[700], width: 50 }}>{event.time}</span>
                <div style={{ width: 28, height: 28, borderRadius: 6, background: c.bg, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  <Icon style={{ width: 14, height: 14, color: c.icon }} />
                </div>
                <div style={{ flex: 1 }}>
                  <p style={{ fontSize: '13px', fontWeight: 500 }}>{event.label}</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>{event.detail}</p>
                </div>
                <Badge status={event.status === 'warning' ? 'warning' : event.status === 'success' ? 'success' : 'neutral'} label={event.status === 'warning' ? 'At Risk' : event.status === 'success' ? 'On Track' : 'Upcoming'} />
                <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* ===== CARRIER CUTOFFS ===== */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Carrier Cutoffs</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Progress and velocity toward pickup deadlines • Click for details</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {carrierCutoffs.map((c, i) => {
            const currentPct = Math.round((c.current / c.target) * 100);
            const willMeet = c.predicted >= c.target;
            return (
              <div 
                key={i} 
                onClick={() => onNavigateToWork && onNavigateToWork()}
                style={{ 
                  display: 'flex', 
                  alignItems: 'center', 
                  gap: sp.md,
                  padding: sp.md, 
                  background: c.status === 'warning' ? C.warning[50] : C.neutral[50], 
                  borderRadius: 8,
                  border: `1px solid ${c.status === 'warning' ? C.warning[200] : C.neutral[200]}`,
                  cursor: 'pointer',
                  transition: 'all 0.15s'
                }}
                onMouseEnter={(e) => { 
                  e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                  e.currentTarget.style.transform = 'translateY(-1px)';
                }}
                onMouseLeave={(e) => { 
                  e.currentTarget.style.boxShadow = 'none';
                  e.currentTarget.style.transform = 'translateY(0)';
                }}
              >
                <div style={{ width: 120, flexShrink: 0 }}>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>{c.carrier}</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>{c.cutoff} ({c.hoursOut}h out)</p>
                </div>
                
                <div style={{ flex: 1 }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4, fontSize: '11px' }}>
                    <span style={{ color: C.neutral[500] }}>{c.current.toLocaleString()} done</span>
                    <span style={{ color: C.purple[600] }}>{c.predicted.toLocaleString()} pred</span>
                  </div>
                  <div style={{ height: 6, background: C.neutral[200], borderRadius: 3, overflow: 'hidden', position: 'relative' }}>
                    <div style={{ width: `${currentPct}%`, height: '100%', background: c.status === 'success' ? C.success[500] : C.warning[500] }} />
                  </div>
                </div>
                
                <div style={{ textAlign: 'center', minWidth: 80 }}>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>Velocity</p>
                  <p style={{ fontSize: '13px', fontWeight: 500, color: c.velocity >= c.velocityNeeded ? C.success[600] : C.warning[600] }}>
                    {c.velocity}/hr
                  </p>
                  <p style={{ fontSize: '10px', color: C.neutral[400] }}>need {c.velocityNeeded}</p>
                </div>
                
                <Badge status={willMeet ? 'success' : 'warning'} label={willMeet ? `+${c.predicted - c.target}` : `${c.predicted - c.target}`} />
                <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
              </div>
            );
          })}
        </div>
        
        {/* View All Work Content link */}
        <div style={{ marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}`, display: 'flex', justifyContent: 'flex-end' }}>
          <span
            onClick={() => onNavigateToWork && onNavigateToWork()}
            style={{ fontSize: '13px', fontWeight: 500, color: C.greenLight[600], cursor: 'pointer', display: 'flex', alignItems: 'center', gap: sp.xs }}
            onMouseEnter={(e) => e.currentTarget.style.color = C.greenLight[700]}
            onMouseLeave={(e) => e.currentTarget.style.color = C.greenLight[600]}
          >
            View All Work Content <ChevronRight style={{ width: 14, height: 14 }} />
          </span>
        </div>
      </Card>
      
      {/* ===== BREAK SCHEDULE ===== */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Break Schedule</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Upcoming breaks and coverage impact</p>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm }}>
          {breakSchedule.map((b, i) => (
            <div key={i} style={{ 
              padding: sp.md, 
              background: b.status === 'warning' ? C.warning[50] : C.neutral[50], 
              borderRadius: 8,
              border: `1px solid ${b.status === 'warning' ? C.warning[200] : C.neutral[200]}`
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                <span style={{ fontSize: '14px', fontWeight: 600 }}>{b.time}</span>
                <Badge status={b.status} label={b.wave} />
              </div>
              <p style={{ fontSize: '12px', color: C.neutral[600], marginBottom: sp.xs }}>{b.fteCount} FTE on break</p>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span style={{ fontSize: '11px', color: C.neutral[500] }}>Coverage:</span>
                <span style={{ fontSize: '13px', fontWeight: 500, color: b.coverage >= b.coverageMin ? C.success[600] : C.warning[600] }}>
                  {b.coverage} FTE <span style={{ fontSize: '10px', color: C.neutral[400] }}>(min {b.coverageMin})</span>
                </span>
              </div>
              {b.alert && <p style={{ fontSize: '10px', color: C.warning[600], marginTop: sp.xs }}>{b.alert}</p>}
            </div>
          ))}
        </div>
      </Card>
      
      {/* ===== PREDICTIVE ALERTS ===== */}
      <Card style={{ borderLeft: `4px solid ${C.greenLight[500]}` }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
          <div style={{ width: 32, height: 32, borderRadius: 6, background: C.greenLight[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
            <Zap style={{ width: 16, height: 16, color: C.greenLight[600] }} />
          </div>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and recommendations for schedule • Click for details</p>
          </div>
          <Badge status="warning" label={`${staffingAlerts.filter(a => a.sev === 'warning' || a.sev === 'critical').length} Active`} style={{ marginLeft: 'auto' }} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {staffingAlerts.map((a, i) => (
            <Alert 
              key={i} 
              {...a} 
              onClick={() => onNavigateToAlert && onNavigateToAlert(a.id, a.category, true)}
            />
          ))}
        </div>
        <div 
          onClick={() => onViewInsights && onViewInsights()}
          style={{ 
            marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}`,
            display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.xs,
            cursor: 'pointer', color: C.greenLight[600], fontSize: '13px', fontWeight: 500
          }}
          onMouseEnter={(e) => e.currentTarget.style.color = C.greenLight[700]}
          onMouseLeave={(e) => e.currentTarget.style.color = C.greenLight[600]}
        >
          View Full Analysis <ChevronRight style={{ width: 16, height: 16 }} />
        </div>
      </Card>
      </>
      )}
      
      {/* ===== INBOUND SUB-TAB ===== */}
      {scheduleSubTab === 'inbound' && (
        <>
        {/* Inbound Score Breakdown */}
        <Card>
          <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.lg, marginBottom: sp.md }}>
            <div style={{ 
              width: 100, height: 100, borderRadius: '50%', 
              background: `conic-gradient(${C.warning[500]} ${78 * 3.6}deg, ${C.neutral[100]} 0deg)`,
              display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0
            }}>
              <div style={{ width: 80, height: 80, borderRadius: '50%', background: 'white', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>
                <span style={{ fontSize: '28px', fontWeight: 600, color: C.warning[600] }}>78</span>
                <span style={{ fontSize: '10px', color: C.neutral[500] }}>INBOUND</span>
              </div>
            </div>
            
            <div style={{ flex: 1 }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
                <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Inbound Score</h3>
                <span style={{ fontSize: '12px', color: C.neutral[500] }}>Dock utilization & receiving efficiency • Click factor for details</span>
              </div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                {[
                  { label: 'On-Time Arrivals', value: 67, weight: 30, detail: '4 of 6 on schedule', status: 'warning', scrollTo: 'inbound-appointments' },
                  { label: 'Dock Utilization', value: 83, weight: 25, detail: '5 of 6 doors active', status: 'warning', scrollTo: 'inbound-docks' },
                  { label: 'Receiving Velocity', value: 88, weight: 25, detail: '94 units/hr vs 107 target', status: 'warning', scrollTo: 'inbound-appointments' },
                  { label: 'Dwell Time', value: 72, weight: 20, detail: 'Avg 48 min vs 35 target', status: 'warning', scrollTo: 'inbound-appointments' }
                ].map((comp, i) => (
                  <div 
                    key={i} 
                    onClick={() => {
                      const el = document.getElementById(comp.scrollTo);
                      if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }}
                    style={{ 
                      display: 'flex', 
                      alignItems: 'center', 
                      gap: sp.sm,
                      padding: `${sp.xs} ${sp.sm}`,
                      margin: `0 -${sp.sm}`,
                      borderRadius: 4,
                      cursor: 'pointer',
                      transition: 'background 0.15s'
                    }}
                    onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[100]}
                    onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                  >
                    <span style={{ fontSize: '12px', color: C.neutral[600], width: 110, flexShrink: 0 }}>{comp.label}</span>
                    <div style={{ flex: 1, height: 8, background: C.neutral[100], borderRadius: 4, overflow: 'hidden' }}>
                      <div style={{ width: `${comp.value}%`, height: '100%', borderRadius: 4, background: comp.status === 'warning' ? C.warning[500] : C.success[500] }} />
                    </div>
                    <span style={{ fontSize: '12px', fontWeight: 500, width: 32, textAlign: 'right', color: comp.status === 'warning' ? C.warning[600] : C.success[600] }}>{comp.value}%</span>
                    <span style={{ fontSize: '11px', color: C.neutral[500], width: 130 }}>{comp.detail}</span>
                    <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
                  </div>
                ))}
              </div>
            </div>
          </div>
          
          <div style={{ background: C.warning[50], borderRadius: 6, padding: sp.sm, display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <AlertTriangle style={{ width: 16, height: 16, color: C.warning[600] }} />
            <span style={{ fontSize: '12px', color: C.warning[700] }}>
              <strong>Issue:</strong> Truck #T-1847 arrived 45 min early, competing for Dock 1 with scheduled arrival. 
              Truck #T-1852 running 30 min late — receiving crew idle at Dock 3.
            </span>
          </div>
        </Card>
        
        {/* Dock Door Status */}
        <Card id="inbound-docks">
          <div style={{ marginBottom: sp.md }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Dock Door Status</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Real-time receiving dock availability and assignments • Click for details</p>
          </div>
          
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(6, 1fr)', gap: sp.sm }}>
            {[
              { door: 1, status: 'occupied', truck: 'T-1847', since: '09:45', crew: 2, progress: 65, supplier: 'Acme Manufacturing', pallets: 32, unitsRemaining: 672, estComplete: '11:15' },
              { door: 2, status: 'available', truck: null, since: null, crew: 0, nextAppt: '11:30', nextSupplier: 'Global Parts Co', nextPallets: 22 },
              { door: 3, status: 'waiting', truck: 'T-1852', since: null, crew: 2, note: 'Crew waiting', supplier: 'BuildMaster', delayReason: 'Traffic on I-95', eta: '10:30' },
              { door: 4, status: 'available', truck: null, since: null, crew: 0, nextAppt: '13:00', nextSupplier: 'TechSupply Inc', nextPallets: 16 },
              { door: 5, status: 'available', truck: null, since: null, crew: 0, nextAppt: '14:30', nextSupplier: 'PackRight LLC', nextPallets: 14 },
              { door: 6, status: 'maintenance', truck: null, since: null, crew: 0, note: 'Door sensor repair', maintTech: 'R. Chen', estReturn: '12:00' }
            ].map((dock, i) => {
              const colors = {
                occupied: { bg: C.brand[100], border: C.brand[300], icon: C.brand[600] },
                available: { bg: C.success[50], border: C.success[200], icon: C.success[600] },
                waiting: { bg: C.warning[50], border: C.warning[200], icon: C.warning[600] },
                maintenance: { bg: C.neutral[100], border: C.neutral[300], icon: C.neutral[500] }
              };
              const c = colors[dock.status];
              const isExpanded = expandedInboundDock === dock.door;
              
              return (
                <div 
                  key={i} 
                  onClick={() => setExpandedInboundDock(isExpanded ? null : dock.door)}
                  style={{ 
                    padding: sp.md, 
                    background: c.bg, 
                    borderRadius: 8, 
                    border: `2px solid ${isExpanded ? c.icon : c.border}`,
                    textAlign: 'center',
                    cursor: 'pointer',
                    transition: 'all 0.15s',
                    boxShadow: isExpanded ? `0 4px 12px ${c.icon}30` : 'none'
                  }}
                  onMouseEnter={(e) => { if (!isExpanded) e.currentTarget.style.transform = 'translateY(-2px)'; }}
                  onMouseLeave={(e) => { if (!isExpanded) e.currentTarget.style.transform = 'translateY(0)'; }}
                >
                  <p style={{ fontSize: '20px', fontWeight: 600, color: c.icon }}>D{dock.door}</p>
                  <p style={{ fontSize: '11px', fontWeight: 500, color: c.icon, textTransform: 'uppercase', marginBottom: sp.xs }}>
                    {dock.status}
                  </p>
                  
                  {dock.truck && (
                    <p style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[700] }}>{dock.truck}</p>
                  )}
                  {dock.since && (
                    <p style={{ fontSize: '10px', color: C.neutral[500] }}>Since {dock.since}</p>
                  )}
                  {dock.progress && (
                    <div style={{ marginTop: sp.xs }}>
                      <div style={{ height: 4, background: C.neutral[200], borderRadius: 2 }}>
                        <div style={{ width: `${dock.progress}%`, height: '100%', background: C.brand[500], borderRadius: 2 }} />
                      </div>
                      <p style={{ fontSize: '10px', color: C.neutral[500], marginTop: 2 }}>{dock.progress}%</p>
                    </div>
                  )}
                  {dock.nextAppt && (
                    <p style={{ fontSize: '10px', color: C.neutral[500] }}>Next: {dock.nextAppt}</p>
                  )}
                  {dock.note && (
                    <p style={{ fontSize: '10px', color: dock.status === 'waiting' ? C.warning[600] : C.neutral[500] }}>{dock.note}</p>
                  )}
                  {dock.crew > 0 && (
                    <p style={{ fontSize: '10px', color: C.neutral[600], marginTop: sp.xs }}>{dock.crew} FTE assigned</p>
                  )}
                </div>
              );
            })}
          </div>
          
          {/* Expanded Dock Detail */}
          {expandedInboundDock && (() => {
            const dockData = [
              { door: 1, status: 'occupied', truck: 'T-1847', since: '09:45', crew: 2, progress: 65, supplier: 'Acme Manufacturing', pallets: 32, unitsRemaining: 672, estComplete: '11:15', carrier: 'ABC Freight', po: 'PO-88450' },
              { door: 2, status: 'available', truck: null, since: null, crew: 0, nextAppt: '11:30', nextSupplier: 'Global Parts Co', nextPallets: 22, nextCarrier: 'FastHaul' },
              { door: 3, status: 'waiting', truck: 'T-1852', since: null, crew: 2, note: 'Crew waiting', supplier: 'BuildMaster', delayReason: 'Traffic on I-95', eta: '10:30', carrier: 'Continental Carriers', pallets: 28, po: 'PO-88455' },
              { door: 4, status: 'available', truck: null, since: null, crew: 0, nextAppt: '13:00', nextSupplier: 'TechSupply Inc', nextPallets: 16, nextCarrier: 'XPress Logistics' },
              { door: 5, status: 'available', truck: null, since: null, crew: 0, nextAppt: '14:30', nextSupplier: 'PackRight LLC', nextPallets: 14, nextCarrier: 'Regional Transport' },
              { door: 6, status: 'maintenance', truck: null, since: null, crew: 0, note: 'Door sensor repair', maintTech: 'R. Chen', estReturn: '12:00', workOrder: 'WO-2853' }
            ].find(d => d.door === expandedInboundDock);
            
            if (!dockData) return null;
            
            const colors = {
              occupied: { bg: C.brand[50], border: C.brand[200], accent: C.brand[600] },
              available: { bg: C.success[50], border: C.success[200], accent: C.success[600] },
              waiting: { bg: C.warning[50], border: C.warning[200], accent: C.warning[600] },
              maintenance: { bg: C.neutral[50], border: C.neutral[200], accent: C.neutral[600] }
            };
            const dc = colors[dockData.status];
            
            return (
              <div style={{ 
                marginTop: sp.md, 
                padding: sp.md, 
                background: dc.bg, 
                borderRadius: 8, 
                border: `1px solid ${dc.border}` 
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.sm }}>
                  <div>
                    <h4 style={{ fontSize: '14px', fontWeight: 600, color: dc.accent }}>Dock {dockData.door} Details</h4>
                    <p style={{ fontSize: '12px', color: C.neutral[500], textTransform: 'capitalize' }}>{dockData.status}</p>
                  </div>
                  <button 
                    onClick={(e) => { e.stopPropagation(); setExpandedInboundDock(null); }}
                    style={{ background: 'none', border: 'none', cursor: 'pointer', padding: 4 }}
                  >
                    <X style={{ width: 16, height: 16, color: C.neutral[400] }} />
                  </button>
                </div>
                
                {dockData.status === 'occupied' && (
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Truck</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.truck}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.carrier}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Supplier</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.supplier}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.po}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Progress</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.progress}% complete</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.unitsRemaining} units left</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Est. Complete</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.estComplete}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.crew} FTE assigned</p>
                    </div>
                  </div>
                )}
                
                {dockData.status === 'available' && (
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Next Appointment</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.nextAppt}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Supplier</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.nextSupplier}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.nextCarrier}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Expected Load</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.nextPallets} pallets</p>
                    </div>
                  </div>
                )}
                
                {dockData.status === 'waiting' && (
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Truck</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.truck}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.carrier}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Supplier</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.supplier}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.po}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Delay Reason</p>
                      <p style={{ fontSize: '13px', fontWeight: 500, color: C.warning[600] }}>{dockData.delayReason}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>ETA</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.eta}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.crew} FTE waiting</p>
                    </div>
                  </div>
                )}
                
                {dockData.status === 'maintenance' && (
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Issue</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.note}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Technician</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.maintTech}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.workOrder}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Est. Return</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.estReturn}</p>
                    </div>
                  </div>
                )}
              </div>
            );
          })()}
        </Card>
        
        {/* Today's Dock Appointments */}
        <Card id="inbound-appointments">
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Today's Dock Appointments</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>Scheduled inbound trucks and receiving status • Click for details</p>
            </div>
            <div style={{ display: 'flex', gap: sp.xs }}>
              <Badge status="success" label="4 Complete" />
              <Badge status="warning" label="2 In Progress" />
              <Badge status="neutral" label="3 Upcoming" />
            </div>
          </div>
          
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
            {[
              { id: 'T-1842', carrier: 'ABC Freight', supplier: 'Acme Manufacturing', scheduled: '06:00', actual: '06:12', dock: 'Dock 1', status: 'complete', pallets: 24, units: 1440, po: 'PO-88421', unloadTime: 42, skus: 48, receivedBy: 'M. Santos', putawayZone: 'Bulk Storage' },
              { id: 'T-1844', carrier: 'FastHaul', supplier: 'Global Parts Co', scheduled: '07:30', actual: '07:28', dock: 'Dock 2', status: 'complete', pallets: 18, units: 864, po: 'PO-88435', unloadTime: 35, skus: 32, receivedBy: 'C. Mendez', putawayZone: 'Reserve 1' },
              { id: 'T-1845', carrier: 'XPress Logistics', supplier: 'TechSupply Inc', scheduled: '08:00', actual: '08:15', dock: 'Dock 4', status: 'complete', pallets: 12, units: 720, po: 'PO-88440', unloadTime: 28, skus: 24, receivedBy: 'J. Martinez', putawayZone: 'Forward Pick A' },
              { id: 'T-1846', carrier: 'Regional Transport', supplier: 'PackRight LLC', scheduled: '09:00', actual: '08:55', dock: 'Dock 5', status: 'complete', pallets: 20, units: 960, po: 'PO-88442', unloadTime: 38, skus: 36, receivedBy: 'D. Kim', putawayZone: 'Bulk Storage' },
              { id: 'T-1847', carrier: 'ABC Freight', supplier: 'Acme Manufacturing', scheduled: '10:30', actual: '09:45', dock: 'Dock 1', status: 'unloading', pallets: 32, units: 1920, po: 'PO-88450', unloadTime: null, issue: 'Arrived 45 min early — dock conflict', skus: 56, assignedCrew: ['M. Brown', 'L. Chen'], progress: 65, unitsRemaining: 672 },
              { id: 'T-1852', carrier: 'Continental Carriers', supplier: 'BuildMaster', scheduled: '10:00', actual: null, dock: 'Dock 3', status: 'delayed', pallets: 28, units: 1680, po: 'PO-88455', eta: '10:30', issue: 'Running 30 min late — traffic on I-95', skus: 42, assignedCrew: ['R. Patel', 'A. Garcia'], waitingSince: '09:45' },
              { id: 'T-1855', carrier: 'FastHaul', supplier: 'Global Parts Co', scheduled: '11:30', actual: null, dock: 'Dock 2', status: 'scheduled', pallets: 22, units: 1056, po: 'PO-88460', skus: 28 },
              { id: 'T-1858', carrier: 'XPress Logistics', supplier: 'TechSupply Inc', scheduled: '13:00', actual: null, dock: 'Dock 4', status: 'scheduled', pallets: 16, units: 960, po: 'PO-88465', skus: 20 },
              { id: 'T-1860', carrier: 'Regional Transport', supplier: 'PackRight LLC', scheduled: '14:30', actual: null, dock: 'Dock 6', status: 'scheduled', pallets: 14, units: 672, po: 'PO-88470', skus: 18 }
            ].map((appt, i) => {
              const statusColors = {
                complete: { bg: C.success[50], border: C.success[200], text: C.success[700], label: 'Complete' },
                unloading: { bg: C.brand[50], border: C.brand[200], text: C.brand[700], label: 'Unloading' },
                delayed: { bg: C.error[50], border: C.error[200], text: C.error[700], label: 'Delayed' },
                scheduled: { bg: C.neutral[50], border: C.neutral[200], text: C.neutral[600], label: 'Scheduled' }
              };
              const sc = statusColors[appt.status];
              const isExpanded = expandedAppointment === appt.id;
              
              return (
                <div key={i}>
                  <div 
                    onClick={() => setExpandedAppointment(isExpanded ? null : appt.id)}
                    style={{ 
                      display: 'flex', 
                      alignItems: 'center',
                      padding: sp.md, 
                      background: sc.bg, 
                      borderRadius: isExpanded ? '8px 8px 0 0' : 8,
                      border: `1px solid ${isExpanded ? sc.text : sc.border}`,
                      borderBottom: isExpanded ? 'none' : `1px solid ${sc.border}`,
                      gap: sp.md,
                      cursor: 'pointer',
                      transition: 'all 0.15s'
                    }}
                    onMouseEnter={(e) => { if (!isExpanded) e.currentTarget.style.boxShadow = '0 2px 6px rgba(0,0,0,0.06)'; }}
                    onMouseLeave={(e) => { if (!isExpanded) e.currentTarget.style.boxShadow = 'none'; }}
                  >
                    {/* Time */}
                    <div style={{ width: 70, flexShrink: 0 }}>
                      <p style={{ fontSize: '14px', fontWeight: 600, color: C.neutral[800] }}>{appt.scheduled}</p>
                      {appt.actual && appt.status !== 'scheduled' && (
                        <p style={{ fontSize: '10px', color: appt.actual !== appt.scheduled ? C.warning[600] : C.success[600] }}>
                          Actual: {appt.actual}
                        </p>
                      )}
                      {appt.eta && <p style={{ fontSize: '10px', color: C.error[600] }}>ETA: {appt.eta}</p>}
                    </div>
                    
                    {/* Truck & Supplier */}
                    <div style={{ flex: 1, minWidth: 0 }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                        <span style={{ fontSize: '13px', fontWeight: 500 }}>{appt.id}</span>
                        <span style={{ fontSize: '11px', color: C.neutral[500] }}>{appt.carrier}</span>
                      </div>
                      <p style={{ fontSize: '12px', color: C.neutral[600] }}>{appt.supplier} • {appt.po}</p>
                      {appt.issue && (
                        <p style={{ fontSize: '11px', color: C.error[600], marginTop: 2 }}>⚠ {appt.issue}</p>
                      )}
                    </div>
                    
                    {/* Dock */}
                    <div style={{ textAlign: 'center', width: 60 }}>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Dock</p>
                      <p style={{ fontSize: '14px', fontWeight: 600, color: C.blueLight[600] }}>{appt.dock.replace('Dock ', '')}</p>
                    </div>
                    
                    {/* Cargo */}
                    <div style={{ textAlign: 'center', width: 70 }}>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Pallets</p>
                      <p style={{ fontSize: '14px', fontWeight: 500 }}>{appt.pallets}</p>
                    </div>
                    
                    <div style={{ textAlign: 'center', width: 70 }}>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Units</p>
                      <p style={{ fontSize: '14px', fontWeight: 500 }}>{appt.units.toLocaleString()}</p>
                    </div>
                    
                    {/* Unload Time / Status */}
                    <div style={{ width: 90, textAlign: 'right' }}>
                      {appt.unloadTime && (
                        <p style={{ fontSize: '12px', color: C.neutral[600] }}>{appt.unloadTime} min</p>
                      )}
                      <Badge status={appt.status === 'complete' ? 'success' : appt.status === 'unloading' ? 'info' : appt.status === 'delayed' ? 'error' : 'neutral'} label={sc.label} />
                    </div>
                    
                    <ChevronRight style={{ 
                      width: 16, height: 16, color: C.neutral[400],
                      transform: isExpanded ? 'rotate(90deg)' : 'rotate(0deg)',
                      transition: 'transform 0.15s'
                    }} />
                  </div>
                  
                  {/* Expanded Detail */}
                  {isExpanded && (
                    <div style={{ 
                      padding: sp.md, 
                      background: `${sc.bg}`, 
                      borderRadius: '0 0 8px 8px',
                      border: `1px solid ${sc.text}`,
                      borderTop: `1px dashed ${sc.border}`
                    }}>
                      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
                        <div>
                          <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>SKUs</p>
                          <p style={{ fontSize: '13px', fontWeight: 500 }}>{appt.skus} unique items</p>
                        </div>
                        
                        {appt.status === 'complete' && (
                          <>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Received By</p>
                              <p style={{ fontSize: '13px', fontWeight: 500 }}>{appt.receivedBy}</p>
                            </div>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Putaway Zone</p>
                              <p style={{ fontSize: '13px', fontWeight: 500 }}>{appt.putawayZone}</p>
                            </div>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Performance</p>
                              <p style={{ fontSize: '13px', fontWeight: 500, color: appt.unloadTime < 40 ? C.success[600] : C.neutral[600] }}>
                                {appt.unloadTime < 40 ? '✓ Under target' : 'On target'}
                              </p>
                            </div>
                          </>
                        )}
                        
                        {appt.status === 'unloading' && (
                          <>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Assigned Crew</p>
                              <p style={{ fontSize: '13px', fontWeight: 500 }}>{appt.assignedCrew?.join(', ')}</p>
                            </div>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Progress</p>
                              <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                                <div style={{ flex: 1, height: 6, background: C.neutral[200], borderRadius: 3 }}>
                                  <div style={{ width: `${appt.progress}%`, height: '100%', background: C.brand[500], borderRadius: 3 }} />
                                </div>
                                <span style={{ fontSize: '12px', fontWeight: 500 }}>{appt.progress}%</span>
                              </div>
                            </div>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Units Remaining</p>
                              <p style={{ fontSize: '13px', fontWeight: 500 }}>{appt.unitsRemaining?.toLocaleString()}</p>
                            </div>
                          </>
                        )}
                        
                        {appt.status === 'delayed' && (
                          <>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Assigned Crew</p>
                              <p style={{ fontSize: '13px', fontWeight: 500 }}>{appt.assignedCrew?.join(', ')}</p>
                            </div>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Waiting Since</p>
                              <p style={{ fontSize: '13px', fontWeight: 500, color: C.warning[600] }}>{appt.waitingSince}</p>
                            </div>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Idle Time</p>
                              <p style={{ fontSize: '13px', fontWeight: 500, color: C.error[600] }}>~45 min</p>
                            </div>
                          </>
                        )}
                        
                        {appt.status === 'scheduled' && (
                          <>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Est. Unload Time</p>
                              <p style={{ fontSize: '13px', fontWeight: 500 }}>{Math.round(appt.pallets * 1.8)} min</p>
                            </div>
                            <div>
                              <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Crew Needed</p>
                              <p style={{ fontSize: '13px', fontWeight: 500 }}>{appt.pallets > 20 ? 2 : 1} FTE</p>
                            </div>
                          </>
                        )}
                      </div>
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        </Card>
        
        {/* Inbound Analysis */}
        <Card style={{ borderLeft: `4px solid ${C.blueLight[500]}` }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
            <div style={{ width: 32, height: 32, borderRadius: 6, background: C.blueLight[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
              <Zap style={{ width: 16, height: 16, color: C.blueLight[600] }} />
            </div>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and recommendations for inbound operations • Click for details</p>
            </div>
            <Badge status="warning" label="2 Active" style={{ marginLeft: 'auto' }} />
          </div>
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
            <Alert 
              {...ALERTS_DATA['inbound-dock-congestion']} 
              onClick={() => onNavigateToAlert && onNavigateToAlert('inbound-dock-congestion', 'schedules', true)}
            />
            <Alert 
              {...ALERTS_DATA['inbound-crew-gap']} 
              onClick={() => onNavigateToAlert && onNavigateToAlert('inbound-crew-gap', 'schedules', true)}
            />
            <Alert 
              {...ALERTS_DATA['inbound-afternoon-light']} 
              onClick={() => onNavigateToAlert && onNavigateToAlert('inbound-afternoon-light', 'schedules', true)}
            />
          </div>
          <div 
            onClick={() => onViewInsights && onViewInsights()}
            style={{ 
              marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}`,
              display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.xs,
              cursor: 'pointer', color: C.blueLight[600], fontSize: '13px', fontWeight: 500
            }}
            onMouseEnter={(e) => e.currentTarget.style.color = C.blueLight[700]}
            onMouseLeave={(e) => e.currentTarget.style.color = C.blueLight[600]}
          >
            View Full Analysis <ChevronRight style={{ width: 16, height: 16 }} />
          </div>
        </Card>
        </>
      )}
      
      {/* ===== OUTBOUND SUB-TAB ===== */}
      {scheduleSubTab === 'outbound' && (
        <>
        {/* Outbound Score Breakdown */}
        <Card>
          <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.lg, marginBottom: sp.md }}>
            <div style={{ 
              width: 100, height: 100, borderRadius: '50%', 
              background: `conic-gradient(${C.warning[500]} ${82 * 3.6}deg, ${C.neutral[100]} 0deg)`,
              display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0
            }}>
              <div style={{ width: 80, height: 80, borderRadius: '50%', background: 'white', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>
                <span style={{ fontSize: '28px', fontWeight: 600, color: C.warning[600] }}>82</span>
                <span style={{ fontSize: '10px', color: C.neutral[500] }}>OUTBOUND</span>
              </div>
            </div>
            
            <div style={{ flex: 1 }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
                <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Outbound Score</h3>
                <span style={{ fontSize: '12px', color: C.neutral[500] }}>Shipping efficiency & carrier compliance • Click factor for details</span>
              </div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                {[
                  { label: 'Cutoff Compliance', value: 75, weight: 35, detail: '3 of 4 carriers on track', status: 'warning', scrollTo: 'outbound-pickups' },
                  { label: 'Staging Readiness', value: 88, weight: 25, detail: '22 of 25 loads staged', status: 'warning', scrollTo: 'outbound-docks' },
                  { label: 'Dock Utilization', value: 92, weight: 20, detail: '5 of 6 doors active', status: 'success', scrollTo: 'outbound-docks' },
                  { label: 'Load Accuracy', value: 98, weight: 20, detail: '99.1% — 2 corrections today', status: 'success', scrollTo: 'outbound-pickups' }
                ].map((comp, i) => (
                  <div 
                    key={i} 
                    onClick={() => {
                      const el = document.getElementById(comp.scrollTo);
                      if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }}
                    style={{ 
                      display: 'flex', 
                      alignItems: 'center', 
                      gap: sp.sm,
                      padding: `${sp.xs} ${sp.sm}`,
                      margin: `0 -${sp.sm}`,
                      borderRadius: 4,
                      cursor: 'pointer',
                      transition: 'background 0.15s'
                    }}
                    onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[100]}
                    onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                  >
                    <span style={{ fontSize: '12px', color: C.neutral[600], width: 110, flexShrink: 0 }}>{comp.label}</span>
                    <div style={{ flex: 1, height: 8, background: C.neutral[100], borderRadius: 4, overflow: 'hidden' }}>
                      <div style={{ width: `${comp.value}%`, height: '100%', borderRadius: 4, background: comp.status === 'warning' ? C.warning[500] : C.success[500] }} />
                    </div>
                    <span style={{ fontSize: '12px', fontWeight: 500, width: 32, textAlign: 'right', color: comp.status === 'warning' ? C.warning[600] : C.success[600] }}>{comp.value}%</span>
                    <span style={{ fontSize: '11px', color: C.neutral[500], width: 140 }}>{comp.detail}</span>
                    <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
                  </div>
                ))}
              </div>
            </div>
          </div>
          
          <div style={{ background: C.warning[50], borderRadius: 6, padding: sp.sm, display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <AlertTriangle style={{ width: 16, height: 16, color: C.warning[600] }} />
            <span style={{ fontSize: '12px', color: C.warning[700] }}>
              <strong>Risk:</strong> UPS cutoff (15:30) at risk — current velocity 127/hr vs 135/hr needed. 
              3 loads not yet staged for FedEx Express (17:00 cutoff).
            </span>
          </div>
        </Card>
        
        {/* Shipping Dock Status */}
        <Card id="outbound-docks">
          <div style={{ marginBottom: sp.md }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Shipping Dock Status</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Outbound dock assignments and trailer status • Click for details</p>
          </div>
          
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(6, 1fr)', gap: sp.sm }}>
            {[
              { door: 7, status: 'loading', carrier: 'FedEx Ground', trailer: 'TRL-4421', progress: 78, orders: 145, eta: '13:45', loaders: ['M. Santos', 'J. Park'], ordersLoaded: 113, pallets: 18, cubeUtil: 72 },
              { door: 8, status: 'loading', carrier: 'UPS', trailer: 'TRL-2287', progress: 42, orders: 89, eta: '14:30', loaders: ['C. Wei'], ordersLoaded: 37, pallets: 12, cubeUtil: 45, behindSchedule: true },
              { door: 9, status: 'staged', carrier: 'USPS', trailer: 'TRL-1156', progress: 100, orders: 112, pickup: '16:00', loaders: [], pallets: 14, cubeUtil: 88, sealNumber: 'USPS-44821' },
              { door: 10, status: 'available', carrier: null, trailer: null, nextCarrier: 'FedEx Express', nextTime: '16:30', nextOrders: 124 },
              { door: 11, status: 'loading', carrier: 'FedEx Ground', trailer: 'TRL-4422', progress: 91, orders: 98, eta: '13:30', loaders: ['R. Patel'], ordersLoaded: 89, pallets: 12, cubeUtil: 68 },
              { door: 12, status: 'available', carrier: null, trailer: null, nextCarrier: 'Regional', nextTime: '17:00', nextOrders: 45 }
            ].map((dock, i) => {
              const colors = {
                loading: { bg: C.orange[50], border: C.orange[200], icon: C.orange[600] },
                staged: { bg: C.success[50], border: C.success[200], icon: C.success[600] },
                available: { bg: C.neutral[50], border: C.neutral[200], icon: C.neutral[500] }
              };
              const c = colors[dock.status];
              const isExpanded = expandedOutboundDock === dock.door;
              
              return (
                <div 
                  key={i} 
                  onClick={() => setExpandedOutboundDock(isExpanded ? null : dock.door)}
                  style={{ 
                    padding: sp.md, 
                    background: c.bg, 
                    borderRadius: 8, 
                    border: `2px solid ${isExpanded ? c.icon : c.border}`,
                    textAlign: 'center',
                    cursor: 'pointer',
                    transition: 'all 0.15s',
                    boxShadow: isExpanded ? `0 4px 12px ${c.icon}30` : 'none'
                  }}
                  onMouseEnter={(e) => { if (!isExpanded) e.currentTarget.style.transform = 'translateY(-2px)'; }}
                  onMouseLeave={(e) => { if (!isExpanded) e.currentTarget.style.transform = 'translateY(0)'; }}
                >
                  <p style={{ fontSize: '20px', fontWeight: 600, color: c.icon }}>D{dock.door}</p>
                  <p style={{ fontSize: '11px', fontWeight: 500, color: c.icon, textTransform: 'uppercase', marginBottom: sp.xs }}>
                    {dock.status}
                  </p>
                  
                  {dock.carrier && (
                    <p style={{ fontSize: '11px', fontWeight: 500, color: C.neutral[700] }}>{dock.carrier}</p>
                  )}
                  {dock.trailer && (
                    <p style={{ fontSize: '10px', color: C.neutral[500] }}>{dock.trailer}</p>
                  )}
                  {dock.progress !== undefined && dock.progress < 100 && (
                    <div style={{ marginTop: sp.xs }}>
                      <div style={{ height: 4, background: C.neutral[200], borderRadius: 2 }}>
                        <div style={{ width: `${dock.progress}%`, height: '100%', background: C.orange[500], borderRadius: 2 }} />
                      </div>
                      <p style={{ fontSize: '10px', color: C.neutral[500], marginTop: 2 }}>{dock.progress}% • {dock.orders} orders</p>
                    </div>
                  )}
                  {dock.progress === 100 && (
                    <p style={{ fontSize: '10px', color: C.success[600] }}>Ready • {dock.orders} orders</p>
                  )}
                  {dock.eta && <p style={{ fontSize: '10px', color: C.neutral[500] }}>Complete: {dock.eta}</p>}
                  {dock.pickup && <p style={{ fontSize: '10px', color: C.success[600] }}>Pickup: {dock.pickup}</p>}
                  {dock.nextCarrier && (
                    <p style={{ fontSize: '10px', color: C.neutral[500] }}>Next: {dock.nextCarrier} @ {dock.nextTime}</p>
                  )}
                </div>
              );
            })}
          </div>
          
          {/* Expanded Outbound Dock Detail */}
          {expandedOutboundDock && (() => {
            const dockData = [
              { door: 7, status: 'loading', carrier: 'FedEx Ground', trailer: 'TRL-4421', progress: 78, orders: 145, eta: '13:45', loaders: ['M. Santos', 'J. Park'], ordersLoaded: 113, pallets: 18, cubeUtil: 72, startTime: '11:30' },
              { door: 8, status: 'loading', carrier: 'UPS', trailer: 'TRL-2287', progress: 42, orders: 89, eta: '14:30', loaders: ['C. Wei'], ordersLoaded: 37, pallets: 12, cubeUtil: 45, behindSchedule: true, startTime: '12:15', issue: 'Single loader — below target velocity' },
              { door: 9, status: 'staged', carrier: 'USPS', trailer: 'TRL-1156', progress: 100, orders: 112, pickup: '16:00', loaders: [], pallets: 14, cubeUtil: 88, sealNumber: 'USPS-44821', completedAt: '14:20' },
              { door: 10, status: 'available', carrier: null, trailer: null, nextCarrier: 'FedEx Express', nextTime: '16:30', nextOrders: 124, nextPallets: 16 },
              { door: 11, status: 'loading', carrier: 'FedEx Ground', trailer: 'TRL-4422', progress: 91, orders: 98, eta: '13:30', loaders: ['R. Patel'], ordersLoaded: 89, pallets: 12, cubeUtil: 68, startTime: '11:00' },
              { door: 12, status: 'available', carrier: null, trailer: null, nextCarrier: 'Regional', nextTime: '17:00', nextOrders: 45, nextPallets: 8 }
            ].find(d => d.door === expandedOutboundDock);
            
            if (!dockData) return null;
            
            const colors = {
              loading: { bg: C.orange[50], border: C.orange[200], accent: C.orange[600] },
              staged: { bg: C.success[50], border: C.success[200], accent: C.success[600] },
              available: { bg: C.neutral[50], border: C.neutral[200], accent: C.neutral[600] }
            };
            const dc = colors[dockData.status];
            
            return (
              <div style={{ 
                marginTop: sp.md, 
                padding: sp.md, 
                background: dc.bg, 
                borderRadius: 8, 
                border: `1px solid ${dc.border}` 
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.sm }}>
                  <div>
                    <h4 style={{ fontSize: '14px', fontWeight: 600, color: dc.accent }}>Dock {dockData.door} Details</h4>
                    <p style={{ fontSize: '12px', color: C.neutral[500], textTransform: 'capitalize' }}>{dockData.status}</p>
                  </div>
                  <button 
                    onClick={(e) => { e.stopPropagation(); setExpandedOutboundDock(null); }}
                    style={{ background: 'none', border: 'none', cursor: 'pointer', padding: 4 }}
                  >
                    <X style={{ width: 16, height: 16, color: C.neutral[400] }} />
                  </button>
                </div>
                
                {dockData.status === 'loading' && (
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: sp.md }}>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Carrier / Trailer</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.carrier}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.trailer}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Orders Loaded</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.ordersLoaded} / {dockData.orders}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.pallets} pallets</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Cube Utilization</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.cubeUtil}%</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Loaders</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.loaders.join(', ') || '—'}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>Started {dockData.startTime}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Est. Complete</p>
                      <p style={{ fontSize: '13px', fontWeight: 500, color: dockData.behindSchedule ? C.warning[600] : C.neutral[700] }}>{dockData.eta}</p>
                      {dockData.behindSchedule && <p style={{ fontSize: '11px', color: C.warning[600] }}>Behind schedule</p>}
                    </div>
                  </div>
                )}
                
                {dockData.status === 'loading' && dockData.issue && (
                  <div style={{ marginTop: sp.sm, padding: sp.sm, background: C.warning[50], borderRadius: 6, display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <AlertTriangle style={{ width: 14, height: 14, color: C.warning[600] }} />
                    <span style={{ fontSize: '12px', color: C.warning[700] }}>{dockData.issue}</span>
                  </div>
                )}
                
                {dockData.status === 'staged' && (
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Carrier / Trailer</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.carrier}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.trailer}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Orders / Pallets</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.orders} orders</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{dockData.pallets} pallets • {dockData.cubeUtil}% cube</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Seal Number</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.sealNumber}</p>
                      <p style={{ fontSize: '11px', color: C.success[600] }}>✓ Sealed & ready</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Pickup Time</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.pickup}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>Completed {dockData.completedAt}</p>
                    </div>
                  </div>
                )}
                
                {dockData.status === 'available' && (
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Next Carrier</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.nextCarrier}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Staging Time</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.nextTime}</p>
                    </div>
                    <div>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>Expected Load</p>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{dockData.nextOrders} orders • {dockData.nextPallets} pallets</p>
                    </div>
                  </div>
                )}
              </div>
            );
          })()}
        </Card>
        
        {/* Carrier Pickup Schedule */}
        <Card id="outbound-pickups">
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Carrier Pickup Schedule</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>Today's carrier cutoffs and pickup appointments • Click for details</p>
            </div>
            <div style={{ display: 'flex', gap: sp.xs }}>
              <Badge status="success" label="2 On Track" />
              <Badge status="warning" label="1 At Risk" />
              <Badge status="neutral" label="1 Upcoming" />
            </div>
          </div>
          
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
            {[
              { 
                carrier: 'FedEx Ground', cutoff: '14:00', pickup: '14:30', 
                target: 1850, current: 1247, predicted: 1920, velocity: 168, velocityNeeded: 151,
                status: 'on-track', docks: ['D7', 'D11'], loadsStaged: 2, loadsTotal: 2,
                // Extended data
                ordersRemaining: 603, avgOrderSize: 2.3, topSkus: ['SKU-4421', 'SKU-8832', 'SKU-1127'],
                velocityTrend: 'up', velocityHistory: [152, 158, 165, 168], buffer: 70,
                pickQueue: 245, packQueue: 180, shipQueue: 178
              },
              { 
                carrier: 'UPS', cutoff: '15:30', pickup: '16:00', 
                target: 1420, current: 680, predicted: 1380, velocity: 127, velocityNeeded: 135,
                status: 'at-risk', docks: ['D8'], loadsStaged: 0, loadsTotal: 1, issue: 'Velocity 8/hr below target',
                // Extended data
                ordersRemaining: 740, avgOrderSize: 1.8, topSkus: ['SKU-2287', 'SKU-9943', 'SKU-5521'],
                velocityTrend: 'down', velocityHistory: [142, 138, 131, 127], shortfall: 40,
                pickQueue: 412, packQueue: 198, shipQueue: 130,
                recommendation: 'Reassign 2 FTE from Pack Station 2'
              },
              { 
                carrier: 'USPS', cutoff: '16:00', pickup: '16:30', 
                target: 890, current: 445, predicted: 910, velocity: 74, velocityNeeded: 74,
                status: 'on-track', docks: ['D9'], loadsStaged: 1, loadsTotal: 1,
                // Extended data
                ordersRemaining: 445, avgOrderSize: 1.2, topSkus: ['SKU-1156', 'SKU-3378'],
                velocityTrend: 'stable', velocityHistory: [72, 74, 73, 74], buffer: 20,
                pickQueue: 198, packQueue: 147, shipQueue: 100
              },
              { 
                carrier: 'FedEx Express', cutoff: '17:00', pickup: '17:30', 
                target: 320, current: 124, predicted: 340, velocity: 46, velocityNeeded: 28,
                status: 'on-track', docks: ['D10'], loadsStaged: 0, loadsTotal: 1, note: 'Staging begins 16:00',
                // Extended data
                ordersRemaining: 196, avgOrderSize: 3.1, topSkus: ['SKU-7742', 'SKU-8891'],
                velocityTrend: 'up', velocityHistory: [38, 41, 44, 46], buffer: 20,
                pickQueue: 98, packQueue: 62, shipQueue: 36
              }
            ].map((c, i) => {
              const progressPct = Math.round((c.current / c.target) * 100);
              const statusColors = {
                'on-track': { bg: C.success[50], border: C.success[200], accent: C.success[600] },
                'at-risk': { bg: C.warning[50], border: C.warning[200], accent: C.warning[600] }
              };
              const sc = statusColors[c.status];
              const isExpanded = expandedCarrierPickup === c.carrier;
              
              return (
                <div key={i}>
                  <div 
                    onClick={() => setExpandedCarrierPickup(isExpanded ? null : c.carrier)}
                    style={{ 
                      padding: sp.md, 
                      background: sc.bg, 
                      borderRadius: isExpanded ? '8px 8px 0 0' : 8,
                      border: `1px solid ${isExpanded ? sc.accent : sc.border}`,
                      borderBottom: isExpanded ? 'none' : `1px solid ${sc.border}`,
                      cursor: 'pointer',
                      transition: 'all 0.15s'
                    }}
                    onMouseEnter={(e) => { if (!isExpanded) e.currentTarget.style.boxShadow = '0 2px 6px rgba(0,0,0,0.06)'; }}
                    onMouseLeave={(e) => { if (!isExpanded) e.currentTarget.style.boxShadow = 'none'; }}
                  >
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                      {/* Carrier */}
                      <div style={{ width: 120, flexShrink: 0 }}>
                        <p style={{ fontSize: '14px', fontWeight: 600 }}>{c.carrier}</p>
                        <p style={{ fontSize: '11px', color: C.neutral[500] }}>Cutoff: {c.cutoff} • Pickup: {c.pickup}</p>
                      </div>
                      
                      {/* Progress */}
                      <div style={{ flex: 1 }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                          <span style={{ fontSize: '11px', color: C.neutral[600] }}>{c.current.toLocaleString()} / {c.target.toLocaleString()} orders</span>
                          <span style={{ fontSize: '11px', color: c.status === 'on-track' ? C.success[600] : C.warning[600] }}>
                            {c.predicted.toLocaleString()} predicted
                          </span>
                        </div>
                        <div style={{ height: 8, background: C.neutral[200], borderRadius: 4, overflow: 'hidden' }}>
                          <div style={{ 
                            width: `${progressPct}%`, 
                            height: '100%', 
                            background: c.status === 'on-track' ? C.success[500] : C.warning[500],
                            borderRadius: 4
                          }} />
                        </div>
                      </div>
                      
                      {/* Velocity */}
                      <div style={{ textAlign: 'center', width: 80 }}>
                        <p style={{ fontSize: '10px', color: C.neutral[500] }}>Velocity</p>
                        <p style={{ 
                          fontSize: '14px', 
                          fontWeight: 600, 
                          color: c.velocity >= c.velocityNeeded ? C.success[600] : C.warning[600] 
                        }}>
                          {c.velocity}/hr
                        </p>
                        <p style={{ fontSize: '10px', color: C.neutral[400] }}>need {c.velocityNeeded}</p>
                      </div>
                      
                      {/* Staging */}
                      <div style={{ textAlign: 'center', width: 70 }}>
                        <p style={{ fontSize: '10px', color: C.neutral[500] }}>Staged</p>
                        <p style={{ fontSize: '14px', fontWeight: 600, color: c.loadsStaged === c.loadsTotal ? C.success[600] : C.neutral[600] }}>
                          {c.loadsStaged}/{c.loadsTotal}
                        </p>
                      </div>
                      
                      {/* Docks */}
                      <div style={{ textAlign: 'center', width: 60 }}>
                        <p style={{ fontSize: '10px', color: C.neutral[500] }}>Docks</p>
                        <p style={{ fontSize: '12px', fontWeight: 500, color: C.orange[600] }}>{c.docks.join(', ')}</p>
                      </div>
                      
                      {/* Status */}
                      <Badge status={c.status === 'on-track' ? 'success' : 'warning'} label={c.status === 'on-track' ? 'On Track' : 'At Risk'} />
                      
                      <ChevronRight style={{ 
                        width: 16, height: 16, color: C.neutral[400],
                        transform: isExpanded ? 'rotate(90deg)' : 'rotate(0deg)',
                        transition: 'transform 0.15s'
                      }} />
                    </div>
                    
                    {(c.issue || c.note) && !isExpanded && (
                      <p style={{ fontSize: '11px', color: c.issue ? C.warning[600] : C.neutral[500], marginTop: sp.xs }}>
                        {c.issue ? `⚠ ${c.issue}` : `ℹ ${c.note}`}
                      </p>
                    )}
                  </div>
                  
                  {/* Expanded Detail */}
                  {isExpanded && (
                    <div style={{ 
                      padding: sp.md, 
                      background: sc.bg, 
                      borderRadius: '0 0 8px 8px',
                      border: `1px solid ${sc.accent}`,
                      borderTop: `1px dashed ${sc.border}`
                    }}>
                      {/* Velocity Trend */}
                      <div style={{ display: 'flex', gap: sp.lg, marginBottom: sp.md }}>
                        <div style={{ flex: 1 }}>
                          <p style={{ fontSize: '11px', color: C.neutral[500], marginBottom: sp.xs }}>Velocity Trend (last 4 hours)</p>
                          <div style={{ display: 'flex', alignItems: 'end', gap: 4, height: 40 }}>
                            {c.velocityHistory.map((v, vi) => (
                              <div key={vi} style={{ 
                                flex: 1, 
                                background: vi === c.velocityHistory.length - 1 
                                  ? (c.status === 'on-track' ? C.success[500] : C.warning[500])
                                  : C.neutral[300],
                                height: `${(v / Math.max(...c.velocityHistory)) * 100}%`,
                                borderRadius: 2,
                                minHeight: 8
                              }} />
                            ))}
                          </div>
                          <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: 4 }}>
                            <span style={{ fontSize: '10px', color: C.neutral[400] }}>-4hr</span>
                            <span style={{ fontSize: '10px', color: C.neutral[400] }}>Now</span>
                          </div>
                        </div>
                        
                        <div style={{ width: 120 }}>
                          <p style={{ fontSize: '11px', color: C.neutral[500], marginBottom: sp.xs }}>Trend</p>
                          <p style={{ 
                            fontSize: '14px', 
                            fontWeight: 600, 
                            color: c.velocityTrend === 'up' ? C.success[600] : c.velocityTrend === 'down' ? C.error[600] : C.neutral[600] 
                          }}>
                            {c.velocityTrend === 'up' ? '↑ Increasing' : c.velocityTrend === 'down' ? '↓ Decreasing' : '→ Stable'}
                          </p>
                          {c.buffer && <p style={{ fontSize: '11px', color: C.success[600] }}>+{c.buffer} order buffer</p>}
                          {c.shortfall && <p style={{ fontSize: '11px', color: C.error[600] }}>~{c.shortfall} orders at risk</p>}
                        </div>
                      </div>
                      
                      {/* Queue Breakdown */}
                      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md, marginBottom: sp.md }}>
                        <div>
                          <p style={{ fontSize: '10px', color: C.neutral[500] }}>Orders Remaining</p>
                          <p style={{ fontSize: '14px', fontWeight: 600 }}>{c.ordersRemaining.toLocaleString()}</p>
                          <p style={{ fontSize: '10px', color: C.neutral[400] }}>Avg {c.avgOrderSize} items/order</p>
                        </div>
                        <div>
                          <p style={{ fontSize: '10px', color: C.neutral[500] }}>Pick Queue</p>
                          <p style={{ fontSize: '14px', fontWeight: 600 }}>{c.pickQueue}</p>
                        </div>
                        <div>
                          <p style={{ fontSize: '10px', color: C.neutral[500] }}>Pack Queue</p>
                          <p style={{ fontSize: '14px', fontWeight: 600 }}>{c.packQueue}</p>
                        </div>
                        <div>
                          <p style={{ fontSize: '10px', color: C.neutral[500] }}>Ship Queue</p>
                          <p style={{ fontSize: '14px', fontWeight: 600 }}>{c.shipQueue}</p>
                        </div>
                      </div>
                      
                      {/* Top SKUs */}
                      <div style={{ marginBottom: sp.md }}>
                        <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.xs }}>Top SKUs in Queue</p>
                        <div style={{ display: 'flex', gap: sp.xs }}>
                          {c.topSkus.map((sku, si) => (
                            <span key={si} style={{ 
                              fontSize: '11px', 
                              padding: '2px 8px', 
                              background: C.neutral[100], 
                              borderRadius: 4,
                              color: C.neutral[600]
                            }}>
                              {sku}
                            </span>
                          ))}
                        </div>
                      </div>
                      
                      {/* Issue/Note with Recommendation */}
                      {(c.issue || c.note) && (
                        <div style={{ 
                          padding: sp.sm, 
                          background: c.issue ? C.warning[100] : C.blueLight[50], 
                          borderRadius: 6,
                          display: 'flex',
                          alignItems: 'flex-start',
                          gap: sp.sm
                        }}>
                          {c.issue ? (
                            <AlertTriangle style={{ width: 14, height: 14, color: C.warning[600], flexShrink: 0, marginTop: 2 }} />
                          ) : (
                            <Info style={{ width: 14, height: 14, color: C.blueLight[600], flexShrink: 0, marginTop: 2 }} />
                          )}
                          <div>
                            <p style={{ fontSize: '12px', color: c.issue ? C.warning[700] : C.blueLight[700] }}>
                              {c.issue || c.note}
                            </p>
                            {c.recommendation && (
                              <p style={{ fontSize: '12px', color: C.warning[600], fontWeight: 500, marginTop: 4 }}>
                                💡 Recommendation: {c.recommendation}
                              </p>
                            )}
                          </div>
                        </div>
                      )}
                    </div>
                  )}
                </div>
              );
            })}
          </div>
          
          {/* View All Work Content link */}
          <div 
            onClick={() => onNavigateToWork && onNavigateToWork()}
            style={{ 
              marginTop: sp.md, 
              paddingTop: sp.md, 
              borderTop: `1px solid ${C.neutral[200]}`,
              display: 'flex', 
              justifyContent: 'flex-end'
            }}
          >
            <span
              style={{ 
                fontSize: '13px', 
                fontWeight: 500, 
                color: C.orange[600], 
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: sp.xs
              }}
              onMouseEnter={(e) => e.currentTarget.style.color = C.orange[700]}
              onMouseLeave={(e) => e.currentTarget.style.color = C.orange[600]}
            >
              View All Work Content <ChevronRight style={{ width: 14, height: 14 }} />
            </span>
          </div>
        </Card>
        
        {/* Outbound Analysis */}
        <Card style={{ borderLeft: `4px solid ${C.orange[500]}` }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
            <div style={{ width: 32, height: 32, borderRadius: 6, background: C.orange[50], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
              <Zap style={{ width: 16, height: 16, color: C.orange[600] }} />
            </div>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and recommendations for outbound operations • Click for details</p>
            </div>
            <Badge status="warning" label="2 Active" style={{ marginLeft: 'auto' }} />
          </div>
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
            <Alert 
              {...ALERTS_DATA['outbound-ups-cutoff']} 
              onClick={() => onNavigateToAlert && onNavigateToAlert('outbound-ups-cutoff', 'schedules', true)}
            />
            <Alert 
              {...ALERTS_DATA['outbound-fedex-staging']} 
              onClick={() => onNavigateToAlert && onNavigateToAlert('outbound-fedex-staging', 'schedules', true)}
            />
            <Alert 
              {...ALERTS_DATA['outbound-fedex-ground-ok']} 
              onClick={() => onNavigateToAlert && onNavigateToAlert('outbound-fedex-ground-ok', 'schedules', true)}
            />
          </div>
          <div 
            onClick={() => onViewInsights && onViewInsights()}
            style={{ 
              marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}`,
              display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.xs,
              cursor: 'pointer', color: C.orange[600], fontSize: '13px', fontWeight: 500
            }}
            onMouseEnter={(e) => e.currentTarget.style.color = C.orange[700]}
            onMouseLeave={(e) => e.currentTarget.style.color = C.orange[600]}
          >
            View Full Analysis <ChevronRight style={{ width: 16, height: 16 }} />
          </div>
        </Card>
        </>
      )}
      
      {/* ===== MAINTENANCE SUB-TAB ===== */}
      {scheduleSubTab === 'maintenance' && (
        <>
        {/* Maintenance Score Breakdown */}
        <Card>
          <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.lg, marginBottom: sp.md }}>
            <div style={{ 
              width: 100, height: 100, borderRadius: '50%', 
              background: `conic-gradient(${C.success[500]} ${91 * 3.6}deg, ${C.neutral[100]} 0deg)`,
              display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0
            }}>
              <div style={{ width: 80, height: 80, borderRadius: '50%', background: 'white', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>
                <span style={{ fontSize: '28px', fontWeight: 600, color: C.success[600] }}>91</span>
                <span style={{ fontSize: '10px', color: C.neutral[500] }}>MAINT</span>
              </div>
            </div>
            
            <div style={{ flex: 1 }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
                <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Maintenance Score</h3>
                <span style={{ fontSize: '12px', color: C.neutral[500] }}>Equipment health & PM compliance • Click factor for details</span>
              </div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                {[
                  { label: 'PM Compliance', value: 94, weight: 30, detail: '32 of 34 on schedule', status: 'success', scrollTo: 'maint-pm-grid' },
                  { label: 'Equipment Uptime', value: 96, weight: 30, detail: '23 of 24 units operational', status: 'success', scrollTo: 'maint-pm-grid' },
                  { label: 'Work Order Backlog', value: 85, weight: 20, detail: '3 open orders (2 routine)', status: 'warning', scrollTo: 'maint-schedule' },
                  { label: 'Mean Time to Repair', value: 88, weight: 20, detail: 'Avg 45 min vs 40 target', status: 'warning', scrollTo: 'maint-schedule' }
                ].map((comp, i) => (
                  <div 
                    key={i} 
                    onClick={() => {
                      const el = document.getElementById(comp.scrollTo);
                      if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }}
                    style={{ 
                      display: 'flex', 
                      alignItems: 'center', 
                      gap: sp.sm,
                      padding: `${sp.xs} ${sp.sm}`,
                      margin: `0 -${sp.sm}`,
                      borderRadius: 4,
                      cursor: 'pointer',
                      transition: 'background 0.15s'
                    }}
                    onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[100]}
                    onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                  >
                    <span style={{ fontSize: '12px', color: C.neutral[600], width: 120, flexShrink: 0 }}>{comp.label}</span>
                    <div style={{ flex: 1, height: 8, background: C.neutral[100], borderRadius: 4, overflow: 'hidden' }}>
                      <div style={{ width: `${comp.value}%`, height: '100%', borderRadius: 4, background: comp.status === 'warning' ? C.warning[500] : C.success[500] }} />
                    </div>
                    <span style={{ fontSize: '12px', fontWeight: 500, width: 32, textAlign: 'right', color: comp.status === 'warning' ? C.warning[600] : C.success[600] }}>{comp.value}%</span>
                    <span style={{ fontSize: '11px', color: C.neutral[500], width: 140 }}>{comp.detail}</span>
                    <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
                  </div>
                ))}
              </div>
            </div>
          </div>
          
          <div style={{ background: C.blueLight[50], borderRadius: 6, padding: sp.sm, display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <Info style={{ width: 16, height: 16, color: C.blueLight[600] }} />
            <span style={{ fontSize: '12px', color: C.blueLight[700] }}>
              <strong>Note:</strong> EPJ-03 currently down for hydraulic repair (Est. completion 11:30). 
              FL-02 PM scheduled for 14:00-15:00 — will reduce Inbound A capacity.
            </span>
          </div>
        </Card>
        
        {/* Today's Maintenance Schedule */}
        <Card id="maint-schedule">
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Today's Maintenance Schedule</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>Scheduled PM, repairs, and service windows</p>
            </div>
            <div style={{ display: 'flex', gap: sp.xs }}>
              <Badge status="success" label="2 Complete" />
              <Badge status="warning" label="1 In Progress" />
              <Badge status="neutral" label="3 Scheduled" />
            </div>
          </div>
          
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
            {[
              { id: 'WO-2847', type: 'PM', equipment: 'FL-01', desc: '250-hour preventive maintenance', scheduled: '06:00-07:00', actual: '06:00-06:45', status: 'complete', tech: 'J. Martinez', zone: 'Bulk Storage', impact: 'None — completed before shift peak' },
              { id: 'WO-2848', type: 'PM', equipment: 'EPJ-04', desc: 'Battery inspection & terminal cleaning', scheduled: '06:30-07:00', actual: '06:30-06:50', status: 'complete', tech: 'J. Martinez', zone: 'Pack Station 2', impact: 'None' },
              { id: 'WO-2849', type: 'Repair', equipment: 'EPJ-03', desc: 'Hydraulic lift cylinder repair', scheduled: '08:00-11:30', actual: '08:15-', status: 'in-progress', tech: 'R. Chen', zone: 'Inbound A', impact: 'Reduced putaway capacity — rerouting to EPJ-01', progress: 70 },
              { id: 'WO-2850', type: 'PM', equipment: 'FL-02', desc: '250-hour preventive maintenance', scheduled: '14:00-15:00', actual: null, status: 'scheduled', tech: 'J. Martinez', zone: 'Inbound A', impact: 'Plan: Shift FL-03 to cover Inbound A' },
              { id: 'WO-2851', type: 'Inspection', equipment: 'CONV-01', desc: 'Weekly conveyor belt inspection', scheduled: '15:00-15:30', actual: null, status: 'scheduled', tech: 'R. Chen', zone: 'Pack Station 1', impact: 'Brief slowdown — divert to manual lanes' },
              { id: 'WO-2852', type: 'PM', equipment: 'FL-03', desc: 'Pre-shift inspection (idle unit)', scheduled: '13:30-14:00', actual: null, status: 'scheduled', tech: 'M. Torres', zone: 'Reserve 1', impact: 'None — unit currently idle' }
            ].map((wo, i) => {
              const statusColors = {
                complete: { bg: C.success[50], border: C.success[200], badge: 'success', label: 'Complete' },
                'in-progress': { bg: C.brand[50], border: C.brand[200], badge: 'info', label: 'In Progress' },
                scheduled: { bg: C.neutral[50], border: C.neutral[200], badge: 'neutral', label: 'Scheduled' }
              };
              const typeColors = {
                PM: C.success[600],
                Repair: C.warning[600],
                Inspection: C.blueLight[600]
              };
              const sc = statusColors[wo.status];
              
              return (
                <div key={i} style={{ 
                  padding: sp.md, 
                  background: sc.bg, 
                  borderRadius: 8,
                  border: `1px solid ${sc.border}`
                }}>
                  <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.md }}>
                    {/* Time */}
                    <div style={{ width: 90, flexShrink: 0 }}>
                      <p style={{ fontSize: '13px', fontWeight: 600, color: C.neutral[800] }}>{wo.scheduled.split('-')[0]}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{wo.scheduled}</p>
                      {wo.actual && wo.status === 'complete' && (
                        <p style={{ fontSize: '10px', color: C.success[600] }}>✓ {wo.actual}</p>
                      )}
                    </div>
                    
                    {/* Work Order Details */}
                    <div style={{ flex: 1, minWidth: 0 }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 4 }}>
                        <span style={{ fontSize: '12px', fontWeight: 600, color: C.neutral[700] }}>{wo.id}</span>
                        <span style={{ 
                          fontSize: '10px', 
                          fontWeight: 600, 
                          padding: '2px 6px', 
                          borderRadius: 4, 
                          background: `${typeColors[wo.type]}20`,
                          color: typeColors[wo.type]
                        }}>
                          {wo.type}
                        </span>
                        <span style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[800] }}>{wo.equipment}</span>
                      </div>
                      <p style={{ fontSize: '12px', color: C.neutral[600], marginBottom: 4 }}>{wo.desc}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>
                        <strong>Zone:</strong> {wo.zone} • <strong>Tech:</strong> {wo.tech}
                      </p>
                      {wo.impact && (
                        <p style={{ fontSize: '11px', color: wo.impact.includes('None') ? C.neutral[400] : C.warning[600], marginTop: 4 }}>
                          {wo.impact.includes('None') ? wo.impact : `⚠ ${wo.impact}`}
                        </p>
                      )}
                    </div>
                    
                    {/* Progress (for in-progress) */}
                    {wo.progress && (
                      <div style={{ width: 60, textAlign: 'center' }}>
                        <p style={{ fontSize: '10px', color: C.neutral[500] }}>Progress</p>
                        <p style={{ fontSize: '16px', fontWeight: 600, color: C.brand[600] }}>{wo.progress}%</p>
                        <div style={{ height: 4, background: C.neutral[200], borderRadius: 2, marginTop: 4 }}>
                          <div style={{ width: `${wo.progress}%`, height: '100%', background: C.brand[500], borderRadius: 2 }} />
                        </div>
                      </div>
                    )}
                    
                    {/* Status */}
                    <Badge status={sc.badge} label={sc.label} />
                  </div>
                </div>
              );
            })}
          </div>
        </Card>
        
        {/* Equipment PM Status Grid */}
        <Card id="maint-pm-grid">
          <div style={{ marginBottom: sp.md }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Equipment PM Status</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Preventive maintenance schedule by equipment • Click to view equipment</p>
          </div>
          
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { id: 'FL-01', type: 'Forklift', lastPM: 'Today', nextPM: '+250 hrs', hours: 12, status: 'current' },
              { id: 'FL-02', type: 'Forklift', lastPM: '12 days ago', nextPM: 'Today 14:00', hours: 248, status: 'due' },
              { id: 'FL-03', type: 'Forklift', lastPM: '8 days ago', nextPM: '+180 hrs', hours: 70, status: 'current' },
              { id: 'EPJ-01', type: 'Pallet Jack', lastPM: '5 days ago', nextPM: '+120 hrs', hours: 45, status: 'current' },
              { id: 'EPJ-02', type: 'Pallet Jack', lastPM: '3 days ago', nextPM: '+145 hrs', hours: 22, status: 'current' },
              { id: 'EPJ-03', type: 'Pallet Jack', lastPM: '—', nextPM: 'After repair', hours: 0, status: 'down' },
              { id: 'EPJ-04', type: 'Pallet Jack', lastPM: 'Today', nextPM: '+165 hrs', hours: 8, status: 'current' },
              { id: 'CONV-01', type: 'Conveyor', lastPM: '6 days ago', nextPM: 'Today 15:00', hours: null, status: 'due' }
            ].map((eq, i) => {
              const colors = {
                current: { bg: C.success[50], border: C.success[200], text: C.success[700] },
                due: { bg: C.warning[50], border: C.warning[200], text: C.warning[700] },
                overdue: { bg: C.error[50], border: C.error[200], text: C.error[700] },
                down: { bg: C.neutral[100], border: C.neutral[300], text: C.neutral[600] }
              };
              const c = colors[eq.status];
              
              return (
                <div 
                  key={i} 
                  onClick={() => onNavigateToEquipment && onNavigateToEquipment()}
                  style={{ 
                    padding: sp.md, 
                    background: c.bg, 
                    borderRadius: 8, 
                    border: `1px solid ${c.border}`,
                    cursor: 'pointer',
                    transition: 'all 0.15s'
                  }}
                  onMouseEnter={(e) => { 
                    e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                    e.currentTarget.style.transform = 'translateY(-1px)';
                  }}
                  onMouseLeave={(e) => { 
                    e.currentTarget.style.boxShadow = 'none';
                    e.currentTarget.style.transform = 'translateY(0)';
                  }}
                >
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                    <div>
                      <p style={{ fontSize: '14px', fontWeight: 600, color: C.neutral[800] }}>{eq.id}</p>
                      <p style={{ fontSize: '10px', color: C.neutral[500] }}>{eq.type}</p>
                    </div>
                    <span style={{ 
                      fontSize: '9px', 
                      fontWeight: 600, 
                      padding: '2px 6px', 
                      borderRadius: 4, 
                      background: c.border,
                      color: c.text,
                      textTransform: 'uppercase'
                    }}>
                      {eq.status === 'current' ? 'OK' : eq.status === 'due' ? 'Due' : eq.status === 'down' ? 'Down' : 'Overdue'}
                    </span>
                  </div>
                  
                  <div style={{ fontSize: '11px', color: C.neutral[600] }}>
                    <p><strong>Last:</strong> {eq.lastPM}</p>
                    <p><strong>Next:</strong> {eq.nextPM}</p>
                    {eq.hours !== null && eq.hours > 0 && (
                      <p style={{ color: C.neutral[400], marginTop: 4 }}>{eq.hours} hrs since PM</p>
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        </Card>
        
        {/* Maintenance Analysis */}
        <Card style={{ borderLeft: `4px solid ${C.neutral[500]}` }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
            <div style={{ width: 32, height: 32, borderRadius: 6, background: C.neutral[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
              <Zap style={{ width: 16, height: 16, color: C.neutral[600] }} />
            </div>
            <div>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and recommendations for maintenance • Click for details</p>
            </div>
            <Badge status="info" label="2 Active" style={{ marginLeft: 'auto' }} />
          </div>
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
            <Alert 
              {...ALERTS_DATA['maint-fl02-pm-peak']} 
              onClick={() => onNavigateToAlert && onNavigateToAlert('maint-fl02-pm-peak', 'schedules', true)}
            />
            <Alert 
              {...ALERTS_DATA['maint-epj03-return']} 
              onClick={() => onNavigateToAlert && onNavigateToAlert('maint-epj03-return', 'schedules', true)}
            />
            <Alert 
              {...ALERTS_DATA['maint-fleet-health']} 
              onClick={() => onNavigateToAlert && onNavigateToAlert('maint-fleet-health', 'schedules', true)}
            />
          </div>
          <div 
            onClick={() => onViewInsights && onViewInsights()}
            style={{ 
              marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}`,
              display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.xs,
              cursor: 'pointer', color: C.neutral[600], fontSize: '13px', fontWeight: 500
            }}
            onMouseEnter={(e) => e.currentTarget.style.color = C.neutral[700]}
            onMouseLeave={(e) => e.currentTarget.style.color = C.neutral[600]}
          >
            View Full Analysis <ChevronRight style={{ width: 16, height: 16 }} />
          </div>
        </Card>
        </>
      )}
    </>
  );
};

// Equipment Tab Content - facility-level equipment overview
const EquipmentTabContent = ({ onViewInsights, onNavigateToAlert, onSelectEquipment }) => {
  // Fleet summary data
  const fleetSummary = {
    totalUnits: 32,
    active: 24,
    idle: 3,
    charging: 2,
    maintenance: 2,
    offline: 1,
    availability: 93.8,
    avgUtilization: 76,
    upcomingPM: 4,
    overduePM: 1
  };
  
  // Fleet by equipment type
  const fleetByType = [
    { 
      type: 'Sit-Down Forklift', 
      icon: Truck, 
      total: 8, 
      active: 6, 
      idle: 1, 
      charging: 0, 
      maintenance: 1, 
      offline: 0,
      avgUtil: 82,
      avgBattery: null, // IC powered
      isPoweredByBattery: false,
      mtbf: 420, // hours
      color: C.brand[500]
    },
    { 
      type: 'Reach Truck', 
      icon: Truck, 
      total: 6, 
      active: 5, 
      idle: 0, 
      charging: 1, 
      maintenance: 0, 
      offline: 0,
      avgUtil: 78,
      avgBattery: 68,
      isPoweredByBattery: true,
      mtbf: 380,
      color: C.purple[500]
    },
    { 
      type: 'Electric Pallet Jack', 
      icon: Package, 
      total: 10, 
      active: 7, 
      idle: 1, 
      charging: 1, 
      maintenance: 1, 
      offline: 0,
      avgUtil: 85,
      avgBattery: 72,
      isPoweredByBattery: true,
      mtbf: 520,
      color: C.orange[500]
    },
    { 
      type: 'Order Picker', 
      icon: Users, 
      total: 4, 
      active: 3, 
      idle: 1, 
      charging: 0, 
      maintenance: 0, 
      offline: 0,
      avgUtil: 71,
      avgBattery: 58,
      isPoweredByBattery: true,
      mtbf: 460,
      color: C.greenLight[500]
    },
    { 
      type: 'Tugger/Tow Tractor', 
      icon: Truck, 
      total: 4, 
      active: 3, 
      idle: 0, 
      charging: 0, 
      maintenance: 0, 
      offline: 1,
      avgUtil: 62,
      avgBattery: 81,
      isPoweredByBattery: true,
      mtbf: 490,
      color: C.blueLight[500]
    }
  ];
  
  // Individual equipment data
  const equipmentData = [
    { id: 'FL-01', type: 'Sit-Down Forklift', zone: 'Z04 Bulk Storage', status: 'Active', utilization: 85, operator: 'Mike Brown', battery: null, hoursToday: 6.2, hoursSincePM: 380, nextPM: '12/18', certified: true },
    { id: 'FL-02', type: 'Sit-Down Forklift', zone: 'Z01 Inbound', status: 'Active', utilization: 78, operator: 'Carlos Mendez', battery: null, hoursToday: 5.8, hoursSincePM: 395, nextPM: '12/17', certified: true },
    { id: 'FL-03', type: 'Sit-Down Forklift', zone: 'Z05 Reserve', status: 'Idle', utilization: 0, operator: null, battery: null, hoursToday: 2.1, hoursSincePM: 210, nextPM: '01/05', certified: true },
    { id: 'FL-04', type: 'Sit-Down Forklift', zone: 'Z02 Outbound', status: 'Active', utilization: 88, operator: 'James Wilson', battery: null, hoursToday: 6.5, hoursSincePM: 405, nextPM: '12/16', certified: true },
    { id: 'FL-05', type: 'Sit-Down Forklift', zone: 'Z04 Bulk Storage', status: 'Active', utilization: 72, operator: 'David Lee', battery: null, hoursToday: 5.4, hoursSincePM: 290, nextPM: '12/28', certified: true },
    { id: 'FL-06', type: 'Sit-Down Forklift', zone: 'Z01 Inbound', status: 'Maintenance', utilization: 0, operator: null, battery: null, hoursToday: 0, hoursSincePM: 425, nextPM: 'Overdue', certified: true },
    { id: 'FL-07', type: 'Sit-Down Forklift', zone: 'Z05 Reserve', status: 'Active', utilization: 81, operator: 'Robert Chen', battery: null, hoursToday: 6.0, hoursSincePM: 180, nextPM: '01/12', certified: true },
    { id: 'FL-08', type: 'Sit-Down Forklift', zone: 'Z02 Outbound', status: 'Active', utilization: 79, operator: 'Kevin Park', battery: null, hoursToday: 5.9, hoursSincePM: 320, nextPM: '12/22', certified: true },
    { id: 'RT-01', type: 'Reach Truck', zone: 'Z05 Reserve', status: 'Active', utilization: 82, operator: 'Maria Santos', battery: 72, hoursToday: 6.1, hoursSincePM: 340, nextPM: '12/20', certified: true },
    { id: 'RT-02', type: 'Reach Truck', zone: 'Z05 Reserve', status: 'Active', utilization: 76, operator: 'Chen Wei', battery: 65, hoursToday: 5.6, hoursSincePM: 290, nextPM: '12/26', certified: true },
    { id: 'RT-03', type: 'Reach Truck', zone: 'Z04 Bulk Storage', status: 'Active', utilization: 85, operator: 'Ana Rodriguez', battery: 58, hoursToday: 6.3, hoursSincePM: 360, nextPM: '12/19', certified: true },
    { id: 'RT-04', type: 'Reach Truck', zone: 'Z05 Reserve', status: 'Charging', utilization: 0, operator: null, battery: 35, hoursToday: 4.2, hoursSincePM: 280, nextPM: '12/27', certified: true },
    { id: 'RT-05', type: 'Reach Truck', zone: 'Z04 Bulk Storage', status: 'Active', utilization: 71, operator: 'Tom Harris', battery: 81, hoursToday: 5.2, hoursSincePM: 195, nextPM: '01/08', certified: true },
    { id: 'RT-06', type: 'Reach Truck', zone: 'Z05 Reserve', status: 'Active', utilization: 78, operator: 'Lisa Wang', battery: 69, hoursToday: 5.8, hoursSincePM: 310, nextPM: '12/23', certified: true },
    { id: 'EPJ-01', type: 'Electric Pallet Jack', zone: 'Z03 Forward Pick', status: 'Active', utilization: 92, operator: 'Sarah Johnson', battery: 68, hoursToday: 6.8, hoursSincePM: 480, nextPM: '12/18', certified: true },
    { id: 'EPJ-02', type: 'Electric Pallet Jack', zone: 'Z02 Pack Station', status: 'Active', utilization: 88, operator: 'Chris Taylor', battery: 74, hoursToday: 6.5, hoursSincePM: 420, nextPM: '12/21', certified: true },
    { id: 'EPJ-03', type: 'Electric Pallet Jack', zone: 'Z01 Inbound', status: 'Maintenance', utilization: 0, operator: null, battery: 45, hoursToday: 0, hoursSincePM: 510, nextPM: '12/14', certified: true },
    { id: 'EPJ-04', type: 'Electric Pallet Jack', zone: 'Z03 Forward Pick', status: 'Active', utilization: 85, operator: 'Amy Foster', battery: 62, hoursToday: 6.3, hoursSincePM: 390, nextPM: '12/24', certified: true },
    { id: 'EPJ-05', type: 'Electric Pallet Jack', zone: 'Z02 Outbound', status: 'Active', utilization: 79, operator: 'Mark Davis', battery: 88, hoursToday: 5.9, hoursSincePM: 250, nextPM: '01/02', certified: true },
    { id: 'EPJ-06', type: 'Electric Pallet Jack', zone: 'Z03 Forward Pick', status: 'Charging', utilization: 0, operator: null, battery: 28, hoursToday: 3.8, hoursSincePM: 440, nextPM: '12/19', certified: true },
    { id: 'EPJ-07', type: 'Electric Pallet Jack', zone: 'Z01 Inbound', status: 'Active', utilization: 86, operator: 'Nina Patel', battery: 71, hoursToday: 6.4, hoursSincePM: 365, nextPM: '12/25', certified: true },
    { id: 'EPJ-08', type: 'Electric Pallet Jack', zone: 'Z02 Pack Station', status: 'Active', utilization: 91, operator: 'Derek Kim', battery: 55, hoursToday: 6.7, hoursSincePM: 495, nextPM: '12/16', certified: true },
    { id: 'EPJ-09', type: 'Electric Pallet Jack', zone: 'Z03 Forward Pick', status: 'Idle', utilization: 0, operator: null, battery: 92, hoursToday: 1.5, hoursSincePM: 180, nextPM: '01/10', certified: true },
    { id: 'EPJ-10', type: 'Electric Pallet Jack', zone: 'Z02 Outbound', status: 'Active', utilization: 83, operator: 'Rachel Green', battery: 77, hoursToday: 6.1, hoursSincePM: 330, nextPM: '12/28', certified: true },
    { id: 'OP-01', type: 'Order Picker', zone: 'Z03 Forward Pick', status: 'Active', utilization: 78, operator: 'Jake Miller', battery: 64, hoursToday: 5.8, hoursSincePM: 410, nextPM: '12/20', certified: true },
    { id: 'OP-02', type: 'Order Picker', zone: 'Z03 Forward Pick', status: 'Active', utilization: 72, operator: 'Emily Clark', battery: 52, hoursToday: 5.3, hoursSincePM: 380, nextPM: '12/22', certified: true },
    { id: 'OP-03', type: 'Order Picker', zone: 'Z03 Forward Pick', status: 'Active', utilization: 65, operator: 'Brian Scott', battery: 58, hoursToday: 4.8, hoursSincePM: 290, nextPM: '01/04', certified: true },
    { id: 'OP-04', type: 'Order Picker', zone: 'Z03 Forward Pick', status: 'Idle', utilization: 0, operator: null, battery: 89, hoursToday: 2.0, hoursSincePM: 150, nextPM: '01/15', certified: true },
    { id: 'TT-01', type: 'Tugger/Tow Tractor', zone: 'Yard', status: 'Active', utilization: 68, operator: 'Steve Adams', battery: 85, hoursToday: 5.0, hoursSincePM: 440, nextPM: '12/18', certified: true },
    { id: 'TT-02', type: 'Tugger/Tow Tractor', zone: 'Z01-Z02 Corridor', status: 'Active', utilization: 72, operator: 'Paul Wright', battery: 79, hoursToday: 5.3, hoursSincePM: 390, nextPM: '12/23', certified: true },
    { id: 'TT-03', type: 'Tugger/Tow Tractor', zone: 'Yard', status: 'Offline', utilization: 0, operator: null, battery: 0, hoursToday: 0, hoursSincePM: 520, nextPM: 'Overdue', certified: false },
    { id: 'TT-04', type: 'Tugger/Tow Tractor', zone: 'Z02-Dock Corridor', status: 'Active', utilization: 58, operator: 'Tony Garcia', battery: 82, hoursToday: 4.3, hoursSincePM: 260, nextPM: '01/06', certified: true }
  ];
  
  // Equipment alerts
  const equipmentAlerts = [
    { id: 'equip-pm-overdue', sev: 'critical', title: 'FL-06 PM overdue', msg: '25 hours past scheduled maintenance', time: 'Now', conf: 95, category: 'equipment' },
    { id: 'equip-tt03-offline', sev: 'critical', title: 'TT-03 offline', msg: 'Unit requires major repair - out of service', time: 'Now', conf: 100, category: 'equipment' },
    { id: 'equip-epj03-repair', sev: 'warning', title: 'EPJ-03 in repair', msg: 'Expected return 14:00 today', time: '+4hr', conf: 85, category: 'equipment' },
    { id: 'equip-battery-low', sev: 'warning', title: '3 units low battery', msg: 'RT-04, EPJ-06 charging; OP-02 at 52%', time: 'Now', conf: 90, category: 'equipment' },
    { id: 'equip-pm-upcoming', sev: 'info', title: '4 PMs scheduled this week', msg: 'FL-04 today, FL-02 tomorrow, 2 more by Friday', time: '+1-5d', conf: 100, category: 'equipment' }
  ];
  
  // Maintenance schedule
  const maintenanceSchedule = [
    { id: 'FL-04', type: 'Sit-Down Forklift', pmType: 'Scheduled PM', date: 'Today', time: '14:00-15:00', status: 'scheduled', technician: 'Mike T.' },
    { id: 'FL-02', type: 'Sit-Down Forklift', pmType: 'Scheduled PM', date: 'Tomorrow', time: '08:00-09:00', status: 'scheduled', technician: 'Mike T.' },
    { id: 'EPJ-01', type: 'Electric Pallet Jack', pmType: 'Scheduled PM', date: '12/18', time: '06:00-06:45', status: 'scheduled', technician: 'Sarah L.' },
    { id: 'RT-03', type: 'Reach Truck', pmType: 'Scheduled PM', date: '12/19', time: '14:00-15:00', status: 'scheduled', technician: 'Mike T.' },
    { id: 'FL-06', type: 'Sit-Down Forklift', pmType: 'Corrective Repair', date: 'In Progress', time: 'Started 08:30', status: 'in-progress', technician: 'Mike T.' },
    { id: 'EPJ-03', type: 'Electric Pallet Jack', pmType: 'Corrective Repair', date: 'In Progress', time: 'ETA 14:00', status: 'in-progress', technician: 'Sarah L.' },
    { id: 'TT-03', type: 'Tugger/Tow Tractor', pmType: 'Major Repair', date: 'Pending Parts', time: 'ETA 12/20', status: 'pending', technician: 'External' }
  ];
  
  // Charging schedule for battery-powered equipment
  const chargingBays = [
    { bay: 'Bay 1', unit: 'RT-04', battery: 35, timeRemaining: '1hr 45min', status: 'charging' },
    { bay: 'Bay 2', unit: 'EPJ-06', battery: 28, timeRemaining: '2hr 10min', status: 'charging' },
    { bay: 'Bay 3', unit: null, battery: null, timeRemaining: null, status: 'available' },
    { bay: 'Bay 4', unit: null, battery: null, timeRemaining: null, status: 'available' }
  ];
  
  // Equipment columns for grid
  const equipColumns = [
    { key: 'id', label: 'Unit ID', render: (v, row) => (
      <span style={{ fontWeight: 500, color: row.status === 'Offline' ? C.error[600] : C.neutral[800] }}>{v}</span>
    )},
    { key: 'type', label: 'Type', render: (v) => (
      <span style={{ fontSize: '12px' }}>{v}</span>
    )},
    { key: 'zone', label: 'Location' },
    { key: 'status', label: 'Status', render: (v) => (
      <Badge 
        status={v === 'Active' ? 'success' : v === 'Idle' ? 'neutral' : v === 'Charging' ? 'info' : v === 'Maintenance' ? 'warning' : 'error'} 
        label={v} 
      />
    )},
    { key: 'battery', label: 'Battery', align: 'center', render: (v, row) => {
      if (v === null) return <span style={{ color: C.neutral[400], fontSize: '11px' }}>N/A</span>;
      const color = v > 60 ? C.success[500] : v > 30 ? C.warning[500] : C.error[500];
      return (
        <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
          <div style={{ width: 32, height: 8, background: C.neutral[200], borderRadius: 4, overflow: 'hidden' }}>
            <div style={{ width: `${v}%`, height: '100%', background: color, borderRadius: 4 }} />
          </div>
          <span style={{ fontSize: '11px', color }}>{v}%</span>
        </div>
      );
    }},
    { key: 'utilization', label: 'Util', align: 'right', render: (v) => v > 0 ? (
      <span style={{ color: v > 85 ? C.success[600] : v > 60 ? C.neutral[600] : C.warning[600] }}>{v}%</span>
    ) : '—' },
    { key: 'hoursToday', label: 'Hrs Today', align: 'right', render: (v) => v > 0 ? `${v.toFixed(1)}` : '—' },
    { key: 'nextPM', label: 'Next PM', render: (v) => (
      <span style={{ 
        color: v === 'Overdue' ? C.error[600] : v === 'Today' ? C.warning[600] : C.neutral[600],
        fontWeight: v === 'Overdue' ? 500 : 400
      }}>{v}</span>
    )},
    { key: 'operator', label: 'Operator', render: (v) => v || <span style={{ color: C.neutral[400] }}>—</span> }
  ];

  return (
    <>
      <Header icon={Wrench} title="Asset Health" sub="Material handling equipment fleet status and maintenance" color={C.neutral[500]} />
      
      {/* Fleet Availability Summary */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.md }}>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Fleet Availability</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>{fleetSummary.totalUnits} total units across 5 equipment types</p>
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <div style={{ textAlign: 'right' }}>
              <span style={{ fontSize: '28px', fontWeight: 300, color: fleetSummary.availability >= 95 ? C.success[600] : fleetSummary.availability >= 90 ? C.warning[600] : C.error[600] }}>
                {fleetSummary.availability}%
              </span>
              <p style={{ fontSize: '11px', color: C.neutral[500] }}>Availability Rate</p>
            </div>
            <div style={{ width: 1, height: 40, background: C.neutral[200] }} />
            <div style={{ textAlign: 'right' }}>
              <span style={{ fontSize: '28px', fontWeight: 300, color: C.brand[600] }}>{fleetSummary.avgUtilization}%</span>
              <p style={{ fontSize: '11px', color: C.neutral[500] }}>Avg Utilization</p>
            </div>
          </div>
        </div>
        
        {/* Status breakdown */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(6, 1fr)', gap: sp.sm }}>
          {[
            { label: 'Active', value: fleetSummary.active, color: C.success, icon: CheckCircle },
            { label: 'Idle', value: fleetSummary.idle, color: C.neutral, icon: Clock },
            { label: 'Charging', value: fleetSummary.charging, color: C.brand, icon: Zap },
            { label: 'Maintenance', value: fleetSummary.maintenance, color: C.warning, icon: Wrench },
            { label: 'Offline', value: fleetSummary.offline, color: C.error, icon: AlertTriangle },
            { label: 'PM Due', value: fleetSummary.upcomingPM, color: C.blueLight, icon: Calendar }
          ].map((item, i) => {
            const Icon = item.icon;
            return (
              <div key={i} style={{ 
                padding: sp.sm, 
                background: item.color[50], 
                borderRadius: 8, 
                display: 'flex', 
                alignItems: 'center', 
                gap: sp.sm,
                border: `1px solid ${item.color[200]}`
              }}>
                <Icon style={{ width: 18, height: 18, color: item.color[600] }} />
                <div>
                  <p style={{ fontSize: '20px', fontWeight: 500, color: item.color[700], lineHeight: 1 }}>{item.value}</p>
                  <p style={{ fontSize: '10px', color: item.color[600] }}>{item.label}</p>
                </div>
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* Fleet by Type - Full Width */}
      <Card>
        <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Fleet by Equipment Type</h3>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {fleetByType.map((fleet, i) => {
            const Icon = fleet.icon;
            const availableUnits = fleet.active + fleet.idle + fleet.charging;
            const availabilityPct = Math.round((availableUnits / fleet.total) * 100);
            return (
              <div key={i} style={{ 
                padding: sp.sm, 
                background: C.neutral[50], 
                borderRadius: 8,
                border: `1px solid ${C.neutral[200]}`
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.xs, flexWrap: 'wrap', gap: sp.sm }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <div style={{ width: 28, height: 28, borderRadius: 6, background: fleet.color + '20', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                      <Icon style={{ width: 14, height: 14, color: fleet.color }} />
                    </div>
                    <div>
                      <span style={{ fontSize: '13px', fontWeight: 500 }}>{fleet.type}</span>
                      <span style={{ fontSize: '11px', color: C.neutral[500], marginLeft: sp.sm }}>{fleet.total} units</span>
                    </div>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.md, flexWrap: 'wrap' }}>
                    {fleet.isPoweredByBattery && (
                      <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                        <Zap style={{ width: 12, height: 12, color: C.brand[500] }} />
                        <span style={{ fontSize: '11px', color: C.neutral[600] }}>{fleet.avgBattery}% avg</span>
                      </div>
                    )}
                    <span style={{ 
                      fontSize: '12px', 
                      fontWeight: 500,
                      color: availabilityPct >= 90 ? C.success[600] : availabilityPct >= 75 ? C.warning[600] : C.error[600]
                    }}>
                      {availabilityPct}% available
                    </span>
                  </div>
                </div>
                {/* Status bar */}
                <div style={{ display: 'flex', height: 8, borderRadius: 4, overflow: 'hidden', background: C.neutral[200] }}>
                  <div style={{ width: `${(fleet.active / fleet.total) * 100}%`, background: C.success[500] }} title={`${fleet.active} Active`} />
                  <div style={{ width: `${(fleet.idle / fleet.total) * 100}%`, background: C.neutral[400] }} title={`${fleet.idle} Idle`} />
                  <div style={{ width: `${(fleet.charging / fleet.total) * 100}%`, background: C.brand[500] }} title={`${fleet.charging} Charging`} />
                  <div style={{ width: `${(fleet.maintenance / fleet.total) * 100}%`, background: C.warning[500] }} title={`${fleet.maintenance} Maintenance`} />
                  <div style={{ width: `${(fleet.offline / fleet.total) * 100}%`, background: C.error[500] }} title={`${fleet.offline} Offline`} />
                </div>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: sp.xs, flexWrap: 'wrap', gap: sp.xs }}>
                  <div style={{ display: 'flex', gap: sp.sm, fontSize: '10px', color: C.neutral[500], flexWrap: 'wrap' }}>
                    <span><span style={{ color: C.success[600], fontWeight: 500 }}>{fleet.active}</span> active</span>
                    {fleet.idle > 0 && <span><span style={{ color: C.neutral[600], fontWeight: 500 }}>{fleet.idle}</span> idle</span>}
                    {fleet.charging > 0 && <span><span style={{ color: C.brand[600], fontWeight: 500 }}>{fleet.charging}</span> charging</span>}
                    {fleet.maintenance > 0 && <span><span style={{ color: C.warning[600], fontWeight: 500 }}>{fleet.maintenance}</span> maint</span>}
                    {fleet.offline > 0 && <span><span style={{ color: C.error[600], fontWeight: 500 }}>{fleet.offline}</span> offline</span>}
                  </div>
                  <span style={{ fontSize: '10px', color: C.neutral[500] }}>Util: {fleet.avgUtil}%</span>
                </div>
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* Analysis - Full Width */}
      <Card>
        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: sp.md }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <Lightbulb style={{ width: 16, height: 16, color: C.neutral[500] }} />
            <h3 style={{ fontSize: '14px', fontWeight: 500 }}>Equipment Alerts</h3>
          </div>
          <Badge status="warning" label={`${equipmentAlerts.length} Active`} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {equipmentAlerts.map((alert, i) => (
            <Alert 
              key={i} 
              {...alert} 
              onClick={() => onNavigateToAlert && onNavigateToAlert(alert.id, 'equipment', true)}
            />
          ))}
        </div>
        <div 
          onClick={() => onViewInsights && onViewInsights()}
          style={{ 
            marginTop: sp.md, 
            paddingTop: sp.md, 
            borderTop: `1px solid ${C.neutral[200]}`,
            display: 'flex', 
            alignItems: 'center', 
            justifyContent: 'center', 
            gap: sp.xs,
            cursor: 'pointer', 
            color: C.neutral[600], 
            fontSize: '13px', 
            fontWeight: 500
          }}
        >
          <span>View Full Analysis</span>
          <ArrowRight style={{ width: 14, height: 14 }} />
        </div>
      </Card>
      
      {/* Maintenance Schedule - Full Width */}
      <Card>
        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: sp.md }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <Calendar style={{ width: 16, height: 16, color: C.neutral[500] }} />
            <h3 style={{ fontSize: '14px', fontWeight: 500 }}>Maintenance Schedule</h3>
          </div>
          <Badge status={fleetSummary.overduePM > 0 ? 'error' : 'info'} label={fleetSummary.overduePM > 0 ? `${fleetSummary.overduePM} Overdue` : `${fleetSummary.upcomingPM} Upcoming`} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
          {maintenanceSchedule.map((item, i) => (
            <div key={i} style={{ 
              display: 'flex', 
              alignItems: 'center', 
              justifyContent: 'space-between',
              padding: sp.sm, 
              background: item.status === 'in-progress' ? C.warning[50] : item.status === 'pending' ? C.error[50] : C.neutral[50], 
              borderRadius: 6,
              borderLeft: `3px solid ${item.status === 'in-progress' ? C.warning[500] : item.status === 'pending' ? C.error[500] : C.blueLight[500]}`,
              flexWrap: 'wrap',
              gap: sp.sm
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <span style={{ fontSize: '13px', fontWeight: 500, minWidth: 50 }}>{item.id}</span>
                <div>
                  <p style={{ fontSize: '12px', color: C.neutral[700] }}>{item.pmType}</p>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>{item.date} • {item.time}</p>
                </div>
              </div>
              <div style={{ textAlign: 'right' }}>
                <Badge 
                  status={item.status === 'in-progress' ? 'warning' : item.status === 'pending' ? 'error' : 'info'} 
                  label={item.status === 'in-progress' ? 'In Progress' : item.status === 'pending' ? 'Pending' : 'Scheduled'} 
                />
                <p style={{ fontSize: '10px', color: C.neutral[500], marginTop: 2 }}>{item.technician}</p>
              </div>
            </div>
          ))}
        </div>
      </Card>
      
      {/* Charging Status - Full Width */}
      <Card>
        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: sp.md }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <Zap style={{ width: 16, height: 16, color: C.brand[500] }} />
            <h3 style={{ fontSize: '14px', fontWeight: 500 }}>Charging Stations</h3>
          </div>
          <span style={{ fontSize: '12px', color: C.neutral[500] }}>{chargingBays.filter(b => b.status === 'charging').length} of {chargingBays.length} in use</span>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: sp.sm }}>
          {chargingBays.map((bay, i) => (
            <div key={i} style={{ 
              padding: sp.md, 
              background: bay.status === 'charging' ? C.brand[50] : C.neutral[50], 
              borderRadius: 8,
              border: `1px solid ${bay.status === 'charging' ? C.brand[200] : C.neutral[200]}`
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.xs }}>
                <span style={{ fontSize: '12px', fontWeight: 500 }}>{bay.bay}</span>
                <Badge status={bay.status === 'charging' ? 'info' : 'neutral'} label={bay.status === 'charging' ? 'In Use' : 'Available'} />
              </div>
              {bay.unit ? (
                <>
                  <p style={{ fontSize: '16px', fontWeight: 500, color: C.brand[700] }}>{bay.unit}</p>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, marginTop: sp.xs }}>
                    <div style={{ flex: 1, height: 6, background: C.neutral[200], borderRadius: 3, overflow: 'hidden' }}>
                      <div style={{ 
                        width: `${bay.battery}%`, 
                        height: '100%', 
                        background: bay.battery > 60 ? C.success[500] : bay.battery > 30 ? C.warning[500] : C.error[500],
                        borderRadius: 3
                      }} />
                    </div>
                    <span style={{ fontSize: '11px', color: C.neutral[600] }}>{bay.battery}%</span>
                  </div>
                  <p style={{ fontSize: '10px', color: C.neutral[500], marginTop: sp.xs }}>
                    <Clock style={{ width: 10, height: 10, display: 'inline', marginRight: 4 }} />
                    {bay.timeRemaining} remaining
                  </p>
                </>
              ) : (
                <p style={{ fontSize: '13px', color: C.neutral[400], marginTop: sp.sm }}>Ready for use</p>
              )}
            </div>
          ))}
        </div>
        {/* Low battery warnings */}
        <div style={{ marginTop: sp.md, padding: sp.sm, background: C.warning[50], borderRadius: 6, border: `1px solid ${C.warning[200]}` }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, marginBottom: sp.xs }}>
            <AlertTriangle style={{ width: 14, height: 14, color: C.warning[600] }} />
            <span style={{ fontSize: '12px', fontWeight: 500, color: C.warning[700] }}>Low Battery Units</span>
          </div>
          <p style={{ fontSize: '11px', color: C.warning[700] }}>
            OP-02 (52%), EPJ-08 (55%), RT-03 (58%) - Consider scheduling charging during next break
          </p>
        </div>
      </Card>
      
      {/* Equipment Inventory - Using DataGrid */}
      <DataGrid 
        title="Equipment Inventory" 
        subtitle="All MHE units" 
        columns={equipColumns} 
        data={equipmentData} 
        color={C.neutral[500]}
        entityType="equipment"
        filterOptions={[
          { key: 'type', label: 'Type', options: [...new Set(equipmentData.map(e => e.type))] },
          { key: 'status', label: 'Status', options: ['Active', 'Idle', 'Charging', 'Maintenance', 'Offline'] }
        ]}
        onAction={(action, row) => {
          if (action === 'view' && onSelectEquipment) {
            onSelectEquipment(row.id, `${row.id} — ${row.type}`);
          }
        }}
      />
    </>
  );
};

// ===== EQUIPMENT DETAIL CONTENT =====
// Content for equipment detail view - tabs are managed by parent
const EquipmentDetailContent = ({ equipmentId, activeTab, onNavigateToStaff, onNavigateToZone, onNavigateToEquipment, onNavigateToAlert }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue, endTime, endTimeLabel, useEOD } = useTimeContext();
  
  // Helper to generate equipment data for any ID
  const generateEquipmentData = (id) => {
    // Parse equipment type from ID prefix
    const prefix = id.split('-')[0];
    const typeMap = {
      'FL': { type: 'Sit-Down Forklift', manufacturer: 'Toyota', model: '8FGCU25', isPowered: false },
      'RT': { type: 'Reach Truck', manufacturer: 'Crown', model: 'RR5700', isPowered: true },
      'EPJ': { type: 'Electric Pallet Jack', manufacturer: 'Crown', model: 'PE4500-80', isPowered: true },
      'OP': { type: 'Order Picker', manufacturer: 'Raymond', model: '5400', isPowered: true },
      'TT': { type: 'Tugger/Tow Tractor', manufacturer: 'Toyota', model: '8TB50', isPowered: true }
    };
    const typeInfo = typeMap[prefix] || typeMap['FL'];
    
    // Random status based on some logic
    const statuses = ['Active', 'Active', 'Active', 'Idle', 'Maintenance'];
    const status = statuses[Math.abs(id.charCodeAt(id.length - 1)) % statuses.length];
    
    return {
      id,
      type: typeInfo.type,
      status,
      zone: 'Z01 Inbound',
      zoneId: 'Z01',
      operator: status === 'Active' ? 'Mike Brown' : null,
      battery: typeInfo.isPowered ? 65 + (Math.abs(id.charCodeAt(id.length - 1)) % 30) : null,
      isPowered: typeInfo.isPowered,
      utilization: status === 'Active' ? 72 : status === 'Idle' ? 45 : 0,
      purchaseDate: '2020-06-15',
      manufacturer: typeInfo.manufacturer,
      model: typeInfo.model,
      serialNumber: `${prefix}-${Math.abs(id.charCodeAt(id.length - 1) * 1234)}`,
      hoursSincePM: 280 + (Math.abs(id.charCodeAt(id.length - 1)) % 150),
      pmInterval: 400,
      nextPMDue: '12/28',
      lastPMDate: '2024-10-15',
      hoursToday: status === 'Active' ? 4.5 : 0,
      hoursThisWeek: status === 'Active' ? 28.5 : status === 'Idle' ? 12 : 0,
      hoursThisMonth: 156,
      maintenanceCostYTD: 1850,
      avgCostPerHour: 0.35,
      certifiedOperators: [
        { id: 'E005', name: 'Mike Brown' },
        { id: 'E015', name: 'Carlos Mendez' },
        { id: 'E009', name: 'Kevin Park' }
      ],
      maintenanceHistory: [
        { date: '2024-10-15', type: 'PM', desc: '400-hour service', cost: 320, tech: 'Mike T.', status: 'completed' },
        { date: '2024-08-01', type: 'PM', desc: '400-hour service', cost: 310, tech: 'Sarah L.', status: 'completed' }
      ],
      utilizationHistory: [
        { date: 'Mon', hours: 6.5, target: 7 },
        { date: 'Tue', hours: 6.2, target: 7 },
        { date: 'Wed', hours: 5.8, target: 7 },
        { date: 'Thu', hours: 6.0, target: 7 },
        { date: 'Fri', hours: status === 'Active' ? 4.5 : 0, target: 7 }
      ],
      locationHistory: [
        { time: '06:00', zone: 'Z01 Inbound', zoneId: 'Z01' },
        { time: '08:30', zone: 'Z03 Forward Pick', zoneId: 'Z03' },
        { time: '10:00', zone: 'Z01 Inbound', zoneId: 'Z01' }
      ],
      alerts: status === 'Maintenance' ? [
        { id: `equip-${id}-maint`, sev: 'warning', title: 'In maintenance', msg: 'Scheduled service in progress', time: 'Now', conf: 100 }
      ] : [],
      fleet: { type: typeInfo.type, total: 8, activeCount: 6 },
      relatedEquipment: [
        { id: `${prefix}-01`, status: 'Active' },
        { id: `${prefix}-02`, status: 'Active' },
        { id: `${prefix}-03`, status: 'Idle' }
      ].filter(e => e.id !== id),
      // Default route data
      routeStats: {
        totalDistanceToday: 3.8,
        totalDistanceWeek: 24.2,
        avgTripDistance: 0.16,
        tripsToday: 22,
        tripsThisWeek: 142,
        deadTravelPct: 15,
        avgTripTime: 3.8,
        efficiencyScore: 85
      },
      commonRoutes: [
        { id: 'R1', from: 'Dock Area', fromZone: 'Z01', to: 'Storage', toZone: 'Z04', frequency: 38, avgTime: 3.5, distance: 0.14, activity: 'Putaway' },
        { id: 'R2', from: 'Storage', fromZone: 'Z04', to: 'Dock Area', toZone: 'Z01', frequency: 35, avgTime: 3.0, distance: 0.14, activity: 'Return' },
        { id: 'R3', from: 'Storage', fromZone: 'Z04', to: 'Pick Area', toZone: 'Z03', frequency: 24, avgTime: 4.0, distance: 0.18, activity: 'Replenishment' }
      ],
      stopPoints: [
        { id: 'SP1', location: 'Dock Area', zone: 'Z01 Inbound', zoneId: 'Z01', avgDwell: 2.5, visits: 72, activities: ['Unload', 'Stage'], heatLevel: 'high' },
        { id: 'SP2', location: 'Storage', zone: 'Z04 Bulk', zoneId: 'Z04', avgDwell: 1.8, visits: 58, activities: ['Putaway', 'Retrieval'], heatLevel: 'medium' },
        { id: 'SP3', location: 'Pick Area', zone: 'Z03 Forward', zoneId: 'Z03', avgDwell: 2.0, visits: 28, activities: ['Replenishment'], heatLevel: 'low' }
      ],
      routeAlerts: []
    };
  };

  // Mock equipment data - specific overrides for known equipment
  const specificEquipment = {
    'FL-01': {
      id: 'FL-01', type: 'Sit-Down Forklift', status: 'Active', zone: 'Z04 Bulk Storage', zoneId: 'Z04',
      operator: 'Mike Brown', operatorId: 'E005', battery: null, isPowered: false, utilization: 78,
      purchaseDate: '2020-02-10', manufacturer: 'Toyota', model: '8FGCU25', serialNumber: 'TY8F-31452',
      hoursSincePM: 285, pmInterval: 400, nextPMDue: '12/28', lastPMDate: '2024-11-15',
      hoursToday: 4.2, hoursThisWeek: 28.5, hoursThisMonth: 156,
      maintenanceCostYTD: 1650, avgCostPerHour: 0.32,
      certifiedOperators: [
        { id: 'E005', name: 'Mike Brown' },
        { id: 'E015', name: 'Carlos Mendez' },
        { id: 'E009', name: 'Kevin Park' }
      ],
      maintenanceHistory: [
        { date: '2024-11-15', type: 'PM', desc: '400-hour service', cost: 320, tech: 'Mike T.', status: 'completed' },
        { date: '2024-09-02', type: 'PM', desc: '400-hour service', cost: 310, tech: 'Sarah L.', status: 'completed' },
        { date: '2024-07-18', type: 'Corrective', desc: 'Tire replacement', cost: 420, tech: 'Mike T.', status: 'completed' }
      ],
      // Timeline data for tri-temporal display
      utilizationTimeline: [
        { time: '06:00', actual: 0 },
        { time: '07:00', actual: 0.8 },
        { time: '08:00', actual: 1.9 },
        { time: '09:00', actual: 3.1 },
        { time: '10:00', actual: 4.2, predicted: 4.2, now: true },
        { time: '11:00', predicted: 5.0, upper: 5.3, lower: 4.7 },
        { time: '12:00', predicted: 5.6, upper: 6.0, lower: 5.2 },
        { time: '13:00', predicted: 6.2, upper: 6.7, lower: 5.7 },
        { time: '14:00', predicted: 6.8, upper: 7.4, lower: 6.2 } // EOS Day
      ],
      // Extended timeline for EOD view
      utilizationTimelineEOD: [
        { time: '06:00', actual: 0 },
        { time: '08:00', actual: 1.9 },
        { time: '10:00', actual: 4.2, predicted: 4.2, now: true },
        { time: '12:00', predicted: 5.6, upper: 6.0, lower: 5.2 },
        { time: '14:00', predicted: 6.8, upper: 7.4, lower: 6.2 },
        { time: '16:00', predicted: 8.2, upper: 9.0, lower: 7.4 },
        { time: '18:00', predicted: 10.5, upper: 11.5, lower: 9.5 },
        { time: '20:00', predicted: 12.8, upper: 14.0, lower: 11.6 },
        { time: '22:00', predicted: 14.2, upper: 15.6, lower: 12.8 } // EOD
      ],
      utilizationHistory: [
        { date: 'Mon', hours: 6.8, target: 7 },
        { date: 'Tue', hours: 7.1, target: 7 },
        { date: 'Wed', hours: 6.5, target: 7 },
        { date: 'Thu', hours: 6.9, target: 7 },
        { time: '10:00', date: 'Fri', hours: 4.2, target: 7, isToday: true }
      ],
      // Battery simulation for gas-powered (fuel level)
      fuelLevel: 68,
      fuelTimeline: [
        { time: '06:00', actual: 95 },
        { time: '08:00', actual: 82 },
        { time: '10:00', actual: 68, predicted: 68, now: true },
        { time: '12:00', predicted: 52, upper: 56, lower: 48 },
        { time: '14:00', predicted: 35, upper: 42, lower: 28 } // EOS - needs refuel
      ],
      fuelTimelineEOD: [
        { time: '06:00', actual: 95 },
        { time: '10:00', actual: 68, predicted: 68, now: true },
        { time: '14:00', predicted: 35, upper: 42, lower: 28 },
        { time: '16:00', predicted: 95 }, // Refueled at shift change
        { time: '18:00', predicted: 78 },
        { time: '22:00', predicted: 45 }
      ],
      predictedRefuelTime: '13:45',
      locationHistory: [
        { time: '06:00', zone: 'Z01 Inbound', zoneId: 'Z01' },
        { time: '07:30', zone: 'Z04 Bulk Storage', zoneId: 'Z04' },
        { time: '09:15', zone: 'Z03 Forward Pick', zoneId: 'Z03' },
        { time: '10:00', zone: 'Z04 Bulk Storage', zoneId: 'Z04' }
      ],
      alerts: [],
      // Realistic predictive alerts - issues requiring intervention
      predictiveAlerts: [
        { 
          id: 'fl01-pm', 
          sev: 'warning', 
          title: 'PM threshold approaching', 
          msg: 'Will reach 400-hour PM interval in ~15 operating hours. Schedule maintenance to avoid breakdown risk.', 
          time: '+2 days', 
          conf: 94,
          insightAvailable: true
        },
        { 
          id: 'fl01-efficiency', 
          sev: 'info', 
          title: 'Route efficiency declining', 
          msg: 'Dead travel increased 8% this week vs. baseline. Zone congestion in Z04 may be a factor.', 
          time: 'This week', 
          conf: 78,
          insightAvailable: true
        },
        { 
          id: 'fl01-tire', 
          sev: 'warning', 
          title: 'Tire wear detected', 
          msg: 'Front-right tire showing accelerated wear pattern. Replacement recommended within 50 operating hours.', 
          time: '+1 week', 
          conf: 85,
          insightAvailable: true
        }
      ],
      // Scheduled events - operational, not alerts
      upcomingEvents: [
        { id: 'ev-fuel', type: 'refuel', title: 'Refuel needed', time: '13:45', desc: 'Fuel will drop below 30% at current usage', icon: 'fuel' },
        { id: 'ev-handoff', type: 'handoff', title: 'Operator handoff', time: '14:00', desc: 'Mike Brown → Carlos Mendez', icon: 'users' },
        { id: 'ev-pm', type: 'maintenance', title: 'Scheduled PM', time: 'Dec 28', desc: '400-hour preventive maintenance', icon: 'wrench' }
      ],
      fleet: { type: 'Sit-Down Forklift', total: 8, activeCount: 6 },
      relatedEquipment: [
        { id: 'FL-02', status: 'Active' },
        { id: 'FL-03', status: 'Active' },
        { id: 'FL-06', status: 'Maintenance' },
        { id: 'FL-07', status: 'Idle' }
      ],
      // Performance metrics with predictions
      metrics: {
        assetHealth: { current: 92, predicted: 91, target: 85 },
        mtbf: { current: 186, unit: 'hrs' },
        mttr: { current: 1.8, unit: 'hrs' },
        availability: { current: 97, predicted: 96, target: 95 }
      },
      // Today's stats with predictions and timelines for contextual interpolation
      todayStats: {
        palletsHandled: { 
          current: 142, 
          predicted: 248, 
          target: 220,
          timeline: [
            { time: '06:00', actual: 0 },
            { time: '08:00', actual: 52 },
            { time: '10:00', actual: 142, predicted: 142 },
            { time: '12:00', predicted: 185 },
            { time: '14:00', predicted: 248 }
          ]
        },
        tripsCompleted: { 
          current: 38, 
          predicted: 68, 
          target: 60,
          timeline: [
            { time: '06:00', actual: 0 },
            { time: '08:00', actual: 14 },
            { time: '10:00', actual: 38, predicted: 38 },
            { time: '12:00', predicted: 52 },
            { time: '14:00', predicted: 68 }
          ]
        },
        avgTripTime: { current: 3.8, predicted: 3.6, unit: 'min', target: 4.0 },
        deadTravel: { current: 12, predicted: 14, unit: '%', target: 15 }
      },
      // Route data
      routeStats: {
        totalDistanceToday: 4.8,
        totalDistanceWeek: 32.4,
        avgTripDistance: 0.16,
        tripsToday: 38,
        tripsThisWeek: 186,
        deadTravelPct: 12,
        avgTripTime: 3.8,
        efficiencyScore: 91
      },
      commonRoutes: [
        { id: 'R1', from: 'Dock 1-4', fromZone: 'Z01', to: 'Bulk A1-A12', toZone: 'Z04', frequency: 52, avgTime: 3.6, distance: 0.15, activity: 'Putaway' },
        { id: 'R2', from: 'Bulk A1-A12', fromZone: 'Z04', to: 'Dock 1-4', toZone: 'Z01', frequency: 48, avgTime: 3.0, distance: 0.15, activity: 'Return Empty' },
        { id: 'R3', from: 'Bulk B1-B8', fromZone: 'Z04', to: 'Forward Pick', toZone: 'Z03', frequency: 32, avgTime: 4.2, distance: 0.22, activity: 'Replenishment' }
      ],
      stopPoints: [
        { id: 'SP1', location: 'Dock 1-4', zone: 'Z01', zoneId: 'Z01', avgDwell: 2.5, visits: 96, activities: ['Unload inbound', 'Stage pallets'], heatLevel: 'high' },
        { id: 'SP2', location: 'Bulk Storage A', zone: 'Z04', zoneId: 'Z04', avgDwell: 1.4, visits: 82, activities: ['Putaway', 'Retrieval'], heatLevel: 'high' },
        { id: 'SP3', location: 'Forward Pick', zone: 'Z03', zoneId: 'Z03', avgDwell: 1.9, visits: 38, activities: ['Replenishment'], heatLevel: 'medium' }
      ],
      routeAlerts: []
    },
    'FL-06': {
      id: 'FL-06', type: 'Sit-Down Forklift', status: 'Maintenance', zone: 'Z01 Inbound', zoneId: 'Z01',
      operator: null, battery: null, isPowered: false, utilization: 0,
      purchaseDate: '2019-03-15', manufacturer: 'Toyota', model: '8FGCU25', serialNumber: 'TY8F-29847',
      hoursSincePM: 425, pmInterval: 400, nextPMDue: 'Overdue', lastPMDate: '2024-10-18',
      hoursToday: 0, hoursThisWeek: 18.5, hoursThisMonth: 142,
      maintenanceCostYTD: 2840, avgCostPerHour: 0.42,
      certifiedOperators: [
        { id: 'E005', name: 'Mike Brown' },
        { id: 'E015', name: 'Carlos Mendez' },
        { id: 'E009', name: 'Kevin Park' }
      ],
      maintenanceHistory: [
        { date: '2024-12-17', type: 'Corrective', desc: 'Hydraulic leak repair', cost: 450, tech: 'Mike T.', status: 'in-progress' },
        { date: '2024-10-18', type: 'PM', desc: '400-hour service', cost: 320, tech: 'Mike T.', status: 'completed' },
        { date: '2024-08-05', type: 'PM', desc: '400-hour service', cost: 310, tech: 'Sarah L.', status: 'completed' },
        { date: '2024-06-12', type: 'Corrective', desc: 'Brake adjustment', cost: 180, tech: 'Mike T.', status: 'completed' }
      ],
      utilizationHistory: [
        { date: 'Mon', hours: 6.2, target: 7 },
        { date: 'Tue', hours: 5.8, target: 7 },
        { date: 'Wed', hours: 6.5, target: 7 },
        { date: 'Thu', hours: 5.4, target: 7 },
        { date: 'Fri', hours: 0, target: 7 }
      ],
      locationHistory: [
        { time: '06:00', zone: 'Z01 Inbound', zoneId: 'Z01' },
        { time: '08:30', zone: 'Z04 Bulk Storage', zoneId: 'Z04' },
        { time: '10:00', zone: 'Z01 Inbound', zoneId: 'Z01' }
      ],
      alerts: [
        { id: 'equip-pm-overdue', sev: 'critical', title: 'PM overdue', msg: '25 hours past scheduled maintenance', time: 'Now', conf: 95 }
      ],
      fleet: { type: 'Sit-Down Forklift', total: 8, activeCount: 6 },
      relatedEquipment: [
        { id: 'FL-01', status: 'Active' },
        { id: 'FL-02', status: 'Active' },
        { id: 'FL-03', status: 'Active' },
        { id: 'FL-07', status: 'Idle' },
        { id: 'FL-08', status: 'Maintenance' }
      ],
      // Route data
      routeStats: {
        totalDistanceToday: 4.2, // miles
        totalDistanceWeek: 28.6,
        avgTripDistance: 0.18, // miles per trip
        tripsToday: 24,
        tripsThisWeek: 156,
        deadTravelPct: 18, // percentage of travel without load
        avgTripTime: 4.2, // minutes
        efficiencyScore: 82 // vs optimal
      },
      commonRoutes: [
        { id: 'R1', from: 'Dock 1-4', fromZone: 'Z01', to: 'Bulk A1-A12', toZone: 'Z04', frequency: 45, avgTime: 3.8, distance: 0.15, activity: 'Putaway' },
        { id: 'R2', from: 'Bulk A1-A12', fromZone: 'Z04', to: 'Dock 1-4', toZone: 'Z01', frequency: 42, avgTime: 3.2, distance: 0.15, activity: 'Return Empty' },
        { id: 'R3', from: 'Bulk B1-B8', fromZone: 'Z04', to: 'Forward Pick', toZone: 'Z03', frequency: 28, avgTime: 4.5, distance: 0.22, activity: 'Replenishment' },
        { id: 'R4', from: 'Dock 1-4', fromZone: 'Z01', to: 'Bulk B1-B8', toZone: 'Z04', frequency: 22, avgTime: 4.1, distance: 0.19, activity: 'Putaway' },
        { id: 'R5', from: 'Staging', fromZone: 'Z02', to: 'Dock 5-8', toZone: 'Z02', frequency: 18, avgTime: 2.1, distance: 0.08, activity: 'Loading' }
      ],
      stopPoints: [
        { id: 'SP1', location: 'Dock 1-4', zone: 'Z01', zoneId: 'Z01', avgDwell: 2.8, visits: 87, activities: ['Unload inbound', 'Stage pallets'], heatLevel: 'high' },
        { id: 'SP2', location: 'Bulk Storage A', zone: 'Z04', zoneId: 'Z04', avgDwell: 1.5, visits: 68, activities: ['Putaway', 'Retrieval'], heatLevel: 'high' },
        { id: 'SP3', location: 'Bulk Storage B', zone: 'Z04', zoneId: 'Z04', avgDwell: 1.8, visits: 45, activities: ['Putaway', 'Replenishment'], heatLevel: 'medium' },
        { id: 'SP4', location: 'Forward Pick', zone: 'Z03', zoneId: 'Z03', avgDwell: 2.2, visits: 32, activities: ['Replenishment'], heatLevel: 'medium' },
        { id: 'SP5', location: 'Staging Area', zone: 'Z02', zoneId: 'Z02', avgDwell: 3.1, visits: 24, activities: ['Stage outbound', 'Load trucks'], heatLevel: 'low' },
        { id: 'SP6', location: 'Charging Station', zone: 'Z01', zoneId: 'Z01', avgDwell: 0, visits: 0, activities: ['N/A - Gas powered'], heatLevel: 'none' }
      ],
      routeAlerts: [
        { id: 'route-dead-travel', sev: 'warning', title: 'High dead travel', msg: '18% of trips are empty returns - consider batching', conf: 78 },
        { id: 'route-congestion', sev: 'info', title: 'Congestion pattern', msg: 'Dock 1-4 area busy 06:00-08:00, suggest staggering', conf: 85 }
      ]
    },
    'EPJ-03': {
      id: 'EPJ-03', type: 'Electric Pallet Jack', status: 'Maintenance', zone: 'Z01 Inbound', zoneId: 'Z01',
      operator: null, battery: 45, isPowered: true, utilization: 0,
      purchaseDate: '2021-06-20', manufacturer: 'Crown', model: 'PE4500-80', serialNumber: 'CR-PE-58291',
      hoursSincePM: 510, pmInterval: 500, nextPMDue: '12/14', lastPMDate: '2024-09-28',
      hoursToday: 0, hoursThisWeek: 24.2, hoursThisMonth: 168,
      maintenanceCostYTD: 1240, avgCostPerHour: 0.28,
      certifiedOperators: [
        { id: 'E004', name: 'Sarah Johnson' },
        { id: 'E021', name: 'Nina Patel' },
        { id: 'E022', name: 'Amy Foster' },
        { id: 'E023', name: 'Chris Taylor' }
      ],
      maintenanceHistory: [
        { date: '2024-12-17', type: 'Corrective', desc: 'Lift cylinder repair', cost: 380, tech: 'Sarah L.', status: 'in-progress' },
        { date: '2024-09-28', type: 'PM', desc: '500-hour service', cost: 280, tech: 'Sarah L.', status: 'completed' }
      ],
      utilizationHistory: [
        { date: 'Mon', hours: 6.8, target: 7 },
        { date: 'Tue', hours: 6.5, target: 7 },
        { date: 'Wed', hours: 6.3, target: 7 },
        { date: 'Thu', hours: 4.6, target: 7 },
        { date: 'Fri', hours: 0, target: 7 }
      ],
      locationHistory: [
        { time: '06:00', zone: 'Z03 Forward Pick', zoneId: 'Z03' },
        { time: '09:00', zone: 'Z01 Inbound', zoneId: 'Z01' }
      ],
      alerts: [
        { id: 'equip-epj03-repair', sev: 'warning', title: 'In repair', msg: 'Expected return 14:00 today', time: '+4hr', conf: 85 }
      ],
      fleet: { type: 'Electric Pallet Jack', total: 10, activeCount: 7 },
      relatedEquipment: [
        { id: 'EPJ-01', status: 'Active' },
        { id: 'EPJ-02', status: 'Active' },
        { id: 'EPJ-04', status: 'Active' },
        { id: 'EPJ-05', status: 'Idle' }
      ]
    }
  };
  
  // Get equipment data - use specific if available, otherwise generate
  const equipment = specificEquipment[equipmentId] || generateEquipmentData(equipmentId);
  
  const statusColor = equipment.status === 'Active' ? C.success : equipment.status === 'Idle' ? C.neutral : equipment.status === 'Charging' ? C.brand : equipment.status === 'Maintenance' ? C.warning : C.error;

  // Contributing Factors Modal state
  const [contributingFactorsModal, setContributingFactorsModal] = useState({ isOpen: false, title: '', data: null });
  
  // Contributing Factors data for each metric
  const contributingFactorsData = {
    utilization: {
      whatsHappening: `FL-01 is tracking at ${equipment.hoursToday} hours today, which is 12% above the typical pace for this time of day. Current utilization rate suggests the asset will exceed the 7-hour daily target.`,
      whyImportant: 'Higher-than-expected utilization increases wear patterns and may accelerate the PM schedule. However, it also indicates strong productivity and efficient asset deployment.',
      contributors: [
        { label: 'Operator Performance', weight: 42, direction: 'up', detail: 'Mike Brown averaging 8% faster cycle times', onClick: () => {} },
        { label: 'Route Assignments', weight: 35, direction: 'up', detail: 'High-frequency dock-to-storage routes today', onClick: () => {} },
        { label: 'Zone Congestion', weight: 23, direction: 'neutral', detail: 'Z04 traffic normal for this shift', onClick: () => {} }
      ],
      calculation: {
        formula: 'Utilization = (Actual Operating Hours / Scheduled Hours) × 100',
        dataSources: ['Telematics GPS', 'Ignition sensor', 'Operator login events'],
        refreshRate: 'Real-time',
        confidence: 98
      },
      actions: [
        { label: 'View Operators', onClick: () => {} },
        { label: 'View Routes', onClick: () => {} }
      ]
    },
    fuelLevel: {
      whatsHappening: `Fuel level is at ${equipment.fuelLevel}% and depleting at 8.2%/hour. At current consumption, refueling will be required by 13:45 to avoid dropping below the 30% safety threshold.`,
      whyImportant: 'Running below 30% increases risk of fuel starvation during operations and can damage the fuel pump. Scheduling a refuel during the next natural break prevents unplanned downtime.',
      contributors: [
        { label: 'Operating Intensity', weight: 55, direction: 'up', detail: 'Heavy lifting increases consumption 12%', onClick: () => {} },
        { label: 'Route Distance', weight: 30, direction: 'neutral', detail: 'Average trip distance today: 0.16 mi', onClick: () => {} },
        { label: 'Idle Time', weight: 15, direction: 'down', detail: 'Low idle time reducing waste', onClick: () => {} }
      ],
      calculation: {
        formula: 'Depletion Rate = (Start Level - Current Level) / Operating Hours',
        dataSources: ['Fuel tank sensor', 'Engine run time', 'Historical consumption'],
        refreshRate: 'Every 5 minutes',
        confidence: 82
      },
      actions: [
        { label: 'View Maintenance', onClick: () => {} },
        { label: 'Schedule Refuel', onClick: () => {} }
      ]
    },
    assetHealth: {
      whatsHappening: 'Asset Health score is 92%, indicating excellent overall condition. The score has remained stable over the past 30 days with minor fluctuation due to approaching PM interval.',
      whyImportant: 'Maintaining Asset Health above 85% correlates with 40% fewer unplanned breakdowns. Current trajectory suggests the score may dip to 91% by end of shift as PM hours accumulate.',
      contributors: [
        { label: 'PM Compliance', weight: 40, direction: 'neutral', detail: '285 of 400 hours to next PM', onClick: () => {} },
        { label: 'Fault History', weight: 35, direction: 'up', detail: 'No faults in past 30 days', onClick: () => {} },
        { label: 'Sensor Readings', weight: 25, direction: 'neutral', detail: 'All telemetry within normal range', onClick: () => {} }
      ],
      calculation: {
        formula: 'Health = (0.4 × PM Score) + (0.35 × Fault Score) + (0.25 × Sensor Score)',
        dataSources: ['PM logs', 'Fault code history', 'IoT sensor telemetry'],
        refreshRate: 'Every 15 minutes',
        confidence: 94
      },
      actions: [
        { label: 'View Maintenance History', onClick: () => {} },
        { label: 'View Sensor Data', onClick: () => {} }
      ]
    },
    palletsHandled: {
      whatsHappening: 'FL-01 has handled 142 pallets so far today, on pace to reach 248 by end of shift. This exceeds the 220-pallet target by 13%.',
      whyImportant: 'Strong pallet throughput indicates effective deployment. Exceeding targets while maintaining efficiency scores suggests optimal operator-equipment pairing.',
      contributors: [
        { label: 'Operator Skill', weight: 45, direction: 'up', detail: 'Mike Brown: 95th percentile speed', onClick: () => {} },
        { label: 'Zone Assignment', weight: 35, direction: 'up', detail: 'High-volume Z04 bulk storage', onClick: () => {} },
        { label: 'Pallet Type Mix', weight: 20, direction: 'neutral', detail: '80% standard pallets today', onClick: () => {} }
      ],
      calculation: {
        formula: 'Count of completed pallet movements logged via scan events',
        dataSources: ['Barcode scans', 'WMS transactions', 'Location sensors'],
        refreshRate: 'Real-time',
        confidence: 99
      },
      actions: [
        { label: 'View Operator Stats', onClick: () => {} },
        { label: 'View Zone Activity', onClick: () => {} }
      ]
    },
    tripsCompleted: {
      whatsHappening: '38 trips completed today with an average trip time of 3.8 minutes. Projected to reach 68 trips by end of shift.',
      whyImportant: 'Trip count combined with efficiency score indicates productive asset utilization. Current dead travel of 12% is below the 15% threshold.',
      contributors: [
        { label: 'Route Efficiency', weight: 50, direction: 'up', detail: 'Optimized dock-to-storage paths', onClick: () => {} },
        { label: 'Zone Proximity', weight: 30, direction: 'neutral', detail: 'Working adjacent zones today', onClick: () => {} },
        { label: 'Load/Unload Speed', weight: 20, direction: 'up', detail: 'Fast staging at docks', onClick: () => {} }
      ],
      calculation: {
        formula: 'Trip = Start location → Load → Destination → Unload confirmation',
        dataSources: ['GPS waypoints', 'Load sensors', 'Scan events'],
        refreshRate: 'Real-time',
        confidence: 97
      },
      actions: [
        { label: 'View Routes', onClick: () => {} },
        { label: 'View Zone Map', onClick: () => {} }
      ]
    },
    efficiencyScore: {
      whatsHappening: 'Efficiency score is 91%, indicating excellent performance. This factors in dead travel, trip times, and route optimization.',
      whyImportant: 'Efficiency above 85% indicates optimal asset deployment. Current score is 6 points above fleet average for sit-down forklifts.',
      contributors: [
        { label: 'Dead Travel', weight: 40, direction: 'up', detail: 'Only 12% empty trips vs 15% target', onClick: () => {} },
        { label: 'Trip Time', weight: 35, direction: 'up', detail: '3.8 min avg vs 4.2 min baseline', onClick: () => {} },
        { label: 'Route Selection', weight: 25, direction: 'neutral', detail: 'Using recommended paths', onClick: () => {} }
      ],
      calculation: {
        formula: 'Efficiency = 100 - (Dead Travel Penalty) - (Time Penalty) + (Route Bonus)',
        dataSources: ['GPS tracks', 'Route recommendations', 'Historical baselines'],
        refreshRate: 'Hourly',
        confidence: 88
      },
      actions: [
        { label: 'View Route Analysis', onClick: () => {} },
        { label: 'Compare to Fleet', onClick: () => {} }
      ]
    }
  };

  return (
    <>
      {/* Contributing Factors Modal */}
      <ContributingFactorsModal 
        isOpen={contributingFactorsModal.isOpen}
        onClose={() => setContributingFactorsModal({ isOpen: false, title: '', data: null })}
        title={contributingFactorsModal.title}
        data={contributingFactorsModal.data}
      />
      
      {/* Dashboard Tab - includes Hero Card */}
      {activeTab === 'dashboard' && (
        <>
          {/* Consolidated Hero Card - Equipment Identity + Performance Metrics */}
          <Card style={{ borderLeft: `4px solid ${statusColor[500]}` }}>
            {/* Top Section - Equipment Identity */}
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', flexWrap: 'wrap', gap: sp.md, marginBottom: sp.lg }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                <div style={{ 
                  width: 56, height: 56, borderRadius: 12, 
                  background: statusColor[50], 
                  display: 'flex', alignItems: 'center', justifyContent: 'center' 
                }}>
                  <Truck style={{ width: 28, height: 28, color: statusColor[600] }} />
                </div>
                <div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <h2 style={{ fontSize: '24px', fontWeight: 500, margin: 0, color: C.neutral[900] }}>{equipment.id} — {equipment.type}</h2>
                    <Badge status={equipment.status === 'Active' ? 'success' : equipment.status === 'Maintenance' ? 'warning' : equipment.status === 'Offline' ? 'error' : 'neutral'} label={equipment.status} dot={equipment.status === 'Active'} />
                  </div>
                  <p style={{ fontSize: '14px', color: C.neutral[600], margin: 0, marginTop: 4 }}>{equipment.manufacturer} {equipment.model} • {equipment.zone}</p>
                  {/* Current Operator - with chevron for navigation */}
                  {equipment.operator && (
                    <div 
                      onClick={() => onNavigateToStaff && equipment.certifiedOperators?.[0] && onNavigateToStaff(equipment.certifiedOperators[0].id, equipment.certifiedOperators[0].name)}
                      style={{ 
                        display: 'inline-flex', alignItems: 'center', gap: sp.xs, 
                        marginTop: sp.sm, padding: '4px 6px 4px 10px',
                        background: C.purple[50], borderRadius: 16,
                        cursor: 'pointer',
                        border: `1px solid ${C.purple[200]}`,
                        transition: 'all 0.15s'
                      }}
                      onMouseEnter={(e) => { 
                        e.currentTarget.style.background = C.purple[100]; 
                        e.currentTarget.style.borderColor = C.purple[300];
                      }}
                      onMouseLeave={(e) => { 
                        e.currentTarget.style.background = C.purple[50]; 
                        e.currentTarget.style.borderColor = C.purple[200];
                      }}
                    >
                      <Users style={{ width: 14, height: 14, color: C.purple[600] }} />
                      <span style={{ fontSize: '12px', color: C.purple[700], fontWeight: 500 }}>
                        {equipment.operator}
                      </span>
                      <span style={{ fontSize: '11px', color: C.purple[500] }}>operating</span>
                      <ChevronRight style={{ width: 14, height: 14, color: C.purple[400] }} />
                    </div>
                  )}
                </div>
              </div>
              {/* Utilization with tri-temporal including contextual */}
              <div style={{ textAlign: 'right' }}>
                <p style={{ fontSize: '11px', color: C.neutral[500], marginBottom: 4 }}>Utilization Today</p>
                <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs, justifyContent: 'flex-end', flexWrap: 'wrap' }}>
                  <span style={{ fontSize: '28px', fontWeight: 300, color: C.neutral[800] }}>{equipment.hoursToday}</span>
                  <span style={{ fontSize: '14px', color: C.neutral[500] }}>hrs</span>
                  {equipment.utilizationTimeline && (
                    <>
                      {/* Contextual time value - only show if different from NOW */}
                      {isContextualDifferent && contextualTime !== '10:00' && (
                        <>
                          <ArrowRight style={{ width: 12, height: 12, color: C.neutral[400], marginLeft: 4 }} />
                          <span style={{ 
                            fontSize: '16px', 
                            fontWeight: 500, 
                            color: C.brand[700],
                            padding: '2px 6px',
                            background: C.brand[100],
                            borderRadius: 4
                          }}>
                            {interpolateValue(useEOD ? equipment.utilizationTimelineEOD : equipment.utilizationTimeline, contextualTime)?.toFixed(1) || '—'}
                          </span>
                          <span style={{ fontSize: '10px', color: C.brand[600] }}>@{contextualTime}</span>
                        </>
                      )}
                      {/* End time prediction */}
                      <ArrowRight style={{ width: 14, height: 14, color: C.neutral[400], marginLeft: 4 }} />
                      <span style={{ fontSize: '18px', fontWeight: 500, color: C.purple[600] }}>
                        {useEOD ? '14.2' : '6.8'}
                      </span>
                      <span style={{ fontSize: '11px', color: C.purple[500] }}>@{endTimeLabel}</span>
                    </>
                  )}
                </div>
                <p style={{ fontSize: '11px', color: C.neutral[400] }}>Target: 7 hrs/shift</p>
              </div>
            </div>
            
            {/* Divider */}
            <div style={{ borderTop: `1px solid ${C.neutral[200]}`, marginBottom: sp.md }} />
            
            {/* Performance Metrics + Health Indicators - 6 metrics in 3x2 grid */}
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm }}>
              {[
                { 
                  label: 'Asset Health', 
                  value: equipment.metrics?.assetHealth?.current || 92, 
                  pred: equipment.metrics?.assetHealth?.predicted || 91,
                  target: 85,
                  unit: '%', 
                  desc: 'Composite score',
                  getColor: (v) => v >= 90 ? C.success : v >= 75 ? C.warning : C.error,
                  hasContextual: true,
                  factorsKey: 'assetHealth'
                },
                { 
                  label: 'Availability', 
                  value: equipment.metrics?.availability?.current || 97, 
                  pred: equipment.metrics?.availability?.predicted || 96,
                  target: 95,
                  unit: '%', 
                  desc: 'Uptime rate',
                  getColor: (v) => v >= 95 ? C.success : v >= 85 ? C.warning : C.error,
                  hasContextual: true,
                  factorsKey: 'assetHealth'
                },
                { 
                  label: 'Breakdown Risk', 
                  value: equipment.hoursSincePM > equipment.pmInterval ? 'High' : 'Low',
                  isRisk: true,
                  desc: 'Next 7 days',
                  getColor: () => equipment.hoursSincePM > equipment.pmInterval ? C.error : C.success,
                  factorsKey: 'assetHealth'
                },
                { 
                  label: 'MTBF', 
                  value: equipment.metrics?.mtbf?.current || 186, 
                  unit: 'hrs', 
                  desc: 'Mean time between failures',
                  getColor: () => C.brand,
                  factorsKey: 'assetHealth'
                },
                { 
                  label: 'MTTR', 
                  value: equipment.metrics?.mttr?.current || 1.8, 
                  unit: 'hrs', 
                  desc: 'Mean time to repair',
                  getColor: (v) => v <= 2 ? C.success : v <= 4 ? C.warning : C.error,
                  factorsKey: 'assetHealth'
                },
                { 
                  label: 'Cost vs Fleet', 
                  value: '-8%',
                  isComparison: true,
                  desc: 'Maintenance YTD',
                  getColor: () => C.success, // Below average is good
                  factorsKey: 'assetHealth'
                }
              ].map((m, i) => {
                const color = m.getColor(m.value);
                // Calculate contextual value (interpolate between current and predicted based on time)
                const contextualVal = isContextualDifferent && contextualTime !== '10:00' && m.hasContextual && m.pred
                  ? Math.round(m.value + ((m.pred - m.value) * 0.5)) // Simplified interpolation
                  : null;
                return (
                  <div 
                    key={i} 
                    style={{ 
                      padding: sp.sm, 
                      background: color[50], 
                      borderRadius: 6, 
                      textAlign: 'center',
                      borderTop: `3px solid ${color[500]}`
                    }}
                  >
                    <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{m.label}</p>
                    <div style={{ display: 'flex', alignItems: 'baseline', justifyContent: 'center', gap: 2, flexWrap: 'wrap' }}>
                      <span style={{ fontSize: m.isRisk || m.isComparison ? '18px' : '20px', fontWeight: 500, color: color[600] }}>
                        {m.value}
                      </span>
                      {m.unit && <span style={{ fontSize: '11px', color: C.neutral[500] }}>{m.unit}</span>}
                      {/* Contextual value */}
                      {contextualVal !== null && (
                        <>
                          <ArrowRight style={{ width: 8, height: 8, color: C.neutral[400] }} />
                          <span style={{ 
                            fontSize: '12px', 
                            fontWeight: 500, 
                            color: C.brand[700],
                            padding: '1px 4px',
                            background: C.brand[100],
                            borderRadius: 3
                          }}>
                            {contextualVal}
                          </span>
                        </>
                      )}
                      {/* Predicted value */}
                      {m.pred && (
                        <>
                          <ArrowRight style={{ width: 8, height: 8, color: C.neutral[400] }} />
                          <span style={{ fontSize: '12px', color: C.purple[600] }}>{m.pred}</span>
                        </>
                      )}
                    </div>
                    <p style={{ fontSize: '9px', color: C.neutral[400] }}>{m.desc}</p>
                  </div>
                );
              })}
            </div>
          </Card>
          
          {/* Utilization Timeline - Line Chart with Tri-Temporal */}
          <Card>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
              <div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 4 }}>
                  <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Utilization Timeline</h3>
                  <ContributingFactorsLink onClick={() => setContributingFactorsModal({ 
                    isOpen: true, 
                    title: 'Utilization', 
                    data: contributingFactorsData.utilization 
                  })} />
                </div>
                <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>
                  Hours worked today • Target: 7 hrs by {useEOD ? 'EOD' : 'EOS'}
                </p>
              </div>
              {isContextualDifferent && contextualTime !== '10:00' && (
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, padding: '4px 10px', background: C.brand[100], borderRadius: 6 }}>
                  <span style={{ fontSize: '12px', color: C.brand[600] }}>
                    @{contextualTime}: <strong>{interpolateValue(useEOD ? equipment.utilizationTimelineEOD : equipment.utilizationTimeline, contextualTime)?.toFixed(1) || '—'}</strong> hrs
                  </span>
                </div>
              )}
            </div>
            {/* Line chart with contextual marker */}
            <div style={{ position: 'relative', height: 160 }}>
              <ResponsiveContainer width="100%" height="100%">
                <AreaChart data={useEOD ? equipment.utilizationTimelineEOD : equipment.utilizationTimeline} margin={{ top: 10, right: 10, left: 0, bottom: 5 }}>
                  <defs>
                    <linearGradient id="utilActualFill" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="0%" stopColor={C.brand[500]} stopOpacity={0.2} />
                      <stop offset="100%" stopColor={C.brand[500]} stopOpacity={0} />
                    </linearGradient>
                    <linearGradient id="utilPredFill" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="0%" stopColor={C.purple[500]} stopOpacity={0.15} />
                      <stop offset="100%" stopColor={C.purple[500]} stopOpacity={0.02} />
                    </linearGradient>
                  </defs>
                  <XAxis dataKey="time" tick={{ fontSize: 10, fill: C.neutral[500] }} axisLine={{ stroke: C.neutral[200] }} tickLine={false} />
                  <YAxis tick={{ fontSize: 10, fill: C.neutral[500] }} axisLine={false} tickLine={false} width={25} domain={[0, 'auto']} />
                  {/* Target line */}
                  <Area type="linear" dataKey={() => 7} stroke={C.success[400]} strokeWidth={1} strokeDasharray="4 4" fill="none" />
                  {/* Confidence band */}
                  <Area type="linear" dataKey="upper" stroke="none" fill="url(#utilPredFill)" />
                  <Area type="linear" dataKey="lower" stroke="none" fill="url(#utilPredFill)" />
                  {/* Actual line */}
                  <Area type="linear" dataKey="actual" stroke={C.brand[500]} strokeWidth={2} fill="url(#utilActualFill)" dot={false} connectNulls />
                  {/* Predicted line */}
                  <Area type="linear" dataKey="predicted" stroke={C.purple[500]} strokeWidth={2} strokeDasharray="6 3" fill="none" dot={false} connectNulls />
                </AreaChart>
              </ResponsiveContainer>
              {/* NOW marker label overlay */}
              {(() => {
                const timeline = useEOD ? equipment.utilizationTimelineEOD : equipment.utilizationTimeline;
                const times = timeline.map(d => {
                  const [h, m] = d.time.split(':').map(Number);
                  return h + (m || 0) / 60;
                });
                const minTime = Math.min(...times);
                const maxTime = Math.max(...times);
                const nowDecimal = 10; // 10:00
                const nowPosition = ((nowDecimal - minTime) / (maxTime - minTime)) * 100;
                return (
                  <div style={{ 
                    position: 'absolute', 
                    top: 10, 
                    bottom: 25, 
                    left: `calc(${nowPosition}% * 0.85 + 25px)`,
                    width: 2, 
                    background: C.neutral[600], 
                    zIndex: 9,
                    pointerEvents: 'none'
                  }}>
                    <div style={{
                      position: 'absolute', 
                      top: -8, 
                      left: '50%', 
                      transform: 'translateX(-50%)', 
                      background: C.neutral[600], 
                      color: 'white', 
                      padding: '2px 6px', 
                      borderRadius: 3, 
                      fontSize: 9, 
                      fontWeight: 600,
                      whiteSpace: 'nowrap'
                    }}>
                      NOW
                    </div>
                  </div>
                );
              })()}
              {/* Contextual time marker overlay - only if different from NOW */}
              {isContextualDifferent && contextualTime !== '10:00' && (() => {
                const timeline = useEOD ? equipment.utilizationTimelineEOD : equipment.utilizationTimeline;
                const times = timeline.map(d => {
                  const [h, m] = d.time.split(':').map(Number);
                  return h + (m || 0) / 60;
                });
                const [ctxH, ctxM] = contextualTime.split(':').map(Number);
                const ctxDecimal = ctxH + (ctxM || 0) / 60;
                const minTime = Math.min(...times);
                const maxTime = Math.max(...times);
                if (ctxDecimal < minTime || ctxDecimal > maxTime) return null;
                const position = ((ctxDecimal - minTime) / (maxTime - minTime)) * 100;
                return (
                  <div style={{ 
                    position: 'absolute', 
                    top: 10, 
                    bottom: 25, 
                    left: `calc(${position}% * 0.85 + 25px)`,
                    width: 2, 
                    background: C.brand[500], 
                    zIndex: 10,
                    pointerEvents: 'none'
                  }}>
                    <div style={{ 
                      position: 'absolute', 
                      top: -8, 
                      left: '50%', 
                      transform: 'translateX(-50%)', 
                      background: C.brand[500], 
                      color: 'white', 
                      padding: '2px 6px', 
                      borderRadius: 3, 
                      fontSize: 9, 
                      fontWeight: 600,
                      whiteSpace: 'nowrap'
                    }}>
                      {contextualTime}
                    </div>
                  </div>
                );
              })()}
            </div>
            {/* Legend */}
            <div style={{ display: 'flex', justifyContent: 'center', gap: sp.lg, paddingTop: sp.sm, borderTop: `1px solid ${C.neutral[100]}`, marginTop: sp.sm }}>
              <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
                <span style={{ width: 16, height: 3, background: C.brand[500], borderRadius: 2 }} />
                Actual
              </span>
              <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
                <span style={{ width: 16, height: 0, borderTop: `2px dashed ${C.purple[500]}` }} />
                Predicted
              </span>
              <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
                <span style={{ width: 16, height: 0, borderTop: `2px dashed ${C.success[400]}` }} />
                Target (7h)
              </span>
              <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
                <span style={{ width: 16, height: 3, background: C.neutral[600], borderRadius: 2 }} />
                Now
              </span>
              {isContextualDifferent && contextualTime !== '10:00' && (
                <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.brand[600] }}>
                  <span style={{ width: 16, height: 3, background: C.brand[500], borderRadius: 2 }} />
                  @{contextualTime}
                </span>
              )}
            </div>
          </Card>
          
          {/* Today's Stats - 2 column layout, compact */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.sm }}>
            {[
              { 
                label: 'Pallets Handled', 
                value: equipment.todayStats?.palletsHandled?.current || 142, 
                pred: equipment.todayStats?.palletsHandled?.predicted || 248,
                target: equipment.todayStats?.palletsHandled?.target || 220, 
                timeline: equipment.todayStats?.palletsHandled?.timeline,
                icon: Package,
                good: (equipment.todayStats?.palletsHandled?.predicted || 248) >= (equipment.todayStats?.palletsHandled?.target || 220)
              },
              { 
                label: 'Trips Completed', 
                value: equipment.todayStats?.tripsCompleted?.current || 38, 
                pred: equipment.todayStats?.tripsCompleted?.predicted || 68,
                target: equipment.todayStats?.tripsCompleted?.target || 60, 
                timeline: equipment.todayStats?.tripsCompleted?.timeline,
                icon: TrendingUp,
                good: (equipment.todayStats?.tripsCompleted?.predicted || 68) >= (equipment.todayStats?.tripsCompleted?.target || 60)
              },
              { 
                label: 'Hours Since PM', 
                value: equipment.hoursSincePM, 
                target: equipment.pmInterval, 
                warn: equipment.hoursSincePM > equipment.pmInterval * 0.9, 
                icon: Wrench,
                inlineTarget: true
              },
              { 
                label: 'Efficiency Score', 
                value: equipment.routeStats?.efficiencyScore || 91, 
                unit: '%',
                icon: Zap,
                good: (equipment.routeStats?.efficiencyScore || 91) >= 85
              }
            ].map((metric, i) => {
              const contextualVal = isContextualDifferent && contextualTime !== '10:00' && metric.timeline 
                ? Math.round(interpolateValue(metric.timeline, contextualTime)) 
                : null;
              return (
                <Card key={i} style={{ padding: sp.sm, borderLeft: `3px solid ${metric.warn ? C.warning[500] : metric.good ? C.success[500] : C.neutral[300]}` }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <div style={{ 
                      width: 32, height: 32, borderRadius: 6, 
                      background: metric.warn ? C.warning[50] : metric.good ? C.success[50] : C.neutral[50],
                      display: 'flex', alignItems: 'center', justifyContent: 'center',
                      flexShrink: 0
                    }}>
                      <metric.icon style={{ width: 16, height: 16, color: metric.warn ? C.warning[600] : metric.good ? C.success[600] : C.neutral[500] }} />
                    </div>
                    <div style={{ flex: 1, minWidth: 0 }}>
                      <p style={{ fontSize: '10px', color: C.neutral[500], margin: 0, marginBottom: 2 }}>{metric.label}</p>
                      <div style={{ display: 'flex', alignItems: 'baseline', gap: 4, flexWrap: 'wrap' }}>
                        <span style={{ fontSize: '20px', fontWeight: 500, color: metric.warn ? C.warning[700] : C.neutral[800] }}>
                          {metric.value}{metric.unit || ''}
                        </span>
                        {/* Inline target for Hours Since PM */}
                        {metric.inlineTarget && metric.target && (
                          <span style={{ fontSize: '12px', color: C.neutral[400] }}>/ {metric.target}</span>
                        )}
                        {/* Contextual value */}
                        {contextualVal !== null && (
                          <>
                            <ArrowRight style={{ width: 10, height: 10, color: C.neutral[400] }} />
                            <span style={{ 
                              fontSize: '13px', 
                              fontWeight: 500, 
                              color: C.brand[700],
                              padding: '1px 6px',
                              background: C.brand[100],
                              borderRadius: 3
                            }}>
                              {contextualVal}
                            </span>
                          </>
                        )}
                        {/* Predicted value */}
                        {metric.pred && (
                          <>
                            <ArrowRight style={{ width: 10, height: 10, color: C.neutral[400] }} />
                            <span style={{ fontSize: '14px', fontWeight: 500, color: C.purple[600] }}>{metric.pred}</span>
                          </>
                        )}
                        {/* Target badge for metrics with predictions */}
                        {metric.target && metric.pred && (
                          <span style={{ 
                            fontSize: '10px', 
                            color: metric.good ? C.success[600] : C.warning[600],
                            marginLeft: 2
                          }}>
                            ({metric.good ? '✓' : '!'} {metric.target})
                          </span>
                        )}
                      </div>
                    </div>
                  </div>
                </Card>
              );
            })}
          </div>

          {/* Fuel/Battery Prediction Card */}
          <Card style={{ background: `linear-gradient(135deg, ${C.warning[50]} 0%, ${C.neutral[50]} 100%)` }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.md }}>
              <div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 4 }}>
                  <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0, display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <Fuel style={{ width: 16, height: 16, color: C.warning[600] }} />
                    Fuel Level Prediction
                  </h3>
                  <ContributingFactorsLink onClick={() => setContributingFactorsModal({ 
                    isOpen: true, 
                    title: 'Fuel Level', 
                    data: contributingFactorsData.fuelLevel 
                  })} />
                </div>
                <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>
                  Estimated refuel needed at {equipment.predictedRefuelTime || '13:45'}
                </p>
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                {isContextualDifferent && contextualTime !== '10:00' && (
                  <div style={{ padding: '4px 8px', background: C.brand[100], borderRadius: 4 }}>
                    <span style={{ fontSize: '11px', color: C.brand[700] }}>
                      @{contextualTime}: <strong>{Math.round(interpolateValue(useEOD ? equipment.fuelTimelineEOD : equipment.fuelTimeline, contextualTime) || 0)}%</strong>
                    </span>
                  </div>
                )}
                <Badge status="warning" label="Refuel by 13:45" />
              </div>
            </div>
            
            {/* Fuel timeline mini-chart with NOW and contextual markers */}
            <div style={{ position: 'relative', height: 100, marginBottom: sp.sm }}>
              <ResponsiveContainer width="100%" height="100%">
                <AreaChart data={useEOD ? equipment.fuelTimelineEOD : equipment.fuelTimeline} margin={{ top: 5, right: 5, left: 0, bottom: 5 }}>
                  <defs>
                    <linearGradient id="fuelGradient" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="0%" stopColor={C.warning[500]} stopOpacity={0.3} />
                      <stop offset="100%" stopColor={C.warning[500]} stopOpacity={0.05} />
                    </linearGradient>
                  </defs>
                  <XAxis dataKey="time" tick={{ fontSize: 9, fill: C.neutral[500] }} axisLine={false} tickLine={false} />
                  <YAxis tick={{ fontSize: 9, fill: C.neutral[500] }} axisLine={false} tickLine={false} width={25} domain={[0, 100]} />
                  {/* Warning threshold */}
                  <Area type="linear" dataKey={() => 30} stroke={C.error[300]} strokeWidth={1} strokeDasharray="3 3" fill="none" />
                  {/* Actual + predicted */}
                  <Area type="linear" dataKey="actual" stroke={C.warning[500]} strokeWidth={2} fill="url(#fuelGradient)" dot={false} connectNulls />
                  <Area type="linear" dataKey="predicted" stroke={C.warning[500]} strokeWidth={2} strokeDasharray="4 3" fill="url(#fuelGradient)" dot={false} connectNulls />
                </AreaChart>
              </ResponsiveContainer>
              {/* NOW marker label overlay */}
              {(() => {
                const timeline = useEOD ? equipment.fuelTimelineEOD : equipment.fuelTimeline;
                const times = timeline.map(d => {
                  const [h, m] = d.time.split(':').map(Number);
                  return h + (m || 0) / 60;
                });
                const minTime = Math.min(...times);
                const maxTime = Math.max(...times);
                const nowDecimal = 10; // 10:00
                const nowPosition = ((nowDecimal - minTime) / (maxTime - minTime)) * 100;
                return (
                  <div style={{ 
                    position: 'absolute', 
                    top: 5, 
                    bottom: 20, 
                    left: `calc(${nowPosition}% * 0.88 + 25px)`,
                    width: 2, 
                    background: C.neutral[600], 
                    zIndex: 9,
                    pointerEvents: 'none'
                  }}>
                    <div style={{ 
                      position: 'absolute', 
                      top: -6, 
                      left: '50%', 
                      transform: 'translateX(-50%)', 
                      background: C.neutral[600], 
                      color: 'white', 
                      padding: '1px 4px', 
                      borderRadius: 2, 
                      fontSize: 8, 
                      fontWeight: 600,
                      whiteSpace: 'nowrap'
                    }}>
                      NOW
                    </div>
                  </div>
                );
              })()}
              {/* Contextual time marker overlay - only if different from NOW */}
              {isContextualDifferent && contextualTime !== '10:00' && (() => {
                const timeline = useEOD ? equipment.fuelTimelineEOD : equipment.fuelTimeline;
                const times = timeline.map(d => {
                  const [h, m] = d.time.split(':').map(Number);
                  return h + (m || 0) / 60;
                });
                const [ctxH, ctxM] = contextualTime.split(':').map(Number);
                const ctxDecimal = ctxH + (ctxM || 0) / 60;
                const minTime = Math.min(...times);
                const maxTime = Math.max(...times);
                if (ctxDecimal < minTime || ctxDecimal > maxTime) return null;
                const position = ((ctxDecimal - minTime) / (maxTime - minTime)) * 100;
                return (
                  <div style={{ 
                    position: 'absolute', 
                    top: 5, 
                    bottom: 20, 
                    left: `calc(${position}% * 0.88 + 25px)`,
                    width: 2, 
                    background: C.brand[500], 
                    zIndex: 10,
                    pointerEvents: 'none'
                  }}>
                    <div style={{ 
                      position: 'absolute', 
                      top: -6, 
                      left: '50%', 
                      transform: 'translateX(-50%)', 
                      background: C.brand[500], 
                      color: 'white', 
                      padding: '1px 4px', 
                      borderRadius: 2, 
                      fontSize: 8, 
                      fontWeight: 600,
                      whiteSpace: 'nowrap'
                    }}>
                      {contextualTime}
                    </div>
                  </div>
                );
              })()}
            </div>
            
            {/* Current stats row with contextual value */}
            <div style={{ display: 'flex', gap: sp.md }}>
              <div style={{ flex: 1, padding: sp.sm, background: 'rgba(255,255,255,0.7)', borderRadius: 6 }}>
                <p style={{ fontSize: '10px', color: C.neutral[500], margin: 0 }}>Fuel Level</p>
                <div style={{ display: 'flex', alignItems: 'baseline', gap: 4, flexWrap: 'wrap' }}>
                  <span style={{ fontSize: '20px', fontWeight: 600, color: C.warning[700] }}>{equipment.fuelLevel || 68}%</span>
                  {/* Contextual value - only show if different from NOW */}
                  {isContextualDifferent && contextualTime !== '10:00' && (
                    <>
                      <ArrowRight style={{ width: 10, height: 10, color: C.neutral[400] }} />
                      <span style={{ 
                        fontSize: '13px', 
                        fontWeight: 500, 
                        color: C.brand[700],
                        padding: '1px 5px',
                        background: C.brand[100],
                        borderRadius: 3
                      }}>
                        {Math.round(interpolateValue(useEOD ? equipment.fuelTimelineEOD : equipment.fuelTimeline, contextualTime) || 0)}%
                      </span>
                      <span style={{ fontSize: '9px', color: C.brand[600] }}>@{contextualTime}</span>
                    </>
                  )}
                  {/* End time prediction */}
                  <ArrowRight style={{ width: 10, height: 10, color: C.neutral[400] }} />
                  <span style={{ fontSize: '14px', color: C.purple[600] }}>{useEOD ? '45' : '35'}%</span>
                  <span style={{ fontSize: '10px', color: C.purple[500] }}>@{endTimeLabel}</span>
                </div>
              </div>
              <div style={{ flex: 1, padding: sp.sm, background: 'rgba(255,255,255,0.7)', borderRadius: 6 }}>
                <p style={{ fontSize: '10px', color: C.neutral[500], margin: 0 }}>Est. Runtime Left</p>
                <p style={{ fontSize: '16px', fontWeight: 500, margin: 0 }}>~3.5 hrs</p>
              </div>
              <div style={{ flex: 1, padding: sp.sm, background: 'rgba(255,255,255,0.7)', borderRadius: 6 }}>
                <p style={{ fontSize: '10px', color: C.neutral[500], margin: 0 }}>Consumption Rate</p>
                <p style={{ fontSize: '16px', fontWeight: 500, margin: 0 }}>8.2%/hr</p>
              </div>
            </div>
          </Card>
          
          {/* Upcoming Events - Scheduled operational items */}
          {equipment.upcomingEvents && equipment.upcomingEvents.length > 0 && (
            <Card>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
                <div>
                  <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0, display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <Calendar style={{ width: 16, height: 16, color: C.neutral[500] }} />
                    Upcoming Events
                  </h3>
                  <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>Scheduled operational activities</p>
                </div>
              </div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                {equipment.upcomingEvents.map((event, i) => {
                  const iconMap = {
                    fuel: Fuel,
                    users: Users,
                    wrench: Wrench
                  };
                  const EventIcon = iconMap[event.icon] || Clock;
                  const colorMap = {
                    refuel: C.warning,
                    handoff: C.purple,
                    maintenance: C.brand
                  };
                  const color = colorMap[event.type] || C.neutral;
                  
                  return (
                    <div key={i} style={{ 
                      display: 'flex', 
                      alignItems: 'center', 
                      gap: sp.md,
                      padding: sp.sm,
                      background: C.neutral[50],
                      borderRadius: 6,
                      borderLeft: `3px solid ${color[400]}`
                    }}>
                      <div style={{ 
                        width: 32, height: 32, borderRadius: 6,
                        background: color[100],
                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                        flexShrink: 0
                      }}>
                        <EventIcon style={{ width: 16, height: 16, color: color[600] }} />
                      </div>
                      <div style={{ flex: 1 }}>
                        <p style={{ fontSize: '13px', fontWeight: 500, margin: 0, color: C.neutral[800] }}>{event.title}</p>
                        <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>{event.desc}</p>
                      </div>
                      <div style={{ 
                        padding: '4px 8px', 
                        background: color[100], 
                        borderRadius: 4,
                        flexShrink: 0
                      }}>
                        <span style={{ fontSize: '12px', fontWeight: 500, color: color[700] }}>{event.time}</span>
                      </div>
                    </div>
                  );
                })}
              </div>
            </Card>
          )}
          
          {/* Analysis - with CTA to Insights tab */}
          {equipment.predictiveAlerts && equipment.predictiveAlerts.length > 0 && (
            <Card>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
                <div>
                  <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Analysis</h3>
                  <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>Issues that may impact productivity</p>
                </div>
                <div 
                  onClick={() => {/* Navigate to Insights tab - would need prop */}}
                  style={{ 
                    display: 'flex', alignItems: 'center', gap: sp.xs,
                    padding: '6px 12px',
                    background: C.purple[50],
                    borderRadius: 6,
                    cursor: 'pointer',
                    border: `1px solid ${C.purple[200]}`
                  }}
                >
                  <Lightbulb style={{ width: 14, height: 14, color: C.purple[600] }} />
                  <span style={{ fontSize: '12px', color: C.purple[700], fontWeight: 500 }}>View AI Recommendations</span>
                  <ChevronRight style={{ width: 14, height: 14, color: C.purple[500] }} />
                </div>
              </div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                {equipment.predictiveAlerts.map((alert, i) => (
                  <div key={i} style={{ 
                    display: 'flex', 
                    alignItems: 'center', 
                    justifyContent: 'space-between',
                    padding: sp.sm,
                    background: alert.sev === 'warning' ? C.warning[50] : alert.sev === 'critical' ? C.error[50] : C.brand[50],
                    borderRadius: 6,
                    borderLeft: `3px solid ${alert.sev === 'warning' ? C.warning[500] : alert.sev === 'critical' ? C.error[500] : C.brand[500]}`
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                      <AlertTriangle style={{ 
                        width: 16, height: 16, 
                        color: alert.sev === 'warning' ? C.warning[600] : alert.sev === 'critical' ? C.error[600] : C.brand[600] 
                      }} />
                      <div>
                        <p style={{ fontSize: '13px', fontWeight: 500, margin: 0 }}>{alert.title}</p>
                        <p style={{ fontSize: '11px', color: C.neutral[600], margin: 0 }}>{alert.msg}</p>
                      </div>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                      <div style={{ textAlign: 'right' }}>
                        <p style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[700], margin: 0 }}>{alert.time}</p>
                        <p style={{ fontSize: '10px', color: C.neutral[500], margin: 0 }}>{alert.conf}% confidence</p>
                      </div>
                      <div 
                        style={{ 
                          padding: '4px 8px', 
                          background: C.purple[100], 
                          borderRadius: 4,
                          cursor: 'pointer'
                        }}
                        title="Explore solutions in Insights tab"
                      >
                        <Lightbulb style={{ width: 14, height: 14, color: C.purple[600] }} />
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </Card>
          )}
          
          {/* Active Alerts (existing) */}
          {equipment.alerts && equipment.alerts.length > 0 && (
            <Card>
              <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Active Alerts</h3>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                {equipment.alerts.map((alert, i) => (
                  <Alert 
                    key={i} 
                    {...alert} 
                    onClick={() => onNavigateToAlert && onNavigateToAlert(alert.id, 'equipment', true)}
                  />
                ))}
              </div>
            </Card>
          )}
        </>
      )}
      
      {/* Operators Tab */}
      {activeTab === 'operators' && (
        <>
          {/* Current Operator Card */}
          <Card style={{ borderLeft: `4px solid ${C.purple[500]}` }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                <div style={{ 
                  width: 48, height: 48, borderRadius: '50%', 
                  background: C.purple[100], 
                  display: 'flex', alignItems: 'center', justifyContent: 'center',
                  border: `3px solid ${C.purple[500]}`
                }}>
                  <Users style={{ width: 24, height: 24, color: C.purple[600] }} />
                </div>
                <div>
                  <p style={{ fontSize: '11px', color: C.neutral[500], marginBottom: 2 }}>CURRENTLY OPERATING</p>
                  <p 
                    onClick={() => onNavigateToStaff && equipment.certifiedOperators?.[0] && onNavigateToStaff(equipment.certifiedOperators[0].id, equipment.certifiedOperators[0].name)}
                    style={{ fontSize: '18px', fontWeight: 500, color: C.purple[700], cursor: 'pointer' }}
                  >
                    {equipment.certifiedOperators?.[0]?.name || 'Unassigned'}
                  </p>
                  <p style={{ fontSize: '12px', color: C.neutral[500] }}>Since 6:02 AM • 5.2 hrs today</p>
                </div>
              </div>
              <div style={{ display: 'flex', gap: sp.md }}>
                <div style={{ textAlign: 'center', padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                  <p style={{ fontSize: '18px', fontWeight: 500, color: C.success[600] }}>89</p>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>Driver Score</p>
                </div>
                <div style={{ textAlign: 'center', padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                  <p style={{ fontSize: '18px', fontWeight: 500 }}>42</p>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>Pallets/hr</p>
                </div>
              </div>
            </div>
          </Card>
          
          {/* Operator Stats Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Certified Ops', value: equipment.certifiedOperators?.length || 0, sub: 'For this unit' },
              { label: 'Avg Driver Score', value: 87, unit: '%', sub: 'Safety & efficiency', good: true },
              { label: 'Impact Events', value: 2, sub: 'Last 30 days', warn: true },
              { label: 'Expiring Certs', value: 1, sub: 'Next 30 days', warn: true }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '20px', fontWeight: 500, color: s.warn ? C.warning[600] : s.good ? C.success[600] : C.neutral[800] }}>
                  {s.value}{s.unit && <span style={{ fontSize: '12px', color: C.neutral[500] }}>{s.unit}</span>}
                </p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Certified Operators List */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>All Certified Operators</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {(equipment.certifiedOperators || []).map((op, i) => {
                const score = 75 + Math.floor(Math.random() * 20);
                const hoursOnUnit = 120 + Math.floor(Math.random() * 200);
                const certExpiry = ['2025-03-15', '2025-06-22', '2025-08-10', '2025-01-30'][i % 4];
                const impactEvents = i === 0 ? 2 : 0;
                const isExpiringSoon = new Date(certExpiry) < new Date(Date.now() + 30*24*60*60*1000);
                const isCurrent = i === 0;
                
                return (
                  <div 
                    key={i} 
                    onClick={() => onNavigateToStaff && onNavigateToStaff(op.id, op.name)}
                    style={{ 
                      display: 'flex', 
                      alignItems: 'center',
                      padding: sp.md,
                      background: isCurrent ? C.purple[50] : 'white',
                      border: `1px solid ${isCurrent ? C.purple[200] : C.neutral[200]}`,
                      borderLeft: `4px solid ${isCurrent ? C.purple[500] : score >= 85 ? C.success[500] : score >= 70 ? C.warning[500] : C.error[500]}`,
                      borderRadius: '0 8px 8px 0',
                      cursor: 'pointer'
                    }}
                  >
                    {/* Avatar with score ring */}
                    <div style={{ position: 'relative', marginRight: sp.md }}>
                      <div style={{ 
                        width: 44, height: 44, borderRadius: '50%', 
                        background: C.purple[100], 
                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                        border: `3px solid ${score >= 85 ? C.success[500] : score >= 70 ? C.warning[500] : C.error[500]}`
                      }}>
                        <Users style={{ width: 20, height: 20, color: C.purple[600] }} />
                      </div>
                      {/* Score badge */}
                      <div style={{ 
                        position: 'absolute', bottom: -4, right: -4, 
                        width: 22, height: 22, borderRadius: '50%',
                        background: score >= 85 ? C.success[500] : score >= 70 ? C.warning[500] : C.error[500],
                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                        fontSize: '9px', fontWeight: 700, color: 'white',
                        border: '2px solid white'
                      }}>
                        {score}
                      </div>
                    </div>
                    
                    {/* Operator Info */}
                    <div style={{ flex: 1 }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.xs }}>
                        <p style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>{op.name}</p>
                        {isCurrent && (
                          <Badge status="info" label="Current" />
                        )}
                        {impactEvents > 0 && (
                          <Badge status="error" label={`${impactEvents} impacts`} />
                        )}
                        {isExpiringSoon && (
                          <Badge status="warning" label="Cert expiring" />
                        )}
                      </div>
                      <div style={{ display: 'flex', gap: sp.lg, fontSize: '11px', color: C.neutral[500] }}>
                        <span>{hoursOnUnit} hrs on unit</span>
                        <span>Cert expires: {certExpiry}</span>
                      </div>
                    </div>
                    
                    {/* Driver Score Breakdown */}
                    <div style={{ display: 'flex', gap: sp.md, marginRight: sp.md }}>
                      <div style={{ textAlign: 'center' }}>
                        <p style={{ fontSize: '14px', fontWeight: 600, color: C.neutral[800] }}>{Math.round(score * 0.95)}</p>
                        <p style={{ fontSize: '9px', color: C.neutral[500] }}>Safety</p>
                      </div>
                      <div style={{ textAlign: 'center' }}>
                        <p style={{ fontSize: '14px', fontWeight: 600, color: C.neutral[800] }}>{Math.round(score * 1.02)}</p>
                        <p style={{ fontSize: '9px', color: C.neutral[500] }}>Efficiency</p>
                      </div>
                      <div style={{ textAlign: 'center' }}>
                        <p style={{ fontSize: '14px', fontWeight: 600, color: C.neutral[800] }}>{Math.round(score * 0.98)}</p>
                        <p style={{ fontSize: '9px', color: C.neutral[500] }}>Care</p>
                      </div>
                    </div>
                    
                    <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
                  </div>
                );
              })}
            </div>
          </Card>
          
          {/* Recent Activity on This Unit */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Recent Operator Activity</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
              {[
                { op: equipment.certifiedOperators?.[0]?.name || 'J. Martinez', action: 'Completed shift', time: '2 hrs ago', duration: '6.5 hrs', pallets: 89 },
                { op: equipment.certifiedOperators?.[1]?.name || 'M. Chen', action: 'Started shift', time: 'Now', duration: '1.2 hrs', pallets: 18 },
                { op: equipment.certifiedOperators?.[0]?.name || 'J. Martinez', action: 'Impact event', time: 'Yesterday', duration: null, pallets: null, alert: true }
              ].map((activity, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.sm,
                  background: activity.alert ? C.error[50] : C.neutral[50],
                  borderRadius: 6
                }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    {activity.alert ? (
                      <AlertTriangle style={{ width: 16, height: 16, color: C.error[500] }} />
                    ) : (
                      <Clock style={{ width: 16, height: 16, color: C.neutral[400] }} />
                    )}
                    <div>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{activity.op}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{activity.action} • {activity.time}</p>
                    </div>
                  </div>
                  {activity.duration && (
                    <div style={{ display: 'flex', gap: sp.md, fontSize: '12px' }}>
                      <span style={{ color: C.neutral[600] }}>{activity.duration}</span>
                      <span style={{ color: C.brand[600], fontWeight: 500 }}>{activity.pallets} pallets</span>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </Card>
          
          {/* Training & Certification Status */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Certification Requirements</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { cert: 'Forklift Operator License', required: true, ops: equipment.certifiedOperators?.length || 4, compliant: equipment.certifiedOperators?.length || 4 },
                { cert: 'Hazmat Handling', required: false, ops: equipment.certifiedOperators?.length || 4, compliant: 2 },
                { cert: 'Cold Storage Operations', required: false, ops: equipment.certifiedOperators?.length || 4, compliant: 3 }
              ].map((cert, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.sm,
                  background: C.neutral[50],
                  borderRadius: 6
                }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <div style={{ 
                      width: 8, height: 8, borderRadius: '50%', 
                      background: cert.compliant === cert.ops ? C.success[500] : C.warning[500] 
                    }} />
                    <span style={{ fontSize: '13px' }}>{cert.cert}</span>
                    {cert.required && <Badge status="info" label="Required" />}
                  </div>
                  <span style={{ fontSize: '12px', color: C.neutral[600] }}>
                    {cert.compliant}/{cert.ops} operators
                  </span>
                </div>
              ))}
            </div>
          </Card>
        </>
      )}
      
      
      {/* Routes Tab */}
      {activeTab === 'routes' && (
        <>
          {/* Route Stats Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Distance Today', value: `${equipment.routeStats?.totalDistanceToday || 0}`, unit: 'mi', sub: `${equipment.routeStats?.tripsToday || 0} trips` },
              { label: 'Avg Trip', value: `${equipment.routeStats?.avgTripDistance || 0}`, unit: 'mi', sub: `${equipment.routeStats?.avgTripTime || 0} min avg` },
              { label: 'Dead Travel', value: `${equipment.routeStats?.deadTravelPct || 0}`, unit: '%', sub: 'Empty returns', warn: (equipment.routeStats?.deadTravelPct || 0) > 15 },
              { label: 'Efficiency', value: `${equipment.routeStats?.efficiencyScore || 85}`, unit: '%', sub: 'vs optimal path', good: true }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '20px', fontWeight: 500, color: s.warn ? C.warning[600] : s.good ? C.success[600] : C.neutral[800] }}>
                  {s.value}<span style={{ fontSize: '12px', color: C.neutral[500] }}>{s.unit}</span>
                </p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Warehouse Floor Plan with Routes */}
          <Card>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
              <div>
                <h3 style={{ fontSize: '14px', fontWeight: 500 }}>Travel Paths - Floor Plan View</h3>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Route frequency shown by line thickness. Click zones for details.</p>
              </div>
              <Badge status="info" label="This Week" />
            </div>
            
            {/* SVG Floor Plan */}
            <div style={{ background: C.neutral[50], borderRadius: 8, padding: sp.sm, position: 'relative' }}>
              <svg viewBox="0 0 600 320" style={{ width: '100%', height: 'auto', display: 'block' }}>
                {/* Background grid */}
                <defs>
                  <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                    <path d="M 20 0 L 0 0 0 20" fill="none" stroke={C.neutral[200]} strokeWidth="0.5"/>
                  </pattern>
                </defs>
                <rect width="600" height="320" fill="url(#grid)"/>
                
                {/* Dock Area - Z01 */}
                <rect x="20" y="20" width="120" height="60" rx="4" fill={C.brand[100]} stroke={C.brand[400]} strokeWidth="2"/>
                <text x="80" y="42" textAnchor="middle" fontSize="11" fontWeight="600" fill={C.brand[700]}>Z01 - Inbound</text>
                <text x="80" y="56" textAnchor="middle" fontSize="9" fill={C.brand[600]}>Docks 1-8</text>
                {/* Dock doors */}
                <rect x="30" y="70" width="15" height="8" fill={C.brand[300]}/>
                <rect x="50" y="70" width="15" height="8" fill={C.brand[300]}/>
                <rect x="70" y="70" width="15" height="8" fill={C.brand[300]}/>
                <rect x="90" y="70" width="15" height="8" fill={C.brand[300]}/>
                <rect x="110" y="70" width="15" height="8" fill={C.brand[300]}/>
                
                {/* Staging - Z02 */}
                <rect x="160" y="20" width="100" height="60" rx="4" fill={C.warning[50]} stroke={C.warning[300]} strokeWidth="1"/>
                <text x="210" y="42" textAnchor="middle" fontSize="11" fontWeight="600" fill={C.warning[700]}>Z02 - Staging</text>
                <text x="210" y="56" textAnchor="middle" fontSize="9" fill={C.warning[600]}>Outbound Prep</text>
                
                {/* Forward Pick - Z03 */}
                <rect x="280" y="20" width="140" height="60" rx="4" fill={C.purple[50]} stroke={C.purple[300]} strokeWidth="1"/>
                <text x="350" y="42" textAnchor="middle" fontSize="11" fontWeight="600" fill={C.purple[700]}>Z03 - Forward Pick</text>
                <text x="350" y="56" textAnchor="middle" fontSize="9" fill={C.purple[600]}>High-velocity SKUs</text>
                
                {/* Outbound - Z05 */}
                <rect x="440" y="20" width="140" height="60" rx="4" fill={C.success[50]} stroke={C.success[100]} strokeWidth="1"/>
                <text x="510" y="42" textAnchor="middle" fontSize="11" fontWeight="600" fill={C.success[700]}>Z05 - Outbound</text>
                <text x="510" y="56" textAnchor="middle" fontSize="9" fill={C.success[600]}>Ship Docks</text>
                
                {/* Bulk Storage - Z04 (large area) */}
                <rect x="20" y="100" width="280" height="200" rx="4" fill={C.success[50]} stroke={C.success[100]} strokeWidth="1"/>
                <text x="160" y="125" textAnchor="middle" fontSize="13" fontWeight="600" fill={C.success[700]}>Z04 - Bulk Storage</text>
                {/* Aisle labels */}
                <text x="50" y="150" fontSize="9" fill={C.success[600]}>Aisle A</text>
                <text x="50" y="180" fontSize="9" fill={C.success[600]}>Aisle B</text>
                <text x="50" y="210" fontSize="9" fill={C.success[600]}>Aisle C</text>
                <text x="50" y="240" fontSize="9" fill={C.success[600]}>Aisle D</text>
                <text x="50" y="270" fontSize="9" fill={C.success[600]}>Aisle E</text>
                {/* Rack representations */}
                <rect x="80" y="145" width="200" height="8" fill={C.success[100]} rx="2"/>
                <rect x="80" y="175" width="200" height="8" fill={C.success[100]} rx="2"/>
                <rect x="80" y="205" width="200" height="8" fill={C.success[100]} rx="2"/>
                <rect x="80" y="235" width="200" height="8" fill={C.success[100]} rx="2"/>
                <rect x="80" y="265" width="200" height="8" fill={C.success[100]} rx="2"/>
                
                {/* Reserve - Z06 */}
                <rect x="320" y="100" width="260" height="200" rx="4" fill={C.neutral[100]} stroke={C.neutral[200]} strokeWidth="1"/>
                <text x="450" y="125" textAnchor="middle" fontSize="13" fontWeight="600" fill={C.neutral[600]}>Z06 - Reserve Storage</text>
                <text x="450" y="145" textAnchor="middle" fontSize="9" fill={C.neutral[500]}>Overflow / Seasonal</text>
                
                {/* === ROUTE PATHS === */}
                {/* Primary Route: Dock -> Bulk A (heaviest traffic) */}
                <path 
                  d="M 80 78 L 80 95 L 160 145" 
                  fill="none" 
                  stroke={C.brand[500]} 
                  strokeWidth="6" 
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  opacity="0.7"
                />
                {/* Return path (dashed, thinner) */}
                <path 
                  d="M 160 145 L 80 95 L 80 78" 
                  fill="none" 
                  stroke={C.brand[300]} 
                  strokeWidth="2" 
                  strokeLinecap="round"
                  strokeDasharray="6 4"
                  opacity="0.5"
                />
                
                {/* Secondary Route: Bulk -> Forward Pick (replenishment) */}
                <path 
                  d="M 200 175 L 260 95 L 350 80" 
                  fill="none" 
                  stroke={C.purple[500]} 
                  strokeWidth="4" 
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  opacity="0.6"
                />
                
                {/* Tertiary Route: Staging -> Outbound */}
                <path 
                  d="M 210 80 L 280 60 L 440 50" 
                  fill="none" 
                  stroke={C.success[500]} 
                  strokeWidth="3" 
                  strokeLinecap="round"
                  opacity="0.5"
                />
                
                {/* Route: Dock -> Bulk B */}
                <path 
                  d="M 100 78 L 100 98 L 160 180" 
                  fill="none" 
                  stroke={C.brand[400]} 
                  strokeWidth="3" 
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  opacity="0.5"
                />
                
                {/* === STOP POINTS (with work activities) === */}
                {/* Stop 1: Dock Area - High Activity */}
                <circle cx="80" cy="60" r="12" fill={C.error[100]} stroke={C.error[500]} strokeWidth="2"/>
                <circle cx="80" cy="60" r="5" fill={C.error[500]}/>
                
                {/* Stop 2: Bulk A - High Activity */}
                <circle cx="160" cy="160" r="12" fill={C.error[100]} stroke={C.error[500]} strokeWidth="2"/>
                <circle cx="160" cy="160" r="5" fill={C.error[500]}/>
                
                {/* Stop 3: Bulk B - Medium Activity */}
                <circle cx="160" cy="190" r="10" fill={C.warning[100]} stroke={C.warning[500]} strokeWidth="2"/>
                <circle cx="160" cy="190" r="4" fill={C.warning[500]}/>
                
                {/* Stop 4: Forward Pick - Medium Activity */}
                <circle cx="350" cy="55" r="10" fill={C.warning[100]} stroke={C.warning[500]} strokeWidth="2"/>
                <circle cx="350" cy="55" r="4" fill={C.warning[500]}/>
                
                {/* Stop 5: Staging - Low Activity */}
                <circle cx="210" cy="55" r="8" fill={C.success[100]} stroke={C.success[500]} strokeWidth="2"/>
                <circle cx="210" cy="55" r="3" fill={C.success[500]}/>
                
                {/* Current Position Indicator */}
                <g>
                  <circle cx="80" cy="60" r="18" fill={C.brand[500]} opacity="0.2">
                    <animate attributeName="r" values="16;22;16" dur="2s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.3;0.1;0.3" dur="2s" repeatCount="indefinite"/>
                  </circle>
                </g>
                
                {/* Equipment icon at current position */}
                <rect x="72" y="52" width="16" height="16" rx="2" fill={C.brand[600]}/>
                <text x="80" y="64" textAnchor="middle" fontSize="10" fill="white" fontWeight="bold">FL</text>
              </svg>
              
              {/* Legend */}
              <div style={{ display: 'flex', gap: sp.lg, marginTop: sp.md, justifyContent: 'center', flexWrap: 'wrap' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                  <div style={{ width: 24, height: 4, background: C.brand[500], borderRadius: 2 }}/>
                  <span style={{ fontSize: '10px', color: C.neutral[600] }}>Primary route (45+ trips)</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                  <div style={{ width: 24, height: 3, background: C.purple[500], borderRadius: 2 }}/>
                  <span style={{ fontSize: '10px', color: C.neutral[600] }}>Replenishment (28 trips)</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                  <div style={{ width: 24, height: 2, background: C.brand[300], borderRadius: 2, borderStyle: 'dashed' }}/>
                  <span style={{ fontSize: '10px', color: C.neutral[600] }}>Return (empty)</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                  <div style={{ width: 10, height: 10, borderRadius: '50%', background: C.error[500] }}/>
                  <span style={{ fontSize: '10px', color: C.neutral[600] }}>High activity stop</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                  <div style={{ width: 8, height: 8, borderRadius: '50%', background: C.warning[500] }}/>
                  <span style={{ fontSize: '10px', color: C.neutral[600] }}>Medium</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                  <div style={{ width: 6, height: 6, borderRadius: '50%', background: C.success[500] }}/>
                  <span style={{ fontSize: '10px', color: C.neutral[600] }}>Low</span>
                </div>
              </div>
            </div>
          </Card>
          
          {/* Stop Points with Work Activities */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Stop Points & Work Performed</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {(equipment.stopPoints || []).filter(s => s.visits > 0).map((stop) => (
                <div 
                  key={stop.id}
                  onClick={() => onNavigateToZone && onNavigateToZone(stop.zoneId, stop.zone)}
                  style={{ 
                    display: 'flex', 
                    alignItems: 'flex-start',
                    padding: sp.md,
                    background: 'white',
                    border: `1px solid ${C.neutral[200]}`,
                    borderLeft: `4px solid ${stop.heatLevel === 'high' ? C.error[500] : stop.heatLevel === 'medium' ? C.warning[500] : C.success[500]}`,
                    borderRadius: '0 8px 8px 0',
                    cursor: 'pointer',
                    transition: 'all 0.15s ease'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = C.neutral[50];
                    e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = 'white';
                    e.currentTarget.style.boxShadow = 'none';
                  }}
                >
                  <div style={{ 
                    width: 40, height: 40, 
                    borderRadius: 8, 
                    background: stop.heatLevel === 'high' ? C.error[50] : stop.heatLevel === 'medium' ? C.warning[50] : C.success[50],
                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                    marginRight: sp.md,
                    flexShrink: 0
                  }}>
                    <MapPin style={{ 
                      width: 20, height: 20, 
                      color: stop.heatLevel === 'high' ? C.error[600] : stop.heatLevel === 'medium' ? C.warning[600] : C.success[600] 
                    }} />
                  </div>
                  
                  <div style={{ flex: 1 }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.xs }}>
                      <p style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>{stop.location}</p>
                      <Badge status={stop.heatLevel === 'high' ? 'error' : stop.heatLevel === 'medium' ? 'warning' : 'success'} label={stop.heatLevel} />
                    </div>
                    <p style={{ fontSize: '11px', color: C.neutral[500], marginBottom: sp.sm }}>{stop.zone}</p>
                    
                    {/* Work Activities */}
                    <div style={{ marginBottom: sp.sm }}>
                      <p style={{ fontSize: '10px', color: C.neutral[400], marginBottom: sp.xs }}>WORK PERFORMED</p>
                      <div style={{ display: 'flex', gap: sp.xs, flexWrap: 'wrap' }}>
                        {stop.activities.map((act, j) => (
                          <span key={j} style={{ 
                            fontSize: '11px', 
                            padding: '3px 8px', 
                            background: C.brand[50], 
                            borderRadius: 4,
                            color: C.brand[700],
                            fontWeight: 500
                          }}>
                            {act}
                          </span>
                        ))}
                      </div>
                    </div>
                    
                    {/* Metrics row */}
                    <div style={{ display: 'flex', gap: sp.lg }}>
                      <div>
                        <p style={{ fontSize: '16px', fontWeight: 600, color: C.neutral[800] }}>{stop.visits}</p>
                        <p style={{ fontSize: '9px', color: C.neutral[500] }}>visits/week</p>
                      </div>
                      <div>
                        <p style={{ fontSize: '16px', fontWeight: 600, color: C.neutral[800] }}>{stop.avgDwell}m</p>
                        <p style={{ fontSize: '9px', color: C.neutral[500] }}>avg dwell</p>
                      </div>
                      <div>
                        <p style={{ fontSize: '16px', fontWeight: 600, color: C.neutral[800] }}>{Math.round(stop.visits * stop.avgDwell)}m</p>
                        <p style={{ fontSize: '9px', color: C.neutral[500] }}>total time</p>
                      </div>
                    </div>
                  </div>
                  
                  <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400], marginLeft: sp.sm, flexShrink: 0 }} />
                </div>
              ))}
            </div>
          </Card>
          
          {/* Frequent Routes Table */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Route Breakdown</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
              {(equipment.commonRoutes || []).map((route, i) => (
                <div 
                  key={route.id}
                  style={{ 
                    display: 'flex', 
                    alignItems: 'center',
                    padding: sp.sm,
                    background: C.neutral[50],
                    borderRadius: 6
                  }}
                >
                  <div style={{ 
                    width: 28, height: 28, 
                    borderRadius: 6, 
                    background: i === 0 ? C.brand[500] : i < 3 ? C.brand[200] : C.neutral[200],
                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                    marginRight: sp.sm,
                    fontSize: '12px',
                    fontWeight: 600,
                    color: i === 0 ? 'white' : C.neutral[700]
                  }}>
                    {i + 1}
                  </div>
                  
                  <div style={{ flex: 1 }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, marginBottom: 2 }}>
                      <span style={{ fontSize: '13px', fontWeight: 500 }}>{route.from}</span>
                      <ArrowRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
                      <span style={{ fontSize: '13px', fontWeight: 500 }}>{route.to}</span>
                      <Badge status={route.activity.includes('Return') ? 'neutral' : 'info'} label={route.activity} />
                    </div>
                    <div style={{ display: 'flex', gap: sp.md, fontSize: '11px', color: C.neutral[500] }}>
                      <span>{route.distance} mi</span>
                      <span>{route.avgTime} min avg</span>
                      <span style={{ color: i === 0 ? C.brand[600] : C.neutral[500] }}>{route.frequency} trips/wk</span>
                    </div>
                  </div>
                  
                  {/* Visual frequency bar */}
                  <div style={{ width: 60, marginLeft: sp.sm }}>
                    <div style={{ height: 6, background: C.neutral[200], borderRadius: 3 }}>
                      <div style={{ 
                        height: '100%', 
                        width: `${Math.min((route.frequency / 50) * 100, 100)}%`, 
                        background: i === 0 ? C.brand[500] : C.brand[300], 
                        borderRadius: 3 
                      }} />
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Route Optimization Insights */}
          {(equipment.routeAlerts || []).length > 0 && (
            <Card>
              <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Optimization Opportunities</h3>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                {equipment.routeAlerts.map((alert, i) => (
                  <Alert key={i} {...alert} />
                ))}
              </div>
            </Card>
          )}
        </>
      )}
      
      {/* Location Tab */}
      {activeTab === 'location' && (
        <>
          {/* Location Stats Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Current Zone', value: equipment.zone?.split(' ')[0] || 'Z04', sub: 'Bulk Storage' },
              { label: 'Time in Zone', value: '47', unit: 'm', sub: 'Current session' },
              { label: 'Zones Visited', value: 6, sub: 'Today', good: true },
              { label: 'Charging Visits', value: 2, sub: 'Last charged 3hr ago' }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '20px', fontWeight: 500, color: s.good ? C.success[600] : C.neutral[800] }}>
                  {s.value}{s.unit && <span style={{ fontSize: '12px', color: C.neutral[500] }}>{s.unit}</span>}
                </p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Current Location Card - Compact */}
          <Card 
            style={{ cursor: 'pointer', transition: 'all 0.15s ease' }}
            onMouseEnter={(e) => e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)'}
            onMouseLeave={(e) => e.currentTarget.style.boxShadow = '0 1px 3px rgba(0,0,0,0.05)'}
          >
            <div 
              onClick={() => onNavigateToZone && onNavigateToZone(equipment.zoneId, equipment.zone)}
              style={{ 
                display: 'flex',
                alignItems: 'center',
                gap: sp.md
              }}
            >
              <div style={{ 
                width: 40, height: 40, borderRadius: 8, 
                background: C.brand[100], 
                display: 'flex', alignItems: 'center', justifyContent: 'center',
                flexShrink: 0
              }}>
                <MapPin style={{ width: 20, height: 20, color: C.brand[600] }} />
              </div>
              <div style={{ flex: 1, minWidth: 0 }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <p style={{ fontSize: '15px', fontWeight: 500, color: C.brand[700], margin: 0 }}>{equipment.zone}</p>
                  <Badge status="success" label="Active" />
                </div>
                <p style={{ fontSize: '12px', color: C.neutral[500], margin: 0 }}>Aisle C, Bay 12 • Since 10:23 AM (47 min)</p>
              </div>
              <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400], flexShrink: 0 }} />
            </div>
          </Card>
          
          {/* Zone Dwell Time Breakdown */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Zone Time Distribution (Today)</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { zone: 'Z04 - Bulk Storage', time: 185, pct: 45, color: C.success[500] },
                { zone: 'Z01 - Inbound Docks', time: 98, pct: 24, color: C.brand[500] },
                { zone: 'Z03 - Forward Pick', time: 62, pct: 15, color: C.purple[500] },
                { zone: 'Z02 - Staging', time: 41, pct: 10, color: C.warning[500] },
                { zone: 'Charging Station', time: 24, pct: 6, color: C.neutral[400] }
              ].map((z, i) => (
                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <div style={{ width: 12, height: 12, borderRadius: 3, background: z.color, flexShrink: 0 }} />
                  <span style={{ fontSize: '12px', flex: 1 }}>{z.zone}</span>
                  <span style={{ fontSize: '12px', color: C.neutral[600], minWidth: 50 }}>{z.time} min</span>
                  <div style={{ width: 100, height: 6, background: C.neutral[100], borderRadius: 3 }}>
                    <div style={{ width: `${z.pct}%`, height: '100%', background: z.color, borderRadius: 3 }} />
                  </div>
                  <span style={{ fontSize: '11px', color: C.neutral[500], minWidth: 30, textAlign: 'right' }}>{z.pct}%</span>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Location Timeline */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Location Timeline</h3>
            <div style={{ position: 'relative', paddingLeft: sp.lg }}>
              {/* Timeline line */}
              <div style={{ position: 'absolute', left: 6, top: 8, bottom: 8, width: 2, background: C.neutral[200] }} />
              
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.md }}>
                {(equipment.locationHistory || []).map((loc, i) => (
                  <div 
                    key={i} 
                    onClick={() => onNavigateToZone && onNavigateToZone(loc.zoneId, loc.zone)}
                    style={{ 
                      display: 'flex', 
                      alignItems: 'flex-start', 
                      gap: sp.sm,
                      cursor: 'pointer',
                      position: 'relative',
                      transition: 'transform 0.15s ease'
                    }}
                    onMouseEnter={(e) => e.currentTarget.style.transform = 'translateX(4px)'}
                    onMouseLeave={(e) => e.currentTarget.style.transform = 'translateX(0)'}
                  >
                    {/* Timeline dot */}
                    <div style={{ 
                      position: 'absolute', left: -20,
                      width: 12, height: 12, borderRadius: '50%', 
                      background: i === 0 ? C.brand[500] : C.neutral[300],
                      border: '2px solid white',
                      zIndex: 1
                    }} />
                    
                    <div style={{ 
                      flex: 1,
                      padding: sp.sm,
                      background: i === 0 ? C.brand[50] : C.neutral[50],
                      borderRadius: 6,
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center'
                    }}>
                      <div>
                        <span style={{ fontSize: '13px', fontWeight: i === 0 ? 500 : 400 }}>{loc.zone}</span>
                        {i === 0 && <p style={{ fontSize: '11px', color: C.brand[600], marginTop: 2, margin: 0 }}>Current location</p>}
                      </div>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                        <span style={{ fontSize: '11px', color: C.neutral[500] }}>{loc.time}</span>
                        <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </Card>
          
        </>
      )}
      
      {/* Schedule Tab */}
      {activeTab === 'schedule' && (
        <>
          {/* Schedule Stats Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'DVIR Status', value: 'Pass', sub: 'Inspected 6:00 AM', good: true },
              { label: 'Shift Assigned', value: 'Day', sub: '6AM - 2PM' },
              { label: 'Next PM', value: equipment.nextPMDue === 'Overdue' ? 'Overdue' : '3d', sub: `${equipment.hoursSincePM}/${equipment.pmInterval} hrs`, warn: equipment.hoursSincePM > equipment.pmInterval },
              { label: 'Events Today', value: 3, sub: 'Scheduled changes' }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '18px', fontWeight: 500, color: s.warn ? C.error[600] : s.good ? C.success[600] : C.neutral[800] }}>
                  {s.value}
                </p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Scheduled Events Today */}
          <Card>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
              <h3 style={{ fontSize: '14px', fontWeight: 500 }}>Scheduled Events Today</h3>
              <Badge status="info" label="3 upcoming" />
            </div>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { 
                  time: '14:00', 
                  type: 'zone', 
                  title: 'Move to Z03 - Forward Pick',
                  desc: 'Reassigned to support outbound surge. Expected 2hr assignment.',
                  icon: MapPin,
                  color: C.brand[500]
                },
                { 
                  time: '14:00', 
                  type: 'operator', 
                  title: 'Operator Handoff → M. Chen',
                  desc: 'Shift change. J. Martinez ending day shift.',
                  icon: Users,
                  color: C.purple[500]
                },
                { 
                  time: '16:30', 
                  type: 'task', 
                  title: 'Assigned to Outbound Loading',
                  desc: 'Priority trailer 847 departure at 17:00. Dock 5.',
                  icon: Package,
                  color: C.warning[500]
                }
              ].map((event, i) => (
                <div 
                  key={i} 
                  style={{ 
                    display: 'flex', alignItems: 'flex-start', gap: sp.md,
                    padding: sp.md,
                    background: C.neutral[50],
                    borderRadius: 8,
                    borderLeft: `4px solid ${event.color}`,
                    cursor: 'pointer',
                    transition: 'all 0.15s ease'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = 'white';
                    e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = C.neutral[50];
                    e.currentTarget.style.boxShadow = 'none';
                  }}
                >
                  <div style={{ 
                    minWidth: 50, 
                    padding: sp.xs, 
                    background: 'white', 
                    borderRadius: 4, 
                    textAlign: 'center',
                    border: `1px solid ${C.neutral[200]}`
                  }}>
                    <p style={{ fontSize: '14px', fontWeight: 600, color: C.neutral[800] }}>{event.time}</p>
                  </div>
                  <div style={{ 
                    width: 32, height: 32, borderRadius: 6,
                    background: `${event.color}15`,
                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                    flexShrink: 0
                  }}>
                    <event.icon style={{ width: 16, height: 16, color: event.color }} />
                  </div>
                  <div style={{ flex: 1 }}>
                    <p style={{ fontSize: '13px', fontWeight: 500, marginBottom: 2 }}>{event.title}</p>
                    <p style={{ fontSize: '12px', color: C.neutral[500] }}>{event.desc}</p>
                  </div>
                  <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400], alignSelf: 'center' }} />
                </div>
              ))}
            </div>
          </Card>
          
          {/* DVIR - Daily Vehicle Inspection Report */}
          <Card>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
              <h3 style={{ fontSize: '14px', fontWeight: 500 }}>Daily Vehicle Inspection (DVIR)</h3>
              <Badge status="success" label="Passed" />
            </div>
            <div style={{ 
              padding: sp.md, 
              background: C.success[50], 
              borderRadius: 8,
              borderLeft: `3px solid ${C.success[500]}`
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                <div>
                  <p style={{ fontSize: '14px', fontWeight: 500, color: C.success[700] }}>Pre-shift Inspection Complete</p>
                  <p style={{ fontSize: '12px', color: C.neutral[600], marginTop: sp.xs }}>Inspected by J. Martinez at 6:02 AM</p>
                </div>
                <CheckCircle style={{ width: 24, height: 24, color: C.success[500] }} />
              </div>
              
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm, marginTop: sp.md }}>
                {[
                  { item: 'Brakes', status: 'OK' },
                  { item: 'Forks', status: 'OK' },
                  { item: 'Lights', status: 'OK' },
                  { item: 'Horn', status: 'OK' },
                  { item: 'Hydraulics', status: 'OK' },
                  { item: 'Battery', status: 'OK' }
                ].map((check, i) => (
                  <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <div style={{ width: 8, height: 8, borderRadius: '50%', background: C.success[500] }} />
                    <span style={{ fontSize: '11px', color: C.neutral[600] }}>{check.item}</span>
                  </div>
                ))}
              </div>
            </div>
          </Card>
          
          {/* Shift Assignment */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Shift Assignment</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { shift: 'Day Shift', time: '6:00 AM - 2:00 PM', operator: equipment.certifiedOperators?.[0]?.name || 'J. Martinez', current: true },
                { shift: 'Swing Shift', time: '2:00 PM - 10:00 PM', operator: equipment.certifiedOperators?.[1]?.name || 'M. Chen', current: false },
                { shift: 'Night Shift', time: '10:00 PM - 6:00 AM', operator: 'Unassigned', current: false, unassigned: true }
              ].map((s, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.sm,
                  background: s.current ? C.brand[50] : C.neutral[50],
                  borderRadius: 6,
                  borderLeft: s.current ? `3px solid ${C.brand[500]}` : 'none'
                }}>
                  <div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                      <p style={{ fontSize: '13px', fontWeight: s.current ? 500 : 400 }}>{s.shift}</p>
                      {s.current && <Badge status="info" label="Current" />}
                    </div>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>{s.time}</p>
                  </div>
                  <div style={{ textAlign: 'right' }}>
                    <p style={{ 
                      fontSize: '12px', 
                      color: s.unassigned ? C.warning[600] : C.neutral[700],
                      fontWeight: 500
                    }}>
                      {s.operator}
                    </p>
                  </div>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Maintenance Schedule */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Maintenance Schedule</h3>
            <div style={{ 
              padding: sp.md, 
              background: equipment.nextPMDue === 'Overdue' ? C.error[50] : C.warning[50], 
              borderRadius: 8,
              borderLeft: `3px solid ${equipment.nextPMDue === 'Overdue' ? C.error[500] : C.warning[500]}`
            }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <div>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>Next Preventive Maintenance</p>
                  <p style={{ fontSize: '12px', color: C.neutral[600] }}>Every {equipment.pmInterval} operating hours</p>
                </div>
                <Badge status={equipment.nextPMDue === 'Overdue' ? 'error' : 'warning'} label={equipment.nextPMDue} />
              </div>
              <div style={{ marginTop: sp.sm }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '12px', color: C.neutral[600] }}>
                  <span>Current hours: <strong>{equipment.hoursSincePM}</strong></span>
                  <span>Target: {equipment.pmInterval}</span>
                </div>
                <div style={{ 
                  height: 8, background: C.neutral[200], borderRadius: 4, marginTop: sp.xs, overflow: 'hidden'
                }}>
                  <div style={{ 
                    width: `${Math.min((equipment.hoursSincePM / equipment.pmInterval) * 100, 100)}%`,
                    height: '100%',
                    background: equipment.hoursSincePM > equipment.pmInterval ? C.error[500] : equipment.hoursSincePM > equipment.pmInterval * 0.9 ? C.warning[500] : C.success[500],
                    borderRadius: 4
                  }} />
                </div>
              </div>
            </div>
            
            {/* Upcoming scheduled maintenance */}
            <div style={{ marginTop: sp.md }}>
              <p style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600], marginBottom: sp.sm }}>UPCOMING</p>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                {[
                  { task: '250hr PM Service', due: 'Dec 20', tech: 'Mike Wilson', status: 'scheduled' },
                  { task: 'Battery Replacement', due: 'Jan 15', tech: 'TBD', status: 'planned' },
                  { task: 'Annual Safety Inspection', due: 'Feb 1', tech: 'External', status: 'planned' }
                ].map((task, i) => (
                  <div key={i} style={{ 
                    display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                    padding: sp.sm, background: C.neutral[50], borderRadius: 6
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                      <Calendar style={{ width: 14, height: 14, color: C.neutral[400] }} />
                      <div>
                        <p style={{ fontSize: '13px' }}>{task.task}</p>
                        <p style={{ fontSize: '11px', color: C.neutral[500] }}>{task.tech}</p>
                      </div>
                    </div>
                    <div style={{ textAlign: 'right' }}>
                      <p style={{ fontSize: '12px', fontWeight: 500 }}>{task.due}</p>
                      <Badge status={task.status === 'scheduled' ? 'info' : 'neutral'} label={task.status} />
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </Card>
          
          {/* Maintenance History */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Maintenance History</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
              {(equipment.maintenanceHistory || []).map((m, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.sm,
                  background: m.status === 'in-progress' ? C.warning[50] : C.neutral[50],
                  borderRadius: 6,
                  borderLeft: `3px solid ${m.status === 'in-progress' ? C.warning[500] : m.type === 'PM' ? C.brand[500] : C.neutral[300]}`
                }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <Wrench style={{ width: 16, height: 16, color: C.neutral[400] }} />
                    <div>
                      <p style={{ fontSize: '13px', fontWeight: 500 }}>{m.desc}</p>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>{m.date} • {m.tech}</p>
                    </div>
                  </div>
                  <div style={{ textAlign: 'right' }}>
                    <Badge status={m.type === 'PM' ? 'info' : m.status === 'in-progress' ? 'warning' : 'neutral'} label={m.type} />
                    <p style={{ fontSize: '12px', color: C.neutral[600], marginTop: 2 }}>${m.cost}</p>
                  </div>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Parts on Order */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Parts Inventory</h3>
            <div style={{ padding: sp.sm, background: C.success[50], borderRadius: 6, marginBottom: sp.sm }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <CheckCircle style={{ width: 16, height: 16, color: C.success[600] }} />
                <span style={{ fontSize: '13px', color: C.success[700] }}>All required parts in stock</span>
              </div>
            </div>
            <p style={{ fontSize: '11px', color: C.neutral[500] }}>
              Common replacement parts for this unit are available in the maintenance shop.
            </p>
          </Card>
        </>
      )}
      
      {/* Fleet Tab */}
      {activeTab === 'fleet' && (
        <>
          {/* Fleet Comparison Stats */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Fleet Rank', value: '#3', sub: `of ${equipment.fleet?.total || 8} units`, good: true },
              { label: 'vs Fleet Avg', value: '+8%', sub: 'Utilization', good: true },
              { label: 'Age', value: '3.2', unit: 'yrs', sub: 'Fleet avg: 4.1 yrs' },
              { label: 'Replacement', value: 'Low', sub: 'Priority score', good: true }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '18px', fontWeight: 500, color: s.good ? C.success[600] : s.warn ? C.warning[600] : C.neutral[800] }}>
                  {s.value}{s.unit && <span style={{ fontSize: '12px', color: C.neutral[500] }}>{s.unit}</span>}
                </p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* This Unit vs Fleet */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Performance vs Fleet</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.md }}>
              {[
                { metric: 'Utilization', thisUnit: equipment.utilization || 78, fleetAvg: 72, unit: '%' },
                { metric: 'Maintenance Cost/hr', thisUnit: 4.20, fleetAvg: 5.10, unit: '$', lower: true },
                { metric: 'MTBF', thisUnit: 142, fleetAvg: 128, unit: 'hrs' },
                { metric: 'Availability', thisUnit: 94, fleetAvg: 91, unit: '%' },
                { metric: 'Driver Score Avg', thisUnit: 87, fleetAvg: 84, unit: '%' }
              ].map((m, i) => {
                const isBetter = m.lower ? m.thisUnit < m.fleetAvg : m.thisUnit > m.fleetAvg;
                const diff = m.lower ? m.fleetAvg - m.thisUnit : m.thisUnit - m.fleetAvg;
                const diffPct = ((diff / m.fleetAvg) * 100).toFixed(0);
                return (
                  <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <span style={{ fontSize: '12px', color: C.neutral[600], width: 140 }}>{m.metric}</span>
                    <div style={{ flex: 1, display: 'flex', alignItems: 'center', gap: sp.sm }}>
                      <div style={{ flex: 1, height: 8, background: C.neutral[100], borderRadius: 4, position: 'relative' }}>
                        {/* Fleet avg marker */}
                        <div style={{ 
                          position: 'absolute', 
                          left: `${Math.min((m.fleetAvg / (m.fleetAvg * 1.3)) * 100, 100)}%`,
                          top: -4,
                          bottom: -4,
                          width: 2,
                          background: C.neutral[400]
                        }} />
                        {/* This unit bar */}
                        <div style={{ 
                          width: `${Math.min((m.thisUnit / (m.fleetAvg * 1.3)) * 100, 100)}%`,
                          height: '100%',
                          background: isBetter ? C.success[500] : C.warning[500],
                          borderRadius: 4
                        }} />
                      </div>
                    </div>
                    <div style={{ width: 70, textAlign: 'right' }}>
                      <span style={{ fontSize: '13px', fontWeight: 500 }}>{m.thisUnit}{m.unit}</span>
                    </div>
                    <div style={{ width: 50 }}>
                      <Badge 
                        status={isBetter ? 'success' : 'warning'} 
                        label={`${isBetter ? '+' : ''}${diffPct}%`} 
                      />
                    </div>
                  </div>
                );
              })}
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginTop: sp.md, fontSize: '10px', color: C.neutral[500] }}>
              <div style={{ width: 20, height: 2, background: C.neutral[400] }} />
              <span>Fleet average</span>
            </div>
          </Card>
          
          {/* Total Cost of Ownership */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Total Cost of Ownership</h3>
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: sp.md }}>
              <div>
                <p style={{ fontSize: '11px', color: C.neutral[500], marginBottom: sp.xs }}>THIS UNIT (YTD)</p>
                <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', padding: sp.xs, background: C.neutral[50], borderRadius: 4 }}>
                    <span style={{ fontSize: '12px' }}>Acquisition (amortized)</span>
                    <span style={{ fontSize: '12px', fontWeight: 500 }}>$4,200</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', padding: sp.xs, background: C.neutral[50], borderRadius: 4 }}>
                    <span style={{ fontSize: '12px' }}>Maintenance</span>
                    <span style={{ fontSize: '12px', fontWeight: 500 }}>${equipment.maintenanceCostYTD?.toLocaleString() || '2,450'}</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', padding: sp.xs, background: C.neutral[50], borderRadius: 4 }}>
                    <span style={{ fontSize: '12px' }}>Energy</span>
                    <span style={{ fontSize: '12px', fontWeight: 500 }}>$890</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', padding: sp.sm, background: C.brand[50], borderRadius: 4 }}>
                    <span style={{ fontSize: '13px', fontWeight: 500 }}>Total TCO</span>
                    <span style={{ fontSize: '13px', fontWeight: 600, color: C.brand[600] }}>$7,540</span>
                  </div>
                </div>
              </div>
              <div>
                <p style={{ fontSize: '11px', color: C.neutral[500], marginBottom: sp.xs }}>FLEET AVERAGE (YTD)</p>
                <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', padding: sp.xs, background: C.neutral[50], borderRadius: 4 }}>
                    <span style={{ fontSize: '12px' }}>Acquisition (amortized)</span>
                    <span style={{ fontSize: '12px', fontWeight: 500 }}>$4,800</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', padding: sp.xs, background: C.neutral[50], borderRadius: 4 }}>
                    <span style={{ fontSize: '12px' }}>Maintenance</span>
                    <span style={{ fontSize: '12px', fontWeight: 500 }}>$3,120</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', padding: sp.xs, background: C.neutral[50], borderRadius: 4 }}>
                    <span style={{ fontSize: '12px' }}>Energy</span>
                    <span style={{ fontSize: '12px', fontWeight: 500 }}>$950</span>
                  </div>
                  <div style={{ display: 'flex', justifyContent: 'space-between', padding: sp.sm, background: C.neutral[100], borderRadius: 4 }}>
                    <span style={{ fontSize: '13px', fontWeight: 500 }}>Total TCO</span>
                    <span style={{ fontSize: '13px', fontWeight: 600 }}>$8,870</span>
                  </div>
                </div>
              </div>
            </div>
            <div style={{ 
              marginTop: sp.md, padding: sp.sm, 
              background: C.success[50], borderRadius: 6, 
              display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.sm 
            }}>
              <TrendingDown style={{ width: 16, height: 16, color: C.success[600] }} />
              <span style={{ fontSize: '13px', color: C.success[700], fontWeight: 500 }}>
                15% below fleet average TCO
              </span>
            </div>
          </Card>
          
          {/* Replacement Assessment */}
          <Card>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
              <h3 style={{ fontSize: '14px', fontWeight: 500 }}>Replacement Assessment</h3>
              <Badge status="success" label="Keep" />
            </div>
            <div style={{ padding: sp.md, background: C.success[50], borderRadius: 8 }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                <div style={{ 
                  width: 60, height: 60, borderRadius: '50%', 
                  background: C.success[100], 
                  display: 'flex', alignItems: 'center', justifyContent: 'center',
                  border: `4px solid ${C.success[500]}`
                }}>
                  <span style={{ fontSize: '20px', fontWeight: 600, color: C.success[700] }}>82</span>
                </div>
                <div>
                  <p style={{ fontSize: '14px', fontWeight: 500, color: C.success[700] }}>Low Replacement Priority</p>
                  <p style={{ fontSize: '12px', color: C.neutral[600] }}>
                    Unit is performing well with below-average costs and above-average reliability.
                  </p>
                </div>
              </div>
              
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm, marginTop: sp.md }}>
                {[
                  { factor: 'Age', score: 85, note: '3.2 yrs / 7yr lifecycle' },
                  { factor: 'Condition', score: 78, note: 'Good mechanical health' },
                  { factor: 'Economics', score: 88, note: 'Below-avg TCO' }
                ].map((f, i) => (
                  <div key={i} style={{ padding: sp.sm, background: 'white', borderRadius: 6 }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.xs }}>
                      <span style={{ fontSize: '11px', color: C.neutral[600] }}>{f.factor}</span>
                      <span style={{ fontSize: '12px', fontWeight: 500, color: C.success[600] }}>{f.score}</span>
                    </div>
                    <div style={{ height: 4, background: C.neutral[100], borderRadius: 2 }}>
                      <div style={{ width: `${f.score}%`, height: '100%', background: C.success[500], borderRadius: 2 }} />
                    </div>
                    <p style={{ fontSize: '9px', color: C.neutral[500], marginTop: 2 }}>{f.note}</p>
                  </div>
                ))}
              </div>
            </div>
          </Card>
          
          {/* Fleet Units List */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Fleet Comparison</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
              {[
                { id: 'FL-03', util: 82, status: 'Active', rank: 1 },
                { id: 'FL-01', util: 79, status: 'Active', rank: 2 },
                { id: equipment.id, util: equipment.utilization || 78, status: equipment.status, rank: 3, current: true },
                { id: 'FL-08', util: 75, status: 'Active', rank: 4 },
                { id: 'FL-02', util: 71, status: 'Idle', rank: 5 },
              ].map((unit, i) => (
                <div 
                  key={i} 
                  onClick={() => !unit.current && onNavigateToEquipment && onNavigateToEquipment(unit.id, unit.id)}
                  style={{ 
                    display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                    padding: sp.sm,
                    background: unit.current ? C.brand[50] : C.neutral[50],
                    borderRadius: 6,
                    borderLeft: unit.current ? `3px solid ${C.brand[500]}` : 'none',
                    cursor: unit.current ? 'default' : 'pointer',
                    transition: 'all 0.15s ease'
                  }}
                  onMouseEnter={(e) => {
                    if (!unit.current) {
                      e.currentTarget.style.background = 'white';
                      e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                    }
                  }}
                  onMouseLeave={(e) => {
                    if (!unit.current) {
                      e.currentTarget.style.background = C.neutral[50];
                      e.currentTarget.style.boxShadow = 'none';
                    }
                  }}
                >
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <div style={{ 
                      width: 24, height: 24, borderRadius: '50%',
                      background: unit.rank <= 3 ? C.success[100] : C.neutral[200],
                      display: 'flex', alignItems: 'center', justifyContent: 'center',
                      fontSize: '11px', fontWeight: 600,
                      color: unit.rank <= 3 ? C.success[700] : C.neutral[600]
                    }}>
                      {unit.rank}
                    </div>
                    <div>
                      <span style={{ fontSize: '13px', fontWeight: unit.current ? 500 : 400 }}>{unit.id}</span>
                      {unit.current && <span style={{ fontSize: '11px', color: C.brand[600], marginLeft: sp.xs }}>(This unit)</span>}
                    </div>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                    <span style={{ fontSize: '12px', color: C.neutral[600] }}>{unit.util}% util</span>
                    <Badge status={unit.status === 'Active' ? 'success' : 'neutral'} label={unit.status} />
                    {!unit.current && <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />}
                  </div>
                </div>
              ))}
            </div>
          </Card>
        </>
      )}
      
      {/* Insights Tab */}
      {activeTab === 'insights' && (
        <>
          {/* Insight Summary Stats */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Active Alerts', value: equipment.alerts?.length || 0, sub: 'Requiring attention', warn: (equipment.alerts?.length || 0) > 0 },
              { label: 'Anomalies', value: 2, sub: 'Detected this week', warn: true },
              { label: 'Trend', value: 'Stable', sub: 'Overall health', good: true },
              { label: 'Confidence', value: 87, unit: '%', sub: 'Prediction accuracy' }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '18px', fontWeight: 500, color: s.warn ? C.warning[600] : s.good ? C.success[600] : C.neutral[800] }}>
                  {s.value}{s.unit && <span style={{ fontSize: '12px', color: C.neutral[500] }}>{s.unit}</span>}
                </p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Analysis */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Analysis</h3>
            {(equipment.alerts?.length || 0) > 0 ? (
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                {equipment.alerts.map((alert, i) => (
                  <Alert 
                    key={i} 
                    {...alert} 
                    onClick={() => onNavigateToAlert && onNavigateToAlert(alert.id, 'equipment', true)}
                  />
                ))}
              </div>
            ) : (
              <div style={{ padding: sp.lg, background: C.success[50], borderRadius: 8, textAlign: 'center' }}>
                <CheckCircle style={{ width: 32, height: 32, color: C.success[600], marginBottom: sp.sm }} />
                <p style={{ color: C.success[700] }}>No active alerts for this unit</p>
              </div>
            )}
          </Card>
          
          {/* Anomaly Detection */}
          <Card>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
              <h3 style={{ fontSize: '14px', fontWeight: 500 }}>Anomaly Detection</h3>
              <Badge status="warning" label="2 detected" />
            </div>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { 
                  anomaly: 'Unusual idle pattern', 
                  detected: '2 days ago',
                  desc: 'Unit idle for 45+ min during peak hours (unusual for this operator)',
                  severity: 'low',
                  suggestion: 'May indicate training need or assignment issue'
                },
                { 
                  anomaly: 'Battery drain rate elevated', 
                  detected: 'Yesterday',
                  desc: 'Draining 15% faster than baseline. Possible battery degradation.',
                  severity: 'medium',
                  suggestion: 'Schedule battery health check'
                }
              ].map((a, i) => (
                <div 
                  key={i} 
                  style={{ 
                    padding: sp.md,
                    background: a.severity === 'medium' ? C.warning[50] : C.neutral[50],
                    borderRadius: 8,
                    borderLeft: `4px solid ${a.severity === 'medium' ? C.warning[500] : C.neutral[300]}`,
                    cursor: 'pointer',
                    transition: 'all 0.15s ease'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = 'white';
                    e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = a.severity === 'medium' ? C.warning[50] : C.neutral[50];
                    e.currentTarget.style.boxShadow = 'none';
                  }}
                >
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                    <p style={{ fontSize: '14px', fontWeight: 500 }}>{a.anomaly}</p>
                    <span style={{ fontSize: '11px', color: C.neutral[500] }}>{a.detected}</span>
                  </div>
                  <p style={{ fontSize: '12px', color: C.neutral[600], marginBottom: sp.sm }}>{a.desc}</p>
                  <div style={{ 
                    padding: sp.sm, background: 'white', borderRadius: 6,
                    display: 'flex', alignItems: 'center', gap: sp.sm
                  }}>
                    <Lightbulb style={{ width: 16, height: 16, color: C.warning[500], flexShrink: 0 }} />
                    <span style={{ fontSize: '12px', color: C.neutral[700] }}>{a.suggestion}</span>
                  </div>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Root Cause Analysis */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Root Cause Analysis</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500], marginBottom: sp.md }}>
              Contributing factors to recent maintenance events
            </p>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { cause: 'High utilization hours', pct: 35, color: C.brand[500] },
                { cause: 'Operator behavior patterns', pct: 25, color: C.purple[500] },
                { cause: 'Environmental conditions', pct: 20, color: C.warning[500] },
                { cause: 'Component age', pct: 15, color: C.neutral[400] },
                { cause: 'Other factors', pct: 5, color: C.neutral[300] }
              ].map((c, i) => (
                <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <div style={{ width: 12, height: 12, borderRadius: 3, background: c.color, flexShrink: 0 }} />
                  <span style={{ fontSize: '12px', flex: 1 }}>{c.cause}</span>
                  <div style={{ width: 120, height: 6, background: C.neutral[100], borderRadius: 3 }}>
                    <div style={{ width: `${c.pct}%`, height: '100%', background: c.color, borderRadius: 3 }} />
                  </div>
                  <span style={{ fontSize: '11px', color: C.neutral[600], width: 35, textAlign: 'right' }}>{c.pct}%</span>
                </div>
              ))}
            </div>
          </Card>
          
          {/* What-If Scenarios */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>What-If Scenarios</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500], marginBottom: sp.md }}>
              Projected impact of potential changes
            </p>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { 
                  scenario: 'Reduce daily hours by 1hr', 
                  impact: 'Extends next PM by ~3 days',
                  effect: 'positive',
                  metric: '+12%',
                  metricLabel: 'Remaining life'
                },
                { 
                  scenario: 'Add operator rotation', 
                  impact: 'Distributes wear patterns across shifts',
                  effect: 'positive',
                  metric: '-8%',
                  metricLabel: 'Breakdown risk'
                },
                { 
                  scenario: 'Delay PM by 1 week', 
                  impact: 'Increased breakdown probability',
                  effect: 'negative',
                  metric: '+23%',
                  metricLabel: 'Failure risk'
                }
              ].map((s, i) => (
                <div key={i} style={{ 
                  padding: sp.md,
                  background: C.neutral[50],
                  borderRadius: 8,
                  display: 'flex',
                  alignItems: 'center',
                  gap: sp.md
                }}>
                  <div style={{ flex: 1 }}>
                    <p style={{ fontSize: '13px', fontWeight: 500, marginBottom: 2 }}>{s.scenario}</p>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>{s.impact}</p>
                  </div>
                  <div style={{ 
                    textAlign: 'center', padding: sp.sm, borderRadius: 6,
                    background: s.effect === 'positive' ? C.success[50] : C.error[50]
                  }}>
                    <p style={{ 
                      fontSize: '16px', fontWeight: 600, 
                      color: s.effect === 'positive' ? C.success[600] : C.error[600] 
                    }}>
                      {s.metric}
                    </p>
                    <p style={{ fontSize: '9px', color: C.neutral[500] }}>{s.metricLabel}</p>
                  </div>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Performance Trends */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Trend Analysis</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { metric: 'Utilization', current: 78, prev: 82, trend: 'down' },
                { metric: 'Maintenance frequency', current: 1.2, prev: 1.5, trend: 'down', lower: true, unit: '/mo' },
                { metric: 'Avg trip efficiency', current: 85, prev: 81, trend: 'up', unit: '%' },
                { metric: 'Operator satisfaction', current: 4.2, prev: 4.0, trend: 'up', unit: '/5' }
              ].map((t, i) => {
                const isBetter = t.lower ? t.trend === 'down' : t.trend === 'up';
                return (
                  <div key={i} style={{ 
                    padding: sp.sm, background: C.neutral[50], borderRadius: 6,
                    display: 'flex', alignItems: 'center', justifyContent: 'space-between'
                  }}>
                    <span style={{ fontSize: '13px' }}>{t.metric}</span>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                      <span style={{ fontSize: '13px', fontWeight: 500 }}>
                        {t.current}{t.unit || '%'}
                      </span>
                      <div style={{ 
                        display: 'flex', alignItems: 'center', gap: 2,
                        color: isBetter ? C.success[600] : C.warning[600]
                      }}>
                        {t.trend === 'up' ? (
                          <TrendingUp style={{ width: 14, height: 14 }} />
                        ) : (
                          <TrendingDown style={{ width: 14, height: 14 }} />
                        )}
                        <span style={{ fontSize: '11px' }}>
                          {t.trend === 'up' ? '+' : ''}{((t.current - t.prev) / t.prev * 100).toFixed(0)}%
                        </span>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </Card>
        </>
      )}
      
      {/* Config Tab */}
      {activeTab === 'config' && (
        <>
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Unit Information</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.md }}>
              {[
                { label: 'Asset ID', value: equipment.id },
                { label: 'Type', value: equipment.type },
                { label: 'Manufacturer', value: equipment.manufacturer },
                { label: 'Model', value: equipment.model },
                { label: 'Serial Number', value: equipment.serialNumber },
                { label: 'Purchase Date', value: equipment.purchaseDate },
                { label: 'PM Interval', value: `${equipment.pmInterval} hours` },
                { label: 'Last PM', value: equipment.lastPMDate }
              ].map((item, i) => (
                <div key={i} style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                  <p style={{ fontSize: '10px', color: C.neutral[500], textTransform: 'uppercase' }}>{item.label}</p>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>{item.value}</p>
                </div>
              ))}
            </div>
          </Card>
        </>
      )}
      
      {/* Work Tab */}
      {activeTab === 'work' && (
        <>
          {/* Work Stats Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Pallets Today', value: 248, sub: 'vs 220 target', good: true },
              { label: 'Pallets/Hour', value: 42, sub: 'Fleet avg: 38', good: true },
              { label: 'Idle Time', value: 12, unit: '%', sub: 'Last 8 hours', warn: true },
              { label: 'Lift Cycles', value: 312, sub: 'Today' }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '20px', fontWeight: 500, color: s.warn ? C.warning[600] : s.good ? C.success[600] : C.neutral[800] }}>
                  {s.value}{s.unit && <span style={{ fontSize: '12px', color: C.neutral[500] }}>{s.unit}</span>}
                </p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Throughput Chart */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Hourly Throughput</h3>
            <div style={{ display: 'flex', gap: sp.xs, alignItems: 'flex-end', height: 100 }}>
              {[
                { hour: '6AM', pallets: 28 },
                { hour: '7AM', pallets: 45 },
                { hour: '8AM', pallets: 52 },
                { hour: '9AM', pallets: 48 },
                { hour: '10AM', pallets: 42 },
                { hour: '11AM', pallets: 33 },
                { hour: 'Now', pallets: 0, current: true }
              ].map((h, i) => (
                <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                  <div style={{ 
                    width: '80%', 
                    height: Math.max((h.pallets / 55) * 70, 2),
                    background: h.current ? C.neutral[200] : h.pallets >= 45 ? C.success[500] : h.pallets >= 35 ? C.brand[500] : C.warning[500],
                    borderRadius: '4px 4px 0 0'
                  }} />
                  <span style={{ fontSize: '10px', color: C.neutral[500], marginTop: sp.xs }}>{h.hour}</span>
                  {!h.current && <span style={{ fontSize: '11px', fontWeight: 500 }}>{h.pallets}</span>}
                </div>
              ))}
            </div>
          </Card>
          
          {/* Work Breakdown */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Work Breakdown (Today)</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { task: 'Putaway', count: 98, time: 124, pct: 40, color: C.brand[500] },
                { task: 'Replenishment', count: 62, time: 78, pct: 25, color: C.purple[500] },
                { task: 'Picking', count: 48, time: 54, pct: 19, color: C.success[500] },
                { task: 'Loading', count: 28, time: 32, pct: 11, color: C.warning[500] },
                { task: 'Other', count: 12, time: 14, pct: 5, color: C.neutral[400] }
              ].map((w, i) => (
                <div key={i}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                      <div style={{ width: 10, height: 10, borderRadius: 2, background: w.color }} />
                      <span style={{ fontSize: '13px' }}>{w.task}</span>
                    </div>
                    <div style={{ display: 'flex', gap: sp.md, fontSize: '12px', color: C.neutral[600] }}>
                      <span>{w.count} pallets</span>
                      <span>{w.time} min</span>
                      <span style={{ fontWeight: 500 }}>{w.pct}%</span>
                    </div>
                  </div>
                  <div style={{ height: 6, background: C.neutral[100], borderRadius: 3 }}>
                    <div style={{ width: `${w.pct}%`, height: '100%', background: w.color, borderRadius: 3 }} />
                  </div>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Cycle Times */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Cycle Times</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.sm }}>
              {[
                { label: 'Avg Load Time', value: 1.8, unit: 'min', benchmark: 2.0, good: true },
                { label: 'Avg Unload Time', value: 1.5, unit: 'min', benchmark: 1.8, good: true },
                { label: 'Avg Travel (loaded)', value: 2.4, unit: 'min', benchmark: 2.5, good: true },
                { label: 'Avg Travel (empty)', value: 1.9, unit: 'min', benchmark: 2.0, good: true }
              ].map((c, i) => (
                <div key={i} style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                    <span style={{ fontSize: '12px', color: C.neutral[600] }}>{c.label}</span>
                    <span style={{ fontSize: '14px', fontWeight: 500, color: c.good ? C.success[600] : C.warning[600] }}>
                      {c.value} {c.unit}
                    </span>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, marginTop: sp.xs }}>
                    <div style={{ flex: 1, height: 4, background: C.neutral[200], borderRadius: 2 }}>
                      <div style={{ 
                        width: `${Math.min((c.value / c.benchmark) * 100, 100)}%`,
                        height: '100%',
                        background: c.good ? C.success[500] : C.warning[500],
                        borderRadius: 2
                      }} />
                    </div>
                    <span style={{ fontSize: '10px', color: C.neutral[400] }}>/{c.benchmark}</span>
                  </div>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Activity Timeline */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Recent Activity</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
              {[
                { time: '11:08', action: 'Putaway completed', location: 'Bulk A, Row 12', pallets: 2, zoneId: 'z04' },
                { time: '11:02', action: 'Travel to dock', location: 'Dock 3', pallets: 0, travel: true, zoneId: 'z01' },
                { time: '10:54', action: 'Load pickup', location: 'Dock 3', pallets: 2, zoneId: 'z01' },
                { time: '10:48', action: 'Idle', location: 'Dock staging', pallets: 0, idle: true, zoneId: 'z01' },
                { time: '10:41', action: 'Putaway completed', location: 'Bulk A, Row 8', pallets: 2, zoneId: 'z04' }
              ].map((a, i) => (
                <div 
                  key={i} 
                  onClick={() => onNavigateToZone && onNavigateToZone(a.zoneId, a.location)}
                  style={{ 
                    display: 'flex', alignItems: 'center', gap: sp.sm,
                    padding: sp.sm,
                    background: a.idle ? C.warning[50] : C.neutral[50],
                    borderRadius: 6,
                    borderLeft: `3px solid ${a.idle ? C.warning[500] : a.travel ? C.neutral[300] : C.success[500]}`,
                    cursor: 'pointer',
                    transition: 'all 0.15s ease'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = 'white';
                    e.currentTarget.style.boxShadow = '0 2px 6px rgba(0,0,0,0.06)';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = a.idle ? C.warning[50] : C.neutral[50];
                    e.currentTarget.style.boxShadow = 'none';
                  }}
                >
                  <span style={{ fontSize: '11px', color: C.neutral[500], minWidth: 45 }}>{a.time}</span>
                  <div style={{ flex: 1 }}>
                    <p style={{ fontSize: '13px', fontWeight: a.idle ? 400 : 500 }}>{a.action}</p>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>{a.location}</p>
                  </div>
                  {a.pallets > 0 && (
                    <Badge status="info" label={`${a.pallets} pallets`} />
                  )}
                  <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
                </div>
              ))}
            </div>
          </Card>
          
          {/* Weekly Summary */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Weekly Summary</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
              <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                <p style={{ fontSize: '28px', fontWeight: 300 }}>1,240</p>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Total Pallets</p>
              </div>
              <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                <p style={{ fontSize: '28px', fontWeight: 300 }}>29.5</p>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Active Hours</p>
              </div>
              <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                <p style={{ fontSize: '28px', fontWeight: 300, color: C.success[600] }}>112%</p>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>vs Target</p>
              </div>
            </div>
          </Card>
        </>
      )}
    </>
  );
};

// Placeholder components for Staff and Zone detail views
const StaffDetailContent = ({ staffId, staffName, activeTab, onNavigateToStaff, onNavigateToZone, onNavigateToEquipment, onNavigateToAlert }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue, endTime, endTimeLabel, useEOD, scenarioMode, activeScenario } = useTimeContext();
  
  // Contributing Factors Modal state
  const [contributingFactorsModal, setContributingFactorsModal] = useState({ isOpen: false, title: '', data: null });
  
  // Specific staff data - Mike Brown as canonical example
  const specificStaff = {
    'E005': {
      id: 'E005',
      name: 'Mike Brown',
      role: 'Senior Forklift Operator',
      department: 'Warehouse Operations',
      shift: 'Day Shift',
      shiftTime: '6:00 AM - 2:00 PM',
      hireDate: '2019-08-12',
      yearsOfService: 5.4,
      status: 'Active',
      supervisor: 'Sarah Chen',
      supervisorId: 'E102',
      phone: '(555) 867-5309',
      email: 'm.brown@warehouse.com',
      
      // Current shift info
      currentShift: {
        status: 'On Shift',
        clockedIn: '5:55 AM',
        hoursToday: 4.1,
        breaksTaken: 1,
        breaksRemaining: 1,
        zone: 'Z04 - Bulk Storage',
        zoneId: 'Z04',
        equipment: 'FL-01',
        equipmentId: 'FL-01',
        nextBreak: '12:00 PM'
      },
      
      // Performance metrics with tri-temporal
      performance: {
        uph: { current: 52, predicted: 51, target: 45 },
        pickAccuracy: { current: 99.4, predicted: 99.3, target: 99.0 },
        efficiency: { current: 94, predicted: 93, target: 85 },
        palletsToday: { 
          current: 86, 
          predicted: 156,
          target: 140,
          timeline: [
            { time: '06:00', actual: 0 },
            { time: '07:00', actual: 18 },
            { time: '08:00', actual: 38 },
            { time: '09:00', actual: 62 },
            { time: '10:00', actual: 86, predicted: 86 },
            { time: '11:00', predicted: 108 },
            { time: '12:00', predicted: 128 },
            { time: '13:00', predicted: 144 },
            { time: '14:00', predicted: 156 }
          ]
        },
        hoursWorked: {
          current: 4.1,
          predicted: 8.0,
          target: 8.0,
          timeline: [
            { time: '06:00', actual: 0 },
            { time: '08:00', actual: 2.0 },
            { time: '10:00', actual: 4.1, predicted: 4.1 },
            { time: '12:00', predicted: 5.8 },
            { time: '14:00', predicted: 8.0 }
          ]
        },
        tasksCompleted: {
          current: 42,
          predicted: 78,
          target: 70,
          timeline: [
            { time: '06:00', actual: 0 },
            { time: '08:00', actual: 16 },
            { time: '10:00', actual: 42, predicted: 42 },
            { time: '12:00', predicted: 58 },
            { time: '14:00', predicted: 78 }
          ]
        },
        idleTime: { current: 6, predicted: 8, target: 12 },
        avgCycleTime: 1.9,
        directLaborPct: 89,
        ranking: 2,
        rankingTotal: 28,
        rankingTrend: '+3'
      },
      
      // Break tracking with predictions
      breaks: {
        taken: [
          { type: '15 min', startTime: '08:30', endTime: '08:45', status: 'completed' }
        ],
        scheduled: [
          { type: '30 min lunch', scheduledTime: '12:00', status: 'upcoming' }
        ],
        remaining: { 
          breakMinutes: 30,
          timeline: [
            { time: '06:00', actual: 45 },
            { time: '08:45', actual: 30, predicted: 30 },
            { time: '10:00', actual: 30, predicted: 30 },
            { time: '12:30', predicted: 0 },
            { time: '14:00', predicted: 0 }
          ]
        },
        compliance: 100
      },
      
      // Fatigue/Safety score (predictive)
      fatigueScore: {
        current: 92,
        predicted: 78,
        target: 80,
        risk: 'low',
        predictedRisk: 'medium',
        timeline: [
          { time: '06:00', actual: 100 },
          { time: '08:00', actual: 96 },
          { time: '10:00', actual: 92, predicted: 92 },
          { time: '12:00', predicted: 84 },
          { time: '14:00', predicted: 78 }
        ],
        factors: ['Consecutive work hours', 'Break timing', 'Task intensity']
      },
      
      // Equipment certifications
      certifiedEquipment: [
        { id: 'FL-01', type: 'Sit-Down Forklift', certDate: '2022-03-15', expiry: '2025-03-15', hours: 2840, status: 'Active' },
        { id: 'FL-02', type: 'Sit-Down Forklift', certDate: '2022-03-15', expiry: '2025-03-15', hours: 1620, status: 'Active' },
        { id: 'RT-01', type: 'Reach Truck', certDate: '2023-01-20', expiry: '2026-01-20', hours: 890, status: 'Active' },
        { id: 'EPJ-04', type: 'Electric Pallet Jack', certDate: '2023-06-10', expiry: '2026-06-10', hours: 340, status: 'Active' }
      ],
      
      // All certifications
      certifications: [
        { name: 'Forklift Operator License', issuer: 'OSHA', issued: '2022-03-15', expiry: '2025-03-15', status: 'expiring', daysUntilExpiry: 87 },
        { name: 'Reach Truck Certification', issuer: 'OSHA', issued: '2023-01-20', expiry: '2026-01-20', status: 'active' },
        { name: 'Hazmat Handling Level 2', issuer: 'DOT', issued: '2023-05-01', expiry: '2026-05-01', status: 'active' },
        { name: 'CPR/First Aid', issuer: 'Red Cross', issued: '2024-02-15', expiry: '2026-02-15', status: 'active' },
        { name: 'Confined Space Entry', issuer: 'Internal', issued: '2024-08-20', expiry: '2025-08-20', status: 'active' }
      ],
      
      // Training history
      trainingHistory: [
        { course: 'Annual Safety Refresher', date: '2024-11-15', score: 98, status: 'passed' },
        { course: 'New WMS System Training', date: '2024-09-20', score: 92, status: 'passed' },
        { course: 'Hazmat Level 2 Certification', date: '2024-05-01', score: 96, status: 'passed' },
        { course: 'Forklift Advanced Operations', date: '2023-12-10', score: 100, status: 'passed' },
        { course: 'Ergonomics & Injury Prevention', date: '2023-08-15', score: 94, status: 'passed' }
      ],
      
      // Safety record
      safety: {
        daysSinceIncident: 412,
        totalIncidents: 0,
        nearMissReports: 3,
        safetyObservations: 18,
        safetyScore: { current: 98, predicted: 97, target: 90 },
        streak: 'Longest incident-free streak in department'
      },
      
      // Attendance
      attendance: {
        rate: 98.6,
        punctuality: 99.2,
        scheduledDays: 220,
        daysWorked: 217,
        lateArrivals: 2,
        unplannedAbsences: 1,
        ptoBalance: 14,
        ptoUsed: 6,
        sickDaysUsed: 2
      },
      
      // Schedule
      schedule: {
        currentWeek: [
          { day: 'Mon', date: 'Dec 16', shift: 'Day', time: '6AM-2PM', status: 'worked', hours: 8.2 },
          { day: 'Tue', date: 'Dec 17', shift: 'Day', time: '6AM-2PM', status: 'worked', hours: 8.0 },
          { day: 'Wed', date: 'Dec 18', shift: 'Day', time: '6AM-2PM', status: 'current', hours: 4.1 },
          { day: 'Thu', date: 'Dec 19', shift: 'Day', time: '6AM-2PM', status: 'scheduled' },
          { day: 'Fri', date: 'Dec 20', shift: 'Day', time: '6AM-2PM', status: 'scheduled' },
          { day: 'Sat', date: 'Dec 21', shift: 'Off', time: '-', status: 'off' },
          { day: 'Sun', date: 'Dec 22', shift: 'Off', time: '-', status: 'off' }
        ],
        overtimeHours: 0.2,
        overtimeLimit: 10,
        weeklyHours: { current: 20.3, predicted: 40.2, target: 40 }
      },
      
      // Predictive alerts - issues requiring intervention
      predictiveAlerts: [
        {
          id: 'mike-cert',
          sev: 'warning',
          title: 'Certification expiring',
          msg: 'Forklift Operator License expires in 87 days. Schedule recertification training.',
          time: '87 days',
          conf: 100,
          insightAvailable: true
        },
        {
          id: 'mike-fatigue',
          sev: 'info',
          title: 'Fatigue score declining',
          msg: 'Predicted to drop below 80% threshold by 13:30 if lunch break is delayed.',
          time: '+3.5 hrs',
          conf: 76,
          insightAvailable: true
        }
      ],
      
      // Upcoming events
      upcomingEvents: [
        { id: 'ev-break', type: 'break', title: 'Lunch break', time: '12:00 PM', desc: '30 min scheduled', icon: 'coffee' },
        { id: 'ev-handoff', type: 'handoff', title: 'Shift end', time: '2:00 PM', desc: 'Hand off FL-01 to Carlos Mendez', icon: 'users' },
        { id: 'ev-training', type: 'training', title: 'Safety refresher', time: 'Dec 20', desc: 'Annual safety training due', icon: 'clipboard' }
      ],
      
      // Scenario impacts
      scenarioImpacts: {
        'scenario-1': { // +2 FTEs
          tasksReduction: -15,
          fatigueImprovement: +8,
          breakOnTime: true,
          workloadPct: 85
        },
        'scenario-2': { // Stagger breaks
          breakTimeShift: '+15 min',
          fatigueImprovement: +4,
          coverageImproved: true
        }
      }
    }
  };
  
  // Generate generic staff data for other IDs
  const generateStaffData = (id, name) => ({
    id: id || 'EMP-0000',
    name: name || 'Staff Member',
    role: 'Warehouse Associate',
    department: 'Warehouse Operations',
    shift: 'Day Shift',
    shiftTime: '6:00 AM - 2:00 PM',
    hireDate: '2022-01-15',
    yearsOfService: 2.9,
    status: 'Active',
    supervisor: 'Sarah Chen',
    supervisorId: 'E102',
    currentShift: {
      status: 'On Shift',
      clockedIn: '6:00 AM',
      hoursToday: 4.0,
      zone: 'Z01 - Inbound',
      zoneId: 'Z01',
      equipment: null,
      equipmentId: null
    },
    performance: {
      uph: { current: 42, predicted: 41, target: 40 },
      pickAccuracy: { current: 98.5, predicted: 98.4, target: 98.0 },
      efficiency: { current: 88, predicted: 87, target: 85 },
      palletsToday: { current: 64, predicted: 120, target: 110 },
      hoursWorked: { current: 4.0, predicted: 8.0, target: 8.0 },
      tasksCompleted: { current: 32, predicted: 62, target: 55 },
      idleTime: { current: 10, predicted: 12, target: 15 },
      ranking: 12,
      rankingTotal: 28
    },
    fatigueScore: { current: 90, predicted: 82, target: 80 },
    certifications: [],
    certifiedEquipment: [],
    safety: { daysSinceIncident: 180, safetyScore: { current: 92, predicted: 91, target: 90 } },
    attendance: { rate: 96.5, punctuality: 97.0 },
    predictiveAlerts: [],
    upcomingEvents: []
  });
  
  // Get staff data
  const staff = specificStaff[staffId] || generateStaffData(staffId, staffName);
  
  // Helper to safely get nested values
  const safeGet = (obj, path, defaultVal) => {
    try {
      return path.split('.').reduce((o, k) => o?.[k], obj) ?? defaultVal;
    } catch { return defaultVal; }
  };
  
  // Contributing Factors data for person metrics
  const contributingFactorsData = {
    productivity: {
      whatsHappening: `${staff.name} has completed ${safeGet(staff, 'performance.tasksCompleted.current', 42)} tasks today, tracking toward the daily target. Productivity rate is ${safeGet(staff, 'performance.uph.current', 52)} units/hour.`,
      whyImportant: 'Strong productivity indicates effective task assignment and operator skill. Maintaining this pace will exceed daily targets, contributing to zone throughput goals.',
      contributors: [
        { label: 'Equipment Assignment', weight: 35, direction: 'up', detail: 'FL-01 is high-efficiency unit', onClick: () => {} },
        { label: 'Zone Familiarity', weight: 30, direction: 'up', detail: 'Z04 is primary assignment', onClick: () => {} },
        { label: 'Task Sequencing', weight: 20, direction: 'neutral', detail: 'Route optimization applied', onClick: () => {} },
        { label: 'Experience Level', weight: 15, direction: 'up', detail: '5.4 years, senior operator', onClick: () => {} }
      ],
      calculation: {
        formula: 'Tasks/Hour = Completed Tasks / Active Work Hours',
        dataSources: ['WMS task completions', 'Time clock data', 'Equipment telemetry'],
        refreshRate: 'Real-time',
        confidence: 96
      },
      actions: [
        { label: 'View Task History', onClick: () => {} },
        { label: 'Compare to Team', onClick: () => {} }
      ]
    },
    fatigue: {
      whatsHappening: `Fatigue score is currently ${safeGet(staff, 'fatigueScore.current', 92)}%, predicted to decline to ${safeGet(staff, 'fatigueScore.predicted', 78)}% by end of shift.`,
      whyImportant: 'Fatigue scores below 80% correlate with 2.3x increase in safety incidents. Timely breaks and workload balancing can prevent the decline.',
      contributors: [
        { label: 'Continuous Work Time', weight: 40, direction: 'down', detail: '2.5 hrs since last break', onClick: () => {} },
        { label: 'Task Intensity', weight: 30, direction: 'down', detail: 'Heavy lifting in Z04', onClick: () => {} },
        { label: 'Environmental Factors', weight: 20, direction: 'neutral', detail: 'Temperature normal', onClick: () => {} },
        { label: 'Shift Progress', weight: 10, direction: 'down', detail: '51% through shift', onClick: () => {} }
      ],
      calculation: {
        formula: 'Fatigue = 100 - (Work Hours × 3) - (Intensity Factor) + (Break Recovery)',
        dataSources: ['Time clock', 'Task intensity weights', 'Break logs', 'Historical patterns'],
        refreshRate: 'Every 15 minutes',
        confidence: 76
      },
      actions: [
        { label: 'View Break Schedule', onClick: () => {} },
        { label: 'Adjust Workload', onClick: () => {} }
      ]
    },
    efficiency: {
      whatsHappening: `Operating at ${staff.performance.efficiency?.current || 94}% efficiency with only ${staff.performance.idleTime?.current || 6}% idle time. This ranks #${staff.performance.ranking || 2} among ${staff.performance.rankingTotal || 28} operators.`,
      whyImportant: 'High efficiency indicates optimal operator-equipment-zone matching. This performance level sets the benchmark for training other operators.',
      contributors: [
        { label: 'Route Efficiency', weight: 35, direction: 'up', detail: 'Minimal dead travel', onClick: () => {} },
        { label: 'Equipment Uptime', weight: 25, direction: 'up', detail: 'FL-01 at 97% availability', onClick: () => {} },
        { label: 'Task Batching', weight: 25, direction: 'up', detail: 'Optimal pickup sequences', onClick: () => {} },
        { label: 'Idle Minimization', weight: 15, direction: 'up', detail: 'Quick task transitions', onClick: () => {} }
      ],
      calculation: {
        formula: 'Efficiency = (Productive Time / Available Time) × Quality Factor',
        dataSources: ['Equipment telemetry', 'Task timestamps', 'WMS logs'],
        refreshRate: 'Real-time',
        confidence: 94
      },
      actions: [
        { label: 'View Time Breakdown', onClick: () => {} },
        { label: 'Compare to Fleet', onClick: () => {} }
      ]
    }
  };

  const statusColor = staff.status === 'Active' ? C.success : staff.status === 'On Break' ? C.warning : C.neutral;

  return (
    <>
      {/* Contributing Factors Modal */}
      <ContributingFactorsModal 
        isOpen={contributingFactorsModal.isOpen}
        onClose={() => setContributingFactorsModal({ isOpen: false, title: '', data: null })}
        title={contributingFactorsModal.title}
        data={contributingFactorsModal.data}
      />
      
      {/* Dashboard Tab */}
      {activeTab === 'dashboard' && (
        <>
          {/* Hero Card - Consolidated with Performance Summary */}
          <Card style={{ borderLeft: `4px solid ${C.purple[500]}` }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', gap: sp.md, marginBottom: sp.lg }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                <div style={{ 
                  width: 64, height: 64, borderRadius: '50%', 
                  background: `linear-gradient(135deg, ${C.purple[100]} 0%, ${C.purple[200]} 100%)`, 
                  display: 'flex', alignItems: 'center', justifyContent: 'center',
                  border: `3px solid ${C.purple[500]}`,
                  boxShadow: `0 0 0 4px ${C.purple[100]}`
                }}>
                  <Users style={{ width: 32, height: 32, color: C.purple[600] }} />
                </div>
                <div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <h2 style={{ fontSize: '22px', fontWeight: 500, margin: 0 }}>{staff.name}</h2>
                    <Badge status="success" label={staff.currentShift?.status || 'On Shift'} dot />
                  </div>
                  <p style={{ fontSize: '14px', color: C.neutral[600], margin: 0, marginTop: 2 }}>{staff.role} • {staff.yearsOfService} yrs</p>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginTop: sp.sm, flexWrap: 'wrap' }}>
                    {staff.currentShift?.equipment && (
                      <span 
                        onClick={() => onNavigateToEquipment && onNavigateToEquipment(staff.currentShift.equipmentId, staff.currentShift.equipment)}
                        style={{ 
                          display: 'inline-flex', alignItems: 'center', gap: 4,
                          fontSize: '12px', padding: '4px 10px', 
                          background: C.brand[50], borderRadius: 16, 
                          color: C.brand[700], cursor: 'pointer',
                          border: `1px solid ${C.brand[200]}`
                        }}
                      >
                        <Truck style={{ width: 12, height: 12 }} />
                        {staff.currentShift.equipment}
                        <ChevronRight style={{ width: 12, height: 12, color: C.brand[400] }} />
                      </span>
                    )}
                    <span 
                      onClick={() => onNavigateToZone && onNavigateToZone(staff.currentShift?.zoneId, staff.currentShift?.zone)}
                      style={{ 
                        display: 'inline-flex', alignItems: 'center', gap: 4,
                        fontSize: '12px', padding: '4px 10px', 
                        background: C.neutral[100], borderRadius: 16, 
                        color: C.neutral[700], cursor: 'pointer',
                        border: `1px solid ${C.neutral[200]}`
                      }}
                    >
                      <MapPin style={{ width: 12, height: 12 }} />
                      {staff.currentShift?.zone || 'Z01'}
                      <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
                    </span>
                  </div>
                </div>
              </div>
              {/* Performance Rank with trend */}
              <div style={{ textAlign: 'right' }}>
                <p style={{ fontSize: '11px', color: C.neutral[500], marginBottom: 2 }}>Performance Rank</p>
                <div style={{ display: 'flex', alignItems: 'baseline', justifyContent: 'flex-end', gap: 4 }}>
                  <span style={{ fontSize: '32px', fontWeight: 300, color: C.purple[600] }}>#{staff.performance?.ranking || 2}</span>
                  <span style={{ fontSize: '14px', color: C.neutral[500] }}>/ {staff.performance?.rankingTotal || 28}</span>
                </div>
                {staff.performance?.rankingTrend && (
                  <span style={{ 
                    fontSize: '11px', 
                    color: staff.performance.rankingTrend.startsWith('+') ? C.success[600] : C.error[600],
                    display: 'inline-flex', alignItems: 'center', gap: 2
                  }}>
                    {staff.performance.rankingTrend.startsWith('+') ? <ArrowUpRight style={{ width: 12, height: 12 }} /> : <ArrowDownRight style={{ width: 12, height: 12 }} />}
                    {staff.performance.rankingTrend} this week
                  </span>
                )}
              </div>
            </div>
            
            {/* Divider */}
            <div style={{ borderTop: `1px solid ${C.neutral[200]}`, marginBottom: sp.md }} />
            
            {/* Key Performance Metrics - 3x2 grid */}
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm }}>
              {[
                { 
                  label: 'Units/Hour', 
                  value: staff.performance?.uph?.current || 52, 
                  pred: staff.performance?.uph?.predicted || 51,
                  target: staff.performance?.uph?.target || 45,
                  getColor: (v, t) => v >= t ? C.success : C.warning
                },
                { 
                  label: 'Efficiency', 
                  value: staff.performance?.efficiency?.current || 94, 
                  pred: staff.performance?.efficiency?.predicted || 93,
                  target: staff.performance?.efficiency?.target || 85,
                  unit: '%',
                  getColor: (v, t) => v >= t ? C.success : C.warning
                },
                { 
                  label: 'Fatigue Score', 
                  value: staff.fatigueScore?.current || 92, 
                  pred: staff.fatigueScore?.predicted || 78,
                  target: staff.fatigueScore?.target || 80,
                  unit: '%',
                  getColor: (v, t) => v >= t ? C.success : v >= t - 10 ? C.warning : C.error,
                  predWarn: (staff.fatigueScore?.predicted || 78) < (staff.fatigueScore?.target || 80)
                },
                { 
                  label: 'Pick Accuracy', 
                  value: staff.performance?.pickAccuracy?.current || 99.4, 
                  pred: staff.performance?.pickAccuracy?.predicted || 99.3,
                  target: staff.performance?.pickAccuracy?.target || 99.0,
                  unit: '%',
                  getColor: (v, t) => v >= t ? C.success : C.warning
                },
                { 
                  label: 'Safety Score', 
                  value: staff.safety?.safetyScore?.current || 98, 
                  pred: staff.safety?.safetyScore?.predicted || 97,
                  target: staff.safety?.safetyScore?.target || 90,
                  unit: '%',
                  getColor: (v, t) => v >= t ? C.success : C.warning
                },
                { 
                  label: 'Attendance', 
                  value: staff.attendance?.rate || 98.6, 
                  unit: '%',
                  getColor: (v) => v >= 95 ? C.success : v >= 90 ? C.warning : C.error
                }
              ].map((m, i) => {
                const color = m.getColor(m.value, m.target);
                const predColor = m.predWarn ? C.warning : C.purple;
                return (
                  <div key={i} style={{ 
                    padding: sp.sm, 
                    background: color[50], 
                    borderRadius: 6, 
                    textAlign: 'center',
                    borderTop: `3px solid ${color[500]}`
                  }}>
                    <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{m.label}</p>
                    <div style={{ display: 'flex', alignItems: 'baseline', justifyContent: 'center', gap: 2, flexWrap: 'wrap' }}>
                      <span style={{ fontSize: '20px', fontWeight: 500, color: color[600] }}>
                        {m.value}{m.unit || ''}
                      </span>
                      {m.pred && (
                        <>
                          <ArrowRight style={{ width: 8, height: 8, color: C.neutral[400] }} />
                          <span style={{ fontSize: '12px', color: predColor[600] }}>{m.pred}{m.unit || ''}</span>
                        </>
                      )}
                    </div>
                    {m.target && <p style={{ fontSize: '9px', color: C.neutral[400] }}>Target: {m.target}{m.unit || ''}</p>}
                  </div>
                );
              })}
            </div>
          </Card>
          
          {/* Productivity Timeline Chart */}
          <Card>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
              <div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 4 }}>
                  <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Productivity Timeline</h3>
                  <ContributingFactorsLink onClick={() => setContributingFactorsModal({ 
                    isOpen: true, 
                    title: 'Productivity', 
                    data: contributingFactorsData.productivity 
                  })} />
                </div>
                <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>
                  Tasks completed today • Target: {staff.performance?.tasksCompleted?.target || 70} by {useEOD ? 'EOD' : 'EOS'}
                </p>
              </div>
              {isContextualDifferent && contextualTime !== '10:00' && staff.performance?.tasksCompleted?.timeline && (
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, padding: '4px 10px', background: C.brand[100], borderRadius: 6 }}>
                  <span style={{ fontSize: '12px', color: C.brand[600] }}>
                    @{contextualTime}: <strong>{Math.round(interpolateValue(staff.performance.tasksCompleted.timeline, contextualTime) || 0)}</strong> tasks
                  </span>
                </div>
              )}
            </div>
            
            {/* Chart */}
            <div style={{ position: 'relative', height: 160 }}>
              <ResponsiveContainer width="100%" height="100%">
                <AreaChart data={staff.performance?.tasksCompleted?.timeline || []} margin={{ top: 10, right: 10, left: 0, bottom: 5 }}>
                  <defs>
                    <linearGradient id="taskActualFill" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="0%" stopColor={C.purple[500]} stopOpacity={0.2} />
                      <stop offset="100%" stopColor={C.purple[500]} stopOpacity={0} />
                    </linearGradient>
                    <linearGradient id="taskPredFill" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="0%" stopColor={C.indigo[500]} stopOpacity={0.15} />
                      <stop offset="100%" stopColor={C.indigo[500]} stopOpacity={0.02} />
                    </linearGradient>
                  </defs>
                  <XAxis dataKey="time" tick={{ fontSize: 10, fill: C.neutral[500] }} axisLine={{ stroke: C.neutral[200] }} tickLine={false} />
                  <YAxis tick={{ fontSize: 10, fill: C.neutral[500] }} axisLine={false} tickLine={false} width={30} />
                  {/* Target line */}
                  <Area type="linear" dataKey={() => staff.performance?.tasksCompleted?.target || 70} stroke={C.success[400]} strokeWidth={1} strokeDasharray="4 4" fill="none" />
                  {/* Actual line */}
                  <Area type="linear" dataKey="actual" stroke={C.purple[500]} strokeWidth={2} fill="url(#taskActualFill)" dot={false} connectNulls />
                  {/* Predicted line */}
                  <Area type="linear" dataKey="predicted" stroke={C.indigo[500]} strokeWidth={2} strokeDasharray="6 3" fill="none" dot={false} connectNulls />
                </AreaChart>
              </ResponsiveContainer>
              
              {/* NOW marker */}
              {(() => {
                const timeline = staff.performance?.tasksCompleted?.timeline || [];
                if (timeline.length === 0) return null;
                const times = timeline.map(d => {
                  const [h, m] = d.time.split(':').map(Number);
                  return h + (m || 0) / 60;
                });
                const minTime = Math.min(...times);
                const maxTime = Math.max(...times);
                const nowDecimal = 10;
                const nowPosition = ((nowDecimal - minTime) / (maxTime - minTime)) * 100;
                const leftOffset = 30;
                const rightOffset = 10;
                const adjustedPosition = leftOffset + (nowPosition / 100) * (100 - leftOffset - rightOffset) * (100 / (100));
                
                return (
                  <div style={{ 
                    position: 'absolute', 
                    left: `calc(${adjustedPosition}% - ${leftOffset * adjustedPosition / 100}px)`, 
                    top: 10, 
                    bottom: 25, 
                    width: 2, 
                    background: C.neutral[600], 
                    zIndex: 9 
                  }}>
                    <div style={{ 
                      position: 'absolute', 
                      top: -2, 
                      left: '50%', 
                      transform: 'translateX(-50%)', 
                      background: C.neutral[700], 
                      color: 'white', 
                      padding: '1px 4px', 
                      borderRadius: 2, 
                      fontSize: 8, 
                      fontWeight: 600 
                    }}>NOW</div>
                  </div>
                );
              })()}
            </div>
            
            {/* Legend */}
            <div style={{ display: 'flex', gap: sp.md, marginTop: sp.sm, justifyContent: 'center' }}>
              <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 10, color: C.neutral[600] }}>
                <span style={{ width: 16, height: 3, background: C.purple[500], borderRadius: 2 }} /> Actual
              </span>
              <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 10, color: C.neutral[600] }}>
                <span style={{ width: 16, height: 3, background: C.indigo[500], borderRadius: 2, opacity: 0.7 }} /> Predicted
              </span>
              <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 10, color: C.neutral[600] }}>
                <span style={{ width: 16, height: 2, background: C.success[400], borderRadius: 2 }} /> Target
              </span>
            </div>
          </Card>
          
          {/* Fatigue Score Trend */}
          <Card style={{ background: `linear-gradient(135deg, ${(staff.fatigueScore?.predicted || 78) < (staff.fatigueScore?.target || 80) ? C.warning[50] : C.success[50]} 0%, ${C.neutral[50]} 100%)` }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.md }}>
              <div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 4 }}>
                  <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0, display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <Activity style={{ width: 16, height: 16, color: (staff.fatigueScore?.predicted || 78) < (staff.fatigueScore?.target || 80) ? C.warning[600] : C.success[600] }} />
                    Fatigue Score Trend
                  </h3>
                  <ContributingFactorsLink onClick={() => setContributingFactorsModal({ 
                    isOpen: true, 
                    title: 'Fatigue Score', 
                    data: contributingFactorsData.fatigue 
                  })} />
                </div>
                <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>
                  Threshold: {staff.fatigueScore?.target || 80}% • {(staff.fatigueScore?.predicted || 78) < (staff.fatigueScore?.target || 80) ? 'At risk of dropping below threshold' : 'On track'}
                </p>
              </div>
              <div style={{ textAlign: 'right' }}>
                <div style={{ display: 'flex', alignItems: 'baseline', gap: 4 }}>
                  <span style={{ fontSize: '24px', fontWeight: 500, color: C.neutral[800] }}>{staff.fatigueScore?.current || 92}%</span>
                  <ArrowRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
                  <span style={{ 
                    fontSize: '18px', 
                    fontWeight: 500, 
                    color: (staff.fatigueScore?.predicted || 78) < (staff.fatigueScore?.target || 80) ? C.warning[600] : C.purple[600] 
                  }}>
                    {staff.fatigueScore?.predicted || 78}%
                  </span>
                </div>
                <p style={{ fontSize: '10px', color: C.neutral[500] }}>@{endTimeLabel}</p>
              </div>
            </div>
            
            {/* Chart */}
            <div style={{ position: 'relative', height: 120 }}>
              <ResponsiveContainer width="100%" height="100%">
                <AreaChart data={staff.fatigueScore?.timeline || []} margin={{ top: 10, right: 10, left: 0, bottom: 5 }}>
                  <defs>
                    <linearGradient id="fatigueGradient" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="0%" stopColor={C.success[500]} stopOpacity={0.2} />
                      <stop offset="100%" stopColor={C.warning[500]} stopOpacity={0.1} />
                    </linearGradient>
                  </defs>
                  <XAxis dataKey="time" tick={{ fontSize: 10, fill: C.neutral[500] }} axisLine={{ stroke: C.neutral[200] }} tickLine={false} />
                  <YAxis domain={[60, 100]} tick={{ fontSize: 10, fill: C.neutral[500] }} axisLine={false} tickLine={false} width={30} />
                  {/* Threshold line */}
                  <Area type="linear" dataKey={() => staff.fatigueScore?.target || 80} stroke={C.error[400]} strokeWidth={1} strokeDasharray="4 4" fill="none" />
                  {/* Actual line */}
                  <Area type="linear" dataKey="actual" stroke={C.success[500]} strokeWidth={2} fill="url(#fatigueGradient)" dot={false} connectNulls />
                  {/* Predicted line */}
                  <Area type="linear" dataKey="predicted" stroke={C.warning[500]} strokeWidth={2} strokeDasharray="6 3" fill="none" dot={false} connectNulls />
                </AreaChart>
              </ResponsiveContainer>
            </div>
          </Card>
          
          {/* Today's Stats - compact 2-column */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.sm }}>
            {[
              { 
                label: 'Tasks Completed', 
                value: staff.performance?.tasksCompleted?.current || 42,
                pred: staff.performance?.tasksCompleted?.predicted || 78,
                target: staff.performance?.tasksCompleted?.target || 70,
                icon: CheckCircle,
                good: (staff.performance?.tasksCompleted?.predicted || 78) >= (staff.performance?.tasksCompleted?.target || 70)
              },
              { 
                label: 'Hours Worked', 
                value: staff.performance?.hoursWorked?.current || 4.1,
                pred: staff.performance?.hoursWorked?.predicted || 8.0,
                target: staff.performance?.hoursWorked?.target || 8.0,
                icon: Clock,
                good: true
              },
              { 
                label: 'Break Time Left', 
                value: staff.breaks?.remaining?.breakMinutes || 30,
                unit: ' min',
                icon: Coffee,
                good: (staff.breaks?.remaining?.breakMinutes || 30) > 0
              },
              { 
                label: 'Idle Time', 
                value: staff.performance?.idleTime?.current || 6,
                pred: staff.performance?.idleTime?.predicted || 8,
                target: staff.performance?.idleTime?.target || 12,
                unit: '%',
                icon: Minus,
                good: (staff.performance?.idleTime?.current || 6) <= (staff.performance?.idleTime?.target || 12),
                lowerIsBetter: true
              }
            ].map((metric, i) => (
              <Card key={i} style={{ padding: sp.sm, borderLeft: `3px solid ${metric.good ? C.success[500] : C.warning[500]}` }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                  <div style={{ 
                    width: 32, height: 32, borderRadius: 6, 
                    background: metric.good ? C.success[50] : C.warning[50],
                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                    flexShrink: 0
                  }}>
                    <metric.icon style={{ width: 16, height: 16, color: metric.good ? C.success[600] : C.warning[600] }} />
                  </div>
                  <div style={{ flex: 1 }}>
                    <p style={{ fontSize: '10px', color: C.neutral[500], margin: 0, marginBottom: 2 }}>{metric.label}</p>
                    <div style={{ display: 'flex', alignItems: 'baseline', gap: 4, flexWrap: 'wrap' }}>
                      <span style={{ fontSize: '20px', fontWeight: 500, color: C.neutral[800] }}>
                        {metric.value}{metric.unit || ''}
                      </span>
                      {metric.pred && (
                        <>
                          <ArrowRight style={{ width: 10, height: 10, color: C.neutral[400] }} />
                          <span style={{ fontSize: '14px', fontWeight: 500, color: C.purple[600] }}>{metric.pred}{metric.unit || ''}</span>
                        </>
                      )}
                      {metric.target && (
                        <span style={{ fontSize: '10px', color: metric.good ? C.success[600] : C.warning[600] }}>
                          ({metric.good ? '✓' : '!'} {metric.target})
                        </span>
                      )}
                    </div>
                  </div>
                </div>
              </Card>
            ))}
          </div>
          
          {/* Upcoming Events */}
          {staff.upcomingEvents && staff.upcomingEvents.length > 0 && (
            <Card>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
                <Calendar style={{ width: 16, height: 16, color: C.neutral[500] }} />
                <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Upcoming Events</h3>
              </div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                {staff.upcomingEvents.map((event, i) => {
                  const iconMap = { coffee: Coffee, users: Users, clipboard: ClipboardList };
                  const EventIcon = iconMap[event.icon] || Clock;
                  const colorMap = { break: C.warning, handoff: C.purple, training: C.brand };
                  const color = colorMap[event.type] || C.neutral;
                  
                  return (
                    <div key={i} style={{ 
                      display: 'flex', alignItems: 'center', gap: sp.md,
                      padding: sp.sm, background: C.neutral[50], borderRadius: 6,
                      borderLeft: `3px solid ${color[400]}`
                    }}>
                      <div style={{ 
                        width: 32, height: 32, borderRadius: 6,
                        background: color[100],
                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                        flexShrink: 0
                      }}>
                        <EventIcon style={{ width: 16, height: 16, color: color[600] }} />
                      </div>
                      <div style={{ flex: 1 }}>
                        <p style={{ fontSize: '13px', fontWeight: 500, margin: 0 }}>{event.title}</p>
                        <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>{event.desc}</p>
                      </div>
                      <div style={{ padding: '4px 8px', background: color[100], borderRadius: 4 }}>
                        <span style={{ fontSize: '12px', fontWeight: 500, color: color[700] }}>{event.time}</span>
                      </div>
                    </div>
                  );
                })}
              </div>
            </Card>
          )}
          
          {/* Analysis */}
          {staff.predictiveAlerts && staff.predictiveAlerts.length > 0 && (
            <Card>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
                <div>
                  <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Analysis</h3>
                  <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>Issues that may require attention</p>
                </div>
                <div style={{ 
                  display: 'flex', alignItems: 'center', gap: sp.xs,
                  padding: '6px 12px', background: C.purple[50], borderRadius: 6,
                  cursor: 'pointer', border: `1px solid ${C.purple[200]}`
                }}>
                  <Lightbulb style={{ width: 14, height: 14, color: C.purple[600] }} />
                  <span style={{ fontSize: '12px', color: C.purple[700], fontWeight: 500 }}>View Recommendations</span>
                  <ChevronRight style={{ width: 14, height: 14, color: C.purple[500] }} />
                </div>
              </div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                {staff.predictiveAlerts.map((alert, i) => (
                  <div key={i} style={{ 
                    display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                    padding: sp.sm,
                    background: alert.sev === 'warning' ? C.warning[50] : C.brand[50],
                    borderRadius: 6,
                    borderLeft: `3px solid ${alert.sev === 'warning' ? C.warning[500] : C.brand[500]}`
                  }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                      <AlertTriangle style={{ width: 16, height: 16, color: alert.sev === 'warning' ? C.warning[600] : C.brand[600] }} />
                      <div>
                        <p style={{ fontSize: '13px', fontWeight: 500, margin: 0 }}>{alert.title}</p>
                        <p style={{ fontSize: '11px', color: C.neutral[600], margin: 0 }}>{alert.msg}</p>
                      </div>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                      <div style={{ textAlign: 'right' }}>
                        <p style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[700], margin: 0 }}>{alert.time}</p>
                        <p style={{ fontSize: '10px', color: C.neutral[500], margin: 0 }}>{alert.conf}% confidence</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </Card>
          )}
          
          {/* Quick Info */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Quick Info</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.md }}>
              <div>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Shift</p>
                <p style={{ fontSize: '13px', fontWeight: 500, margin: 0 }}>{staff.shift} ({staff.shiftTime})</p>
              </div>
              <div>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Supervisor</p>
                <p 
                  onClick={() => onNavigateToStaff && onNavigateToStaff(staff.supervisorId, staff.supervisor)}
                  style={{ fontSize: '13px', fontWeight: 500, margin: 0, color: C.purple[600], cursor: 'pointer', display: 'inline-flex', alignItems: 'center', gap: 4 }}
                >
                  {staff.supervisor}
                  <ChevronRight style={{ width: 12, height: 12, color: C.purple[400] }} />
                </p>
              </div>
              <div>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Days Since Incident</p>
                <p style={{ fontSize: '13px', fontWeight: 500, margin: 0, color: C.success[600] }}>{staff.safety?.daysSinceIncident || 412} days</p>
              </div>
              <div>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Clocked In</p>
                <p style={{ fontSize: '13px', fontWeight: 500, margin: 0 }}>{staff.currentShift?.clockedIn || '5:55 AM'}</p>
              </div>
            </div>
          </Card>
        </>
      )}
      
      {/* Performance Tab */}
      {activeTab === 'performance' && (
        <>
          {/* Performance Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Units/Hour', value: staff.performance?.uph?.current || staff.performance?.uph || 0, sub: `Target: ${staff.performance?.uph?.target || staff.performance?.uphTarget || 45}`, good: true },
              { label: 'Efficiency', value: `${staff.performance?.efficiency?.current || staff.performance?.efficiency || 0}%`, sub: `${staff.performance?.directLaborPct || 89}% direct labor`, good: true },
              { label: 'Idle Time', value: `${staff.performance?.idleTime?.current || staff.performance?.idleTime || 0}%`, sub: 'Today', warn: (staff.performance?.idleTime?.current || staff.performance?.idleTime || 0) > 10 },
              { label: 'Rank', value: `#${staff.performance?.ranking || 1}`, sub: `of ${staff.performance?.rankingTotal || 28}`, good: (staff.performance?.ranking || 1) <= 5 }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '20px', fontWeight: 500, color: s.warn ? C.warning[600] : s.good ? C.success[600] : C.neutral[800] }}>{s.value}</p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Productivity Breakdown */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Productivity Breakdown</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.md }}>
              {[
                { metric: 'Pallets Today', value: staff.performance?.palletsToday?.current || staff.performance?.palletsToday || 86, target: 80, max: 120 },
                { metric: 'Pallets This Week', value: staff.performance?.palletsWeek || 412, target: 400, max: 500 },
                { metric: 'Pallets This Month', value: staff.performance?.palletsMonth || 1847, target: 1800, max: 2200 },
                { metric: 'Avg Cycle Time', value: staff.performance?.avgCycleTime || 1.9, target: 2.5, max: 4, unit: 'min', lower: true }
              ].map((m, i) => {
                const pct = m.lower ? Math.max(0, 100 - ((m.value / m.max) * 100)) : (m.value / m.max) * 100;
                const isGood = m.lower ? m.value <= m.target : m.value >= m.target;
                return (
                  <div key={i}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                      <span style={{ fontSize: '13px' }}>{m.metric}</span>
                      <span style={{ fontSize: '13px', fontWeight: 500, color: isGood ? C.success[600] : C.warning[600] }}>
                        {m.value}{m.unit || ''} <span style={{ color: C.neutral[400], fontWeight: 400 }}>/ {m.target}{m.unit || ''}</span>
                      </span>
                    </div>
                    <div style={{ height: 8, background: C.neutral[100], borderRadius: 4, position: 'relative' }}>
                      <div style={{ 
                        position: 'absolute', left: `${(m.target / m.max) * 100}%`, top: -2, bottom: -2,
                        width: 2, background: C.neutral[400]
                      }} />
                      <div style={{ 
                        width: `${Math.min(pct, 100)}%`, height: '100%', 
                        background: isGood ? C.success[500] : C.warning[500], borderRadius: 4 
                      }} />
                    </div>
                  </div>
                );
              })}
            </div>
          </Card>
          
          {/* Performance vs Team */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Performance vs Team Average</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { metric: 'Units Per Hour', yours: staff.performance?.uph?.current || staff.performance?.uph || 52, avg: 42, unit: '' },
                { metric: 'Pick Accuracy', yours: staff.performance?.pickAccuracy?.current || staff.performance?.pickAccuracy || 99.4, avg: 98.5, unit: '%' },
                { metric: 'Efficiency', yours: staff.performance?.efficiency?.current || staff.performance?.efficiency || 94, avg: 88, unit: '%' },
                { metric: 'Idle Time', yours: staff.performance?.idleTime?.current || staff.performance?.idleTime || 6, avg: 12, unit: '%', lower: true }
              ].map((m, i) => {
                const diff = m.yours - m.avg;
                const isBetter = m.lower ? diff < 0 : diff > 0;
                return (
                  <div key={i} style={{ 
                    display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                    padding: sp.sm, background: C.neutral[50], borderRadius: 6
                  }}>
                    <span style={{ fontSize: '13px' }}>{m.metric}</span>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                      <span style={{ fontSize: '13px', fontWeight: 500 }}>{m.yours}{m.unit}</span>
                      <div style={{ 
                        display: 'flex', alignItems: 'center', gap: 2,
                        color: isBetter ? C.success[600] : C.warning[600]
                      }}>
                        {isBetter ? <TrendingUp style={{ width: 14, height: 14 }} /> : <TrendingDown style={{ width: 14, height: 14 }} />}
                        <span style={{ fontSize: '11px' }}>{diff > 0 ? '+' : ''}{diff.toFixed(1)}{m.unit}</span>
                      </div>
                      <span style={{ fontSize: '11px', color: C.neutral[400] }}>avg: {m.avg}{m.unit}</span>
                    </div>
                  </div>
                );
              })}
            </div>
          </Card>
          
          {/* Weekly Trend */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Weekly UPH Trend</h3>
            <div style={{ display: 'flex', gap: sp.xs, alignItems: 'flex-end', height: 80 }}>
              {[
                { day: 'Mon', value: 45 },
                { day: 'Tue', value: 48 },
                { day: 'Wed', value: 44 },
                { day: 'Thu', value: 52 },
                { day: 'Fri', value: 47 },
                { day: 'Sat', value: 0 },
                { day: 'Sun', value: 0 }
              ].map((d, i) => (
                <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                  <div style={{ 
                    width: '70%', 
                    height: d.value > 0 ? Math.max((d.value / 55) * 60, 4) : 4,
                    background: d.value >= staff.performance.uphTarget ? C.success[500] : d.value > 0 ? C.warning[500] : C.neutral[200],
                    borderRadius: '4px 4px 0 0'
                  }} />
                  <span style={{ fontSize: '10px', color: C.neutral[500], marginTop: 4 }}>{d.day}</span>
                </div>
              ))}
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginTop: sp.sm, fontSize: '10px', color: C.neutral[500] }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                <div style={{ width: 10, height: 10, background: C.success[500], borderRadius: 2 }} />
                Above target
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                <div style={{ width: 10, height: 10, background: C.warning[500], borderRadius: 2 }} />
                Below target
              </div>
            </div>
          </Card>
        </>
      )}
      
      {/* Equipment Tab */}
      {activeTab === 'equipment' && (
        <>
          {/* Equipment Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Certified On', value: staff.certifiedEquipment.length, sub: 'Equipment types' },
              { label: 'Total Hours', value: '2,225', sub: 'All equipment' },
              { label: 'Primary', value: 'FL-01', sub: 'Most used' },
              { label: 'Last Eval', value: '8mo', sub: 'Since evaluation' }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '18px', fontWeight: 500 }}>{s.value}</p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Certified Equipment List */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Certified Equipment</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {staff.certifiedEquipment.map((eq, i) => (
                <div 
                  key={i}
                  onClick={() => onNavigateToEquipment && onNavigateToEquipment(eq.id, eq.id.toUpperCase())}
                  style={{ 
                    display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                    padding: sp.md, background: C.neutral[50], borderRadius: 8,
                    cursor: 'pointer', transition: 'all 0.15s'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = 'white';
                    e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = C.neutral[50];
                    e.currentTarget.style.boxShadow = 'none';
                  }}
                >
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                    <div style={{ 
                      width: 40, height: 40, borderRadius: 8, 
                      background: C.brand[50], 
                      display: 'flex', alignItems: 'center', justifyContent: 'center' 
                    }}>
                      <Truck style={{ width: 20, height: 20, color: C.brand[600] }} />
                    </div>
                    <div>
                      <p style={{ fontSize: '14px', fontWeight: 500 }}>{eq.type}</p>
                      <p style={{ fontSize: '12px', color: C.neutral[500] }}>{eq.id.toUpperCase()} • {eq.hours} hrs</p>
                    </div>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                    <div style={{ textAlign: 'right' }}>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>Cert expires</p>
                      <p style={{ fontSize: '12px', fontWeight: 500 }}>{eq.expiry}</p>
                    </div>
                    <Badge status={eq.status === 'Active' ? 'success' : 'warning'} label={eq.status} />
                    <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
                  </div>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Hours by Equipment Type */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Hours by Equipment Type</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { type: 'Sit-Down Forklift', hours: 1620, pct: 73, color: C.brand[500] },
                { type: 'Reach Truck', hours: 520, pct: 23, color: C.purple[500] },
                { type: 'Order Picker', hours: 85, pct: 4, color: C.warning[500] }
              ].map((eq, i) => (
                <div key={i}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                    <span style={{ fontSize: '12px' }}>{eq.type}</span>
                    <span style={{ fontSize: '12px', color: C.neutral[600] }}>{eq.hours} hrs ({eq.pct}%)</span>
                  </div>
                  <div style={{ height: 6, background: C.neutral[100], borderRadius: 3 }}>
                    <div style={{ width: `${eq.pct}%`, height: '100%', background: eq.color, borderRadius: 3 }} />
                  </div>
                </div>
              ))}
            </div>
          </Card>
        </>
      )}
      
      {/* Schedule Tab */}
      {activeTab === 'schedule' && (
        <>
          {/* Schedule Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Current Shift', value: staff.shift || 'Day Shift', sub: staff.shiftTime || '6:00 AM - 2:00 PM' },
              { label: 'Hours This Week', value: staff.schedule?.weeklyHours?.current || '20.3', sub: `of ${staff.schedule?.weeklyHours?.target || 40} scheduled` },
              { label: 'Overtime', value: `${staff.schedule?.overtimeHours || 0.2}`, unit: 'hrs', sub: `Limit: ${staff.schedule?.overtimeLimit || 10}`, warn: (staff.schedule?.overtimeHours || 0) > (staff.schedule?.overtimeLimit || 10) * 0.8 },
              { label: 'PTO Balance', value: staff.attendance?.ptoBalance || 14, sub: 'days available' }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '18px', fontWeight: 500, color: s.warn ? C.warning[600] : C.neutral[800] }}>
                  {s.value}{s.unit && <span style={{ fontSize: '12px', color: C.neutral[500] }}>{s.unit}</span>}
                </p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Weekly Schedule */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>This Week</h3>
            <div style={{ display: 'flex', gap: sp.xs }}>
              {(staff.schedule?.currentWeek || [
                { day: 'Mon', date: 'Dec 16', shift: 'Day', time: '6AM-2PM', status: 'worked', hours: 8.2 },
                { day: 'Tue', date: 'Dec 17', shift: 'Day', time: '6AM-2PM', status: 'worked', hours: 8.0 },
                { day: 'Wed', date: 'Dec 18', shift: 'Day', time: '6AM-2PM', status: 'current', hours: 4.1 },
                { day: 'Thu', date: 'Dec 19', shift: 'Day', time: '6AM-2PM', status: 'scheduled' },
                { day: 'Fri', date: 'Dec 20', shift: 'Day', time: '6AM-2PM', status: 'scheduled' },
                { day: 'Sat', date: 'Dec 21', shift: 'Off', time: '-', status: 'off' },
                { day: 'Sun', date: 'Dec 22', shift: 'Off', time: '-', status: 'off' }
              ]).map((day, i) => (
                <div key={i} style={{ 
                  flex: 1, padding: sp.sm, 
                  background: day.status === 'current' ? C.brand[50] : day.status === 'off' ? C.neutral[50] : 'white',
                  border: `1px solid ${day.status === 'current' ? C.brand[300] : C.neutral[200]}`,
                  borderRadius: 8,
                  textAlign: 'center'
                }}>
                  <p style={{ fontSize: '11px', fontWeight: 500, color: day.status === 'current' ? C.brand[600] : C.neutral[600] }}>{day.day}</p>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>{day.date}</p>
                  <div style={{ marginTop: sp.sm }}>
                    {day.status !== 'off' ? (
                      <>
                        <p style={{ fontSize: '12px', fontWeight: 500 }}>{day.shift}</p>
                        <p style={{ fontSize: '10px', color: C.neutral[500] }}>{day.time}</p>
                      </>
                    ) : (
                      <p style={{ fontSize: '12px', color: C.neutral[400] }}>Off</p>
                    )}
                  </div>
                  {day.status === 'current' && (
                    <Badge status="info" label="Today" style={{ marginTop: sp.xs }} />
                  )}
                </div>
              ))}
            </div>
          </Card>
          
          {/* Upcoming Time Off */}
          {staff.schedule?.upcomingTimeOff && (
            <Card>
              <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Upcoming Time Off</h3>
              <div style={{ 
                display: 'flex', alignItems: 'center', gap: sp.md,
                padding: sp.md, background: C.success[50], borderRadius: 8,
                borderLeft: `3px solid ${C.success[500]}`
              }}>
                <Calendar style={{ width: 24, height: 24, color: C.success[600] }} />
                <div>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>{staff.schedule.upcomingTimeOff.type}</p>
                  <p style={{ fontSize: '12px', color: C.neutral[600] }}>
                    {staff.schedule.upcomingTimeOff.start} — {staff.schedule.upcomingTimeOff.end}
                  </p>
                </div>
                <Badge status="success" label="Approved" />
              </div>
            </Card>
          )}
          
          {/* Shift Preferences */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Availability & Preferences</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.md }}>
              <div style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Preferred Shift</p>
                <p style={{ fontSize: '13px', fontWeight: 500 }}>Day Shift (6AM - 2PM)</p>
              </div>
              <div style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Overtime Preference</p>
                <p style={{ fontSize: '13px', fontWeight: 500 }}>Available when needed</p>
              </div>
              <div style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Weekend Availability</p>
                <p style={{ fontSize: '13px', fontWeight: 500 }}>Every other Saturday</p>
              </div>
              <div style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Zone Preference</p>
                <p style={{ fontSize: '13px', fontWeight: 500 }}>Bulk Storage, Inbound</p>
              </div>
            </div>
          </Card>
        </>
      )}
      
      {/* Certifications Tab */}
      {activeTab === 'certifications' && (
        <>
          {/* Cert Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Active Certs', value: (staff.certifications || []).filter(c => c.status === 'active').length, sub: 'Current', good: true },
              { label: 'Expiring Soon', value: (staff.certifications || []).filter(c => c.status === 'expiring').length, sub: 'Next 60 days', warn: (staff.certifications || []).filter(c => c.status === 'expiring').length > 0 },
              { label: 'Trainings', value: (staff.trainingHistory || []).length, sub: 'Completed' },
              { label: 'Avg Score', value: '94%', sub: 'Training scores', good: true }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '20px', fontWeight: 500, color: s.warn ? C.warning[600] : s.good ? C.success[600] : C.neutral[800] }}>{s.value}</p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Active Certifications */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Certifications</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {(staff.certifications || []).map((cert, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.md,
                  background: cert.status === 'expiring' ? C.warning[50] : C.neutral[50],
                  borderRadius: 8,
                  borderLeft: `4px solid ${cert.status === 'expiring' ? C.warning[500] : C.success[500]}`
                }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                    <div style={{ 
                      width: 40, height: 40, borderRadius: 8, 
                      background: cert.status === 'expiring' ? C.warning[100] : C.success[100], 
                      display: 'flex', alignItems: 'center', justifyContent: 'center' 
                    }}>
                      <ClipboardList style={{ width: 20, height: 20, color: cert.status === 'expiring' ? C.warning[600] : C.success[600] }} />
                    </div>
                    <div>
                      <p style={{ fontSize: '14px', fontWeight: 500 }}>{cert.name}</p>
                      <p style={{ fontSize: '12px', color: C.neutral[500] }}>Issued by {cert.issuer} • {cert.issued}</p>
                    </div>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                    <div style={{ textAlign: 'right' }}>
                      <p style={{ fontSize: '11px', color: C.neutral[500] }}>Expires</p>
                      <p style={{ fontSize: '12px', fontWeight: 500, color: cert.status === 'expiring' ? C.warning[600] : C.neutral[700] }}>{cert.expiry}</p>
                    </div>
                    <Badge status={cert.status === 'expiring' ? 'warning' : 'success'} label={cert.status === 'expiring' ? 'Expiring' : 'Active'} />
                  </div>
                </div>
              ))}
              {(!staff.certifications || staff.certifications.length === 0) && (
                <p style={{ fontSize: '13px', color: C.neutral[500], textAlign: 'center', padding: sp.md }}>No certifications on file</p>
              )}
            </div>
          </Card>
          
          {/* Training History */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Training History</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
              {(staff.trainingHistory || []).map((t, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.sm, background: C.neutral[50], borderRadius: 6
                }}>
                  <div>
                    <p style={{ fontSize: '13px', fontWeight: 500 }}>{t.course}</p>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>{t.date}</p>
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <span style={{ fontSize: '14px', fontWeight: 600, color: t.score >= 90 ? C.success[600] : C.warning[600] }}>{t.score}%</span>
                    <Badge status={t.status === 'passed' ? 'success' : 'error'} label={t.status} />
                  </div>
                </div>
              ))}
              {(!staff.trainingHistory || staff.trainingHistory.length === 0) && (
                <p style={{ fontSize: '13px', color: C.neutral[500], textAlign: 'center', padding: sp.md }}>No training history on file</p>
              )}
            </div>
          </Card>
        </>
      )}
      
      {/* Safety Tab */}
      {activeTab === 'safety' && (
        <>
          {/* Safety Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Days Safe', value: staff.safety?.daysSinceIncident || 412, sub: 'Since last incident', good: true },
              { label: 'Safety Score', value: `${staff.safety?.safetyScore?.current || staff.safety?.safetyScore || 98}%`, sub: 'Composite score', good: (staff.safety?.safetyScore?.current || staff.safety?.safetyScore || 98) >= 90 },
              { label: 'Near-Miss Reports', value: staff.safety?.nearMissReports || 3, sub: 'Submitted', good: true },
              { label: 'Total Incidents', value: staff.safety?.totalIncidents || 0, sub: 'All time', warn: (staff.safety?.totalIncidents || 0) > 0 }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '20px', fontWeight: 500, color: s.warn ? C.warning[600] : s.good ? C.success[600] : C.neutral[800] }}>{s.value}</p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Safety Streak */}
          <Card style={{ background: C.success[50], borderLeft: `4px solid ${C.success[500]}` }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.lg }}>
              <div style={{ 
                width: 64, height: 64, borderRadius: '50%', 
                background: C.success[100], 
                display: 'flex', alignItems: 'center', justifyContent: 'center',
                border: `3px solid ${C.success[500]}`
              }}>
                <CheckCircle style={{ width: 32, height: 32, color: C.success[600] }} />
              </div>
              <div>
                <p style={{ fontSize: '28px', fontWeight: 300, color: C.success[700] }}>{staff.safety?.daysSinceIncident || 412} Days</p>
                <p style={{ fontSize: '14px', color: C.success[600] }}>Without a recordable incident</p>
                {staff.safety?.streak && <p style={{ fontSize: '12px', color: C.success[500], marginTop: 4 }}>{staff.safety.streak}</p>}
              </div>
            </div>
          </Card>
          
          {/* Safety Contributions */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Safety Contributions</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.md }}>
              <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8 }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.sm }}>
                  <AlertTriangle style={{ width: 20, height: 20, color: C.warning[500] }} />
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>Near-Miss Reports</p>
                </div>
                <p style={{ fontSize: '28px', fontWeight: 300 }}>{staff.safety?.nearMissReports || 3}</p>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Proactive hazard identification</p>
              </div>
              <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8 }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.sm }}>
                  <Eye style={{ width: 20, height: 20, color: C.brand[500] }} />
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>Safety Observations</p>
                </div>
                <p style={{ fontSize: '28px', fontWeight: 300 }}>{staff.safety?.safetyObservations || 18}</p>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Positive behaviors noted</p>
              </div>
            </div>
          </Card>
          
          {/* Incident History */}
          {staff.safety?.lastIncident && (
            <Card>
              <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Incident History</h3>
              <div style={{ 
                padding: sp.md, background: C.neutral[50], borderRadius: 8,
                borderLeft: `4px solid ${C.warning[500]}`
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                  <div>
                    <p style={{ fontSize: '14px', fontWeight: 500 }}>{staff.safety.lastIncident.type}</p>
                    <p style={{ fontSize: '12px', color: C.neutral[500] }}>{staff.safety.lastIncident.date}</p>
                  </div>
                  <Badge status="neutral" label="Resolved" />
                </div>
                <p style={{ fontSize: '13px', color: C.neutral[600], marginTop: sp.sm }}>{staff.safety.lastIncident.description}</p>
                <p style={{ fontSize: '12px', color: C.success[600], marginTop: sp.xs }}>Resolution: {staff.safety.lastIncident.resolution}</p>
              </div>
            </Card>
          )}
        </>
      )}
      
      {/* Attendance Tab */}
      {activeTab === 'attendance' && (
        <>
          {/* Attendance Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Attendance Rate', value: `${staff.attendance?.rate || 98.6}%`, sub: 'This year', good: (staff.attendance?.rate || 98.6) >= 95 },
              { label: 'Punctuality', value: `${staff.attendance?.punctuality || 99.2}%`, sub: 'On-time arrivals', good: (staff.attendance?.punctuality || 99.2) >= 95 },
              { label: 'Late Arrivals', value: staff.attendance?.lateArrivals || 2, sub: 'This year', warn: (staff.attendance?.lateArrivals || 2) > 5 },
              { label: 'Unplanned Absences', value: staff.attendance?.unplannedAbsences || 1, sub: 'This year', warn: (staff.attendance?.unplannedAbsences || 1) > 3 }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '20px', fontWeight: 500, color: s.warn ? C.warning[600] : s.good ? C.success[600] : C.neutral[800] }}>{s.value}</p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* Leave Balances */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Leave Balances</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
              <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                <p style={{ fontSize: '28px', fontWeight: 300, color: C.brand[600] }}>{staff.attendance?.ptoBalance || 14}</p>
                <p style={{ fontSize: '12px', color: C.neutral[500] }}>PTO Available</p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{staff.attendance?.ptoUsed || 6} used this year</p>
              </div>
              <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                <p style={{ fontSize: '28px', fontWeight: 300 }}>{staff.attendance?.sickDaysUsed || 2}</p>
                <p style={{ fontSize: '12px', color: C.neutral[500] }}>Sick Days Used</p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>This year</p>
              </div>
              <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                <p style={{ fontSize: '28px', fontWeight: 300 }}>{staff.attendance?.daysWorked || 217}</p>
                <p style={{ fontSize: '12px', color: C.neutral[500] }}>Days Worked</p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>of {staff.attendance?.scheduledDays || 220} scheduled</p>
              </div>
            </div>
          </Card>
          
          {/* Attendance Trend */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Monthly Attendance</h3>
            <div style={{ display: 'flex', gap: sp.xs, alignItems: 'flex-end', height: 80 }}>
              {[
                { month: 'Jul', rate: 100 },
                { month: 'Aug', rate: 95 },
                { month: 'Sep', rate: 100 },
                { month: 'Oct', rate: 98 },
                { month: 'Nov', rate: 95 },
                { month: 'Dec', rate: 100 }
              ].map((m, i) => (
                <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                  <div style={{ 
                    width: '70%', 
                    height: Math.max((m.rate / 100) * 60, 4),
                    background: m.rate >= 98 ? C.success[500] : m.rate >= 95 ? C.warning[500] : C.error[500],
                    borderRadius: '4px 4px 0 0'
                  }} />
                  <span style={{ fontSize: '10px', color: C.neutral[500], marginTop: 4 }}>{m.month}</span>
                </div>
              ))}
            </div>
          </Card>
        </>
      )}
      
      {/* History Tab */}
      {activeTab === 'history' && (
        <>
          {/* Today's Activity */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Today's Activity</h3>
            <div style={{ position: 'relative', paddingLeft: sp.lg }}>
              <div style={{ position: 'absolute', left: 6, top: 8, bottom: 8, width: 2, background: C.neutral[200] }} />
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                {(staff.activityHistory || [
                  { time: '10:15 AM', action: 'Completed putaway', details: 'Bulk Storage, Row 12', type: 'work' },
                  { time: '10:02 AM', action: 'Picked up load', details: 'Dock 2, 3 pallets', type: 'work' },
                  { time: '09:45 AM', action: 'Completed putaway', details: 'Bulk Storage, Row 8', type: 'work' },
                  { time: '08:45 AM', action: 'Break ended', details: '15 min break', type: 'break' },
                  { time: '08:30 AM', action: 'Break started', details: 'Scheduled break', type: 'break' },
                  { time: '08:15 AM', action: 'Completed putaway', details: 'Bulk Storage, Row 4', type: 'work' },
                  { time: '07:30 AM', action: 'Zone assignment', details: 'Assigned to Z04 - Bulk Storage', type: 'location' },
                  { time: '05:55 AM', action: 'Clocked in', details: 'On time', type: 'clock' }
                ]).map((activity, i) => (
                  <div key={i} style={{ display: 'flex', alignItems: 'flex-start', gap: sp.sm, position: 'relative' }}>
                    <div style={{ 
                      position: 'absolute', left: -20,
                      width: 12, height: 12, borderRadius: '50%', 
                      background: activity.type === 'work' ? C.success[500] : activity.type === 'clock' ? C.brand[500] : activity.type === 'break' ? C.warning[500] : C.neutral[400],
                      border: '2px solid white', zIndex: 1
                    }} />
                    <div style={{ 
                      flex: 1, padding: sp.sm, 
                      background: i === 0 ? C.brand[50] : C.neutral[50], 
                      borderRadius: 6 
                    }}>
                      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                        <p style={{ fontSize: '13px', fontWeight: 500 }}>{activity.action}</p>
                        <span style={{ fontSize: '11px', color: C.neutral[500] }}>{activity.time}</span>
                      </div>
                      <p style={{ fontSize: '12px', color: C.neutral[500] }}>{activity.details}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </Card>
          
          {/* Career History */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Career History</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { date: 'Mar 2021', event: 'Hired', role: 'Warehouse Associate', details: 'Started in receiving department' },
                { date: 'Sep 2021', event: 'Certification', role: 'Forklift Operator', details: 'Completed OSHA forklift training' },
                { date: 'Jan 2022', event: 'Promotion', role: 'Forklift Operator I', details: 'Moved to primary operator role' },
                { date: 'Jun 2023', event: 'Certification', role: 'Reach Truck', details: 'Added reach truck certification' },
                { date: 'Jan 2024', event: 'Recognition', role: 'Safety Award', details: 'Q4 2023 Safety Champion' }
              ].map((h, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', gap: sp.md,
                  padding: sp.sm, background: C.neutral[50], borderRadius: 6
                }}>
                  <span style={{ fontSize: '11px', color: C.neutral[500], minWidth: 60 }}>{h.date}</span>
                  <Badge status={h.event === 'Promotion' ? 'success' : h.event === 'Recognition' ? 'info' : 'neutral'} label={h.event} />
                  <div style={{ flex: 1 }}>
                    <p style={{ fontSize: '13px', fontWeight: 500 }}>{h.role}</p>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>{h.details}</p>
                  </div>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Performance Trend */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>6-Month Performance Trend</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { metric: 'UPH Average', values: [42, 44, 45, 46, 47, 47], trend: 'up' },
                { metric: 'Accuracy', values: [98.5, 98.8, 99.0, 99.1, 99.2, 99.2], trend: 'up', unit: '%' },
                { metric: 'Safety Score', values: [90, 92, 93, 94, 94, 94], trend: 'stable', unit: '%' }
              ].map((m, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.sm, background: C.neutral[50], borderRadius: 6
                }}>
                  <span style={{ fontSize: '13px', minWidth: 100 }}>{m.metric}</span>
                  <div style={{ display: 'flex', gap: 2 }}>
                    {m.values.map((v, j) => (
                      <div key={j} style={{ 
                        width: 24, height: 24, borderRadius: 4,
                        background: j === m.values.length - 1 ? C.brand[500] : C.neutral[200],
                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                        fontSize: '8px', color: j === m.values.length - 1 ? 'white' : C.neutral[600]
                      }}>
                        {v}
                      </div>
                    ))}
                  </div>
                  <div style={{ display: 'flex', alignItems: 'center', gap: 4, color: m.trend === 'up' ? C.success[600] : C.neutral[500] }}>
                    {m.trend === 'up' && <TrendingUp style={{ width: 14, height: 14 }} />}
                    <span style={{ fontSize: '12px', fontWeight: 500 }}>{m.values[m.values.length - 1]}{m.unit || ''}</span>
                  </div>
                </div>
              ))}
            </div>
          </Card>
        </>
      )}
      
      {/* Insights Tab */}
      {activeTab === 'insights' && (
        <>
          {/* Insights Summary */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
            {[
              { label: 'Performance Trend', value: 'Rising', sub: 'Last 90 days', good: true },
              { label: 'Anomalies', value: 1, sub: 'Detected this month' },
              { label: 'Recommendations', value: 3, sub: 'Available' },
              { label: 'Potential', value: 'High', sub: 'Growth indicator', good: true }
            ].map((s, i) => (
              <Card key={i}>
                <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{s.label}</p>
                <p style={{ fontSize: '18px', fontWeight: 500, color: s.good ? C.success[600] : C.neutral[800] }}>{s.value}</p>
                <p style={{ fontSize: '10px', color: C.neutral[400] }}>{s.sub}</p>
              </Card>
            ))}
          </div>
          
          {/* AI Recommendations */}
          <Card>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
              <Lightbulb style={{ width: 18, height: 18, color: C.warning[500] }} />
              <h3 style={{ fontSize: '14px', fontWeight: 500 }}>AI Recommendations</h3>
            </div>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { 
                  title: 'Cross-train on Reach Truck',
                  desc: 'Strong forklift performance suggests quick adaptation. Would increase scheduling flexibility by 23%.',
                  impact: 'High',
                  type: 'development'
                },
                { 
                  title: 'Candidate for Lead Role',
                  desc: 'Top 15% performer with strong safety record. Consider for team lead when position opens.',
                  impact: 'Medium',
                  type: 'career'
                },
                { 
                  title: 'Optimal Zone Assignment',
                  desc: 'Performance data suggests highest productivity in Bulk Storage. Consider primary assignment.',
                  impact: 'Medium',
                  type: 'assignment'
                }
              ].map((rec, i) => (
                <div key={i} style={{ 
                  padding: sp.md, background: C.neutral[50], borderRadius: 8,
                  borderLeft: `4px solid ${rec.impact === 'High' ? C.success[500] : C.brand[500]}`,
                  cursor: 'pointer', transition: 'all 0.15s'
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.background = 'white';
                  e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.background = C.neutral[50];
                  e.currentTarget.style.boxShadow = 'none';
                }}
                >
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                    <p style={{ fontSize: '14px', fontWeight: 500 }}>{rec.title}</p>
                    <Badge status={rec.impact === 'High' ? 'success' : 'info'} label={`${rec.impact} Impact`} />
                  </div>
                  <p style={{ fontSize: '12px', color: C.neutral[600] }}>{rec.desc}</p>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Performance Anomalies */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Detected Patterns</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              <div style={{ 
                padding: sp.md, background: C.warning[50], borderRadius: 8,
                borderLeft: `4px solid ${C.warning[500]}`
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>Monday productivity dip</p>
                  <span style={{ fontSize: '11px', color: C.neutral[500] }}>Pattern detected</span>
                </div>
                <p style={{ fontSize: '12px', color: C.neutral[600], marginBottom: sp.sm }}>
                  UPH averages 12% lower on Mondays compared to other days. Consider adjusted scheduling or warm-up tasks.
                </p>
                <div style={{ 
                  padding: sp.sm, background: 'white', borderRadius: 6,
                  display: 'flex', alignItems: 'center', gap: sp.sm
                }}>
                  <Lightbulb style={{ width: 14, height: 14, color: C.warning[500] }} />
                  <span style={{ fontSize: '11px', color: C.neutral[700] }}>Suggestion: Start with simpler tasks on Monday mornings</span>
                </div>
              </div>
              
              <div style={{ 
                padding: sp.md, background: C.success[50], borderRadius: 8,
                borderLeft: `4px solid ${C.success[500]}`
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>Peak performance hours identified</p>
                  <span style={{ fontSize: '11px', color: C.neutral[500] }}>Positive pattern</span>
                </div>
                <p style={{ fontSize: '12px', color: C.neutral[600] }}>
                  Highest productivity between 8-11 AM. Consider assigning priority tasks during this window.
                </p>
              </div>
            </div>
          </Card>
          
          {/* What-If Scenarios */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>What-If Scenarios</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { scenario: 'Assign to Bulk Storage full-time', impact: '+8% productivity', direction: 'up' },
                { scenario: 'Add reach truck to certifications', impact: '+15% flexibility', direction: 'up' },
                { scenario: 'Move to swing shift', impact: '-5% productivity', direction: 'down' }
              ].map((s, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.sm, background: C.neutral[50], borderRadius: 6
                }}>
                  <span style={{ fontSize: '13px' }}>{s.scenario}</span>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, color: s.direction === 'up' ? C.success[600] : C.warning[600] }}>
                    {s.direction === 'up' ? <TrendingUp style={{ width: 14, height: 14 }} /> : <TrendingDown style={{ width: 14, height: 14 }} />}
                    <span style={{ fontSize: '12px', fontWeight: 500 }}>{s.impact}</span>
                  </div>
                </div>
              ))}
            </div>
          </Card>
        </>
      )}
      
      {/* Config Tab */}
      {activeTab === 'config' && (
        <>
          {/* Employee Information */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Employee Information</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.md }}>
              {[
                { label: 'Employee ID', value: staff.id },
                { label: 'Full Name', value: staff.name },
                { label: 'Role', value: staff.role },
                { label: 'Department', value: staff.department },
                { label: 'Hire Date', value: staff.hireDate },
                { label: 'Status', value: staff.status },
                { label: 'Phone', value: staff.phone },
                { label: 'Email', value: staff.email }
              ].map((field, i) => (
                <div key={i} style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                  <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>{field.label}</p>
                  <p style={{ fontSize: '13px', fontWeight: 500 }}>{field.value}</p>
                </div>
              ))}
            </div>
          </Card>
          
          {/* Reporting Structure */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Reporting Structure</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              <div 
                onClick={() => onNavigateToStaff && onNavigateToStaff(staff.supervisorId, staff.supervisor)}
                style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.md, background: C.neutral[50], borderRadius: 8,
                  cursor: 'pointer', transition: 'all 0.15s'
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.background = 'white';
                  e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)';
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.background = C.neutral[50];
                  e.currentTarget.style.boxShadow = 'none';
                }}
              >
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                  <div style={{ 
                    width: 40, height: 40, borderRadius: '50%', 
                    background: C.purple[100], 
                    display: 'flex', alignItems: 'center', justifyContent: 'center' 
                  }}>
                    <Users style={{ width: 20, height: 20, color: C.purple[600] }} />
                  </div>
                  <div>
                    <p style={{ fontSize: '14px', fontWeight: 500 }}>{staff.supervisor}</p>
                    <p style={{ fontSize: '12px', color: C.neutral[500] }}>Direct Supervisor</p>
                  </div>
                </div>
                <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
              </div>
            </div>
          </Card>
          
          {/* Work Preferences */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Work Preferences</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { label: 'Preferred Shift', value: 'Day Shift (6AM - 2PM)', editable: true },
                { label: 'Overtime Availability', value: 'Available when needed', editable: true },
                { label: 'Weekend Availability', value: 'Every other Saturday', editable: true },
                { label: 'Zone Preferences', value: 'Bulk Storage, Inbound Docks', editable: true },
                { label: 'Equipment Preferences', value: 'Sit-Down Forklift', editable: true }
              ].map((pref, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.sm, background: C.neutral[50], borderRadius: 6
                }}>
                  <div>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>{pref.label}</p>
                    <p style={{ fontSize: '13px', fontWeight: 500 }}>{pref.value}</p>
                  </div>
                  {pref.editable && (
                    <Settings style={{ width: 14, height: 14, color: C.neutral[400], cursor: 'pointer' }} />
                  )}
                </div>
              ))}
            </div>
          </Card>
          
          {/* Notification Settings */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Notification Settings</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {[
                { label: 'Schedule Changes', enabled: true },
                { label: 'Certification Reminders', enabled: true },
                { label: 'Performance Alerts', enabled: true },
                { label: 'Safety Notifications', enabled: true },
                { label: 'Training Assignments', enabled: false }
              ].map((notif, i) => (
                <div key={i} style={{ 
                  display: 'flex', alignItems: 'center', justifyContent: 'space-between',
                  padding: sp.sm, background: C.neutral[50], borderRadius: 6
                }}>
                  <span style={{ fontSize: '13px' }}>{notif.label}</span>
                  <div style={{ 
                    width: 40, height: 22, borderRadius: 11,
                    background: notif.enabled ? C.success[500] : C.neutral[300],
                    padding: 2, cursor: 'pointer', transition: 'background 0.2s'
                  }}>
                    <div style={{ 
                      width: 18, height: 18, borderRadius: '50%', background: 'white',
                      transform: notif.enabled ? 'translateX(18px)' : 'translateX(0)',
                      transition: 'transform 0.2s',
                      boxShadow: '0 1px 3px rgba(0,0,0,0.2)'
                    }} />
                  </div>
                </div>
              ))}
            </div>
          </Card>
          
          {/* System Info */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>System Information</h3>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.md }}>
              <div style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                <p style={{ fontSize: '10px', color: C.neutral[500] }}>Last Login</p>
                <p style={{ fontSize: '12px' }}>Today, 5:55 AM</p>
              </div>
              <div style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                <p style={{ fontSize: '10px', color: C.neutral[500] }}>Badge ID</p>
                <p style={{ fontSize: '12px' }}>WH-2024-1247</p>
              </div>
              <div style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                <p style={{ fontSize: '10px', color: C.neutral[500] }}>Access Level</p>
                <p style={{ fontSize: '12px' }}>Standard Operator</p>
              </div>
              <div style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6 }}>
                <p style={{ fontSize: '10px', color: C.neutral[500] }}>Profile Updated</p>
                <p style={{ fontSize: '12px' }}>Dec 10, 2024</p>
              </div>
            </div>
          </Card>
        </>
      )}
    </>
  );
};

const ZoneDetailContent = ({ zoneId, activeTab, onNavigateToStaff, onNavigateToZone, onNavigateToEquipment, onNavigateToAlert }) => {
  return (
    <Card>
      <div style={{ padding: sp.xl, textAlign: 'center' }}>
        <MapPin style={{ width: 48, height: 48, color: C.brand[400], marginBottom: sp.md }} />
        <h3 style={{ fontSize: '16px', fontWeight: 500, marginBottom: sp.sm }}>Zone Detail: {zoneId}</h3>
        <p style={{ fontSize: '13px', color: C.neutral[500] }}>Zone detail view coming soon</p>
        <p style={{ fontSize: '12px', color: C.neutral[400], marginTop: sp.sm }}>Current tab: {activeTab}</p>
      </div>
    </Card>
  );
};

// ===== PREDICTIVE TIMELINE CHART =====
const PredictiveTimeline = ({ data, height = 120, yLabel, target, warning, critical, showConfidence = true, contextualTime }) => {
  const nowIndex = data.findIndex(d => d.now);
  const legendHeight = 24;
  
  // Calculate contextual time position if provided
  const getContextualPosition = () => {
    if (!contextualTime || !data || data.length < 2) return null;
    
    const times = data.map(d => {
      const [h, m] = d.time.split(':').map(Number);
      return h + m / 60;
    });
    const [ctxH, ctxM] = contextualTime.split(':').map(Number);
    const ctxDecimal = ctxH + ctxM / 60;
    
    const minTime = Math.min(...times);
    const maxTime = Math.max(...times);
    
    if (ctxDecimal < minTime || ctxDecimal > maxTime) return null;
    
    // Find position as percentage
    const position = ((ctxDecimal - minTime) / (maxTime - minTime)) * 100;
    
    // Check if contextual is same as now
    const nowTime = data[nowIndex]?.time;
    if (nowTime === contextualTime) return null;
    
    return position;
  };
  
  const contextualPosition = getContextualPosition();
  
  return (
    <div style={{ position: 'relative' }}>
      <div style={{ position: 'relative', height }}>
        <ResponsiveContainer width="100%" height="100%">
          <AreaChart data={data} margin={{ top: 10, right: 10, left: 0, bottom: 5 }}>
            <defs>
              <linearGradient id="confBand" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={C.purple[500]} stopOpacity={0.3} />
                <stop offset="100%" stopColor={C.purple[500]} stopOpacity={0.05} />
              </linearGradient>
              <linearGradient id="actualFill" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={C.brand[500]} stopOpacity={0.2} />
                <stop offset="100%" stopColor={C.brand[500]} stopOpacity={0} />
              </linearGradient>
            </defs>
            <XAxis dataKey="time" tick={{ fontSize: 10, fill: C.neutral[500] }} axisLine={{ stroke: C.neutral[200] }} tickLine={false} />
            <YAxis tick={{ fontSize: 10, fill: C.neutral[500] }} axisLine={false} tickLine={false} width={30} domain={['auto', 'auto']} />
            {critical && <Area type="monotone" dataKey={() => critical} stroke="none" fill={C.error[100]} fillOpacity={0.5} />}
            {warning && <Area type="monotone" dataKey={() => warning} stroke="none" fill={C.warning[100]} fillOpacity={0.3} />}
            {showConfidence && <Area type="monotone" dataKey="upper" stroke="none" fill="url(#confBand)" />}
            {showConfidence && <Area type="monotone" dataKey="lower" stroke="none" fill="url(#confBand)" />}
            <Area type="monotone" dataKey="actual" stroke={C.brand[500]} strokeWidth={2} fill="url(#actualFill)" dot={false} />
            <Area type="monotone" dataKey="predicted" stroke={C.purple[500]} strokeWidth={2} strokeDasharray="6 3" fill="none" dot={false} />
            {target && <Area type="monotone" dataKey={() => target} stroke={C.success[500]} strokeWidth={1} strokeDasharray="4 4" fill="none" />}
          </AreaChart>
        </ResponsiveContainer>
        {/* NOW marker */}
        {nowIndex >= 0 && (
          <div style={{ position: 'absolute', top: 10, bottom: 5, left: `${(nowIndex / (data.length - 1)) * 100}%`, width: 2, background: C.neutral[900], zIndex: 10 }}>
            <div style={{ position: 'absolute', top: -8, left: '50%', transform: 'translateX(-50%)', background: C.neutral[900], color: 'white', padding: '2px 6px', borderRadius: 3, fontSize: 9, fontWeight: 600 }}>NOW</div>
          </div>
        )}
        {/* CONTEXTUAL TIME marker */}
        {contextualPosition !== null && (
          <div style={{ position: 'absolute', top: 10, bottom: 5, left: `${contextualPosition}%`, width: 3, background: C.brand[500], zIndex: 15, borderRadius: 1, boxShadow: `0 0 8px ${C.brand[500]}60` }}>
            <div style={{ position: 'absolute', top: -8, left: '50%', transform: 'translateX(-50%)', background: C.brand[500], color: 'white', padding: '2px 6px', borderRadius: 3, fontSize: 9, fontWeight: 600, whiteSpace: 'nowrap' }}>{contextualTime}</div>
          </div>
        )}
      </div>
      {/* Legend - Bottom */}
      <div style={{ display: 'flex', justifyContent: 'center', gap: sp.lg, paddingTop: sp.sm, borderTop: `1px solid ${C.neutral[100]}`, marginTop: sp.sm }}>
        <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
          <span style={{ width: 20, height: 3, background: C.brand[500], borderRadius: 2 }} />
          Actual
        </span>
        <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
          <span style={{ width: 20, height: 0, borderTop: `3px dashed ${C.purple[500]}` }} />
          Predicted
        </span>
        {showConfidence && (
          <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
            <span style={{ width: 20, height: 10, background: `linear-gradient(180deg, ${C.purple[500]}40 0%, ${C.purple[500]}10 100%)`, borderRadius: 2 }} />
            Confidence
          </span>
        )}
        {target && (
          <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
            <span style={{ width: 20, height: 0, borderTop: `2px dashed ${C.success[500]}` }} />
            Target
          </span>
        )}
        {warning && (
          <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
            <span style={{ width: 20, height: 10, background: C.warning[100], borderRadius: 2 }} />
            Warning
          </span>
        )}
        {critical && (
          <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
            <span style={{ width: 20, height: 10, background: C.error[100], borderRadius: 2 }} />
            Critical
          </span>
        )}
      </div>
    </div>
  );
};

// ===== SCENARIO COMPARISON TIMELINE =====
// Shows baseline (gray) vs scenario (purple) with shaded delta region
const ScenarioPredictiveTimeline = ({ data, scenarioData, height = 140, target, contextualTime }) => {
  const nowIndex = data.findIndex(d => d.now);
  
  // Merge data for chart - combine baseline and scenario predictions
  const mergedData = data.map((d, i) => ({
    ...d,
    scenarioPredicted: scenarioData[i]?.predicted || null,
    scenarioUpper: scenarioData[i]?.upper || null,
    scenarioLower: scenarioData[i]?.lower || null
  }));
  
  // Calculate contextual time position
  const getContextualPosition = () => {
    if (!contextualTime || !data || data.length < 2) return null;
    const times = data.map(d => {
      const [h, m] = d.time.split(':').map(Number);
      return h + m / 60;
    });
    const [ctxH, ctxM] = contextualTime.split(':').map(Number);
    const ctxDecimal = ctxH + ctxM / 60;
    const minTime = Math.min(...times);
    const maxTime = Math.max(...times);
    if (ctxDecimal < minTime || ctxDecimal > maxTime) return null;
    const position = ((ctxDecimal - minTime) / (maxTime - minTime)) * 100;
    const nowTime = data[nowIndex]?.time;
    if (nowTime === contextualTime) return null;
    return position;
  };
  
  const contextualPosition = getContextualPosition();
  
  return (
    <div style={{ position: 'relative' }}>
      <div style={{ position: 'relative', height }}>
        <ResponsiveContainer width="100%" height="100%">
          <AreaChart data={mergedData} margin={{ top: 10, right: 10, left: 0, bottom: 5 }}>
            <defs>
              {/* Baseline confidence band - gray */}
              <linearGradient id="baselineConfBand" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={C.neutral[500]} stopOpacity={0.15} />
                <stop offset="100%" stopColor={C.neutral[500]} stopOpacity={0.02} />
              </linearGradient>
              {/* Scenario confidence band - purple */}
              <linearGradient id="scenarioConfBand" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={C.purple[500]} stopOpacity={0.25} />
                <stop offset="100%" stopColor={C.purple[500]} stopOpacity={0.05} />
              </linearGradient>
              {/* Actual fill */}
              <linearGradient id="actualFillScenario" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={C.brand[500]} stopOpacity={0.2} />
                <stop offset="100%" stopColor={C.brand[500]} stopOpacity={0} />
              </linearGradient>
              {/* Delta fill between baseline and scenario */}
              <linearGradient id="deltaFill" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stopColor={C.success[500]} stopOpacity={0.2} />
                <stop offset="100%" stopColor={C.success[500]} stopOpacity={0.05} />
              </linearGradient>
            </defs>
            <XAxis dataKey="time" tick={{ fontSize: 10, fill: C.neutral[500] }} axisLine={{ stroke: C.neutral[200] }} tickLine={false} />
            <YAxis tick={{ fontSize: 10, fill: C.neutral[500] }} axisLine={false} tickLine={false} width={35} domain={['auto', 'auto']} />
            
            {/* Baseline confidence band */}
            <Area type="monotone" dataKey="upper" stroke="none" fill="url(#baselineConfBand)" />
            <Area type="monotone" dataKey="lower" stroke="none" fill="url(#baselineConfBand)" />
            
            {/* Scenario confidence band */}
            <Area type="monotone" dataKey="scenarioUpper" stroke="none" fill="url(#scenarioConfBand)" />
            <Area type="monotone" dataKey="scenarioLower" stroke="none" fill="url(#scenarioConfBand)" />
            
            {/* Actual data */}
            <Area type="monotone" dataKey="actual" stroke={C.brand[500]} strokeWidth={2} fill="url(#actualFillScenario)" dot={false} />
            
            {/* Baseline prediction - gray dashed */}
            <Area type="monotone" dataKey="predicted" stroke={C.neutral[400]} strokeWidth={2} strokeDasharray="4 4" fill="none" dot={false} />
            
            {/* Scenario prediction - purple solid */}
            <Area type="monotone" dataKey="scenarioPredicted" stroke={C.purple[500]} strokeWidth={2.5} fill="none" dot={false} />
            
            {/* Target line */}
            {target && <Area type="monotone" dataKey={() => target} stroke={C.success[500]} strokeWidth={1} strokeDasharray="4 4" fill="none" />}
          </AreaChart>
        </ResponsiveContainer>
        
        {/* NOW marker */}
        {nowIndex >= 0 && (
          <div style={{ position: 'absolute', top: 10, bottom: 5, left: `${(nowIndex / (data.length - 1)) * 100}%`, width: 2, background: C.neutral[900], zIndex: 10 }}>
            <div style={{ position: 'absolute', top: -8, left: '50%', transform: 'translateX(-50%)', background: C.neutral[900], color: 'white', padding: '2px 6px', borderRadius: 3, fontSize: 9, fontWeight: 600 }}>NOW</div>
          </div>
        )}
        
        {/* CONTEXTUAL TIME marker */}
        {contextualPosition !== null && (
          <div style={{ position: 'absolute', top: 10, bottom: 5, left: `${contextualPosition}%`, width: 3, background: C.brand[500], zIndex: 15, borderRadius: 1, boxShadow: `0 0 8px ${C.brand[500]}60` }}>
            <div style={{ position: 'absolute', top: -8, left: '50%', transform: 'translateX(-50%)', background: C.brand[500], color: 'white', padding: '2px 6px', borderRadius: 3, fontSize: 9, fontWeight: 600, whiteSpace: 'nowrap' }}>{contextualTime}</div>
          </div>
        )}
      </div>
      
      {/* Legend */}
      <div style={{ display: 'flex', justifyContent: 'center', gap: sp.lg, paddingTop: sp.sm, borderTop: `1px solid ${C.neutral[100]}`, marginTop: sp.sm }}>
        <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
          <span style={{ width: 20, height: 3, background: C.brand[500], borderRadius: 2 }} />
          Actual
        </span>
        <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
          <span style={{ width: 20, height: 0, borderTop: `2px dashed ${C.neutral[400]}` }} />
          Baseline
        </span>
        <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
          <span style={{ width: 20, height: 3, background: C.purple[500], borderRadius: 2 }} />
          Scenario
        </span>
        {target && (
          <span style={{ display: 'flex', alignItems: 'center', gap: 6, fontSize: 11, color: C.neutral[600] }}>
            <span style={{ width: 20, height: 0, borderTop: `2px dashed ${C.success[500]}` }} />
            Target
          </span>
        )}
      </div>
    </div>
  );
};

// Generate 8-hour timeline data (-4hr to +4hr from NOW at 10:00)
const genTimelineData = (baseActual, basePred, variance = 0.1, trend = 0) => {
  const times = ['06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00'];
  const nowIdx = 4; // 10:00
  return times.map((time, i) => {
    const isActual = i <= nowIdx;
    const progress = i / (times.length - 1);
    const trendAdjust = trend * progress;
    const base = baseActual + (basePred - baseActual) * progress + trendAdjust;
    const noise = (Math.random() - 0.5) * baseActual * 0.05;
    const value = Math.round(base + noise);
    const confWidth = isActual ? 0 : (i - nowIdx) * baseActual * variance * 0.15;
    return {
      time,
      actual: isActual ? value : null,
      predicted: !isActual ? value : (i === nowIdx ? value : null),
      upper: !isActual ? value + confWidth : null,
      lower: !isActual ? Math.max(0, value - confWidth) : null,
      now: i === nowIdx
    };
  });
};

// ===== WAR ROOM - DAY =====
const DayShift = ({ onBack }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue } = useTimeContext();
  
  // Timeline data for KPI interpolation
  const kpiTimelines = {
    ordersIn: [
      { time: '06:00', actual: 0 }, { time: '08:00', actual: 820 }, { time: '10:00', actual: 1847 },
      { time: '12:00', predicted: 3100 }, { time: '14:00', predicted: 4200 }
    ],
    ordersOut: [
      { time: '06:00', actual: 0 }, { time: '08:00', actual: 710 }, { time: '10:00', actual: 1634 },
      { time: '12:00', predicted: 2850 }, { time: '14:00', predicted: 4050 }
    ],
    activeStaff: [
      { time: '06:00', actual: 45 }, { time: '08:00', actual: 44 }, { time: '10:00', actual: 42 },
      { time: '12:00', predicted: 38 }, { time: '14:00', predicted: 44 }
    ],
    backlog: [
      { time: '06:00', actual: 385 }, { time: '08:00', actual: 310 }, { time: '10:00', actual: 213 },
      { time: '12:00', predicted: 165 }, { time: '14:00', predicted: 180 }
    ]
  };
  
  const live = [
    { l: 'Orders In', cur: 1847, pred: 4200, icon: Package, note: '+312/hr', timeline: kpiTimelines.ordersIn },
    { l: 'Orders Out', cur: 1634, pred: 4050, icon: Truck, note: '+298/hr', timeline: kpiTimelines.ordersOut },
    { l: 'Active Staff', cur: 42, pred: 44, icon: Users, note: '4 call-outs', timeline: kpiTimelines.activeStaff },
    { l: 'Backlog', cur: 213, pred: 180, icon: Clock, note: 'Clearing', timeline: kpiTimelines.backlog }
  ];
  
  // Timeline data for predictive charts
  const throughputData = genTimelineData(0, 4200, 0.08, 200);
  const staffingData = [
    { time: '06:00', actual: 45, predicted: null, upper: null, lower: null, target: 48 },
    { time: '07:00', actual: 46, predicted: null, upper: null, lower: null, target: 48 },
    { time: '08:00', actual: 44, predicted: null, upper: null, lower: null, target: 48 },
    { time: '09:00', actual: 43, predicted: null, upper: null, lower: null, target: 48 },
    { time: '10:00', actual: 42, predicted: 42, upper: null, lower: null, now: true, target: 48 },
    { time: '11:00', actual: null, predicted: 40, upper: 42, lower: 38, target: 48 },
    { time: '12:00', actual: null, predicted: 38, upper: 41, lower: 35, target: 48 },
    { time: '13:00', actual: null, predicted: 41, upper: 44, lower: 38, target: 48 },
    { time: '14:00', actual: null, predicted: 44, upper: 47, lower: 41, target: 48 }
  ];
  const zoneZ04Data = [
    { time: '06:00', actual: 62, predicted: null, upper: null, lower: null },
    { time: '07:00', actual: 68, predicted: null, upper: null, lower: null },
    { time: '08:00', actual: 74, predicted: null, upper: null, lower: null },
    { time: '09:00', actual: 79, predicted: null, upper: null, lower: null },
    { time: '10:00', actual: 83, predicted: 83, upper: null, lower: null, now: true },
    { time: '11:00', actual: null, predicted: 88, upper: 91, lower: 85 },
    { time: '12:00', actual: null, predicted: 91, upper: 95, lower: 87 },
    { time: '13:00', actual: null, predicted: 89, upper: 94, lower: 84 },
    { time: '14:00', actual: null, predicted: 85, upper: 91, lower: 79 }
  ];
  
  const carriers = [
    { name: 'FedEx Ground', cut: '14:00', cutHr: 14, tgt: 1850, cur: 1247, pred: 1920, ok: true, vel: 156 },
    { name: 'UPS', cut: '15:30', cutHr: 15.5, tgt: 1420, cur: 680, pred: 1380, ok: false, vel: 142 },
    { name: 'USPS', cut: '16:00', cutHr: 16, tgt: 680, cur: 245, pred: 710, ok: true, vel: 73 },
    { name: 'FedEx Express', cut: '18:00', cutHr: 18, tgt: 520, cur: 85, pred: 545, ok: true, vel: 55 }
  ];
  
  // Generate carrier burnup timeline
  const genCarrierTimeline = (c) => {
    const times = ['06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00'];
    const nowIdx = 4;
    return times.map((time, i) => {
      const hr = 6 + i;
      const isActual = i <= nowIdx;
      const progress = Math.min(1, (c.cur / c.tgt) + ((i - nowIdx) * (c.vel / c.tgt)));
      const value = isActual ? Math.round(c.cur * (i / nowIdx)) : Math.round(c.tgt * Math.min(1.1, progress));
      const confWidth = isActual ? 0 : (i - nowIdx) * c.tgt * 0.03;
      return {
        time,
        actual: isActual ? value : null,
        predicted: !isActual ? value : (i === nowIdx ? value : null),
        upper: !isActual ? Math.min(c.tgt * 1.15, value + confWidth) : null,
        lower: !isActual ? Math.max(0, value - confWidth) : null,
        now: i === nowIdx,
        cutoff: hr >= c.cutHr
      };
    });
  };

  const queues = [
    { name: 'Pick', total: 4200, done: 1890, pred: 4100, vel: 520 },
    { name: 'Pack', total: 3800, done: 1450, pred: 3600, vel: 480 },
    { name: 'Ship', total: 3200, done: 1634, pred: 3350, vel: 420 }
  ];
  
  // Generate burndown data for queues
  const genBurndownData = (q) => {
    const times = ['06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00'];
    const nowIdx = 4;
    const remaining = q.total - q.done;
    return times.map((time, i) => {
      const isActual = i <= nowIdx;
      const completedAtTime = isActual ? (q.done * (i / nowIdx)) : null;
      const remainingAtTime = isActual ? (q.total - completedAtTime) : null;
      const predRemaining = !isActual ? Math.max(0, remaining - ((i - nowIdx) * q.vel)) : null;
      const confWidth = !isActual ? (i - nowIdx) * 40 : 0;
      return {
        time,
        actual: remainingAtTime,
        predicted: i === nowIdx ? remaining : predRemaining,
        upper: predRemaining !== null ? predRemaining + confWidth : null,
        lower: predRemaining !== null ? Math.max(0, predRemaining - confWidth) : null,
        now: i === nowIdx
      };
    });
  };

  const alerts = [
    { sev: 'critical', title: 'Zone Z04 capacity breach', msg: 'Predicted 91% at 12:00 (critical threshold: 90%)', time: '+2hr', conf: 84 },
    { sev: 'critical', title: 'UPS cutoff at risk', msg: '~40 orders short at current velocity (142/hr needed: 185/hr)', time: '+5.5hr', conf: 72 },
    { sev: 'warning', title: 'Staffing gap 11:00-13:00', msg: 'Predicted 38 FTE vs 48 required (break coverage)', time: '+1hr', conf: 91 },
    { sev: 'warning', title: 'Pack queue carryover', msg: '~200 units predicted to carry to swing shift', time: '+4hr', conf: 68 }
  ];
  
  const handoff = { pick: 100, pack: 200, ship: 85, sched: 38, rec: 42, issues: ['Zone Z04 near capacity', 'Dock 7 maintenance until 15:00', 'UPS ~40 orders at risk'] };
  
  // Get contextual staffing value for the forecast card
  const ctxStaffing = isContextualDifferent ? interpolateValue(staffingData, contextualTime) : null;
  const ctxZoneZ04 = isContextualDifferent ? interpolateValue(zoneZ04Data, contextualTime) : null;

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg }}>
      {/* Time Scrubber */}
      <TimeScrubber />
      
      {/* Breadcrumb */}
      <Breadcrumb items={[
        { label: 'Executive Summary', onClick: onBack },
        { label: 'Day Shift War Room' }
      ]} />
      
      {/* Header */}
      <div style={{ background: `linear-gradient(135deg, ${C.neutral[900]} 0%, ${C.neutral[800]} 100%)`, borderRadius: 12, padding: sp.lg, color: 'white' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.lg }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
            <div style={{ padding: sp.sm, background: 'rgba(255,255,255,0.1)', borderRadius: 10 }}><Zap style={{ width: 28, height: 28, color: C.warning[500] }} /></div>
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <h2 style={{ fontSize: '26px', fontWeight: 300, margin: 0 }}>War Room</h2>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, background: C.brand[500], padding: '6px 14px', borderRadius: 20 }}><Sun style={{ width: 16, height: 16 }} /><span style={{ fontSize: '14px', fontWeight: 500 }}>Day Shift</span></div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}><div style={{ width: 10, height: 10, borderRadius: '50%', background: C.success[500], animation: 'pulse 2s infinite' }} /><span style={{ fontSize: '13px', color: C.success[500], fontWeight: 500 }}>LIVE</span></div>
              </div>
              <p style={{ color: C.neutral[400], fontSize: '14px', marginTop: 4 }}>
                8-hour predictive window • 06:00 - 14:00
                {isContextualDifferent && (
                  <span style={{ marginLeft: sp.sm }}>
                    • <span style={{ padding: '2px 8px', background: C.brand[500], color: 'white', borderRadius: 4, fontSize: '12px' }}>Viewing @{contextualTime}</span>
                  </span>
                )}
              </p>
            </div>
          </div>
          <div style={{ textAlign: 'right' }}>
            <p style={{ color: C.neutral[400], fontSize: '12px' }}>Current Time</p>
            <p style={{ fontSize: '48px', fontWeight: 100, margin: 0 }}>10:00</p>
            <p style={{ color: C.neutral[400], fontSize: '11px', marginTop: sp.sm }}>Shift ends 14:00 • Swing starts 14:00</p>
          </div>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
          {live.map((m, i) => {
            const Icon = m.icon;
            const ctxVal = isContextualDifferent ? interpolateValue(m.timeline, contextualTime) : null;
            return (
              <div key={i} style={{ background: 'rgba(255,255,255,0.08)', borderRadius: 10, padding: sp.md, border: '1px solid rgba(255,255,255,0.1)' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}><span style={{ color: C.neutral[400], fontSize: '12px', fontWeight: 500, textTransform: 'uppercase' }}>{m.l}</span><Icon style={{ width: 18, height: 18, color: C.neutral[400] }} /></div>
                <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs, flexWrap: 'wrap' }}>
                  <span style={{ fontSize: '36px', fontWeight: 300 }}>{m.cur.toLocaleString()}</span>
                  {ctxVal !== null && (
                    <>
                      <ArrowRight style={{ width: 14, height: 14, color: C.neutral[500] }} />
                      <span style={{ fontSize: '18px', fontWeight: 500, color: C.brand[300], padding: '2px 8px', background: 'rgba(47, 114, 255, 0.3)', borderRadius: 4 }}>{ctxVal.toLocaleString()}</span>
                    </>
                  )}
                  <ArrowRight style={{ width: 14, height: 14, color: C.neutral[500] }} />
                  <span style={{ fontSize: '20px', color: C.purple[300] }}>{m.pred.toLocaleString()}</span>
                </div>
                <p style={{ fontSize: '11px', color: C.neutral[400], marginTop: sp.sm }}>{m.note}</p>
              </div>
            );
          })}
        </div>
      </div>
      
      {/* Staffing Forecast */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500, margin: 0 }}>Staffing Forecast</h3>
              {ctxStaffing !== null && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{ctxStaffing} FTE</strong> {isContextualPast && '(past)'}
                </span>
              )}
            </div>
            <Badge status="warning" label="Gap 11:00-13:00" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Headcount vs required (48 FTE target) • Now: 42 → Predicted: 44 @ 14:00</p>
        </div>
        <PredictiveTimeline data={staffingData} height={160} target={48} warning={44} critical={40} contextualTime={contextualTime} />
        <div style={{ display: 'flex', gap: sp.md, marginTop: sp.sm, padding: sp.sm, background: C.warning[50], borderRadius: 6 }}>
          <AlertTriangle style={{ width: 14, height: 14, color: C.warning[600], flexShrink: 0, marginTop: 2 }} />
          <div>
            <p style={{ fontSize: '12px', fontWeight: 500, color: C.warning[700] }}>Break coverage gap predicted</p>
            <p style={{ fontSize: '11px', color: C.warning[600] }}>38 FTE at 12:00 vs 48 required • Consider staggered breaks or overtime</p>
          </div>
        </div>
      </Card>
      
      {/* Zone Z04 Capacity */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500, margin: 0 }}>Zone Z04 Capacity</h3>
              {ctxZoneZ04 !== null && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{ctxZoneZ04}%</strong> {isContextualPast && '(past)'}
                </span>
              )}
            </div>
            <Badge status="error" label="Breach @ 12:00" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Bulk Storage utilization trajectory • Now: 83% → Predicted: 85% @ 14:00 • Critical threshold at 90%</p>
        </div>
        <PredictiveTimeline data={zoneZ04Data} height={160} warning={80} critical={90} showConfidence={true} contextualTime={contextualTime} />
        <div style={{ display: 'flex', gap: sp.md, marginTop: sp.sm, padding: sp.sm, background: C.error[50], borderRadius: 6 }}>
          <AlertOctagon style={{ width: 14, height: 14, color: C.error[600], flexShrink: 0, marginTop: 2 }} />
          <div>
            <p style={{ fontSize: '12px', fontWeight: 500, color: C.error[700] }}>Critical threshold breach imminent</p>
            <p style={{ fontSize: '11px', color: C.error[600] }}>91% predicted at 12:00 • Expedite putaway or redirect inbound to Z05</p>
          </div>
        </div>
      </Card>
      
      {/* Carrier Cutoff Trajectories */}
      {carriers.map((c, i) => {
        const timelineData = genCarrierTimeline(c);
        const ctxCarrier = isContextualDifferent ? interpolateValue(timelineData, contextualTime) : null;
        const diff = c.pred - c.tgt;
        const neededVel = Math.round((c.tgt - c.cur) / ((c.cutHr - 10)));
        return (
          <Card key={i}>
            <div style={{ marginBottom: sp.sm }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                  <h3 style={{ fontSize: '16px', fontWeight: 500, margin: 0 }}>{c.name} — Cutoff {c.cut}</h3>
                  {ctxCarrier !== null && (
                    <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                      @{contextualTime}: <strong>{ctxCarrier.toLocaleString()}</strong>
                    </span>
                  )}
                </div>
                <Badge status={c.ok ? 'success' : 'warning'} label={c.ok ? 'Will meet cutoff' : 'At risk'} />
              </div>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>Order completion trajectory toward carrier cutoff • Target: {c.tgt.toLocaleString()} orders</p>
            </div>
            <PredictiveTimeline data={timelineData} height={140} target={c.tgt} contextualTime={contextualTime} />
            <div style={{ display: 'flex', gap: sp.lg, marginTop: sp.md, padding: sp.md, background: c.ok ? C.success[50] : C.warning[50], borderRadius: 6 }}>
              <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Current</span><p style={{ fontSize: '16px', fontWeight: 500 }}>{c.cur.toLocaleString()}</p></div>
              <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Velocity</span><p style={{ fontSize: '16px', fontWeight: 500 }}>{c.vel}/hr</p></div>
              <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Predicted @ Cutoff</span><p style={{ fontSize: '16px', fontWeight: 500, color: c.ok ? C.success[600] : C.warning[600] }}>{c.pred.toLocaleString()}</p></div>
              {!c.ok && <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Need Velocity</span><p style={{ fontSize: '16px', fontWeight: 500, color: C.warning[600] }}>{neededVel}/hr</p></div>}
            </div>
          </Card>
        );
      })}
      
      {/* Work Queue Burndowns */}
      {queues.map((q, i) => {
        const burndownData = genBurndownData(q);
        const ctxQueue = isContextualDifferent ? interpolateValue(burndownData, contextualTime) : null;
        const ok = q.pred >= q.total;
        const over = Math.max(0, q.total - q.pred);
        return (
          <Card key={i}>
            <div style={{ marginBottom: sp.sm }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                  <h3 style={{ fontSize: '16px', fontWeight: 500, margin: 0 }}>{q.name} Queue Burndown</h3>
                  {ctxQueue !== null && (
                    <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                      @{contextualTime}: <strong>{Math.round(ctxQueue).toLocaleString()} remaining</strong>
                    </span>
                  )}
                </div>
                <Badge status={ok ? 'success' : 'warning'} label={ok ? '✓ Will complete' : `~${over} carryover`} />
              </div>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>Remaining work vs time • Velocity: {q.vel}/hr • Est. {Math.round((q.total - q.done) / q.vel * 60)}min to clear</p>
            </div>
            <PredictiveTimeline data={burndownData} height={140} contextualTime={contextualTime} />
          </Card>
        );
      })}
      
      {/* Analysis */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.xs }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3>
            <Badge status="error" label={`${alerts.filter(a => a.sev === 'critical').length} critical`} />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and predicted issues based on current trajectories • Click on item to view details</p>
        </div>
        {alerts.map((a, i) => <Alert key={i} {...a} />)}
      </Card>
      
      {/* Swing Shift Handoff */}
      <Card style={{ background: `linear-gradient(135deg, ${C.purple[700]} 0%, ${C.neutral[900]} 100%)`, color: 'white' }}>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.xs }}>
            <Moon style={{ width: 20, height: 20, color: C.purple[300] }} />
            <span style={{ fontWeight: 500, fontSize: '16px' }}>Swing Shift Handoff</span>
            <span style={{ fontSize: '12px', color: C.purple[300], marginLeft: 'auto' }}>@ 14:00 (+4hr)</span>
          </div>
          <p style={{ fontSize: '12px', color: C.purple[300] }}>Predicted state at shift transition • Carryover work and staffing recommendations</p>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md, marginBottom: sp.md }}>
          <div>
            <p style={{ fontSize: '12px', color: C.purple[300], marginBottom: sp.sm }}>Predicted Carryover</p>
            <div style={{ display: 'flex', gap: sp.sm }}>
              {[['Pick', handoff.pick], ['Pack', handoff.pack], ['Ship', handoff.ship]].map(([k, v]) => (
                <div key={k} style={{ flex: 1, background: 'rgba(255,255,255,0.1)', borderRadius: 6, padding: sp.md, textAlign: 'center' }}>
                  <p style={{ fontSize: '24px', fontWeight: 500, color: v > 150 ? C.warning[300] : 'white' }}>{v}</p>
                  <p style={{ fontSize: '11px', color: C.purple[300] }}>{k}</p>
                </div>
              ))}
            </div>
          </div>
          <div>
            <p style={{ fontSize: '12px', color: C.purple[300], marginBottom: sp.sm }}>Staffing</p>
            <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: 6, padding: sp.md }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <div><p style={{ fontSize: '11px', color: C.purple[300] }}>Scheduled / Recommended</p><p style={{ fontSize: '24px', fontWeight: 500 }}>{handoff.sched} / {handoff.rec}</p></div>
                <span style={{ background: 'rgba(249,144,9,0.3)', color: C.warning[300], padding: '6px 12px', borderRadius: 4, fontSize: '13px', fontWeight: 500 }}>{handoff.rec - handoff.sched} short</span>
              </div>
            </div>
          </div>
          <div>
            <p style={{ fontSize: '12px', color: C.purple[300], marginBottom: sp.sm }}>Issues to Hand Off</p>
            <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: 6, padding: sp.md }}>
              <ul style={{ padding: 0, margin: 0, listStyle: 'none' }}>
                {handoff.issues.map((iss, i) => (
                  <li key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.sm, fontSize: '12px', color: C.purple[100], marginBottom: i < handoff.issues.length - 1 ? 8 : 0 }}>
                    <span style={{ width: 5, height: 5, borderRadius: '50%', background: C.purple[400], flexShrink: 0 }} />{iss}
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </div>
      </Card>
    </div>
  );
};

// ===== WAR ROOM - SWING =====
const SwingShift = ({ onBack }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue } = useTimeContext();
  
  const exp = { pick: 100, pack: 200, ship: 85, orders: 3200, staff: 38, rec: 42 };
  const work = [{ name: 'Inherited Backlog', orders: 385, prio: 'high' }, { name: 'Wave 4', orders: 290, prio: 'normal' }, { name: 'Wave 5', orders: 320, prio: 'normal' }, { name: 'Express/Hot', orders: 45, prio: 'critical' }];
  const staff = [{ fn: 'Receiving', p: 4, a: 4 }, { fn: 'Putaway', p: 5, a: 4 }, { fn: 'Picking', p: 14, a: 12 }, { fn: 'Packing', p: 10, a: 9 }, { fn: 'Shipping', p: 5, a: 5 }];
  const issues = [{ sev: 'warning', title: 'Zone Z04 at 94%', msg: 'Clear bulk storage early', time: 'Inherited' }, { sev: 'warning', title: 'Dock 7 maintenance', msg: 'Returns at 15:00', time: 'Until 15:00' }, { sev: 'info', title: 'UPS carryover', msg: '~40 orders from day', time: 'Priority' }];
  
  // Predictive data for swing shift planning (forecasting 14:00-22:00)
  const staffForecast = [
    { time: '14:00', predicted: 38, upper: 38, lower: 38 },
    { time: '15:00', predicted: 37, upper: 39, lower: 35 },
    { time: '16:00', predicted: 36, upper: 39, lower: 33 },
    { time: '17:00', predicted: 38, upper: 41, lower: 35 },
    { time: '18:00', predicted: 35, upper: 38, lower: 32 },
    { time: '19:00', predicted: 36, upper: 40, lower: 32 },
    { time: '20:00', predicted: 38, upper: 42, lower: 34 },
    { time: '21:00', predicted: 40, upper: 44, lower: 36 },
    { time: '22:00', predicted: 38, upper: 42, lower: 34 }
  ];
  const throughputForecast = [
    { time: '14:00', predicted: 385, upper: 400, lower: 370 },
    { time: '15:00', predicted: 820, upper: 880, lower: 760 },
    { time: '16:00', predicted: 1350, upper: 1450, lower: 1250 },
    { time: '17:00', predicted: 1900, upper: 2050, lower: 1750 },
    { time: '18:00', predicted: 2400, upper: 2600, lower: 2200 },
    { time: '19:00', predicted: 2850, upper: 3100, lower: 2600 },
    { time: '20:00', predicted: 3200, upper: 3500, lower: 2900 },
    { time: '21:00', predicted: 3450, upper: 3800, lower: 3100 },
    { time: '22:00', predicted: 3585, upper: 3950, lower: 3220 }
  ];
  const zoneForecast = [
    { time: '14:00', predicted: 85, upper: 88, lower: 82 },
    { time: '15:00', predicted: 78, upper: 82, lower: 74 },
    { time: '16:00', predicted: 72, upper: 77, lower: 67 },
    { time: '17:00', predicted: 68, upper: 74, lower: 62 },
    { time: '18:00', predicted: 65, upper: 72, lower: 58 },
    { time: '19:00', predicted: 60, upper: 68, lower: 52 },
    { time: '20:00', predicted: 55, upper: 64, lower: 46 },
    { time: '21:00', predicted: 52, upper: 62, lower: 42 },
    { time: '22:00', predicted: 48, upper: 58, lower: 38 }
  ];
  
  // Get contextual values
  const ctxStaff = isContextualDifferent ? interpolateValue(staffForecast, contextualTime, 'predicted') : null;
  const ctxThroughput = isContextualDifferent ? interpolateValue(throughputForecast, contextualTime, 'predicted') : null;
  const ctxZone = isContextualDifferent ? interpolateValue(zoneForecast, contextualTime, 'predicted') : null;

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg }}>
      {/* Time Scrubber */}
      <TimeScrubber />
      
      {/* Breadcrumb */}
      <Breadcrumb items={[
        { label: 'Executive Summary', onClick: onBack },
        { label: 'Swing Shift War Room' }
      ]} />
      
      <div style={{ background: `linear-gradient(135deg, ${C.purple[700]} 0%, ${C.purple[900]} 100%)`, borderRadius: 12, padding: sp.lg, color: 'white' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.lg }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
            <div style={{ padding: sp.sm, background: 'rgba(255,255,255,0.1)', borderRadius: 10 }}><Radio style={{ width: 28, height: 28, color: C.purple[300] }} /></div>
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <h2 style={{ fontSize: '26px', fontWeight: 300, margin: 0 }}>War Room</h2>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, background: C.purple[500], padding: '6px 14px', borderRadius: 20 }}><Moon style={{ width: 16, height: 16 }} /><span style={{ fontSize: '14px', fontWeight: 500 }}>Swing Shift</span></div>
                <span style={{ fontSize: '12px', color: C.purple[300], background: 'rgba(255,255,255,0.1)', padding: '4px 8px', borderRadius: 4 }}>PLANNING</span>
              </div>
              <p style={{ color: C.purple[300], fontSize: '14px', marginTop: 4 }}>
                8-hour forecast • 14:00 - 22:00
                {isContextualDifferent && (
                  <span style={{ marginLeft: sp.sm, padding: '2px 8px', background: 'rgba(47, 114, 255, 0.4)', borderRadius: 4, fontSize: '12px' }}>Viewing @{contextualTime}</span>
                )}
              </p>
            </div>
          </div>
          <div style={{ textAlign: 'right' }}><p style={{ color: C.purple[300], fontSize: '12px' }}>Shift Starts In</p><p style={{ fontSize: '48px', fontWeight: 100, margin: 0 }}>4:00</p><p style={{ color: C.purple[300], fontSize: '11px', marginTop: 4 }}>hrs from now</p></div>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
          {[['Inherited Carryover', exp.pick + exp.pack + exp.ship, 'from day shift', false], ['Planned Volume', exp.orders.toLocaleString(), 'total orders', false], ['Staff Scheduled', exp.staff, `rec: ${exp.rec}`, true], ['Carrier Cutoffs', '4', '1 at risk (UPS)', true]].map(([l, v, sub, warn], i) => (
            <div key={i} style={{ background: 'rgba(255,255,255,0.08)', borderRadius: 10, padding: sp.md }}><p style={{ color: C.purple[300], fontSize: '12px', marginBottom: sp.sm }}>{l}</p><p style={{ fontSize: '32px', fontWeight: 300 }}>{v}</p><p style={{ fontSize: '11px', color: warn ? C.warning[300] : C.purple[300] }}>{sub}</p></div>
          ))}
        </div>
      </div>
      
      {/* Staffing Forecast */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Staffing Forecast</h3>
              {ctxStaff !== null && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{ctxStaff} FTE</strong>
                </span>
              )}
            </div>
            <Badge status="warning" label="-4 gap" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Predicted headcount vs required throughout shift • Target: 42 FTE</p>
        </div>
        <PredictiveTimeline data={staffForecast} height={160} target={42} warning={38} critical={34} contextualTime={contextualTime} />
      </Card>
      
      {/* Throughput Forecast */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Throughput Forecast</h3>
              {ctxThroughput !== null && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{ctxThroughput.toLocaleString()} orders</strong>
                </span>
              )}
            </div>
            <Badge status="success" label="On track" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Cumulative orders processed during shift • Target: 3,200 orders</p>
        </div>
        <PredictiveTimeline data={throughputForecast} height={160} target={3200} contextualTime={contextualTime} />
      </Card>
      
      {/* Zone Z04 Forecast */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Zone Z04 Forecast</h3>
              {ctxZone !== null && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{ctxZone}%</strong>
                </span>
              )}
            </div>
            <Badge status="success" label="Clearing" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Bulk Storage capacity trajectory • Inherited at 94% from day shift</p>
        </div>
        <PredictiveTimeline data={zoneForecast} height={160} warning={80} critical={90} contextualTime={contextualTime} />
      </Card>
      
      {/* Planned Work */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Planned Work</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Work items scheduled for this shift • Priority indicated by color</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {work.map((w, i) => (
            <div key={i} style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: sp.md, background: w.prio === 'critical' ? C.error[50] : w.prio === 'high' ? C.warning[50] : C.neutral[50], borderRadius: 6, borderLeft: `3px solid ${w.prio === 'critical' ? C.error[500] : w.prio === 'high' ? C.warning[500] : C.neutral[300]}` }}>
              <span style={{ fontSize: '14px', fontWeight: 500 }}>{w.name}</span>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}><span style={{ fontSize: '16px', fontWeight: 500 }}>{w.orders} orders</span>{w.prio !== 'normal' && <Badge status={w.prio === 'critical' ? 'error' : 'warning'} label={w.prio} />}</div>
            </div>
          ))}
        </div>
      </Card>
      
      {/* Staffing Plan */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.xs }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Staffing Plan</h3>
            <Badge status="warning" label="4 gap total" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Scheduled vs required headcount by function • Click on item to view details</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {staff.map((s, i) => {
            const gap = s.p - s.a;
            return (
              <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.md, background: gap > 0 ? C.warning[50] : C.neutral[50], borderRadius: 6 }}>
                <span style={{ fontSize: '14px', fontWeight: 500, minWidth: 100 }}>{s.fn}</span>
                <div style={{ flex: 1 }}><Progress value={s.a} max={s.p} color={gap > 0 ? C.warning[500] : C.success[500]} h={8} /></div>
                <span style={{ fontSize: '14px', fontWeight: 500, color: gap > 0 ? C.warning[600] : C.success[600] }}>{s.a}/{s.p}</span>
                {gap > 0 && <Badge status="warning" label={`-${gap}`} />}
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* Inherited Issues */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Inherited Issues from Day Shift</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Active alerts and issues requiring attention this shift</p>
        </div>
        {issues.map((a, i) => <Alert key={i} {...a} />)}
      </Card>
    </div>
  );
};

// ===== WAR ROOM - NIGHT =====
const NightShift = ({ onBack }) => {
  const { contextualTime, isContextualDifferent, interpolateValue } = useTimeContext();
  
  const sum = { tp: 3850, comp: 96, ot: 91, staff: 94 };
  const handoff = { pick: 45, pack: 32, ship: 18, total: 95, zone: 'All zones below 70%' };
  const hl = [{ t: 'success', txt: 'Cleared UPS backlog (+40 orders)' }, { t: 'success', txt: 'Zone Z04 reduced to 62%' }, { t: 'warning', txt: 'Regional LTL 5 orders short' }, { t: 'info', txt: 'Dock 7 maintenance completed' }];
  
  // Actual vs predicted data for completed shift review
  const throughputActual = [
    { time: '22:00', actual: 0, predicted: 0 },
    { time: '23:00', actual: 420, predicted: 400, upper: 450, lower: 350 },
    { time: '00:00', actual: 890, predicted: 850, upper: 950, lower: 750 },
    { time: '01:00', actual: 1450, predicted: 1400, upper: 1550, lower: 1250 },
    { time: '02:00', actual: 2100, predicted: 2000, upper: 2200, lower: 1800 },
    { time: '03:00', actual: 2680, predicted: 2600, upper: 2850, lower: 2350 },
    { time: '04:00', actual: 3200, predicted: 3100, upper: 3400, lower: 2800 },
    { time: '05:00', actual: 3580, predicted: 3500, upper: 3850, lower: 3150 },
    { time: '06:00', actual: 3850, predicted: 3750, upper: 4100, lower: 3400 }
  ];
  const staffingActual = [
    { time: '22:00', actual: 28, predicted: 28 },
    { time: '23:00', actual: 27, predicted: 28, upper: 29, lower: 27 },
    { time: '00:00', actual: 26, predicted: 27, upper: 28, lower: 26 },
    { time: '01:00', actual: 25, predicted: 26, upper: 27, lower: 25 },
    { time: '02:00', actual: 24, predicted: 25, upper: 26, lower: 24 },
    { time: '03:00', actual: 24, predicted: 24, upper: 25, lower: 23 },
    { time: '04:00', actual: 26, predicted: 26, upper: 27, lower: 25 },
    { time: '05:00', actual: 27, predicted: 27, upper: 28, lower: 26 },
    { time: '06:00', actual: 28, predicted: 28, upper: 29, lower: 27 }
  ];
  const zoneActual = [
    { time: '22:00', actual: 85, predicted: 85 },
    { time: '23:00', actual: 82, predicted: 83, upper: 86, lower: 80 },
    { time: '00:00', actual: 78, predicted: 80, upper: 84, lower: 76 },
    { time: '01:00', actual: 74, predicted: 76, upper: 80, lower: 72 },
    { time: '02:00', actual: 70, predicted: 72, upper: 76, lower: 68 },
    { time: '03:00', actual: 66, predicted: 68, upper: 72, lower: 64 },
    { time: '04:00', actual: 64, predicted: 65, upper: 69, lower: 61 },
    { time: '05:00', actual: 62, predicted: 63, upper: 67, lower: 59 },
    { time: '06:00', actual: 62, predicted: 62, upper: 66, lower: 58 }
  ];

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg }}>
      {/* Time Scrubber */}
      <TimeScrubber />
      
      {/* Breadcrumb */}
      <Breadcrumb items={[
        { label: 'Executive Summary', onClick: onBack },
        { label: 'Night Shift War Room' }
      ]} />
      
      <div style={{ background: `linear-gradient(135deg, ${C.neutral[800]} 0%, ${C.neutral[900]} 100%)`, borderRadius: 12, padding: sp.lg, color: 'white' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.lg }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
            <div style={{ padding: sp.sm, background: 'rgba(255,255,255,0.1)', borderRadius: 10 }}><Star style={{ width: 28, height: 28, color: C.warning[500] }} /></div>
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <h2 style={{ fontSize: '26px', fontWeight: 300, margin: 0 }}>War Room</h2>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, background: C.neutral[600], padding: '6px 14px', borderRadius: 20 }}><Moon style={{ width: 16, height: 16 }} /><span style={{ fontSize: '14px', fontWeight: 500 }}>Night Shift</span></div>
                <span style={{ fontSize: '12px', color: C.success[500], background: 'rgba(18,183,106,0.2)', padding: '4px 8px', borderRadius: 4 }}>COMPLETED</span>
              </div>
              <p style={{ color: C.neutral[400], fontSize: '14px', marginTop: 4 }}>Actual vs Predicted review • 22:00 - 06:00</p>
            </div>
          </div>
          <div style={{ textAlign: 'right' }}><p style={{ color: C.neutral[400], fontSize: '12px' }}>Shift Ended</p><p style={{ fontSize: '48px', fontWeight: 100, margin: 0 }}>06:00</p></div>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
          {[['Throughput', sum.tp.toLocaleString(), '+100 vs pred', true], ['Completion', `${sum.comp}%`, '+1% vs pred', true], ['On-Time', `${sum.ot}%`, '-2% vs pred', false], ['Staffing', `${sum.staff}%`, 'On target', true]].map(([l, v, vs, ok], i) => (
            <div key={i} style={{ background: 'rgba(255,255,255,0.08)', borderRadius: 10, padding: sp.md, borderLeft: `3px solid ${ok ? C.success[500] : C.warning[500]}` }}><p style={{ color: C.neutral[400], fontSize: '12px', marginBottom: sp.sm }}>{l}</p><p style={{ fontSize: '32px', fontWeight: 300 }}>{v}</p><p style={{ fontSize: '11px', color: ok ? C.success[300] : C.warning[300] }}>{vs}</p></div>
          ))}
        </div>
      </div>
      
      {/* Throughput: Actual vs Predicted */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.xs }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Throughput: Actual vs Predicted</h3>
            <Badge status="success" label="+2.7% vs pred" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Comparison of actual performance vs model predictions • Validates forecast accuracy</p>
        </div>
        <PredictiveTimeline data={throughputActual} height={160} contextualTime={contextualTime} />
      </Card>
      
      {/* Staffing: Actual vs Predicted */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.xs }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Staffing: Actual vs Predicted</h3>
            <Badge status="success" label="On target" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Headcount throughout shift • Target: 28 FTE maintained</p>
        </div>
        <PredictiveTimeline data={staffingActual} height={160} target={28} contextualTime={contextualTime} />
      </Card>
      
      {/* Zone Z04: Actual vs Predicted */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.xs }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Zone Z04: Actual vs Predicted</h3>
            <Badge status="success" label="Cleared" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Bulk Storage capacity reduction • Started 94%, ended 62%</p>
        </div>
        <PredictiveTimeline data={zoneActual} height={160} warning={80} critical={90} contextualTime={contextualTime} />
      </Card>
      
      {/* Shift Highlights */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Shift Highlights</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Key accomplishments and issues from the completed shift</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {hl.map((h, i) => (
            <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.md, background: h.t === 'success' ? C.success[50] : h.t === 'warning' ? C.warning[50] : C.brand[100], borderRadius: 6 }}>
              {h.t === 'success' ? <CheckCircle style={{ width: 18, height: 18, color: C.success[600] }} /> : h.t === 'warning' ? <AlertTriangle style={{ width: 18, height: 18, color: C.warning[600] }} /> : <Info style={{ width: 18, height: 18, color: C.brand[600] }} />}
              <span style={{ fontSize: '14px', color: h.t === 'success' ? C.success[700] : h.t === 'warning' ? C.warning[700] : C.brand[600] }}>{h.txt}</span>
            </div>
          ))}
        </div>
      </Card>
      
      {/* Day Shift Handoff */}
      <Card style={{ background: `linear-gradient(135deg, ${C.brand[600]} 0%, ${C.brand[700]} 100%)`, color: 'white' }}>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.xs }}>
            <Sun style={{ width: 20, height: 20, color: C.brand[100] }} />
            <span style={{ fontWeight: 500, fontSize: '16px' }}>Day Shift Handoff</span>
          </div>
          <p style={{ fontSize: '12px', color: C.brand[200] }}>Work and status handed off to incoming day shift</p>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
          <div>
            <p style={{ fontSize: '12px', color: C.brand[100], marginBottom: sp.sm }}>Carryover by Queue</p>
            <div style={{ display: 'flex', gap: sp.sm }}>
              {[['Pick', handoff.pick], ['Pack', handoff.pack], ['Ship', handoff.ship]].map(([k, v]) => (
                <div key={k} style={{ flex: 1, background: 'rgba(255,255,255,0.1)', borderRadius: 6, padding: sp.md, textAlign: 'center' }}>
                  <p style={{ fontSize: '24px', fontWeight: 500 }}>{v}</p>
                  <p style={{ fontSize: '11px', color: C.brand[100] }}>{k}</p>
                </div>
              ))}
            </div>
          </div>
          <div>
            <p style={{ fontSize: '12px', color: C.brand[100], marginBottom: sp.sm }}>Total Carryover</p>
            <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: 6, padding: sp.md, textAlign: 'center' }}>
              <p style={{ fontSize: '32px', fontWeight: 500 }}>{handoff.total}</p>
              <p style={{ fontSize: '12px', color: C.brand[100] }}>orders total</p>
            </div>
          </div>
          <div>
            <p style={{ fontSize: '12px', color: C.brand[100], marginBottom: sp.sm }}>Zone Status</p>
            <div style={{ background: 'rgba(18,183,106,0.2)', borderRadius: 6, padding: sp.md, display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <CheckCircle style={{ width: 20, height: 20, color: C.success[300] }} />
              <span style={{ fontSize: '14px', color: C.success[100] }}>{handoff.zone}</span>
            </div>
          </div>
        </div>
      </Card>
    </div>
  );
};

// ===== CATEGORY VIEWS =====
const StaffView = ({ onBack }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue } = useTimeContext();
  
  const alerts = [
    { sev: 'critical', title: 'Break Coverage Gap — 12:00', msg: '38 FTE predicted vs 48 required. Stagger breaks or authorize 2 overtime extensions.', time: '2hr out', conf: 87 },
    { sev: 'warning', title: 'Receiving UPLH Declining', msg: 'Productivity trending to 90 UPLH by 14:00 (target: 95). Consider rebalancing 2 pickers.', time: '4hr out', conf: 72 },
    { sev: 'info', title: 'Swing Shift Handoff Optimal', msg: 'Clean handoff predicted at 14:00 with no carryover labor gaps.', time: '4hr out', conf: 91 }
  ];
  
  // Staff roster data
  const staffData = [
    { id: 'E001', name: 'Maria Santos', role: 'Picker', shift: 'Day', zone: 'Forward Pick A', status: 'Active', uplh: 158, clockIn: '06:00' },
    { id: 'E002', name: 'James Wilson', role: 'Picker', shift: 'Day', zone: 'Forward Pick B', status: 'Active', uplh: 162, clockIn: '06:00' },
    { id: 'E003', name: 'Chen Wei', role: 'Packer', shift: 'Day', zone: 'Pack Station 1', status: 'Active', uplh: 112, clockIn: '06:00' },
    { id: 'E004', name: 'Sarah Johnson', role: 'Receiver', shift: 'Day', zone: 'Inbound A', status: 'Active', uplh: 94, clockIn: '06:00' },
    { id: 'E005', name: 'Mike Brown', role: 'Forklift Op', shift: 'Day', zone: 'Bulk Storage', status: 'Active', uplh: 88, clockIn: '06:00' },
    { id: 'E006', name: 'Ana Garcia', role: 'Picker', shift: 'Day', zone: 'Forward Pick C', status: 'Break', uplh: 145, clockIn: '06:00' },
    { id: 'E007', name: 'David Lee', role: 'Shipper', shift: 'Day', zone: 'Shipping Dock A', status: 'Active', uplh: 134, clockIn: '06:00' },
    { id: 'E008', name: 'Emily Chen', role: 'Packer', shift: 'Day', zone: 'Pack Station 2', status: 'Active', uplh: 118, clockIn: '06:00' },
    { id: 'E009', name: 'Robert Taylor', role: 'Receiver', shift: 'Day', zone: 'Inbound B', status: 'Active', uplh: 91, clockIn: '06:15' },
    { id: 'E010', name: 'Lisa Martinez', role: 'QC Inspector', shift: 'Day', zone: 'QA Station', status: 'Active', uplh: 42, clockIn: '06:00' },
    { id: 'E011', name: 'Tom Anderson', role: 'Picker', shift: 'Day', zone: 'Forward Pick A', status: 'Active', uplh: 149, clockIn: '06:00' },
    { id: 'E012', name: 'Jennifer White', role: 'Lead', shift: 'Day', zone: 'All', status: 'Active', uplh: null, clockIn: '05:45' },
    { id: 'E013', name: 'Chris Davis', role: 'Forklift Op', shift: 'Day', zone: 'Reserve 1', status: 'Call-out', uplh: null, clockIn: null },
    { id: 'E014', name: 'Amanda Clark', role: 'Picker', shift: 'Day', zone: 'Forward Pick B', status: 'Call-out', uplh: null, clockIn: null },
    { id: 'E015', name: 'Kevin Moore', role: 'Packer', shift: 'Day', zone: 'Pack Station 1', status: 'Late', uplh: 105, clockIn: '06:42' },
    { id: 'E016', name: 'Rachel Kim', role: 'Receiver', shift: 'Day', zone: 'Inbound A', status: 'Overtime', uplh: 96, clockIn: '05:00' },
  ];
  
  const staffColumns = [
    { key: 'id', label: 'ID' },
    { key: 'name', label: 'Name' },
    { key: 'role', label: 'Role' },
    { key: 'zone', label: 'Zone' },
    { key: 'status', label: 'Status', render: (v) => <Badge status={v === 'Active' ? 'success' : v === 'Break' ? 'info' : v === 'Call-out' ? 'error' : v === 'Late' ? 'warning' : 'purple'} label={v} /> },
    { key: 'uplh', label: 'UPLH', align: 'right', render: (v) => v ? <span style={{ color: v >= 100 ? C.success[600] : v >= 90 ? C.warning[600] : C.error[600] }}>{v}</span> : '—' },
    { key: 'clockIn', label: 'Clock In', render: (v) => v || '—' }
  ];
  
  const staffFilters = [
    { key: 'role', label: 'Role', options: ['Picker', 'Packer', 'Receiver', 'Shipper', 'Forklift Op', 'Lead', 'QC Inspector'] },
    { key: 'status', label: 'Status', options: ['Active', 'Break', 'Call-out', 'Late', 'Overtime'] }
  ];
  
  const staffTimeline = [
    { time: '06:00', actual: 45, predicted: null },
    { time: '07:00', actual: 46, predicted: null },
    { time: '08:00', actual: 44, predicted: null },
    { time: '09:00', actual: 43, predicted: null },
    { time: '10:00', actual: 42, predicted: 42, now: true },
    { time: '11:00', actual: null, predicted: 40, upper: 42, lower: 38 },
    { time: '12:00', actual: null, predicted: 38, upper: 41, lower: 35 },
    { time: '13:00', actual: null, predicted: 41, upper: 44, lower: 38 },
    { time: '14:00', actual: null, predicted: 44, upper: 47, lower: 41 }
  ];
  const productivityTimeline = [
    { time: '06:00', actual: 145, predicted: null },
    { time: '07:00', actual: 148, predicted: null },
    { time: '08:00', actual: 152, predicted: null },
    { time: '09:00', actual: 150, predicted: null },
    { time: '10:00', actual: 152, predicted: 152, now: true },
    { time: '11:00', actual: null, predicted: 148, upper: 155, lower: 141 },
    { time: '12:00', actual: null, predicted: 142, upper: 150, lower: 134 },
    { time: '13:00', actual: null, predicted: 145, upper: 153, lower: 137 },
    { time: '14:00', actual: null, predicted: 150, upper: 158, lower: 142 }
  ];
  const attendanceTimeline = [
    { time: '06:00', actual: 94, predicted: null },
    { time: '07:00', actual: 96, predicted: null },
    { time: '08:00', actual: 92, predicted: null },
    { time: '09:00', actual: 90, predicted: null },
    { time: '10:00', actual: 88, predicted: 88, now: true },
    { time: '11:00', actual: null, predicted: 83, upper: 88, lower: 79 },
    { time: '12:00', actual: null, predicted: 79, upper: 85, lower: 73 },
    { time: '13:00', actual: null, predicted: 85, upper: 92, lower: 79 },
    { time: '14:00', actual: null, predicted: 92, upper: 98, lower: 85 }
  ];
  const receivingUPLH = [
    { time: '06:00', actual: 88, predicted: null },
    { time: '08:00', actual: 90, predicted: null },
    { time: '10:00', actual: 92, predicted: 92, now: true },
    { time: '12:00', actual: null, predicted: 88, upper: 93, lower: 83 },
    { time: '14:00', actual: null, predicted: 90, upper: 96, lower: 84 }
  ];
  const pickingUPLH = [
    { time: '06:00', actual: 148, predicted: null },
    { time: '08:00', actual: 150, predicted: null },
    { time: '10:00', actual: 152, predicted: 152, now: true },
    { time: '12:00', actual: null, predicted: 145, upper: 155, lower: 135 },
    { time: '14:00', actual: null, predicted: 155, upper: 165, lower: 145 }
  ];
  const packingUPLH = [
    { time: '06:00', actual: 102, predicted: null },
    { time: '08:00', actual: 105, predicted: null },
    { time: '10:00', actual: 108, predicted: 108, now: true },
    { time: '12:00', actual: null, predicted: 100, upper: 110, lower: 90 },
    { time: '14:00', actual: null, predicted: 112, upper: 122, lower: 102 }
  ];

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg, background: 'white', margin: `-${sp.lg}`, padding: sp.lg, minHeight: '100vh' }}>
      {/* Time Scrubber */}
      <TimeScrubber />
      
      <Breadcrumb items={[{ label: 'Executive Summary', onClick: onBack }, { label: 'Staff' }]} />
      <Header icon={Users} title="Staff" sub="Labor capacity, productivity, allocation" color={C.purple[500]} />
      
      {/* Staff Roster Data Grid */}
      <DataGrid title="Staff Roster" subtitle="All employees assigned to current shift" columns={staffColumns} data={staffData} color={C.purple[500]} filterOptions={staffFilters} entityType="staff" />
      
      {/* Headcount Forecast */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Headcount Forecast</h3>
              {isContextualDifferent && interpolateValue(staffTimeline, contextualTime) && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{interpolateValue(staffTimeline, contextualTime)} FTE</strong> {isContextualPast && '(past)'}
                </span>
              )}
            </div>
            <Badge status="warning" label="Gap 11-13:00" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Active FTEs on floor over time • Now: 42 → Pred: 44 @ 14:00 • Target: 48 FTE</p>
        </div>
        <PredictiveTimeline data={staffTimeline} height={160} target={48} warning={44} critical={40} contextualTime={contextualTime} />
      </Card>
      
      {/* Attendance Coverage */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Attendance Coverage Forecast</h3>
              {isContextualDifferent && interpolateValue(attendanceTimeline, contextualTime) && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{interpolateValue(attendanceTimeline, contextualTime)}%</strong>
                </span>
              )}
            </div>
            <Badge status="warning" label="Below 85% @ 12:00" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Percentage of scheduled staff present • Now: 88% → Pred: 92% @ 14:00 • Target: 95%</p>
        </div>
        <PredictiveTimeline data={attendanceTimeline} height={160} target={95} warning={85} critical={80} contextualTime={contextualTime} />
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md, marginTop: sp.md }}>
          <div style={{ padding: sp.md, background: C.success[50], borderRadius: 8, textAlign: 'center' }}><UserCheck style={{ width: 20, height: 20, color: C.success[600], margin: '0 auto 8px' }} /><p style={{ fontSize: '24px', fontWeight: 500, color: C.success[700] }}>42</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Present</p></div>
          <div style={{ padding: sp.md, background: C.error[50], borderRadius: 8, textAlign: 'center' }}><UserX style={{ width: 20, height: 20, color: C.error[600], margin: '0 auto 8px' }} /><p style={{ fontSize: '24px', fontWeight: 500, color: C.error[700] }}>4</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Call-outs</p></div>
          <div style={{ padding: sp.md, background: C.warning[50], borderRadius: 8, textAlign: 'center' }}><Clock style={{ width: 20, height: 20, color: C.warning[600], margin: '0 auto 8px' }} /><p style={{ fontSize: '24px', fontWeight: 500, color: C.warning[700] }}>2</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Late</p></div>
          <div style={{ padding: sp.md, background: C.brand[100], borderRadius: 8, textAlign: 'center' }}><UserPlus style={{ width: 20, height: 20, color: C.brand[600], margin: '0 auto 8px' }} /><p style={{ fontSize: '24px', fontWeight: 500, color: C.brand[700] }}>6</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Overtime</p></div>
        </div>
      </Card>
      
      {/* Productivity Forecast */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Overall Productivity (UPLH)</h3>
              {isContextualDifferent && interpolateValue(productivityTimeline, contextualTime) && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{interpolateValue(productivityTimeline, contextualTime)} UPLH</strong>
                </span>
              )}
            </div>
            <Badge status="success" label="Above target" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Units per labor hour • Now: 152 → Pred: 150 @ 14:00 • Target: 150 UPLH</p>
        </div>
        <PredictiveTimeline data={productivityTimeline} height={160} target={150} warning={140} critical={130} contextualTime={contextualTime} />
      </Card>
      
      {/* UPLH by Function */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Productivity by Function</h3>
            {isContextualDifferent && (
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>
                • <span style={{ padding: '1px 6px', background: C.brand[100], color: C.brand[600], borderRadius: 3 }}>Blue</span> = @{contextualTime}
              </span>
            )}
          </div>
        </div>
        <div style={{ marginBottom: sp.md, padding: sp.md, background: C.neutral[50], borderRadius: 8 }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
            <span style={{ fontSize: '14px', fontWeight: 500 }}>Receiving</span>
            <span style={{ fontSize: '13px', color: C.neutral[500] }}>
              Now: 92 
              {isContextualDifferent && interpolateValue(receivingUPLH, contextualTime) && (
                <span style={{ color: C.brand[600] }}> → {interpolateValue(receivingUPLH, contextualTime)}</span>
              )}
              → Pred: 90 (Target: 95)
            </span>
          </div>
          <PredictiveTimeline data={receivingUPLH} height={80} target={95} warning={90} contextualTime={contextualTime} />
        </div>
        <div style={{ marginBottom: sp.md, padding: sp.md, background: C.neutral[50], borderRadius: 8 }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
            <span style={{ fontSize: '14px', fontWeight: 500 }}>Picking</span>
            <span style={{ fontSize: '13px', color: C.neutral[500] }}>
              Now: 152
              {isContextualDifferent && interpolateValue(pickingUPLH, contextualTime) && (
                <span style={{ color: C.brand[600] }}> → {interpolateValue(pickingUPLH, contextualTime)}</span>
              )}
              → Pred: 155 (Target: 150)
            </span>
          </div>
          <PredictiveTimeline data={pickingUPLH} height={80} target={150} warning={140} contextualTime={contextualTime} />
        </div>
        <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8 }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
            <span style={{ fontSize: '14px', fontWeight: 500 }}>Packing</span>
            <span style={{ fontSize: '13px', color: C.neutral[500] }}>
              Now: 108
              {isContextualDifferent && interpolateValue(packingUPLH, contextualTime) && (
                <span style={{ color: C.brand[600] }}> → {interpolateValue(packingUPLH, contextualTime)}</span>
              )}
              → Pred: 112 (Target: 115)
            </span>
          </div>
          <PredictiveTimeline data={packingUPLH} height={80} target={115} warning={105} contextualTime={contextualTime} />
        </div>
      </Card>
      
      {/* Analysis - BOTTOM */}
      <Card style={{ borderLeft: `4px solid ${C.purple[500]}` }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
          <div style={{ width: 32, height: 32, borderRadius: 6, background: C.purple[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Zap style={{ width: 16, height: 16, color: C.purple[600] }} /></div>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and recommendations for staffing</p></div>
          <Badge status="purple" label={`${alerts.length} Active`} style={{ marginLeft: 'auto' }} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>{alerts.map((a, i) => <Alert key={i} {...a} />)}</div>
      </Card>
    </div>
  );
};

const ZonesView = ({ onBack, onZone }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue } = useTimeContext();
  
  const zones = ['Inbound A', 'Inbound B', 'QA Station', 'Bulk Storage', 'Reserve 1', 'Reserve 2', 'Forward Pick A', 'Forward Pick B', 'Forward Pick C', 'Pack Station 1', 'Pack Station 2', 'Shipping Dock A', 'Shipping Dock B', 'Returns', 'Hazmat', 'Cold Storage'].map((name, i) => {
    const cur = 35 + Math.floor(Math.random() * 45), delta = Math.floor(Math.random() * 20), pred = Math.min(98, cur + delta);
    const zoneId = `Z${(i + 1).toString().padStart(2, '0')}`;
    return { id: zoneId, name, cur, pred, clickable: name.startsWith('Inbound') || zoneId === 'Z04' };
  });
  const zoneColor = p => p >= 90 ? { bg: C.error[500], txt: 'white' } : p >= 80 ? { bg: C.warning[500], txt: 'white' } : p >= 65 ? { bg: C.warning[100], txt: C.warning[700] } : { bg: C.success[100], txt: C.success[700] };
  
  // Predictive timeline for critical zone Z04
  const z04Timeline = [
    { time: '06:00', actual: 62, predicted: null },
    { time: '07:00', actual: 68, predicted: null },
    { time: '08:00', actual: 74, predicted: null },
    { time: '09:00', actual: 79, predicted: null },
    { time: '10:00', actual: 83, predicted: 83, now: true },
    { time: '11:00', actual: null, predicted: 88, upper: 91, lower: 85 },
    { time: '12:00', actual: null, predicted: 91, upper: 95, lower: 87 },
    { time: '13:00', actual: null, predicted: 89, upper: 94, lower: 84 },
    { time: '14:00', actual: null, predicted: 85, upper: 91, lower: 79 }
  ];
  const overallTimeline = [
    { time: '06:00', actual: 58, predicted: null },
    { time: '07:00', actual: 62, predicted: null },
    { time: '08:00', actual: 65, predicted: null },
    { time: '09:00', actual: 68, predicted: null },
    { time: '10:00', actual: 71, predicted: 71, now: true },
    { time: '11:00', actual: null, predicted: 74, upper: 77, lower: 71 },
    { time: '12:00', actual: null, predicted: 76, upper: 80, lower: 72 },
    { time: '13:00', actual: null, predicted: 74, upper: 78, lower: 70 },
    { time: '14:00', actual: null, predicted: 72, upper: 76, lower: 68 }
  ];

  const zonesData = [
    { id: 'Z01', name: 'Inbound A', type: 'Receiving', locations: 48, occupied: 32, utilization: 67, status: 'Normal' },
    { id: 'Z02', name: 'Inbound B', type: 'Receiving', locations: 48, occupied: 38, utilization: 79, status: 'Normal' },
    { id: 'Z03', name: 'QA Station', type: 'Quality', locations: 24, occupied: 18, utilization: 75, status: 'Normal' },
    { id: 'Z04', name: 'Bulk Storage', type: 'Reserve', locations: 2400, occupied: 1992, utilization: 83, status: 'Warning' },
    { id: 'Z05', name: 'Reserve 1', type: 'Reserve', locations: 1800, occupied: 1260, utilization: 70, status: 'Normal' },
    { id: 'Z06', name: 'Reserve 2', type: 'Reserve', locations: 1800, occupied: 1134, utilization: 63, status: 'Normal' },
    { id: 'Z07', name: 'Forward Pick A', type: 'Active', locations: 800, occupied: 768, utilization: 96, status: 'Critical' },
    { id: 'Z08', name: 'Forward Pick B', type: 'Active', locations: 800, occupied: 704, utilization: 88, status: 'Warning' },
    { id: 'Z09', name: 'Forward Pick C', type: 'Active', locations: 800, occupied: 640, utilization: 80, status: 'Warning' },
    { id: 'Z10', name: 'Pack Station 1', type: 'Packing', locations: 32, occupied: 24, utilization: 75, status: 'Normal' },
    { id: 'Z11', name: 'Pack Station 2', type: 'Packing', locations: 32, occupied: 28, utilization: 88, status: 'Warning' },
    { id: 'Z12', name: 'Shipping Dock A', type: 'Shipping', locations: 12, occupied: 8, utilization: 67, status: 'Normal' },
    { id: 'Z13', name: 'Shipping Dock B', type: 'Shipping', locations: 12, occupied: 10, utilization: 83, status: 'Warning' },
    { id: 'Z14', name: 'Returns', type: 'Returns', locations: 200, occupied: 94, utilization: 47, status: 'Normal' },
    { id: 'Z15', name: 'Hazmat', type: 'Hazmat', locations: 100, occupied: 62, utilization: 62, status: 'Normal' },
    { id: 'Z16', name: 'Cold Storage', type: 'Cold', locations: 400, occupied: 296, utilization: 74, status: 'Normal' },
  ];
  const zonesColumns = [
    { key: 'id', label: 'ID' },
    { key: 'name', label: 'Name' },
    { key: 'type', label: 'Type' },
    { key: 'locations', label: 'Locations', align: 'right' },
    { key: 'utilization', label: 'Util %', align: 'right', render: (v) => <span style={{ color: v >= 90 ? C.error[600] : v >= 80 ? C.warning[600] : C.success[600] }}>{v}%</span> },
    { key: 'status', label: 'Status', render: (v) => <Badge status={v === 'Normal' ? 'success' : v === 'Warning' ? 'warning' : 'error'} label={v} /> }
  ];
  const zonesFilters = [
    { key: 'type', label: 'Type', options: ['Receiving', 'Reserve', 'Active', 'Packing', 'Shipping'] },
    { key: 'status', label: 'Status', options: ['Normal', 'Warning', 'Critical'] }
  ];
  // Zones alerts using shared data
  const zonesAlerts = [
    ALERTS_DATA['zones-z04-capacity'],
    ALERTS_DATA['zones-z02-underutilized'],
    ALERTS_DATA['zones-z01-pick-congestion'],
    ALERTS_DATA['zones-z03-replen-needed']
  ];

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg, background: 'white', margin: `-${sp.lg}`, padding: sp.lg, minHeight: '100vh' }}>
      {/* Time Scrubber */}
      <TimeScrubber />
      
      <Breadcrumb items={[{ label: 'Executive Summary', onClick: onBack }, { label: 'Zones' }]} />
      <Header icon={MapPin} title="Zones" sub="Physical space utilization" color={C.blueLight[500]} />
      
      {/* Zones Data Grid */}
      <DataGrid title="Zone Inventory" subtitle="All warehouse zones and capacity" columns={zonesColumns} data={zonesData} color={C.blueLight[500]} filterOptions={zonesFilters} />
      
      {/* Zone Z04 Critical */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Zone Z04 (Bulk Storage)</h3>
              {isContextualDifferent && interpolateValue(z04Timeline, contextualTime) && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{interpolateValue(z04Timeline, contextualTime)}%</strong> {isContextualPast && '(past)'}
                </span>
              )}
            </div>
            <Badge status="error" label="Breach @ 12:00" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Critical zone capacity forecast • Now: 83% → Pred: 85% @ 14:00 • Threshold: 90%</p>
        </div>
        <PredictiveTimeline data={z04Timeline} height={160} warning={80} critical={90} contextualTime={contextualTime} />
        <div style={{ display: 'flex', gap: sp.md, marginTop: sp.sm, padding: sp.sm, background: C.error[50], borderRadius: 6 }}>
          <AlertTriangle style={{ width: 14, height: 14, color: C.error[600], flexShrink: 0 }} />
          <p style={{ fontSize: '11px', color: C.error[700] }}>91% predicted at 12:00 • Expedite putaway or redirect to Z05</p>
        </div>
      </Card>
      
      {/* Overall Utilization */}
      <Card>
        <div style={{ marginBottom: sp.sm }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.xs }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Overall Utilization</h3>
              {isContextualDifferent && interpolateValue(overallTimeline, contextualTime) && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{interpolateValue(overallTimeline, contextualTime)}%</strong>
                </span>
              )}
            </div>
            <Badge status="success" label="Healthy" />
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Average space utilization across all 16 zones • Now: 71% → Pred: 72% @ 14:00</p>
        </div>
        <PredictiveTimeline data={overallTimeline} height={160} warning={75} critical={85} contextualTime={contextualTime} />
      </Card>
      
      {/* Zone Heatmap */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.xs }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Zone Utilization Heatmap</h3>
            <div style={{ display: 'flex', gap: sp.sm }}>{[['<65%', C.success[100]], ['65-79%', C.warning[100]], ['80-89%', C.warning[500]], ['≥90%', C.error[500]]].map(([l, c], i) => <span key={i} style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: '11px', color: C.neutral[500] }}><span style={{ width: 12, height: 12, borderRadius: 2, background: c }} />{l}</span>)}</div>
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Predicted space utilization by zone • Color indicates capacity status • Click on item to view details</p>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
          {zones.map(z => {
            const { bg, txt } = zoneColor(z.pred);
            return (
              <div 
                key={z.id} 
                onClick={() => z.clickable && onZone && onZone(z.id)} 
                className={z.clickable ? 'card-click' : ''}
                style={{ background: bg, color: txt, borderRadius: 8, padding: sp.md, cursor: z.clickable ? 'pointer' : 'default', transition: 'all 0.15s' }}
                onMouseEnter={(e) => { if (z.clickable) { e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)'; e.currentTarget.style.transform = 'translateY(-2px)'; }}}
                onMouseLeave={(e) => { if (z.clickable) { e.currentTarget.style.boxShadow = 'none'; e.currentTarget.style.transform = 'translateY(0)'; }}}
              >
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                  <span style={{ fontSize: '11px', fontWeight: 600, opacity: 0.85 }}>{z.id}</span>
                  {z.pred >= 90 && <AlertTriangle style={{ width: 12, height: 12 }} />}
                  {z.clickable && <ChevronRight style={{ width: 12, height: 12, opacity: 0.7 }} />}
                </div>
                <p style={{ fontSize: '20px', fontWeight: 500 }}>{z.pred}%</p>
                <div style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: '11px', opacity: 0.85 }}><span>{z.cur}%</span><ArrowRight style={{ width: 10, height: 10 }} /><span>+{z.pred - z.cur}%</span></div>
                <p style={{ fontSize: '10px', opacity: 0.7, marginTop: 4 }}>{z.name}</p>
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* Analysis - BOTTOM */}
      <Card style={{ borderLeft: `4px solid ${C.blueLight[500]}` }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
          <div style={{ width: 32, height: 32, borderRadius: 6, background: C.blueLight[50], display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Zap style={{ width: 16, height: 16, color: C.blueLight[500] }} /></div>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and recommendations for zones • Click for details</p></div>
          <Badge status="info" label={`${zonesAlerts.length} Active`} style={{ marginLeft: 'auto' }} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {zonesAlerts.map((a, i) => (
            <Alert 
              key={i} 
              {...a} 
              onClick={() => onNavigateToAlert && onNavigateToAlert(a.id, a.category, true)}
            />
          ))}
        </div>
        <div 
          onClick={() => onViewInsights && onViewInsights()}
          style={{ 
            marginTop: sp.md, paddingTop: sp.md, borderTop: `1px solid ${C.neutral[200]}`,
            display: 'flex', alignItems: 'center', justifyContent: 'center', gap: sp.xs,
            cursor: 'pointer', color: C.blueLight[600], fontSize: '13px', fontWeight: 500
          }}
          onMouseEnter={(e) => e.currentTarget.style.color = C.blueLight[700]}
          onMouseLeave={(e) => e.currentTarget.style.color = C.blueLight[600]}
        >
          View Full Analysis <ChevronRight style={{ width: 16, height: 16 }} />
        </div>
      </Card>
    </div>
  );
};

// ===== INBOUND ZONE DETAIL =====
const InboundZoneDetail = ({ zoneId, onBack, onBackToExec, onDockDetail }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue } = useTimeContext();
  const [activeTab, setActiveTab] = useState('dashboard');
  
  const zoneName = zoneId === 'Z01' ? 'Inbound A' : 'Inbound B';
  const dockDoors = zoneId === 'Z01' ? ['D01', 'D02', 'D03', 'D04'] : ['D05', 'D06', 'D07', 'D08'];
  
  // Tab definitions
  const tabs = [
    { id: 'dashboard', icon: LayoutDashboard, label: 'Dashboard' },
    { id: 'staff', icon: Users, label: 'Staff' },
    { id: 'locations', icon: MapPin, label: 'Locations' },
    { id: 'work', icon: Package, label: 'Work Content' },
    { id: 'spaceUtil', icon: BoxSelect, label: 'Space Utilization' },
    { id: 'equipment', icon: Wrench, label: 'Equipment' },
    { id: 'schedule', icon: Calendar, label: 'Schedule' },
    { id: 'insights', icon: Lightbulb, label: 'Insights' },
    { id: 'config', icon: Filter, label: 'Config' }
  ];
  
  // Zone Overview Metrics
  const zoneMetrics = {
    spaceUtil: { cur: 68, pred: 74, target: 80 },
    throughput: { cur: 142, pred: 168, target: 180 },
    dwellTime: { cur: 38, pred: 42, target: 45 },
    accuracy: { cur: 98.2, pred: 97.8, target: 99 }
  };
  
  // KPI Timelines for header cards
  const kpiTimelines = {
    palletsHr: [
      { time: '06:00', actual: 0 }, { time: '08:00', actual: 78 }, { time: '10:00', actual: 142 },
      { time: '12:00', predicted: 165 }, { time: '14:00', predicted: 168 }
    ],
    dwellTime: [
      { time: '06:00', actual: 32 }, { time: '08:00', actual: 35 }, { time: '10:00', actual: 38 },
      { time: '12:00', predicted: 44 }, { time: '14:00', predicted: 42 }
    ],
    accuracy: [
      { time: '06:00', actual: 99.1 }, { time: '08:00', actual: 98.8 }, { time: '10:00', actual: 98.2 },
      { time: '12:00', predicted: 97.9 }, { time: '14:00', predicted: 97.8 }
    ],
    stagedPallets: [
      { time: '06:00', actual: 22 }, { time: '08:00', actual: 35 }, { time: '10:00', actual: 47 },
      { time: '12:00', predicted: 58 }, { time: '14:00', predicted: 62 }
    ],
    dockUtil: [
      { time: '06:00', actual: 50 }, { time: '08:00', actual: 75 }, { time: '10:00', actual: 75 },
      { time: '12:00', predicted: 100 }, { time: '14:00', predicted: 85 }
    ]
  };
  
  // Staffing Data
  const staff = [
    { role: 'Dock Workers', icon: Users, scheduled: 4, present: 4, productivity: 94 },
    { role: 'Forklift Operators', icon: Truck, scheduled: 3, present: 3, productivity: 102 },
    { role: 'Receiving Clerks', icon: ClipboardList, scheduled: 2, present: 2, productivity: 98 },
    { role: 'QC Inspectors', icon: CheckCircle, scheduled: 1, present: 1, productivity: 100 }
  ];
  
  // Equipment Status
  const equipment = [
    { type: 'Sit-Down Forklift', total: 3, active: 2, maint: 0, idle: 1, utilPred: 85 },
    { type: 'Electric Pallet Jack', total: 4, active: 3, maint: 1, idle: 0, utilPred: 92 },
    { type: 'Manual Pallet Jack', total: 6, active: 4, maint: 0, idle: 2, utilPred: 78 },
    { type: 'RF Scanner', total: 10, active: 8, maint: 0, idle: 2, utilPred: 88 },
    { type: 'Dock Leveler', total: 4, active: 3, maint: 0, idle: 1, utilPred: 82 }
  ];
  
  // Dock Door Status (Trailers)
  const dockStatus = dockDoors.map((door, i) => ({
    door,
    status: i < 3 ? 'occupied' : 'available',
    trailer: i < 3 ? `TRL-${1000 + i}` : null,
    carrier: i < 3 ? ['FedEx', 'UPS', 'ABC Freight'][i] : null,
    arrived: i < 3 ? ['08:15', '09:02', '09:45'][i] : null,
    progress: i < 3 ? [85, 42, 15][i] : 0,
    pallets: i < 3 ? [18, 24, 32][i] : 0,
    unloaded: i < 3 ? [15, 10, 5][i] : 0,
    eta: i < 3 ? ['10:30', '11:15', '12:00'][i] : null
  }));
  
  // Staged Pallets (Entities in zone)
  const stagedPallets = {
    current: 47,
    predicted: 62,
    capacity: 80,
    byStatus: [
      { status: 'Awaiting Putaway', count: 28, color: C.warning[500] },
      { status: 'QC Hold', count: 8, color: C.error[500] },
      { status: 'Ready for Putaway', count: 11, color: C.success[500] }
    ]
  };
  
  // ASN/PO Tracking
  const asnData = [
    { asn: 'ASN-4521', po: 'PO-8834', vendor: 'Acme Corp', lines: 12, received: 10, variance: 0, status: 'in-progress' },
    { asn: 'ASN-4522', po: 'PO-8835', vendor: 'Global Supply', lines: 8, received: 8, variance: 0, status: 'complete' },
    { asn: 'ASN-4523', po: 'PO-8836', vendor: 'FastShip Inc', lines: 24, received: 5, variance: 1, status: 'in-progress' },
    { asn: 'ASN-4524', po: 'PO-8837', vendor: 'Prime Dist', lines: 6, received: 0, variance: 0, status: 'pending' }
  ];
  
  // Predictive Timelines
  const throughputTimeline = [
    { time: '06:00', actual: 0, predicted: null },
    { time: '07:00', actual: 35, predicted: null },
    { time: '08:00', actual: 78, predicted: null },
    { time: '09:00', actual: 112, predicted: null },
    { time: '10:00', actual: 142, predicted: 142, now: true },
    { time: '11:00', actual: null, predicted: 168, upper: 180, lower: 156 },
    { time: '12:00', actual: null, predicted: 195, upper: 210, lower: 180 },
    { time: '13:00', actual: null, predicted: 218, upper: 235, lower: 200 },
    { time: '14:00', actual: null, predicted: 238, upper: 260, lower: 216 }
  ];
  
  const spaceTimeline = [
    { time: '06:00', actual: 45, predicted: null },
    { time: '07:00', actual: 52, predicted: null },
    { time: '08:00', actual: 58, predicted: null },
    { time: '09:00', actual: 64, predicted: null },
    { time: '10:00', actual: 68, predicted: 68, now: true },
    { time: '11:00', actual: null, predicted: 72, upper: 76, lower: 68 },
    { time: '12:00', actual: null, predicted: 74, upper: 79, lower: 69 },
    { time: '13:00', actual: null, predicted: 71, upper: 77, lower: 65 },
    { time: '14:00', actual: null, predicted: 65, upper: 72, lower: 58 }
  ];
  
  // Categorized Alerts
  const alerts = {
    all: [
      { sev: 'warning', title: 'Staged pallet congestion', msg: `Predicted ${stagedPallets.predicted} pallets @ 12:00 (capacity: ${stagedPallets.capacity})`, time: '+2hr', conf: 78, category: 'space' },
      { sev: 'info', title: 'Pallet jack in maintenance', msg: 'EPJ-03 scheduled maintenance until 11:30', time: 'Now', conf: 100, category: 'equipment' },
      { sev: 'warning', title: 'Trailer TRL-1002 running long', msg: 'Predicted completion 12:00 (45min over target)', time: '+2hr', conf: 72, category: 'locations' },
      { sev: 'info', title: 'ASN variance detected', msg: 'ASN-4523 has 1 line variance from PO', time: 'Now', conf: 100, category: 'work' }
    ],
    staff: [],
    work: [],
    space: [],
    equipment: [],
    locations: []
  };
  // Distribute alerts to categories
  alerts.all.forEach(a => { if (alerts[a.category]) alerts[a.category].push(a); });
  
  // Section Header Component
  const SectionHeader = ({ icon: Icon, title, color }) => (
    <div style={{ display: 'flex', alignItems: 'center', gap: sp.md, marginTop: sp.lg, marginBottom: sp.md }}>
      <div style={{ width: 36, height: 36, borderRadius: 8, background: `${color}15`, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
        <Icon style={{ width: 20, height: 20, color }} />
      </div>
      <h2 style={{ fontSize: '18px', fontWeight: 500, color: C.neutral[800], margin: 0 }}>{title}</h2>
    </div>
  );
  
  // Inline Alert Component (smaller, contextual)
  const InlineAlert = ({ sev, title, msg, time, conf }) => {
    const colors = { critical: C.error, warning: C.warning, info: C.brand };
    const c = colors[sev] || colors.info;
    return (
      <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.sm, padding: sp.sm, background: c[50], borderRadius: 6, borderLeft: `3px solid ${c[500]}`, marginTop: sp.sm }}>
        <AlertTriangle style={{ width: 14, height: 14, color: c[600], flexShrink: 0, marginTop: 2 }} />
        <div style={{ flex: 1 }}>
          <p style={{ fontSize: '12px', fontWeight: 500, color: c[700] }}>{title}</p>
          <p style={{ fontSize: '11px', color: c[600] }}>{msg}</p>
        </div>
        <div style={{ textAlign: 'right' }}>
          <span style={{ fontSize: '10px', color: c[500] }}>{time}</span>
          {conf && <p style={{ fontSize: '10px', color: C.neutral[400] }}>{conf}% conf</p>}
        </div>
      </div>
    );
  };

  return (
    <div style={{ display: 'flex', background: 'white', margin: `-${sp.lg}`, minHeight: '100vh' }}>
      {/* Tab sidebar - LEFT SIDE */}
      <div style={{ width: 52, background: C.neutral[100], borderRight: `1px solid ${C.neutral[200]}`, display: 'flex', flexDirection: 'column', paddingTop: sp.md, flexShrink: 0 }}>
        {tabs.map(tab => {
          const Icon = tab.icon;
          const isActive = activeTab === tab.id;
          return (
            <div
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              title={tab.label}
              style={{
                width: 40,
                height: 40,
                margin: '0 auto',
                marginBottom: 4,
                borderRadius: 8,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                cursor: 'pointer',
                background: isActive ? C.brand[100] : 'transparent',
                border: isActive ? `2px solid ${C.brand[500]}` : '2px solid transparent',
                transition: 'all 0.15s'
              }}
            >
              <Icon style={{ width: 18, height: 18, color: isActive ? C.brand[600] : C.neutral[500] }} />
            </div>
          );
        })}
      </div>
      
      {/* Main content area */}
      <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: sp.lg, padding: sp.lg, overflow: 'auto', maxWidth: 708 }}>
        {/* Time Scrubber */}
        <TimeScrubber />
      
        {/* Breadcrumb */}
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, fontSize: '12px' }}>
          <span style={{ color: C.brand[600], cursor: 'pointer' }} onClick={onBackToExec}>🏠 {'{facilityName}'} Overview</span>
          <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
          <span style={{ color: C.neutral[700], fontWeight: 500 }}>{zoneId} {zoneName}</span>
        </div>
      
        {/* Dashboard Tab Content */}
        {activeTab === 'dashboard' && (
          <>
            {/* ===== HEADER WITH KPIs ===== */}
            <div style={{ background: `linear-gradient(135deg, ${C.blueLight[500]} 0%, ${C.brand[600]} 100%)`, borderRadius: 12, padding: sp.lg, color: 'white' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.lg }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
            <div style={{ padding: sp.sm, background: 'rgba(255,255,255,0.15)', borderRadius: 10 }}>
              <Truck style={{ width: 28, height: 28 }} />
            </div>
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <h2 style={{ fontSize: '26px', fontWeight: 300, margin: 0 }}>{zoneId} — {zoneName}</h2>
                <Badge status="success" label="Active" />
              </div>
              <p style={{ opacity: 0.8, fontSize: '14px', marginTop: 4 }}>Inbound Receiving Dock • {dockDoors.length} Dock Doors</p>
            </div>
          </div>
          <div style={{ textAlign: 'right' }}>
            <p style={{ opacity: 0.7, fontSize: '12px' }}>Space Utilization</p>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.sm, flexWrap: 'wrap' }}>
              <span style={{ fontSize: '42px', fontWeight: 300 }}>{zoneMetrics.spaceUtil.cur}%</span>
              {isContextualDifferent && interpolateValue(spaceTimeline, contextualTime) && (
                <>
                  <ArrowRight style={{ width: 14, height: 14, opacity: 0.7 }} />
                  <span style={{ fontSize: '20px', fontWeight: 500, padding: '2px 8px', background: 'rgba(47, 114, 255, 0.4)', borderRadius: 4 }}>
                    {interpolateValue(spaceTimeline, contextualTime)}%
                  </span>
                </>
              )}
              <ArrowRight style={{ width: 16, height: 16, opacity: 0.7 }} />
              <span style={{ fontSize: '24px', fontWeight: 500 }}>{zoneMetrics.spaceUtil.pred}%</span>
            </div>
            {isContextualDifferent && (
              <p style={{ opacity: 0.7, fontSize: '11px', marginTop: 4 }}>@{contextualTime} {isContextualPast && '(past)'}</p>
            )}
          </div>
        </div>
        
        {/* KPI Stats - includes Dwell Time */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: sp.md }}>
          {[
            { l: 'Pallets/Hr', v: zoneMetrics.throughput.cur, p: zoneMetrics.throughput.pred, t: zoneMetrics.throughput.target, icon: Package, timeline: kpiTimelines.palletsHr },
            { l: 'Avg Dwell (min)', v: zoneMetrics.dwellTime.cur, p: zoneMetrics.dwellTime.pred, t: `≤${zoneMetrics.dwellTime.target}`, icon: Clock, warn: zoneMetrics.dwellTime.pred > zoneMetrics.dwellTime.target, timeline: kpiTimelines.dwellTime },
            { l: 'Receiving Accuracy', v: `${zoneMetrics.accuracy.cur}%`, p: `${zoneMetrics.accuracy.pred}%`, t: `${zoneMetrics.accuracy.target}%`, icon: CheckCircle, timeline: kpiTimelines.accuracy, format: v => `${v.toFixed(1)}%` },
            { l: 'Staged Pallets', v: stagedPallets.current, p: stagedPallets.predicted, t: stagedPallets.capacity, icon: Package, timeline: kpiTimelines.stagedPallets },
            { l: 'Dock Utilization', v: `${Math.round(dockStatus.filter(d => d.status === 'occupied').length / dockDoors.length * 100)}%`, p: '85%', t: '90%', icon: MapPin, timeline: kpiTimelines.dockUtil, format: v => `${Math.round(v)}%` }
          ].map((m, i) => {
            const Icon = m.icon;
            const ctxVal = isContextualDifferent && m.timeline ? interpolateValue(m.timeline, contextualTime) : null;
            const displayCtx = ctxVal !== null ? (m.format ? m.format(ctxVal) : Math.round(ctxVal)) : null;
            return (
              <div key={i} style={{ background: 'rgba(255,255,255,0.1)', borderRadius: 10, padding: sp.md }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
                  <span style={{ opacity: 0.8, fontSize: '11px' }}>{m.l}</span>
                  <Icon style={{ width: 14, height: 14, opacity: 0.7 }} />
                </div>
                <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs, flexWrap: 'wrap' }}>
                  <span style={{ fontSize: '20px', fontWeight: 300 }}>{m.v}</span>
                  {displayCtx !== null && (
                    <>
                      <ArrowRight style={{ width: 10, height: 10, opacity: 0.6 }} />
                      <span style={{ fontSize: '13px', fontWeight: 500, padding: '1px 5px', background: 'rgba(47, 114, 255, 0.4)', borderRadius: 3 }}>{displayCtx}</span>
                    </>
                  )}
                  <ArrowRight style={{ width: 10, height: 10, opacity: 0.6 }} />
                  <span style={{ fontSize: '14px', opacity: 0.9, color: m.warn ? C.warning[200] : 'inherit' }}>{m.p}</span>
                </div>
                <p style={{ fontSize: '10px', opacity: 0.6, marginTop: 4 }}>Target: {m.t}</p>
              </div>
            );
          })}
        </div>
      </div>
      
      {/* ===== ALL ALERTS (Consolidated) ===== */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Zone Alerts</h3>
          <Badge status={alerts.all.some(a => a.sev === 'critical') ? 'error' : alerts.all.some(a => a.sev === 'warning') ? 'warning' : 'success'} label={`${alerts.all.length} active`} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {alerts.all.map((a, i) => <Alert key={i} {...a} />)}
        </div>
      </Card>
      
      {/* ===== STAFF SECTION ===== */}
      <SectionHeader icon={Users} title="Staff" color={C.brand[500]} />
      
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Zone Staffing</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Personnel assigned to this zone • {staff.reduce((a, s) => a + s.present, 0)} active</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {staff.map((s, i) => {
            const Icon = s.icon;
            const gap = s.scheduled - s.present;
            return (
              <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.md, background: gap > 0 ? C.warning[50] : C.neutral[50], borderRadius: 8 }}>
                <div style={{ width: 36, height: 36, borderRadius: 8, background: C.brand[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  <Icon style={{ width: 18, height: 18, color: C.brand[600] }} />
                </div>
                <div style={{ flex: 1 }}>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>{s.role}</p>
                  <p style={{ fontSize: '12px', color: C.neutral[500] }}>{s.present}/{s.scheduled} present</p>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                  <div style={{ textAlign: 'right' }}>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>Productivity</p>
                    <p style={{ fontSize: '16px', fontWeight: 500, color: s.productivity >= 100 ? C.success[600] : s.productivity >= 90 ? C.neutral[700] : C.warning[600] }}>{s.productivity}%</p>
                  </div>
                  {gap > 0 && <Badge status="warning" label={`-${gap}`} />}
                </div>
              </div>
            );
          })}
        </div>
        {/* Staff Alerts */}
        {alerts.staff.length > 0 && alerts.staff.map((a, i) => <InlineAlert key={i} {...a} />)}
      </Card>
      
      {/* ===== WORK CONTENT SECTION ===== */}
      <SectionHeader icon={ClipboardList} title="Work Content" color={C.orange[500]} />
      
      {/* ASN/PO Tracking */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>ASN / PO Tracking</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Inbound shipment documentation</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {asnData.map((a, i) => (
            <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.md, background: a.variance > 0 ? C.warning[50] : C.neutral[50], borderRadius: 8 }}>
              <div style={{ minWidth: 100 }}>
                <p style={{ fontSize: '14px', fontWeight: 500 }}>{a.asn}</p>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>{a.po}</p>
              </div>
              <div style={{ flex: 1 }}>
                <p style={{ fontSize: '13px', color: C.neutral[700] }}>{a.vendor}</p>
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                <div style={{ textAlign: 'right' }}>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>{a.received}/{a.lines}</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>lines received</p>
                </div>
                {a.variance > 0 && <Badge status="warning" label={`${a.variance} variance`} />}
                <Badge 
                  status={a.status === 'complete' ? 'success' : a.status === 'in-progress' ? 'info' : 'warning'} 
                  label={a.status === 'complete' ? '✓ Complete' : a.status === 'in-progress' ? 'In Progress' : 'Pending'} 
                />
              </div>
            </div>
          ))}
        </div>
      </Card>
      
      {/* Receiving Throughput */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Receiving Throughput</h3>
              {isContextualDifferent && interpolateValue(throughputTimeline, contextualTime) && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{interpolateValue(throughputTimeline, contextualTime)} pallets</strong>
                </span>
              )}
            </div>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Pallets received per hour • Now: 142 → Pred: 238 @ 14:00 • Target: 180/hr</p>
          </div>
          <Badge status="success" label="On track" />
        </div>
        <PredictiveTimeline data={throughputTimeline} height={160} target={180} contextualTime={contextualTime} />
      </Card>
      
      {/* Staged Pallets - Work Content View (by status) */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Work in Progress</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Staged pallets by processing status</p>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
          {stagedPallets.byStatus.map((s, i) => (
            <div key={i} style={{ padding: sp.lg, background: C.neutral[50], borderRadius: 8, borderLeft: `4px solid ${s.color}`, textAlign: 'center' }}>
              <p style={{ fontSize: '32px', fontWeight: 500, color: C.neutral[800] }}>{s.count}</p>
              <p style={{ fontSize: '12px', color: C.neutral[500] }}>{s.status}</p>
            </div>
          ))}
        </div>
        {/* Work Alerts */}
        {alerts.work.map((a, i) => <InlineAlert key={i} {...a} />)}
      </Card>
      
      {/* ===== SPACE SECTION ===== */}
      <SectionHeader icon={MapPin} title="Space" color={C.blueLight[500]} />
      
      {/* Space Utilization Forecast */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Space Utilization Forecast</h3>
              {isContextualDifferent && interpolateValue(spaceTimeline, contextualTime) && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{interpolateValue(spaceTimeline, contextualTime)}%</strong>
                </span>
              )}
            </div>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Staging area capacity • Now: {zoneMetrics.spaceUtil.cur}% → Pred: 65% @ 14:00 • Peak: 74% @ 12:00</p>
          </div>
          <Badge status="success" label="Within capacity" />
        </div>
        <PredictiveTimeline data={spaceTimeline} height={160} warning={75} critical={85} contextualTime={contextualTime} />
      </Card>
      
      {/* Staged Pallets - Space View (capacity) */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.md }}>
          <div>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Staging Capacity</h3>
              {isContextualDifferent && interpolateValue(kpiTimelines.stagedPallets, contextualTime) && (
                <span style={{ fontSize: '13px', padding: '2px 8px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                  @{contextualTime}: <strong>{Math.round(interpolateValue(kpiTimelines.stagedPallets, contextualTime))} pallets</strong>
                </span>
              )}
            </div>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Pallet positions • Now: {stagedPallets.current} → Pred: {stagedPallets.predicted} • Capacity: {stagedPallets.capacity}</p>
          </div>
          <Badge status={stagedPallets.predicted > stagedPallets.capacity * 0.85 ? 'warning' : 'success'} label={`${stagedPallets.current} → ${stagedPallets.predicted}`} />
        </div>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.xl }}>
          <DonutChart value={Math.round(stagedPallets.current / stagedPallets.capacity * 100)} size={100} stroke={10} color={stagedPallets.current > stagedPallets.capacity * 0.75 ? C.warning[500] : C.success[500]} />
          <div style={{ flex: 1 }}>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.md, marginBottom: sp.sm, flexWrap: 'wrap' }}>
              <div>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Current</p>
                <p style={{ fontSize: '36px', fontWeight: 300 }}>{stagedPallets.current}</p>
              </div>
              {isContextualDifferent && interpolateValue(kpiTimelines.stagedPallets, contextualTime) && (
                <>
                  <ArrowRight style={{ width: 20, height: 20, color: C.neutral[400] }} />
                  <div style={{ padding: sp.sm, background: C.brand[100], borderRadius: 8 }}>
                    <p style={{ fontSize: '11px', color: C.brand[600] }}>@{contextualTime}</p>
                    <p style={{ fontSize: '28px', fontWeight: 500, color: C.brand[600] }}>{Math.round(interpolateValue(kpiTimelines.stagedPallets, contextualTime))}</p>
                  </div>
                </>
              )}
              <ArrowRight style={{ width: 20, height: 20, color: C.neutral[400] }} />
              <div>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Predicted @ 14:00</p>
                <p style={{ fontSize: '36px', fontWeight: 300, color: C.purple[600] }}>{stagedPallets.predicted}</p>
              </div>
              <div style={{ marginLeft: sp.lg }}>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Capacity</p>
                <p style={{ fontSize: '36px', fontWeight: 300, color: C.neutral[400] }}>{stagedPallets.capacity}</p>
              </div>
            </div>
            <Progress value={stagedPallets.current} max={stagedPallets.capacity} pred={stagedPallets.predicted} color={C.brand[500]} h={8} />
          </div>
        </div>
        {/* Space Alerts */}
        {alerts.space.map((a, i) => <InlineAlert key={i} {...a} />)}
      </Card>
      
      {/* ===== EQUIPMENT SECTION ===== */}
      <SectionHeader icon={Truck} title="Equipment" color={C.purple[500]} />
      
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Equipment Status</h3>
            {isContextualDifferent && (
              <span style={{ fontSize: '12px', color: C.neutral[500] }}>
                • <span style={{ padding: '1px 6px', background: C.brand[100], color: C.brand[600], borderRadius: 3 }}>Blue</span> = predicted @{contextualTime}
              </span>
            )}
          </div>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Material handling equipment in zone • Utilization predictions update with timeline</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {equipment.map((e, i) => {
            // Simple contextual interpolation for utilization
            const ctxUtil = isContextualDifferent ? Math.round(e.utilPred * (0.85 + Math.random() * 0.15)) : null;
            return (
              <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.md, background: e.maint > 0 ? C.warning[50] : C.neutral[50], borderRadius: 8 }}>
                <div style={{ flex: 1 }}>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>{e.type}</p>
                  <div style={{ display: 'flex', gap: sp.md, marginTop: 4 }}>
                    <span style={{ fontSize: '12px', color: C.success[600] }}>● {e.active} active</span>
                    {e.idle > 0 && <span style={{ fontSize: '12px', color: C.neutral[500] }}>○ {e.idle} idle</span>}
                    {e.maint > 0 && <span style={{ fontSize: '12px', color: C.warning[600] }}>⚠ {e.maint} maintenance</span>}
                  </div>
                </div>
                <div style={{ textAlign: 'right' }}>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>Util. {ctxUtil !== null ? `@${contextualTime}` : 'Pred.'}</p>
                  <p style={{ fontSize: '16px', fontWeight: 500, color: (ctxUtil || e.utilPred) >= 90 ? C.warning[600] : C.success[600], padding: ctxUtil !== null ? '2px 6px' : 0, background: ctxUtil !== null ? C.brand[100] : 'transparent', borderRadius: 4 }}>
                    {ctxUtil !== null ? ctxUtil : e.utilPred}%
                  </p>
                </div>
                <div style={{ width: 60, textAlign: 'center' }}>
                  <p style={{ fontSize: '20px', fontWeight: 500 }}>{e.active}/{e.total}</p>
                </div>
              </div>
            );
          })}
        </div>
        {/* Equipment Alerts */}
        {alerts.equipment.map((a, i) => <InlineAlert key={i} {...a} />)}
      </Card>
      
      {/* ===== LOCATIONS SECTION ===== */}
      <SectionHeader icon={MapPin} title="Locations" color={C.success[500]} />
      
      <Card 
          className="card-click"
          onClick={() => onDockDetail && onDockDetail()}
          style={{ cursor: onDockDetail ? 'pointer' : 'default' }}
        >
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.md }}>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Dock Door Status</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Trailers at dock • {dockStatus.filter(d => d.status === 'occupied').length}/{dockDoors.length} occupied</p>
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <Badge status="info" label="Click for details" />
            <ChevronRight style={{ width: 20, height: 20, color: C.neutral[400] }} />
          </div>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {dockStatus.map(d => (
            <div key={d.door} style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.md, background: d.status === 'occupied' ? C.brand[100] : C.neutral[50], borderRadius: 8, borderLeft: `4px solid ${d.status === 'occupied' ? C.brand[500] : C.neutral[300]}` }}>
              <div style={{ minWidth: 60 }}>
                <p style={{ fontSize: '16px', fontWeight: 600, color: C.neutral[800] }}>{d.door}</p>
                <p style={{ fontSize: '11px', color: d.status === 'occupied' ? C.brand[600] : C.neutral[500] }}>{d.status === 'occupied' ? 'Occupied' : 'Available'}</p>
              </div>
              {d.status === 'occupied' ? (
                <>
                  <div style={{ flex: 1 }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: 4 }}>
                      <span style={{ fontSize: '14px', fontWeight: 500 }}>{d.trailer}</span>
                      <span style={{ fontSize: '12px', color: C.neutral[500] }}>• {d.carrier}</span>
                      <span style={{ fontSize: '11px', color: C.neutral[400] }}>Arrived {d.arrived}</span>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                      <div style={{ flex: 1 }}><Progress value={d.progress} color={d.progress > 70 ? C.success[500] : C.brand[500]} h={6} /></div>
                      <span style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[600] }}>{d.progress}%</span>
                    </div>
                  </div>
                  <div style={{ textAlign: 'right', minWidth: 100 }}>
                    <p style={{ fontSize: '14px', fontWeight: 500 }}>{d.unloaded}/{d.pallets}</p>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>pallets</p>
                  </div>
                  <div style={{ textAlign: 'right', minWidth: 80 }}>
                    <p style={{ fontSize: '12px', color: C.neutral[500] }}>ETA Complete</p>
                    <p style={{ fontSize: '14px', fontWeight: 500, color: C.purple[600] }}>{d.eta}</p>
                  </div>
                </>
              ) : (
                <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  <span style={{ fontSize: '13px', color: C.neutral[400] }}>No trailer assigned</span>
                </div>
              )}
            </div>
          ))}
        </div>
        {/* Locations Alerts */}
        {alerts.locations.map((a, i) => <InlineAlert key={i} {...a} />)}
      </Card>
          </>
        )}
        
        {/* Staff Tab Content - Zone Scoped */}
        {activeTab === 'staff' && (
          <>
            <Header icon={Users} title={`${zoneId} Staff`} sub={`Personnel assigned to ${zoneName}`} color={C.purple[500]} />
            <Card>
              <div style={{ marginBottom: sp.md }}>
                <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Zone Staffing</h3>
                <p style={{ fontSize: '12px', color: C.neutral[500] }}>Personnel assigned to this zone</p>
              </div>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md, marginBottom: sp.md }}>
                <div style={{ padding: sp.md, background: C.success[50], borderRadius: 8, textAlign: 'center' }}><p style={{ fontSize: '24px', fontWeight: 500, color: C.success[700] }}>8</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Present</p></div>
                <div style={{ padding: sp.md, background: C.neutral[100], borderRadius: 8, textAlign: 'center' }}><p style={{ fontSize: '24px', fontWeight: 500, color: C.neutral[600] }}>10</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Scheduled</p></div>
                <div style={{ padding: sp.md, background: C.warning[50], borderRadius: 8, textAlign: 'center' }}><p style={{ fontSize: '24px', fontWeight: 500, color: C.warning[700] }}>2</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Gap</p></div>
                <div style={{ padding: sp.md, background: C.brand[100], borderRadius: 8, textAlign: 'center' }}><p style={{ fontSize: '24px', fontWeight: 500, color: C.brand[700] }}>94%</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Productivity</p></div>
              </div>
              <DataGrid 
                title="Staff Roster" 
                subtitle="Employees assigned to this zone" 
                columns={[
                  { key: 'name', label: 'Name' },
                  { key: 'role', label: 'Role' },
                  { key: 'status', label: 'Status', render: (v) => <Badge status={v === 'Active' ? 'success' : v === 'Break' ? 'info' : 'warning'} label={v} /> },
                  { key: 'uplh', label: 'UPLH', align: 'right' }
                ]} 
                data={[
                  { name: 'Sarah Johnson', role: 'Receiver', status: 'Active', uplh: 94 },
                  { name: 'Carlos Mendez', role: 'Forklift Op', status: 'Active', uplh: 88 },
                  { name: 'Rachel Kim', role: 'Receiver', status: 'Active', uplh: 96 },
                  { name: 'Tom Wilson', role: 'Receiver', status: 'Break', uplh: 91 }
                ]} 
                color={C.purple[500]}
                entityType="staff"
              />
            </Card>
          </>
        )}
        
        {/* Work Content Tab - Zone Scoped */}
        {activeTab === 'work' && (
          <>
            <Header icon={Package} title={`${zoneId} Work Content`} sub={`Tasks and inventory in ${zoneName}`} color={C.orange[500]} />
            <Card>
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.md }}>
                <div>
                  <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Staged Pallets</h3>
                  <p style={{ fontSize: '12px', color: C.neutral[500] }}>Now: 47 → Pred: 62 • Capacity: 80</p>
                </div>
                <Badge status="warning" label="78% capacity @ 12:00" />
              </div>
              <Progress value={47} max={80} pred={62} color={C.orange[500]} h={8} />
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md, marginTop: sp.md }}>
                <div style={{ padding: sp.md, background: C.warning[50], borderRadius: 8, textAlign: 'center', borderLeft: `3px solid ${C.warning[500]}` }}><p style={{ fontSize: '20px', fontWeight: 500 }}>28</p><p style={{ fontSize: '11px', color: C.neutral[500] }}>Awaiting Putaway</p></div>
                <div style={{ padding: sp.md, background: C.error[50], borderRadius: 8, textAlign: 'center', borderLeft: `3px solid ${C.error[500]}` }}><p style={{ fontSize: '20px', fontWeight: 500 }}>8</p><p style={{ fontSize: '11px', color: C.neutral[500] }}>QC Hold</p></div>
                <div style={{ padding: sp.md, background: C.success[50], borderRadius: 8, textAlign: 'center', borderLeft: `3px solid ${C.success[500]}` }}><p style={{ fontSize: '20px', fontWeight: 500 }}>11</p><p style={{ fontSize: '11px', color: C.neutral[500] }}>Ready</p></div>
              </div>
            </Card>
            <Card>
              <h3 style={{ fontSize: '16px', fontWeight: 500, marginBottom: sp.sm }}>ASN/PO Tracking</h3>
              <DataGrid
                columns={[
                  { key: 'asn', label: 'ASN' },
                  { key: 'vendor', label: 'Vendor' },
                  { key: 'lines', label: 'Lines', align: 'right' },
                  { key: 'received', label: 'Received', align: 'right' },
                  { key: 'status', label: 'Status', render: (v) => <Badge status={v === 'complete' ? 'success' : v === 'in-progress' ? 'info' : 'neutral'} label={v} /> }
                ]}
                data={[
                  { asn: 'ASN-4521', vendor: 'Acme Corp', lines: 12, received: 10, status: 'in-progress' },
                  { asn: 'ASN-4522', vendor: 'Global Supply', lines: 8, received: 8, status: 'complete' },
                  { asn: 'ASN-4523', vendor: 'FastShip Inc', lines: 24, received: 5, status: 'in-progress' }
                ]}
                color={C.orange[500]}
              />
            </Card>
          </>
        )}
        
        {/* Locations Tab - Child entities (Dock Doors) */}
        {activeTab === 'locations' && (
          <>
            <Header icon={MapPin} title={`${zoneId} Locations`} sub={`Dock doors and staging areas in ${zoneName}`} color={C.blueLight[500]} />
            
            {/* Cross-reference: Zone Utilization Summary */}
            <Card style={{ background: `linear-gradient(135deg, ${C.blueLight[50]} 0%, ${C.brand[50]} 100%)`, border: `1px solid ${C.blueLight[200]}` }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <div>
                  <p style={{ fontSize: '12px', color: C.neutral[500], marginBottom: 4 }}>Combined Space Utilization</p>
                  <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.sm }}>
                    <span style={{ fontSize: '28px', fontWeight: 300 }}>68%</span>
                    <ArrowRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
                    <span style={{ fontSize: '18px', fontWeight: 500, color: C.purple[600] }}>74%</span>
                    <span style={{ fontSize: '11px', color: C.neutral[500] }}>@ 14:00</span>
                  </div>
                  <p style={{ fontSize: '11px', color: C.neutral[500], marginTop: 4 }}>Based on 4 locations below</p>
                </div>
                <div style={{ width: 120 }}>
                  <Progress value={68} max={100} pred={74} color={C.blueLight[500]} h={6} />
                </div>
              </div>
            </Card>
            
            {/* Primary: Location List */}
            <Card>
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.md }}>
                <div>
                  <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Dock Doors</h3>
                  <p style={{ fontSize: '12px', color: C.neutral[500] }}>4 doors • 3 occupied • Click to view details</p>
                </div>
                <Badge status="success" label="Healthy" />
              </div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                {[
                  { id: 'D01', status: 'occupied', trailer: 'TRL-1000', progress: 30, utilization: 85 },
                  { id: 'D02', status: 'occupied', trailer: 'TRL-1001', progress: 50, utilization: 92 },
                  { id: 'D03', status: 'occupied', trailer: 'TRL-1002', progress: 70, utilization: 45 },
                  { id: 'D04', status: 'available', trailer: null, progress: 0, utilization: 0 }
                ].map((door) => (
                  <div 
                    key={door.id} 
                    onClick={() => onDockDetail && onDockDetail()} 
                    style={{ 
                      display: 'flex', 
                      alignItems: 'center', 
                      gap: sp.md, 
                      padding: sp.md, 
                      background: door.status === 'occupied' ? C.brand[50] : C.neutral[50], 
                      borderRadius: 8, 
                      cursor: 'pointer', 
                      border: `1px solid ${door.status === 'occupied' ? C.brand[200] : C.neutral[200]}` 
                    }}
                  >
                    <div style={{ width: 40, height: 40, borderRadius: 8, background: door.status === 'occupied' ? C.brand[100] : C.neutral[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                      <MapPin style={{ width: 20, height: 20, color: door.status === 'occupied' ? C.brand[600] : C.neutral[400] }} />
                    </div>
                    <div style={{ flex: 1 }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                        <span style={{ fontSize: '14px', fontWeight: 500 }}>{door.id}</span>
                        <Badge status={door.status === 'occupied' ? 'info' : 'neutral'} label={door.status === 'occupied' ? 'Occupied' : 'Available'} />
                      </div>
                      {door.trailer && <p style={{ fontSize: '11px', color: C.neutral[500] }}>{door.trailer} • {door.progress}% unloaded</p>}
                    </div>
                    {door.status === 'occupied' && (
                      <div style={{ textAlign: 'right' }}>
                        <p style={{ fontSize: '16px', fontWeight: 500, color: door.utilization > 80 ? C.warning[600] : C.success[600] }}>{door.utilization}%</p>
                        <p style={{ fontSize: '10px', color: C.neutral[500] }}>utilization</p>
                      </div>
                    )}
                    <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
                  </div>
                ))}
              </div>
            </Card>
          </>
        )}
        
        {/* Space Utilization Tab - Capacity and utilization trends */}
        {activeTab === 'spaceUtil' && (
          <>
            <Header icon={BoxSelect} title={`${zoneId} Space Utilization`} sub={`Capacity and utilization trends for ${zoneName}`} color={C.greenLight[500]} />
            <Card>
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
                <div>
                  <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Space Utilization Forecast</h3>
                  <p style={{ fontSize: '12px', color: C.neutral[500] }}>Now: 68% → Pred: 74% @ 14:00 • Target: ≤80%</p>
                </div>
                <Badge status="success" label="Healthy" />
              </div>
              <PredictiveTimeline data={spaceTimeline} height={160} target={80} warning={75} critical={90} contextualTime={contextualTime} />
            </Card>
            <Card>
              <h3 style={{ fontSize: '16px', fontWeight: 500, marginBottom: sp.md }}>Staging Capacity</h3>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.lg, marginBottom: sp.md }}>
                <div style={{ textAlign: 'center' }}>
                  <p style={{ fontSize: '32px', fontWeight: 300 }}>47</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>Current</p>
                </div>
                <ArrowRight style={{ width: 20, height: 20, color: C.neutral[400] }} />
                <div style={{ textAlign: 'center' }}>
                  <p style={{ fontSize: '24px', fontWeight: 500, color: C.purple[600] }}>62</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>Predicted</p>
                </div>
                <ArrowRight style={{ width: 20, height: 20, color: C.neutral[400] }} />
                <div style={{ textAlign: 'center' }}>
                  <p style={{ fontSize: '24px', fontWeight: 300, color: C.neutral[400] }}>80</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>Capacity</p>
                </div>
              </div>
              <Progress value={47} max={80} pred={62} color={C.greenLight[500]} h={8} />
            </Card>
            <Card>
              <h3 style={{ fontSize: '16px', fontWeight: 500, marginBottom: sp.md }}>Zone Dimensions</h3>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
                <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                  <p style={{ fontSize: '20px', fontWeight: 500 }}>2,400</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>Sq Ft</p>
                </div>
                <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                  <p style={{ fontSize: '20px', fontWeight: 500 }}>4</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>Dock Doors</p>
                </div>
                <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                  <p style={{ fontSize: '20px', fontWeight: 500 }}>80</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>Pallet Capacity</p>
                </div>
              </div>
            </Card>
            
            {/* Cross-reference: Utilization by Location */}
            <Card>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
                <div>
                  <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Utilization by Location</h3>
                  <p style={{ fontSize: '12px', color: C.neutral[500] }}>Which locations are driving utilization • Click to view details</p>
                </div>
                <span style={{ fontSize: '11px', color: C.brand[600], cursor: 'pointer' }} onClick={() => setActiveTab('locations')}>View all locations →</span>
              </div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
                {[
                  { id: 'D01', utilization: 85, status: 'occupied', trend: 'rising', pallets: 18 },
                  { id: 'D02', utilization: 92, status: 'occupied', trend: 'stable', pallets: 22 },
                  { id: 'D03', utilization: 45, status: 'occupied', trend: 'falling', pallets: 7 },
                  { id: 'D04', utilization: 0, status: 'available', trend: 'stable', pallets: 0 }
                ].map((loc) => {
                  const utilColor = loc.utilization >= 90 ? C.error[500] : loc.utilization >= 75 ? C.warning[500] : loc.utilization > 0 ? C.success[500] : C.neutral[300];
                  return (
                    <div 
                      key={loc.id} 
                      onClick={() => onDockDetail && onDockDetail(loc.id, 'spaceUtil')}
                      style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.sm, background: C.neutral[50], borderRadius: 6, cursor: 'pointer', transition: 'background 0.15s' }}
                      onMouseEnter={(e) => e.currentTarget.style.background = C.neutral[100]}
                      onMouseLeave={(e) => e.currentTarget.style.background = C.neutral[50]}
                    >
                      <div style={{ width: 8, height: 8, borderRadius: '50%', background: utilColor }} />
                      <span style={{ fontSize: '13px', fontWeight: 500, width: 40 }}>{loc.id}</span>
                      <div style={{ flex: 1 }}>
                        <Progress value={loc.utilization} max={100} color={utilColor} h={6} />
                      </div>
                      <span style={{ fontSize: '13px', fontWeight: 500, width: 45, textAlign: 'right' }}>{loc.utilization}%</span>
                      <span style={{ fontSize: '11px', color: C.neutral[500], width: 60 }}>{loc.pallets} pallets</span>
                      {loc.trend === 'rising' && <ArrowUpRight style={{ width: 14, height: 14, color: C.warning[500] }} />}
                      {loc.trend === 'falling' && <ArrowDownRight style={{ width: 14, height: 14, color: C.success[500] }} />}
                      {loc.trend === 'stable' && <ArrowRight style={{ width: 14, height: 14, color: C.neutral[400] }} />}
                      <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
                    </div>
                  );
                })}
              </div>
            </Card>
          </>
        )}
        
        {/* Equipment Tab - Zone Scoped */}
        {activeTab === 'equipment' && (
          <>
            <Header icon={Wrench} title={`${zoneId} Equipment`} sub={`Material handling equipment in ${zoneName}`} color={C.brand[500]} />
            <Card>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md, marginBottom: sp.md }}>
                <div style={{ padding: sp.md, background: C.success[50], borderRadius: 8, textAlign: 'center' }}><p style={{ fontSize: '24px', fontWeight: 500, color: C.success[700] }}>4</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Active</p></div>
                <div style={{ padding: sp.md, background: C.neutral[100], borderRadius: 8, textAlign: 'center' }}><p style={{ fontSize: '24px', fontWeight: 500, color: C.neutral[600] }}>1</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Idle</p></div>
                <div style={{ padding: sp.md, background: C.warning[50], borderRadius: 8, textAlign: 'center' }}><p style={{ fontSize: '24px', fontWeight: 500, color: C.warning[700] }}>1</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Maintenance</p></div>
                <div style={{ padding: sp.md, background: C.brand[100], borderRadius: 8, textAlign: 'center' }}><p style={{ fontSize: '24px', fontWeight: 500, color: C.brand[700] }}>78%</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Avg Util</p></div>
              </div>
              <DataGrid
                title="Zone Equipment"
                columns={[
                  { key: 'id', label: 'ID' },
                  { key: 'type', label: 'Type' },
                  { key: 'status', label: 'Status', render: (v) => <Badge status={v === 'Active' ? 'success' : v === 'Idle' ? 'neutral' : 'warning'} label={v} /> },
                  { key: 'util', label: 'Util %', align: 'right', render: (v) => v > 0 ? `${v}%` : '—' },
                  { key: 'operator', label: 'Operator', render: (v) => v || '—' }
                ]}
                data={[
                  { id: 'FL-02', type: 'Sit-Down Forklift', status: 'Active', util: 78, operator: 'Carlos Mendez' },
                  { id: 'EPJ-01', type: 'Electric Pallet Jack', status: 'Active', util: 85, operator: 'Sarah Johnson' },
                  { id: 'EPJ-03', type: 'Electric Pallet Jack', status: 'Maintenance', util: 0, operator: null },
                  { id: 'RF-12', type: 'RF Scanner', status: 'Active', util: 92, operator: 'Rachel Kim' },
                  { id: 'RF-13', type: 'RF Scanner', status: 'Active', util: 88, operator: 'Tom Wilson' }
                ]}
                color={C.brand[500]}
              />
            </Card>
          </>
        )}
        
        {/* Placeholder for other tabs */}
        {!['dashboard', 'staff', 'locations', 'work', 'spaceUtil', 'equipment'].includes(activeTab) && (
          <div style={{ padding: sp.xl, textAlign: 'center' }}>
            <div style={{ width: 48, height: 48, borderRadius: 12, background: C.neutral[100], display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto', marginBottom: sp.md }}>
              {React.createElement(tabs.find(t => t.id === activeTab)?.icon || LayoutDashboard, { style: { width: 24, height: 24, color: C.neutral[400] } })}
            </div>
            <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[600], marginBottom: sp.sm }}>{tabs.find(t => t.id === activeTab)?.label}</h3>
            <p style={{ fontSize: '13px', color: C.neutral[400] }}>{zoneId} {tabs.find(t => t.id === activeTab)?.label.toLowerCase()} content will appear here</p>
          </div>
        )}
      </div>
    </div>
  );
};

// ===== DOCK DOORS DETAIL (drill-down from Inbound Zone) =====
const DockDoorsDetail = ({ zoneId, locationId = 'D01', initialTab = 'dashboard', onBack, onBackToZones, onBackToExec }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue } = useTimeContext();
  const [activeTab, setActiveTab] = useState(initialTab);
  
  const zoneName = zoneId === 'Z01' ? 'Inbound A' : 'Inbound B';
  const dockDoors = zoneId === 'Z01' ? ['D01', 'D02', 'D03', 'D04'] : ['D05', 'D06', 'D07', 'D08'];
  
  // Tab definitions
  const tabs = [
    { id: 'dashboard', icon: LayoutDashboard, label: 'Dashboard' },
    { id: 'staff', icon: Users, label: 'Staff' },
    { id: 'locations', icon: MapPin, label: 'Locations' },
    { id: 'work', icon: Package, label: 'Work Content' },
    { id: 'spaceUtil', icon: BoxSelect, label: 'Space Utilization' },
    { id: 'equipment', icon: Wrench, label: 'Equipment' },
    { id: 'schedule', icon: Calendar, label: 'Schedule' },
    { id: 'insights', icon: Lightbulb, label: 'Insights' },
    { id: 'config', icon: Filter, label: 'Config' }
  ];
  
  // Get data for the selected location
  const locationData = {
    D01: { status: 'occupied', trailer: 'TRL-1000', carrier: 'FedEx Ground', arrived: '08:15', pallets: 18, unloaded: 15, progress: 83, utilization: 85, sqft: 600, capacity: 20 },
    D02: { status: 'occupied', trailer: 'TRL-1001', carrier: 'UPS Freight', arrived: '09:02', pallets: 24, unloaded: 10, progress: 42, utilization: 92, sqft: 600, capacity: 20 },
    D03: { status: 'occupied', trailer: 'TRL-1002', carrier: 'ABC Freight', arrived: '09:45', pallets: 32, unloaded: 5, progress: 16, utilization: 45, sqft: 600, capacity: 20 },
    D04: { status: 'available', trailer: null, carrier: null, arrived: null, pallets: 0, unloaded: 0, progress: 0, utilization: 0, sqft: 600, capacity: 20 }
  };
  const loc = locationData[locationId] || locationData.D01;
  
  // Summary metrics with timelines
  const summaryMetrics = {
    occupied: { cur: 3, pred: 4 },
    avgDwell: { cur: 52, pred: 65 },
    throughput: { cur: 74, pred: 120 },
    onTime: { cur: 85, pred: 78 }
  };
  
  const metricsTimelines = {
    occupied: [
      { time: '06:00', actual: 1 }, { time: '08:00', actual: 2 }, { time: '10:00', actual: 3 },
      { time: '12:00', predicted: 4 }, { time: '14:00', predicted: 4 }
    ],
    avgDwell: [
      { time: '06:00', actual: 35 }, { time: '08:00', actual: 42 }, { time: '10:00', actual: 52 },
      { time: '12:00', predicted: 58 }, { time: '14:00', predicted: 65 }
    ],
    throughput: [
      { time: '06:00', actual: 0 }, { time: '08:00', actual: 32 }, { time: '10:00', actual: 74 },
      { time: '12:00', predicted: 98 }, { time: '14:00', predicted: 120 }
    ],
    onTime: [
      { time: '06:00', actual: 100 }, { time: '08:00', actual: 92 }, { time: '10:00', actual: 85 },
      { time: '12:00', predicted: 80 }, { time: '14:00', predicted: 78 }
    ]
  };
  
  // Detailed dock door data
  const dockData = [
    { door: 'D01', status: 'occupied', trailer: 'TRL-1000', carrier: 'FedEx Ground', type: 'Inbound', arrived: '08:15', pallets: 18, unloaded: 15, progress: 83, eta: '10:30', dwellTime: 105, onTime: true },
    { door: 'D02', status: 'occupied', trailer: 'TRL-1001', carrier: 'UPS Freight', type: 'Inbound', arrived: '09:02', pallets: 24, unloaded: 10, progress: 42, eta: '11:15', dwellTime: 58, onTime: true },
    { door: 'D03', status: 'occupied', trailer: 'TRL-1002', carrier: 'ABC Freight', type: 'Inbound', arrived: '09:45', pallets: 32, unloaded: 5, progress: 16, eta: '12:00', dwellTime: 15, onTime: false },
    { door: 'D04', status: 'available', trailer: null, carrier: null, type: null, arrived: null, pallets: 0, unloaded: 0, progress: 0, eta: null, dwellTime: 0, onTime: null }
  ];
  
  // Timeline for dock utilization
  const dockUtilTimeline = [
    { time: '06:00', actual: 25, predicted: null },
    { time: '07:00', actual: 50, predicted: null },
    { time: '08:00', actual: 50, predicted: null },
    { time: '09:00', actual: 75, predicted: null },
    { time: '10:00', actual: 75, predicted: 75, now: true },
    { time: '11:00', actual: null, predicted: 100, upper: 100, lower: 75 },
    { time: '12:00', actual: null, predicted: 100, upper: 100, lower: 75 },
    { time: '13:00', actual: null, predicted: 75, upper: 100, lower: 50 },
    { time: '14:00', actual: null, predicted: 100, upper: 100, lower: 75 }
  ];
  
  // Upcoming arrivals
  const upcomingArrivals = [
    { trailer: 'TRL-1003', carrier: 'XPO Logistics', eta: '10:45', pallets: 28, door: 'D04' },
    { trailer: 'TRL-1004', carrier: 'FedEx Freight', eta: '11:30', pallets: 22, door: 'TBD' },
    { trailer: 'TRL-1005', carrier: 'SAIA', eta: '13:00', pallets: 36, door: 'TBD' }
  ];
  
  // Alerts
  const alerts = [
    { sev: 'warning', title: 'TRL-1002 running long', msg: 'ABC Freight trailer at D03 predicted to complete at 12:00 (45min over target)', time: '+2hr', conf: 72 },
    { sev: 'info', title: 'D04 assignment pending', msg: 'TRL-1003 (XPO) arriving 10:45, auto-assigned to D04', time: '+45min', conf: 95 }
  ];
  
  const columns = [
    { key: 'door', label: 'Door' },
    { key: 'status', label: 'Status', render: v => <Badge status={v === 'occupied' ? 'info' : 'success'} label={v} /> },
    { key: 'trailer', label: 'Trailer', render: v => v || '—' },
    { key: 'carrier', label: 'Carrier', render: v => v || '—' },
    { key: 'progress', label: 'Progress', align: 'right', render: (v, row) => row.status === 'occupied' ? (
      <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
        <div style={{ width: 60 }}><Progress value={v} color={v > 70 ? C.success[500] : C.brand[500]} h={6} /></div>
        <span style={{ fontSize: '12px' }}>{v}%</span>
      </div>
    ) : '—' },
    { key: 'pallets', label: 'Pallets', align: 'right', render: (v, row) => row.status === 'occupied' ? `${row.unloaded}/${v}` : '—' },
    { key: 'eta', label: 'ETA Complete', render: v => v ? <span style={{ color: C.purple[600], fontWeight: 500 }}>{v}</span> : '—' },
    { key: 'onTime', label: 'On-Time', render: v => v === null ? '—' : v ? <Badge status="success" label="Yes" /> : <Badge status="warning" label="At risk" /> }
  ];
  
  const filters = [
    { key: 'status', label: 'Status', options: ['occupied', 'available'] }
  ];

  return (
    <div style={{ display: 'flex', background: 'white', margin: `-${sp.lg}`, minHeight: '100vh' }}>
      {/* Tab sidebar - LEFT SIDE */}
      <div style={{ width: 52, background: C.neutral[100], borderRight: `1px solid ${C.neutral[200]}`, display: 'flex', flexDirection: 'column', paddingTop: sp.md, flexShrink: 0 }}>
        {tabs.map(tab => {
          const Icon = tab.icon;
          const isActive = activeTab === tab.id;
          return (
            <div
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              title={tab.label}
              style={{
                width: 40,
                height: 40,
                margin: '0 auto',
                marginBottom: 4,
                borderRadius: 8,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                cursor: 'pointer',
                background: isActive ? C.brand[100] : 'transparent',
                border: isActive ? `2px solid ${C.brand[500]}` : '2px solid transparent',
                transition: 'all 0.15s'
              }}
            >
              <Icon style={{ width: 18, height: 18, color: isActive ? C.brand[600] : C.neutral[500] }} />
            </div>
          );
        })}
      </div>
      
      {/* Main content area */}
      <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: sp.lg, padding: sp.lg, overflow: 'auto', maxWidth: 708 }}>
        {/* Time Scrubber */}
        <TimeScrubber />
      
        {/* Breadcrumb - journey trail */}
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, fontSize: '12px' }}>
          <span style={{ color: C.brand[600], cursor: 'pointer' }} onClick={onBackToExec}>🏠 {'{facilityName}'} Overview</span>
          <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
          <span style={{ color: C.brand[600], cursor: 'pointer' }} onClick={onBack}>{zoneId} {zoneName}</span>
          <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
          <span style={{ color: C.neutral[700], fontWeight: 500 }}>{locationId}</span>
        </div>
        
        {/* Dashboard Tab */}
        {activeTab === 'dashboard' && (
          <>
            {/* Header */}
            <div style={{ background: `linear-gradient(135deg, ${C.blueLight[500]} 0%, ${C.brand[600]} 100%)`, borderRadius: 12, padding: sp.lg, color: 'white' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.lg }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                  <div style={{ padding: sp.sm, background: 'rgba(255,255,255,0.15)', borderRadius: 10 }}>
                    <MapPin style={{ width: 28, height: 28 }} />
                  </div>
                  <div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                      <h2 style={{ fontSize: '26px', fontWeight: 300, margin: 0 }}>{locationId}</h2>
                      <Badge status={loc.status === 'occupied' ? 'info' : 'neutral'} label={loc.status} />
                    </div>
                    <p style={{ opacity: 0.8, fontSize: '14px', marginTop: 4 }}>Dock Door • {zoneId} {zoneName}</p>
                  </div>
                </div>
                <div style={{ textAlign: 'right' }}>
                  <p style={{ opacity: 0.7, fontSize: '12px' }}>Space Utilization</p>
                  <span style={{ fontSize: '42px', fontWeight: 300 }}>{loc.utilization}%</span>
                </div>
              </div>
              
              {/* KPI Grid */}
              {loc.status === 'occupied' && (
                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
                  <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: 8, padding: sp.sm }}>
                    <p style={{ fontSize: '11px', opacity: 0.7 }}>Trailer</p>
                    <p style={{ fontSize: '16px', fontWeight: 500 }}>{loc.trailer}</p>
                  </div>
                  <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: 8, padding: sp.sm }}>
                    <p style={{ fontSize: '11px', opacity: 0.7 }}>Carrier</p>
                    <p style={{ fontSize: '16px', fontWeight: 500 }}>{loc.carrier}</p>
                  </div>
                  <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: 8, padding: sp.sm }}>
                    <p style={{ fontSize: '11px', opacity: 0.7 }}>Progress</p>
                    <p style={{ fontSize: '16px', fontWeight: 500 }}>{loc.progress}%</p>
                  </div>
                  <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: 8, padding: sp.sm }}>
                    <p style={{ fontSize: '11px', opacity: 0.7 }}>Pallets</p>
                    <p style={{ fontSize: '16px', fontWeight: 500 }}>{loc.unloaded}/{loc.pallets}</p>
                  </div>
                </div>
              )}
            </div>
            
            {/* Alerts */}
            <Card style={{ borderLeft: `4px solid ${C.warning[500]}` }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
                <Zap style={{ width: 16, height: 16, color: C.warning[600] }} />
                <h3 style={{ fontSize: '14px', fontWeight: 500 }}>Location Alerts</h3>
              </div>
              <Alert sev="warning" title="Extended dwell time" msg={`${locationId} has been occupied for 105 minutes (target: 90 min)`} time="Now" conf={95} />
            </Card>
          </>
        )}
        
        {/* Space Utilization Tab */}
        {activeTab === 'spaceUtil' && (
          <>
            <Header icon={BoxSelect} title={`${locationId} Space Utilization`} sub={`Capacity and utilization for this dock door`} color={C.greenLight[500]} />
            
            <Card>
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.md }}>
                <div>
                  <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Current Utilization</h3>
                  <p style={{ fontSize: '12px', color: C.neutral[500] }}>Space consumption at this dock door</p>
                </div>
                <Badge status={loc.utilization >= 90 ? 'warning' : 'success'} label={loc.utilization >= 90 ? 'Near Capacity' : 'Healthy'} />
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.xl, marginBottom: sp.md }}>
                <div style={{ textAlign: 'center' }}>
                  <p style={{ fontSize: '48px', fontWeight: 300, color: loc.utilization >= 90 ? C.warning[600] : C.success[600] }}>{loc.utilization}%</p>
                  <p style={{ fontSize: '12px', color: C.neutral[500] }}>Current</p>
                </div>
                <div style={{ flex: 1 }}>
                  <Progress value={loc.utilization} max={100} color={loc.utilization >= 90 ? C.warning[500] : C.greenLight[500]} h={12} />
                </div>
              </div>
            </Card>
            
            <Card>
              <h3 style={{ fontSize: '16px', fontWeight: 500, marginBottom: sp.md }}>Location Dimensions</h3>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
                <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                  <p style={{ fontSize: '24px', fontWeight: 500 }}>{loc.sqft}</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>Sq Ft</p>
                </div>
                <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                  <p style={{ fontSize: '24px', fontWeight: 500 }}>{loc.capacity}</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>Pallet Capacity</p>
                </div>
                <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, textAlign: 'center' }}>
                  <p style={{ fontSize: '24px', fontWeight: 500 }}>{loc.status === 'occupied' ? loc.unloaded : 0}</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>Pallets Staged</p>
                </div>
              </div>
            </Card>
            
            {loc.status === 'occupied' && (
              <Card>
                <h3 style={{ fontSize: '16px', fontWeight: 500, marginBottom: sp.md }}>Active Trailer</h3>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.md, background: C.brand[50], borderRadius: 8 }}>
                  <Truck style={{ width: 24, height: 24, color: C.brand[600] }} />
                  <div style={{ flex: 1 }}>
                    <p style={{ fontSize: '14px', fontWeight: 500 }}>{loc.trailer}</p>
                    <p style={{ fontSize: '12px', color: C.neutral[500] }}>{loc.carrier} • Arrived {loc.arrived}</p>
                  </div>
                  <div style={{ textAlign: 'right' }}>
                    <p style={{ fontSize: '16px', fontWeight: 500 }}>{loc.progress}%</p>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>unloaded</p>
                  </div>
                </div>
              </Card>
            )}
          </>
        )}
        
        {/* Placeholder for other tabs */}
        {!['dashboard', 'spaceUtil'].includes(activeTab) && (
          <div style={{ padding: sp.xl, textAlign: 'center' }}>
            <div style={{ width: 48, height: 48, borderRadius: 12, background: C.neutral[100], display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto', marginBottom: sp.md }}>
              {React.createElement(tabs.find(t => t.id === activeTab)?.icon || LayoutDashboard, { style: { width: 24, height: 24, color: C.neutral[400] } })}
            </div>
            <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[600], marginBottom: sp.sm }}>{tabs.find(t => t.id === activeTab)?.label}</h3>
            <p style={{ fontSize: '13px', color: C.neutral[400] }}>{locationId} {tabs.find(t => t.id === activeTab)?.label.toLowerCase()} content will appear here</p>
          </div>
        )}
      </div>
    </div>
  );
};

// Legacy dock doors list view - keeping for reference
const DockDoorsListView = ({ zoneId, onBack, onBackToZones, onBackToExec }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue } = useTimeContext();
  
  const zoneName = zoneId === 'Z01' ? 'Inbound A' : 'Inbound B';
  const dockDoors = zoneId === 'Z01' ? ['D01', 'D02', 'D03', 'D04'] : ['D05', 'D06', 'D07', 'D08'];
  
  // Detailed dock door data
  const dockData = [
    { door: 'D01', status: 'occupied', trailer: 'TRL-1000', carrier: 'FedEx Ground', type: 'Inbound', arrived: '08:15', pallets: 18, unloaded: 15, progress: 83, eta: '10:30', dwellTime: 105, onTime: true },
    { door: 'D02', status: 'occupied', trailer: 'TRL-1001', carrier: 'UPS Freight', type: 'Inbound', arrived: '09:02', pallets: 24, unloaded: 10, progress: 42, eta: '11:15', dwellTime: 58, onTime: true },
    { door: 'D03', status: 'occupied', trailer: 'TRL-1002', carrier: 'ABC Freight', type: 'Inbound', arrived: '09:45', pallets: 32, unloaded: 5, progress: 16, eta: '12:00', dwellTime: 15, onTime: false },
    { door: 'D04', status: 'available', trailer: null, carrier: null, type: null, arrived: null, pallets: 0, unloaded: 0, progress: 0, eta: null, dwellTime: 0, onTime: null }
  ];
  
  // Timeline for dock utilization
  const dockUtilTimeline = [
    { time: '06:00', actual: 25, predicted: null },
    { time: '07:00', actual: 50, predicted: null },
    { time: '08:00', actual: 50, predicted: null },
    { time: '09:00', actual: 75, predicted: null },
    { time: '10:00', actual: 75, predicted: 75, now: true },
    { time: '11:00', actual: null, predicted: 100, upper: 100, lower: 75 },
    { time: '12:00', actual: null, predicted: 100, upper: 100, lower: 75 }
  ];

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg, background: 'white', margin: `-${sp.lg}`, padding: sp.lg, minHeight: '100vh' }}>
      {/* Time Scrubber */}
      <TimeScrubber />
      
      {/* Breadcrumb */}
      <Breadcrumb items={[
        { label: 'Executive Summary', onClick: onBackToExec },
        { label: 'Zones', onClick: onBackToZones },
        { label: `${zoneId} - ${zoneName}`, onClick: onBack },
        { label: 'Dock Doors' }
      ]} />
      
      {/* Header */}
      <div style={{ background: `linear-gradient(135deg, ${C.success[500]} 0%, ${C.success[700]} 100%)`, borderRadius: 12, padding: sp.lg, color: 'white' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.lg }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
            <div style={{ padding: sp.sm, background: 'rgba(255,255,255,0.15)', borderRadius: 10 }}>
              <MapPin style={{ width: 28, height: 28 }} />
            </div>
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <h2 style={{ fontSize: '26px', fontWeight: 300, margin: 0 }}>Dock Doors</h2>
                <Badge status="success" label={`${dockData.filter(d => d.status === 'occupied').length}/${dockDoors.length} occupied`} />
              </div>
              <p style={{ opacity: 0.8, fontSize: '14px', marginTop: 4 }}>{zoneId} - {zoneName} • Inbound Receiving</p>
            </div>
          </div>
          <div style={{ textAlign: 'right' }}>
            <p style={{ opacity: 0.7, fontSize: '12px' }}>Dock Utilization</p>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.sm, flexWrap: 'wrap' }}>
              <span style={{ fontSize: '42px', fontWeight: 300 }}>75%</span>
              {isContextualDifferent && interpolateValue(dockUtilTimeline, contextualTime) && (
                <>
                  <ArrowRight style={{ width: 14, height: 14, opacity: 0.7 }} />
                  <span style={{ fontSize: '20px', fontWeight: 500, padding: '2px 8px', background: 'rgba(47, 114, 255, 0.4)', borderRadius: 4 }}>
                    {Math.round(interpolateValue(dockUtilTimeline, contextualTime))}%
                  </span>
                </>
              )}
              <ArrowRight style={{ width: 16, height: 16, opacity: 0.7 }} />
              <span style={{ fontSize: '24px', fontWeight: 500 }}>100%</span>
            </div>
            {isContextualDifferent && <p style={{ opacity: 0.7, fontSize: '11px', marginTop: 4 }}>@{contextualTime}</p>}
          </div>
        </div>
      </div>
      <p style={{ color: C.neutral[500], textAlign: 'center' }}>Legacy list view - kept for reference</p>
    </div>
  );
};

// ===== STORAGE ZONE DETAIL (Z04 Bulk Storage) =====
const StorageZoneDetail = ({ zoneId, onBack, onBackToExec, onNavigate }) => {
  const zoneName = 'Bulk Storage';
  
  // Clickable Item Component - for drilling into nouns
  const ClickableItem = ({ type, id, label, children, showChevron = true, style = {} }) => (
    <div 
      onClick={() => onNavigate && onNavigate(type, id)} 
      className="card-click"
      style={{ 
        display: 'inline-flex', 
        alignItems: 'center', 
        gap: sp.xs, 
        cursor: 'pointer',
        borderRadius: 4,
        padding: '2px 4px',
        margin: '-2px -4px',
        transition: 'background 0.15s',
        ...style
      }}
      onMouseEnter={(e) => e.currentTarget.style.background = C.brand[100]}
      onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
    >
      {children || <span style={{ textDecoration: 'underline', textDecorationStyle: 'dotted', textUnderlineOffset: '2px' }}>{label}</span>}
      {showChevron && <ChevronRight style={{ width: 12, height: 12, color: C.brand[500], flexShrink: 0 }} />}
    </div>
  );
  
  // Zone Overview Metrics
  const zoneMetrics = {
    spaceUtil: { cur: 83, pred: 91, target: 85 },
    cubeUtil: { cur: 72, pred: 78, target: 80 },
    invAccuracy: { cur: 99.2, pred: 99.1, target: 99.5 },
    putawayTime: { cur: 4.2, pred: 4.5, target: 4.0 }
  };
  
  // Location Structure - Aisles
  const aisles = [
    { id: 'A02', type: 'Selective Rack', bays: 24, levels: 5, positions: 2, totalSlots: 240, occupied: 198, reserved: 12 },
    { id: 'A04', type: 'Selective Rack', bays: 24, levels: 5, positions: 2, totalSlots: 240, occupied: 221, reserved: 8 },
    { id: 'A06', type: 'Selective Rack', bays: 24, levels: 5, positions: 2, totalSlots: 240, occupied: 189, reserved: 15 },
    { id: 'A08', type: 'VNA Rack', bays: 32, levels: 6, positions: 2, totalSlots: 384, occupied: 342, reserved: 20 },
    { id: 'F01', type: 'Floor Storage', bays: 16, levels: 1, positions: 4, totalSlots: 64, occupied: 58, reserved: 4 }
  ];
  
  // Slot utilization by level
  const levelUtilization = [
    { level: 'A (Floor)', total: 288, occupied: 261, pct: 91 },
    { level: 'B', total: 288, occupied: 254, pct: 88 },
    { level: 'C', total: 288, occupied: 242, pct: 84 },
    { level: 'D', total: 288, occupied: 198, pct: 69 },
    { level: 'E', total: 288, occupied: 165, pct: 57 },
    { level: 'F (Top)', total: 128, occupied: 88, pct: 69 }
  ];
  
  // SKU Velocity Distribution
  const skuVelocity = [
    { class: 'A (Fast)', skus: 45, pct: 15, picks: 68, color: C.success[500], id: 'velocity-a' },
    { class: 'B (Medium)', skus: 120, pct: 40, picks: 25, color: C.warning[500], id: 'velocity-b' },
    { class: 'C (Slow)', skus: 135, pct: 45, picks: 7, color: C.neutral[400], id: 'velocity-c' }
  ];
  
  // Staffing Data
  const staff = [
    { id: 'staff-reach', role: 'Reach Truck Operators', icon: Truck, scheduled: 3, present: 3, productivity: 98 },
    { id: 'staff-vna', role: 'VNA/Turret Operators', icon: Truck, scheduled: 2, present: 2, productivity: 105 },
    { id: 'staff-picker', role: 'Order Pickers', icon: Users, scheduled: 2, present: 1, productivity: 92 },
    { id: 'staff-inv', role: 'Inventory Control', icon: ClipboardList, scheduled: 1, present: 1, productivity: 100 }
  ];
  
  // Equipment Status (Complex)
  const equipment = [
    { id: 'equip-reach', type: 'Reach Truck', total: 4, active: 3, maint: 0, idle: 1, utilPred: 88, maxHeight: '30 ft' },
    { id: 'equip-vna', type: 'VNA Turret Truck', total: 2, active: 2, maint: 0, idle: 0, utilPred: 95, maxHeight: '50 ft' },
    { id: 'equip-picker', type: 'Order Picker (Man-Up)', total: 3, active: 2, maint: 1, idle: 0, utilPred: 78, maxHeight: '25 ft' },
    { id: 'equip-rf', type: 'RF Scanner', total: 12, active: 9, maint: 0, idle: 3, utilPred: 82, maxHeight: '-' },
    { id: 'equip-wire', type: 'Wire Guidance System', total: 2, active: 2, maint: 0, idle: 0, utilPred: 100, maxHeight: '-' }
  ];
  
  // Work Content - Active Tasks
  const workContent = {
    putaway: { id: 'task-putaway', pending: 47, inProgress: 12, completed: 89, rate: 18 },
    replenishment: { id: 'task-replen', pending: 23, inProgress: 5, completed: 34, rate: 8 },
    cycleCounts: { id: 'task-cycle', pending: 15, inProgress: 2, completed: 28, rate: 6 }
  };
  
  // Inventory Stats
  const inventory = {
    totalSKUs: 300,
    totalPallets: 1208,
    avgDaysOnHand: 18,
    turnoverRate: 4.2,
    aging: [
      { id: 'age-0-30', range: '0-30 days', count: 842, pct: 70, color: C.success[500] },
      { id: 'age-31-60', range: '31-60 days', count: 265, pct: 22, color: C.warning[500] },
      { id: 'age-61-90', range: '61-90 days', count: 72, pct: 6, color: C.orange[500] },
      { id: 'age-90+', range: '90+ days', count: 29, pct: 2, color: C.error[500] }
    ]
  };
  
  // Sample Location Details (for Locations section)
  const sampleLocations = [
    { loc: 'Z04-A02-B12-LC-P1', sku: 'SKU-4521', qty: 48, status: 'occupied', lastActivity: '09:45' },
    { loc: 'Z04-A02-B12-LC-P2', sku: null, qty: 0, status: 'empty', lastActivity: '-' },
    { loc: 'Z04-A04-B08-LD-P1', sku: 'SKU-2287', qty: 36, status: 'reserved', lastActivity: '10:02' },
    { loc: 'Z04-A08-B22-LE-P1', sku: 'SKU-8834', qty: 24, status: 'cycle-count', lastActivity: '10:15' },
    { loc: 'Z04-F01-B04-LA-P2', sku: 'SKU-1122', qty: 120, status: 'occupied', lastActivity: '08:30' }
  ];
  
  // Predictive Timelines
  const spaceTimeline = [
    { time: '06:00', actual: 78, predicted: null },
    { time: '07:00', actual: 79, predicted: null },
    { time: '08:00', actual: 81, predicted: null },
    { time: '09:00', actual: 82, predicted: null },
    { time: '10:00', actual: 83, predicted: 83, now: true },
    { time: '11:00', actual: null, predicted: 87, upper: 89, lower: 85 },
    { time: '12:00', actual: null, predicted: 91, upper: 94, lower: 88 },
    { time: '13:00', actual: null, predicted: 89, upper: 92, lower: 86 },
    { time: '14:00', actual: null, predicted: 86, upper: 89, lower: 83 }
  ];
  
  const putawayBacklogTimeline = [
    { time: '06:00', actual: 28, predicted: null },
    { time: '07:00', actual: 35, predicted: null },
    { time: '08:00', actual: 42, predicted: null },
    { time: '09:00', actual: 45, predicted: null },
    { time: '10:00', actual: 47, predicted: 47, now: true },
    { time: '11:00', actual: null, predicted: 52, upper: 58, lower: 46 },
    { time: '12:00', actual: null, predicted: 48, upper: 55, lower: 41 },
    { time: '13:00', actual: null, predicted: 38, upper: 46, lower: 30 },
    { time: '14:00', actual: null, predicted: 25, upper: 35, lower: 15 }
  ];
  
  const replenishmentTimeline = [
    { time: '06:00', actual: 12, predicted: null },
    { time: '07:00', actual: 18, predicted: null },
    { time: '08:00', actual: 22, predicted: null },
    { time: '09:00', actual: 21, predicted: null },
    { time: '10:00', actual: 23, predicted: 23, now: true },
    { time: '11:00', actual: null, predicted: 28, upper: 32, lower: 24 },
    { time: '12:00', actual: null, predicted: 35, upper: 40, lower: 30 },
    { time: '13:00', actual: null, predicted: 30, upper: 36, lower: 24 },
    { time: '14:00', actual: null, predicted: 22, upper: 28, lower: 16 }
  ];
  
  // Categorized Alerts
  const alerts = {
    all: [
      { sev: 'error', title: 'Capacity breach predicted', msg: 'Zone reaching 91% @ 12:00 (target: 85%)', time: '+2hr', conf: 82, category: 'space' },
      { sev: 'warning', title: 'Putaway backlog building', msg: '52 pallets predicted in queue @ 11:00', time: '+1hr', conf: 75, category: 'work' },
      { sev: 'warning', title: 'VNA Turret at max utilization', msg: 'Both units at 95% predicted utilization', time: '+1hr', conf: 88, category: 'equipment' },
      { sev: 'info', title: 'Order Picker in maintenance', msg: 'OP-02 scheduled maintenance until 11:30', time: 'Now', conf: 100, category: 'equipment' },
      { sev: 'warning', title: 'Replenishment demand spike', msg: 'Forward pick zones requesting 35 replenishments @ 12:00', time: '+2hr', conf: 70, category: 'work' },
      { sev: 'info', title: 'Cycle count scheduled', msg: 'Aisle A08 cycle count starting 13:00', time: '+3hr', conf: 100, category: 'work' }
    ],
    staff: [],
    work: [],
    space: [],
    equipment: [],
    locations: []
  };
  alerts.all.forEach(a => { if (alerts[a.category]) alerts[a.category].push(a); });
  
  // Section Header Component
  const SectionHeader = ({ icon: Icon, title, color }) => (
    <div style={{ display: 'flex', alignItems: 'center', gap: sp.md, marginTop: sp.lg, marginBottom: sp.md }}>
      <div style={{ width: 36, height: 36, borderRadius: 8, background: `${color}15`, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
        <Icon style={{ width: 20, height: 20, color }} />
      </div>
      <h2 style={{ fontSize: '18px', fontWeight: 500, color: C.neutral[800], margin: 0 }}>{title}</h2>
    </div>
  );
  
  // Inline Alert Component
  const InlineAlert = ({ sev, title, msg, time, conf }) => {
    const colors = { critical: C.error, error: C.error, warning: C.warning, info: C.brand };
    const c = colors[sev] || colors.info;
    return (
      <div style={{ display: 'flex', alignItems: 'flex-start', gap: sp.sm, padding: sp.sm, background: c[50], borderRadius: 6, borderLeft: `3px solid ${c[500]}`, marginTop: sp.sm }}>
        <AlertTriangle style={{ width: 14, height: 14, color: c[600], flexShrink: 0, marginTop: 2 }} />
        <div style={{ flex: 1 }}>
          <p style={{ fontSize: '12px', fontWeight: 500, color: c[700] }}>{title}</p>
          <p style={{ fontSize: '11px', color: c[600] }}>{msg}</p>
        </div>
        <div style={{ textAlign: 'right' }}>
          <span style={{ fontSize: '10px', color: c[500] }}>{time}</span>
          {conf && <p style={{ fontSize: '10px', color: C.neutral[400] }}>{conf}% conf</p>}
        </div>
      </div>
    );
  };
  
  const totalSlots = aisles.reduce((a, aisle) => a + aisle.totalSlots, 0);
  const occupiedSlots = aisles.reduce((a, aisle) => a + aisle.occupied, 0);
  const reservedSlots = aisles.reduce((a, aisle) => a + aisle.reserved, 0);

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg, background: 'white', margin: `-${sp.lg}`, padding: sp.lg, minHeight: '100vh' }}>
      {/* Breadcrumb */}
      <Breadcrumb items={[
        { label: 'Executive Summary', onClick: onBackToExec },
        { label: 'Zones', onClick: onBack },
        { label: `${zoneId} - ${zoneName}` }
      ]} />
      
      {/* ===== HEADER WITH KPIs ===== */}
      <div style={{ background: `linear-gradient(135deg, ${C.warning[500]} 0%, ${C.error[500]} 100%)`, borderRadius: 12, padding: sp.lg, color: 'white' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.lg }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
            <div style={{ padding: sp.sm, background: 'rgba(255,255,255,0.15)', borderRadius: 10 }}>
              <Package style={{ width: 28, height: 28 }} />
            </div>
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <h2 style={{ fontSize: '26px', fontWeight: 300, margin: 0 }}>{zoneId} — {zoneName}</h2>
                <Badge status="warning" label="Near Capacity" />
              </div>
              <p style={{ opacity: 0.8, fontSize: '14px', marginTop: 4 }}>Mixed Racking & Floor Storage • {aisles.length} Aisles • {totalSlots.toLocaleString()} Slots</p>
            </div>
          </div>
          <div style={{ textAlign: 'right' }}>
            <p style={{ opacity: 0.7, fontSize: '12px' }}>Space Utilization</p>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.sm }}>
              <span style={{ fontSize: '42px', fontWeight: 300 }}>{zoneMetrics.spaceUtil.cur}%</span>
              <ArrowRight style={{ width: 16, height: 16, opacity: 0.7 }} />
              <span style={{ fontSize: '24px', fontWeight: 500, color: zoneMetrics.spaceUtil.pred > zoneMetrics.spaceUtil.target ? C.error[200] : 'inherit' }}>{zoneMetrics.spaceUtil.pred}%</span>
            </div>
          </div>
        </div>
        
        {/* KPI Stats */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: sp.md }}>
          {[
            { l: 'Cube Utilization', v: `${zoneMetrics.cubeUtil.cur}%`, p: `${zoneMetrics.cubeUtil.pred}%`, t: `${zoneMetrics.cubeUtil.target}%`, icon: Package },
            { l: 'Inventory Accuracy', v: `${zoneMetrics.invAccuracy.cur}%`, p: `${zoneMetrics.invAccuracy.pred}%`, t: `${zoneMetrics.invAccuracy.target}%`, icon: CheckCircle },
            { l: 'Avg Putaway (min)', v: zoneMetrics.putawayTime.cur, p: zoneMetrics.putawayTime.pred, t: `≤${zoneMetrics.putawayTime.target}`, icon: Clock, warn: zoneMetrics.putawayTime.pred > zoneMetrics.putawayTime.target },
            { l: 'Putaway Backlog', v: workContent.putaway.pending, p: '52', t: '≤30', icon: Package, warn: true },
            { l: 'Replen Pending', v: workContent.replenishment.pending, p: '35', t: '≤20', icon: TrendingUp, warn: true }
          ].map((m, i) => {
            const Icon = m.icon;
            return (
              <div key={i} style={{ background: 'rgba(255,255,255,0.1)', borderRadius: 10, padding: sp.md }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
                  <span style={{ opacity: 0.8, fontSize: '11px' }}>{m.l}</span>
                  <Icon style={{ width: 14, height: 14, opacity: 0.7 }} />
                </div>
                <div style={{ display: 'flex', alignItems: 'baseline', gap: sp.xs }}>
                  <span style={{ fontSize: '20px', fontWeight: 300 }}>{m.v}</span>
                  <ArrowRight style={{ width: 12, height: 12, opacity: 0.6 }} />
                  <span style={{ fontSize: '14px', opacity: 0.9, color: m.warn ? C.error[200] : 'inherit' }}>{m.p}</span>
                </div>
                <p style={{ fontSize: '10px', opacity: 0.6, marginTop: 4 }}>Target: {m.t}</p>
              </div>
            );
          })}
        </div>
      </div>
      
      {/* ===== ALL ALERTS ===== */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Zone Alerts</h3>
          <Badge status={alerts.all.some(a => a.sev === 'error') ? 'error' : alerts.all.some(a => a.sev === 'warning') ? 'warning' : 'success'} label={`${alerts.all.length} active`} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {alerts.all.map((a, i) => (
            <div
              key={i}
              onClick={() => onNavigate && onNavigate('alert', `alert-${i}`)}
              className="card-click"
              style={{ cursor: 'pointer', transition: 'transform 0.15s' }}
              onMouseEnter={(e) => e.currentTarget.style.transform = 'translateX(4px)'}
              onMouseLeave={(e) => e.currentTarget.style.transform = 'translateX(0)'}
            >
              <Alert {...a} />
            </div>
          ))}
        </div>
      </Card>
      
      {/* ===== STAFF SECTION ===== */}
      <SectionHeader icon={Users} title="Staff" color={C.brand[500]} />
      
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Zone Staffing</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Personnel assigned to this zone • {staff.reduce((a, s) => a + s.present, 0)} active</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {staff.map((s, i) => {
            const Icon = s.icon;
            const gap = s.scheduled - s.present;
            return (
              <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.md, background: gap > 0 ? C.warning[50] : C.neutral[50], borderRadius: 8 }}>
                <div style={{ width: 36, height: 36, borderRadius: 8, background: C.brand[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                  <Icon style={{ width: 18, height: 18, color: C.brand[600] }} />
                </div>
                <div style={{ flex: 1 }}>
                  <ClickableItem type="staff-role" id={s.id} label={s.role} style={{ fontSize: '14px', fontWeight: 500 }} />
                  <p style={{ fontSize: '12px', color: C.neutral[500] }}>{s.present}/{s.scheduled} present</p>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                  <div style={{ textAlign: 'right' }}>
                    <p style={{ fontSize: '11px', color: C.neutral[500] }}>Productivity</p>
                    <p style={{ fontSize: '16px', fontWeight: 500, color: s.productivity >= 100 ? C.success[600] : s.productivity >= 90 ? C.neutral[700] : C.warning[600] }}>{s.productivity}%</p>
                  </div>
                  {gap > 0 && <Badge status="warning" label={`-${gap}`} />}
                  <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
                </div>
              </div>
            );
          })}
        </div>
        {alerts.staff.length > 0 && alerts.staff.map((a, i) => <InlineAlert key={i} {...a} />)}
      </Card>
      
      {/* ===== WORK CONTENT SECTION ===== */}
      <SectionHeader icon={ClipboardList} title="Work Content" color={C.orange[500]} />
      
      {/* Active Tasks Summary */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Active Tasks</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Work in progress across all task types</p>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.md }}>
          {[
            { name: 'Putaway', ...workContent.putaway, color: C.brand[500] },
            { name: 'Replenishment', ...workContent.replenishment, color: C.purple[500] },
            { name: 'Cycle Counts', ...workContent.cycleCounts, color: C.success[500] }
          ].map((task, i) => (
            <div 
              key={i} 
              onClick={() => onNavigate && onNavigate('task-type', task.id)}
              className="card-click"
              style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, borderTop: `3px solid ${task.color}`, cursor: 'pointer', transition: 'all 0.15s' }}
              onMouseEnter={(e) => { e.currentTarget.style.background = C.brand[50]; e.currentTarget.style.transform = 'translateY(-2px)'; }}
              onMouseLeave={(e) => { e.currentTarget.style.background = C.neutral[50]; e.currentTarget.style.transform = 'translateY(0)'; }}
            >
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
                <p style={{ fontSize: '14px', fontWeight: 500 }}>{task.name}</p>
                <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
              </div>
              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
                <div style={{ textAlign: 'center' }}>
                  <p style={{ fontSize: '24px', fontWeight: 500, color: task.pending > 30 ? C.warning[600] : C.neutral[700] }}>{task.pending}</p>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>Pending</p>
                </div>
                <div style={{ textAlign: 'center' }}>
                  <p style={{ fontSize: '24px', fontWeight: 500, color: C.brand[600] }}>{task.inProgress}</p>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>In Progress</p>
                </div>
                <div style={{ textAlign: 'center' }}>
                  <p style={{ fontSize: '24px', fontWeight: 500, color: C.success[600] }}>{task.completed}</p>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>Completed</p>
                </div>
              </div>
              <p style={{ fontSize: '11px', color: C.neutral[500] }}>Rate: {task.rate}/hr</p>
            </div>
          ))}
        </div>
      </Card>
      
      {/* Putaway Backlog Forecast */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Putaway Backlog Forecast</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Pallets awaiting putaway • Target: ≤30 • Peak: 52 @ 11:00</p>
          </div>
          <Badge status="warning" label="Backlog building" />
        </div>
        <PredictiveTimeline data={putawayBacklogTimeline} height={160} target={30} warning={40} critical={50} />
      </Card>
      
      {/* Replenishment Demand */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Replenishment Demand</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Requests from forward pick zones • Peak: 35 @ 12:00</p>
          </div>
          <Badge status="warning" label="Spike @ 12:00" />
        </div>
        <PredictiveTimeline data={replenishmentTimeline} height={160} target={20} warning={30} />
      </Card>
      
      {/* Inventory Stats */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Inventory Profile</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>
            <ClickableItem type="inventory" id="all-skus" label={`${inventory.totalSKUs} SKUs`} showChevron={false} /> • {inventory.totalPallets.toLocaleString()} pallets • {inventory.turnoverRate}x turnover
          </p>
        </div>
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: sp.lg }}>
          {/* SKU Velocity */}
          <div>
            <p style={{ fontSize: '13px', fontWeight: 500, marginBottom: sp.sm }}>SKU Velocity Distribution</p>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {skuVelocity.map((v, i) => (
                <div 
                  key={i} 
                  onClick={() => onNavigate && onNavigate('sku-velocity', v.id)}
                  className="card-click"
                  style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.xs, borderRadius: 4, cursor: 'pointer', transition: 'background 0.15s' }}
                  onMouseEnter={(e) => e.currentTarget.style.background = C.brand[50]}
                  onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                >
                  <div style={{ width: 12, height: 12, borderRadius: 2, background: v.color }} />
                  <span style={{ fontSize: '13px', flex: 1 }}>{v.class}</span>
                  <span style={{ fontSize: '13px', fontWeight: 500 }}>{v.skus} SKUs</span>
                  <span style={{ fontSize: '11px', color: C.neutral[500] }}>({v.picks}% picks)</span>
                  <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
                </div>
              ))}
            </div>
          </div>
          {/* Aging */}
          <div>
            <p style={{ fontSize: '13px', fontWeight: 500, marginBottom: sp.sm }}>Inventory Aging</p>
            <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
              {inventory.aging.map((a, i) => (
                <div 
                  key={i}
                  onClick={() => onNavigate && onNavigate('inventory-aging', a.id)}
                  className="card-click"
                  style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.xs, borderRadius: 4, cursor: 'pointer', transition: 'background 0.15s' }}
                  onMouseEnter={(e) => e.currentTarget.style.background = C.brand[50]}
                  onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                >
                  <div style={{ width: 12, height: 12, borderRadius: 2, background: a.color }} />
                  <span style={{ fontSize: '13px', flex: 1 }}>{a.range}</span>
                  <span style={{ fontSize: '13px', fontWeight: 500 }}>{a.count}</span>
                  <span style={{ fontSize: '11px', color: C.neutral[500] }}>({a.pct}%)</span>
                  <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
                </div>
              ))}
            </div>
          </div>
        </div>
        {alerts.work.map((a, i) => <InlineAlert key={i} {...a} />)}
      </Card>
      
      {/* ===== SPACE SECTION ===== */}
      <SectionHeader icon={MapPin} title="Space" color={C.blueLight[500]} />
      
      {/* Space Utilization Forecast */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Space Utilization Forecast</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>Slot occupancy • Target: ≤85% • Peak: 91% @ 12:00</p>
          </div>
          <Badge status="error" label="Breach @ 12:00" />
        </div>
        <PredictiveTimeline data={spaceTimeline} height={160} target={85} warning={85} critical={90} />
      </Card>
      
      {/* Slot Summary */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.md }}>
          <div>
            <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Slot Capacity</h3>
            <p style={{ fontSize: '12px', color: C.neutral[500] }}>{totalSlots.toLocaleString()} total slots across {aisles.length} aisles</p>
          </div>
          <Badge status={occupiedSlots / totalSlots > 0.85 ? 'warning' : 'success'} label={`${occupiedSlots} / ${totalSlots}`} />
        </div>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.xl, marginBottom: sp.md }}>
          <DonutChart value={Math.round(occupiedSlots / totalSlots * 100)} size={100} stroke={10} color={occupiedSlots / totalSlots > 0.85 ? C.warning[500] : C.success[500]} />
          <div style={{ display: 'flex', gap: sp.lg }}>
            <div style={{ padding: sp.md, background: C.success[50], borderRadius: 8, borderLeft: `4px solid ${C.success[500]}` }}>
              <p style={{ fontSize: '28px', fontWeight: 500, color: C.success[600] }}>{occupiedSlots}</p>
              <p style={{ fontSize: '11px', color: C.neutral[500] }}>Occupied</p>
            </div>
            <div style={{ padding: sp.md, background: C.brand[50], borderRadius: 8, borderLeft: `4px solid ${C.brand[500]}` }}>
              <p style={{ fontSize: '28px', fontWeight: 500, color: C.brand[600] }}>{reservedSlots}</p>
              <p style={{ fontSize: '11px', color: C.neutral[500] }}>Reserved</p>
            </div>
            <div style={{ padding: sp.md, background: C.neutral[50], borderRadius: 8, borderLeft: `4px solid ${C.neutral[400]}` }}>
              <p style={{ fontSize: '28px', fontWeight: 500, color: C.neutral[600] }}>{totalSlots - occupiedSlots - reservedSlots}</p>
              <p style={{ fontSize: '11px', color: C.neutral[500] }}>Available</p>
            </div>
          </div>
        </div>
      </Card>
      
      {/* Utilization by Level */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Utilization by Level</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Vertical space distribution</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {levelUtilization.map((lvl, i) => (
            <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
              <span style={{ fontSize: '13px', fontWeight: 500, minWidth: 80 }}>{lvl.level}</span>
              <div style={{ flex: 1 }}><Progress value={lvl.pct} color={lvl.pct > 85 ? C.warning[500] : C.success[500]} h={8} /></div>
              <span style={{ fontSize: '13px', fontWeight: 500, minWidth: 40, textAlign: 'right' }}>{lvl.pct}%</span>
              <span style={{ fontSize: '11px', color: C.neutral[500], minWidth: 80 }}>{lvl.occupied}/{lvl.total}</span>
            </div>
          ))}
        </div>
        {alerts.space.map((a, i) => <InlineAlert key={i} {...a} />)}
      </Card>
      
      {/* ===== EQUIPMENT SECTION ===== */}
      <SectionHeader icon={Truck} title="Equipment" color={C.purple[500]} />
      
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Equipment Status</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Material handling equipment in zone</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {equipment.map((e, i) => (
            <div 
              key={i} 
              onClick={() => onNavigate && onNavigate('equipment', e.id)}
              className="card-click"
              style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.md, background: e.maint > 0 ? C.warning[50] : e.utilPred >= 90 ? C.brand[50] : C.neutral[50], borderRadius: 8, cursor: 'pointer', transition: 'all 0.15s' }}
              onMouseEnter={(e) => { e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)'; e.currentTarget.style.transform = 'translateX(4px)'; }}
              onMouseLeave={(e) => { e.currentTarget.style.boxShadow = 'none'; e.currentTarget.style.transform = 'translateX(0)'; }}
            >
              <div style={{ flex: 1 }}>
                <p style={{ fontSize: '14px', fontWeight: 500 }}>{e.type}</p>
                <div style={{ display: 'flex', gap: sp.md, marginTop: 4 }}>
                  <span style={{ fontSize: '12px', color: C.success[600] }}>● {e.active} active</span>
                  {e.idle > 0 && <span style={{ fontSize: '12px', color: C.neutral[500] }}>○ {e.idle} idle</span>}
                  {e.maint > 0 && <span style={{ fontSize: '12px', color: C.warning[600] }}>⚠ {e.maint} maintenance</span>}
                </div>
              </div>
              <div style={{ textAlign: 'center', minWidth: 60 }}>
                <p style={{ fontSize: '10px', color: C.neutral[500] }}>Max Height</p>
                <p style={{ fontSize: '12px', fontWeight: 500 }}>{e.maxHeight}</p>
              </div>
              <div style={{ textAlign: 'right' }}>
                <p style={{ fontSize: '11px', color: C.neutral[500] }}>Predicted Util.</p>
                <p style={{ fontSize: '16px', fontWeight: 500, color: e.utilPred >= 90 ? C.warning[600] : C.success[600] }}>{e.utilPred}%</p>
              </div>
              <div style={{ width: 60, textAlign: 'center' }}>
                <p style={{ fontSize: '20px', fontWeight: 500 }}>{e.active}/{e.total}</p>
              </div>
              <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
            </div>
          ))}
        </div>
        {alerts.equipment.map((a, i) => <InlineAlert key={i} {...a} />)}
      </Card>
      
      {/* ===== LOCATIONS SECTION ===== */}
      <SectionHeader icon={MapPin} title="Locations" color={C.success[500]} />
      
      {/* Aisle Summary */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Aisle Structure</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Location hierarchy: Zone → Aisle → Bay → Level → Position</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {aisles.map((aisle, i) => {
            const pct = Math.round(aisle.occupied / aisle.totalSlots * 100);
            return (
              <div 
                key={i} 
                onClick={() => onNavigate && onNavigate('aisle', aisle.id)}
                className="card-click"
                style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.md, background: pct > 90 ? C.warning[50] : C.neutral[50], borderRadius: 8, cursor: 'pointer', transition: 'all 0.15s' }}
                onMouseEnter={(e) => { e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)'; e.currentTarget.style.transform = 'translateX(4px)'; }}
                onMouseLeave={(e) => { e.currentTarget.style.boxShadow = 'none'; e.currentTarget.style.transform = 'translateX(0)'; }}
              >
                <div style={{ minWidth: 60 }}>
                  <p style={{ fontSize: '16px', fontWeight: 600, color: C.neutral[800] }}>{aisle.id}</p>
                  <ClickableItem type="rack-type" id={aisle.type} label={aisle.type} showChevron={false} style={{ fontSize: '11px', color: C.neutral[500] }} />
                </div>
                <div style={{ flex: 1 }}>
                  <div style={{ display: 'flex', gap: sp.lg, marginBottom: 4 }}>
                    <span style={{ fontSize: '12px', color: C.neutral[500] }}>{aisle.bays} bays</span>
                    <span style={{ fontSize: '12px', color: C.neutral[500] }}>{aisle.levels} levels</span>
                    <span style={{ fontSize: '12px', color: C.neutral[500] }}>{aisle.positions} pos/bay</span>
                  </div>
                  <Progress value={pct} color={pct > 90 ? C.warning[500] : C.success[500]} h={6} />
                </div>
                <div style={{ textAlign: 'right', minWidth: 80 }}>
                  <p style={{ fontSize: '14px', fontWeight: 500 }}>{aisle.occupied}/{aisle.totalSlots}</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>{pct}%</p>
                </div>
                <ChevronRight style={{ width: 16, height: 16, color: C.neutral[400] }} />
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* Sample Locations */}
      <Card>
        <div style={{ marginBottom: sp.md }}>
          <h3 style={{ fontSize: '16px', fontWeight: 500 }}>Location Activity</h3>
          <p style={{ fontSize: '12px', color: C.neutral[500] }}>Recent location status changes</p>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {sampleLocations.map((loc, i) => {
            const statusColors = {
              occupied: { bg: C.success[50], border: C.success[500], label: 'Occupied' },
              empty: { bg: C.neutral[50], border: C.neutral[300], label: 'Empty' },
              reserved: { bg: C.brand[50], border: C.brand[500], label: 'Reserved' },
              'cycle-count': { bg: C.purple[50], border: C.purple[500], label: 'Cycle Count' }
            };
            const s = statusColors[loc.status];
            return (
              <div 
                key={i} 
                onClick={() => onNavigate && onNavigate('location', loc.loc)}
                className="card-click"
                style={{ display: 'flex', alignItems: 'center', gap: sp.md, padding: sp.sm, background: s.bg, borderRadius: 6, borderLeft: `3px solid ${s.border}`, cursor: 'pointer', transition: 'all 0.15s' }}
                onMouseEnter={(e) => { e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)'; e.currentTarget.style.transform = 'translateX(4px)'; }}
                onMouseLeave={(e) => { e.currentTarget.style.boxShadow = 'none'; e.currentTarget.style.transform = 'translateX(0)'; }}
              >
                <code style={{ fontSize: '12px', fontWeight: 600, fontFamily: 'monospace', color: C.brand[600], minWidth: 180, textDecoration: 'underline', textDecorationStyle: 'dotted', textUnderlineOffset: '2px' }}>{loc.loc}</code>
                <div style={{ flex: 1 }}>
                  {loc.sku ? (
                    <span style={{ fontSize: '13px' }}>
                      <ClickableItem type="sku" id={loc.sku} label={loc.sku} showChevron={false} style={{ fontWeight: 500 }} />
                      <span style={{ color: C.neutral[500] }}> • Qty: {loc.qty}</span>
                    </span>
                  ) : (
                    <span style={{ fontSize: '13px', color: C.neutral[400] }}>—</span>
                  )}
                </div>
                <Badge status={loc.status === 'occupied' ? 'success' : loc.status === 'empty' ? 'info' : loc.status === 'reserved' ? 'info' : 'warning'} label={s.label} />
                <span style={{ fontSize: '11px', color: C.neutral[500], minWidth: 50 }}>{loc.lastActivity}</span>
                <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
              </div>
            );
          })}
        </div>
        {alerts.locations.length > 0 && alerts.locations.map((a, i) => <InlineAlert key={i} {...a} />)}
      </Card>
    </div>
  );
};

const WorkView = ({ onBack }) => {
  // Queue burndown timelines - each queue gets its own prediction
  const pickTimeline = [
    { time: '06:00', actual: 4200, predicted: null },
    { time: '07:00', actual: 3680, predicted: null },
    { time: '08:00', actual: 3160, predicted: null },
    { time: '09:00', actual: 2640, predicted: null },
    { time: '10:00', actual: 2310, predicted: 2310, now: true },
    { time: '11:00', actual: null, predicted: 1790, upper: 1890, lower: 1690 },
    { time: '12:00', actual: null, predicted: 1270, upper: 1420, lower: 1120 },
    { time: '13:00', actual: null, predicted: 750, upper: 950, lower: 550 },
    { time: '14:00', actual: null, predicted: 100, upper: 350, lower: 0 }
  ];
  const packTimeline = [
    { time: '06:00', actual: 3800, predicted: null },
    { time: '07:00', actual: 3420, predicted: null },
    { time: '08:00', actual: 2940, predicted: null },
    { time: '09:00', actual: 2350, predicted: null },
    { time: '10:00', actual: 2350, predicted: 2350, now: true },
    { time: '11:00', actual: null, predicted: 1870, upper: 1970, lower: 1770 },
    { time: '12:00', actual: null, predicted: 1390, upper: 1540, lower: 1240 },
    { time: '13:00', actual: null, predicted: 910, upper: 1110, lower: 710 },
    { time: '14:00', actual: null, predicted: 200, upper: 450, lower: 0 }
  ];
  const shipTimeline = [
    { time: '06:00', actual: 3200, predicted: null },
    { time: '07:00', actual: 2880, predicted: null },
    { time: '08:00', actual: 2480, predicted: null },
    { time: '09:00', actual: 1960, predicted: null },
    { time: '10:00', actual: 1566, predicted: 1566, now: true },
    { time: '11:00', actual: null, predicted: 1146, upper: 1246, lower: 1046 },
    { time: '12:00', actual: null, predicted: 726, upper: 876, lower: 576 },
    { time: '13:00', actual: null, predicted: 306, upper: 506, lower: 106 },
    { time: '14:00', actual: null, predicted: 0, upper: 150, lower: 0 }
  ];
  
  // Carrier burnup timelines - orders completed toward cutoff target
  const fedexTimeline = [
    { time: '06:00', actual: 0, predicted: null },
    { time: '07:00', actual: 312, predicted: null },
    { time: '08:00', actual: 624, predicted: null },
    { time: '09:00', actual: 936, predicted: null },
    { time: '10:00', actual: 1247, predicted: 1247, now: true },
    { time: '11:00', actual: null, predicted: 1403, upper: 1453, lower: 1353 },
    { time: '12:00', actual: null, predicted: 1559, upper: 1659, lower: 1459 },
    { time: '13:00', actual: null, predicted: 1715, upper: 1865, lower: 1565 },
    { time: '14:00', actual: null, predicted: 1920, upper: 2070, lower: 1770 }
  ];
  const upsTimeline = [
    { time: '06:00', actual: 0, predicted: null },
    { time: '07:00', actual: 142, predicted: null },
    { time: '08:00', actual: 284, predicted: null },
    { time: '09:00', actual: 426, predicted: null },
    { time: '10:00', actual: 680, predicted: 680, now: true },
    { time: '11:00', actual: null, predicted: 822, upper: 892, lower: 752 },
    { time: '12:00', actual: null, predicted: 964, upper: 1084, lower: 844 },
    { time: '13:00', actual: null, predicted: 1106, upper: 1276, lower: 936 },
    { time: '14:00', actual: null, predicted: 1248, upper: 1468, lower: 1028 },
    { time: '15:00', actual: null, predicted: 1380, upper: 1550, lower: 1210 }
  ];

  const ordersData = [
    { orderId: '0136637438', status: 'Released', shipTo: 'Bayer S.A.', country: 'AR', carrier: 'Expeditors Intl', units: 8, age: 74.95, type: 'LTL' },
    { orderId: '0137014596', status: 'Released', shipTo: 'Bayer S.A.', country: 'AR', carrier: 'Expeditors Ocean', units: 34150, age: 25.95, type: 'LTL' },
    { orderId: '0137148308', status: 'Released', shipTo: 'Bayer Philippines', country: 'PH', carrier: 'Expeditors Ocean', units: 21000, age: 7.95, type: 'LTL' },
    { orderId: '0137171270', status: 'Staged', shipTo: 'Bayer Medical Care BV', country: 'NL', carrier: 'Expeditors Ocean', units: 9, age: 6.95, type: 'LTL' },
    { orderId: '0137168981', status: 'In Packing', shipTo: 'Bayer Medical Care BV', country: 'NL', carrier: 'Expeditors Ocean', units: 385, age: 6.95, type: 'LTL' },
    { orderId: '0137173814', status: 'DC Allocated', shipTo: 'Imaxeon Pty Ltd', country: 'AU', carrier: 'Expeditors Ocean', units: 33000, age: 6.95, type: 'LTL' },
    { orderId: '0137170275', status: 'Staged', shipTo: 'SmartVision LTDA', country: 'CL', carrier: 'See Remarks', units: 26000, age: 6.95, type: 'LTL' },
    { orderId: '0137177939', status: 'DC Allocated', shipTo: 'SmartVision LTDA', country: 'CL', carrier: 'See Remarks', units: 33000, age: 5.95, type: 'LTL' },
    { orderId: '0137182456', status: 'Packed', shipTo: 'MedSupply Inc', country: 'US', carrier: 'FedEx Ground', units: 245, age: 1.25, type: 'Parcel' },
    { orderId: '0137183001', status: 'Weighed', shipTo: 'Healthcare Dist', country: 'US', carrier: 'UPS', units: 128, age: 0.95, type: 'Parcel' },
    { orderId: '0137183245', status: 'In Packing', shipTo: 'PharmaCo', country: 'CA', carrier: 'FedEx Express', units: 56, age: 0.75, type: 'Parcel' },
    { orderId: '0137183512', status: 'DC Allocated', shipTo: 'GlobalMed', country: 'US', carrier: 'USPS', units: 12, age: 0.50, type: 'Parcel' },
  ];
  const ordersColumns = [
    { key: 'orderId', label: 'Order ID' },
    { key: 'status', label: 'Status', render: (v) => <Badge status={v === 'Staged' || v === 'Packed' || v === 'Weighed' ? 'success' : v === 'In Packing' ? 'info' : v === 'DC Allocated' ? 'warning' : 'neutral'} label={v} /> },
    { key: 'shipTo', label: 'Ship To' },
    { key: 'country', label: 'Country' },
    { key: 'carrier', label: 'Carrier' },
    { key: 'units', label: 'Units', align: 'right', render: (v) => v.toLocaleString() },
    { key: 'age', label: 'Age (days)', align: 'right', render: (v) => <span style={{ color: v > 30 ? C.error[600] : v > 7 ? C.warning[600] : C.neutral[600] }}>{v}</span> },
    { key: 'type', label: 'Type' }
  ];
  const ordersFilters = [
    { key: 'status', label: 'Status', options: ['Released', 'DC Allocated', 'In Packing', 'Staged', 'Packed', 'Weighed'] },
    { key: 'type', label: 'Type', options: ['Parcel', 'LTL'] }
  ];
  const workAlerts = [
    { sev: 'warning', title: 'UPS Cutoff at Risk — 15:30', msg: '1,380 orders predicted vs 1,420 target. Need +30% velocity.', time: '5.5hr out', conf: 78 },
    { sev: 'warning', title: 'Pack Queue Carryover', msg: '~200 orders may carry to swing shift.', time: '4hr out', conf: 82 },
    { sev: 'success', title: 'FedEx Ground On Track', msg: '1,920 orders predicted by 14:00 cutoff (+70 buffer).', time: '4hr out', conf: 94 }
  ];

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg, background: 'white', margin: `-${sp.lg}`, padding: sp.lg, minHeight: '100vh' }}>
      <Breadcrumb items={[{ label: 'Executive Summary', onClick: onBack }, { label: 'Work Content' }]} />
      <Header icon={ClipboardList} title="Work Content" sub="Task volume, queues, completion" color={C.orange[500]} />
      
      {/* Orders Data Grid */}
      <DataGrid title="Open Orders" subtitle="Distribution orders in pipeline" columns={ordersColumns} data={ordersData} color={C.orange[500]} filterOptions={ordersFilters} />
      
      {/* Pick Queue Burndown */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Pick Queue Burndown</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Remaining orders to pick • Now: 2,310 • Predicted @ 14:00: ~100 carryover</p></div>
          <Badge status="success" label="97% complete by shift end" />
        </div>
        <PredictiveTimeline data={pickTimeline} height={160} />
        <div style={{ display: 'flex', gap: sp.lg, marginTop: sp.md, padding: sp.md, background: C.neutral[50], borderRadius: 6 }}>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Velocity</span><p style={{ fontSize: '16px', fontWeight: 500 }}>520/hr</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Time to Clear</span><p style={{ fontSize: '16px', fontWeight: 500 }}>~4.4 hrs</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Predicted Carryover</span><p style={{ fontSize: '16px', fontWeight: 500, color: C.success[600] }}>~100 orders</p></div>
        </div>
      </Card>
      
      {/* Pack Queue Burndown */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Pack Queue Burndown</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Remaining orders to pack • Now: 2,350 • Predicted @ 14:00: ~200 carryover</p></div>
          <Badge status="warning" label="95% complete by shift end" />
        </div>
        <PredictiveTimeline data={packTimeline} height={160} />
        <div style={{ display: 'flex', gap: sp.lg, marginTop: sp.md, padding: sp.md, background: C.neutral[50], borderRadius: 6 }}>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Velocity</span><p style={{ fontSize: '16px', fontWeight: 500 }}>480/hr</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Time to Clear</span><p style={{ fontSize: '16px', fontWeight: 500 }}>~4.9 hrs</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Predicted Carryover</span><p style={{ fontSize: '16px', fontWeight: 500, color: C.warning[600] }}>~200 orders</p></div>
        </div>
      </Card>
      
      {/* Ship Queue Burndown */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Ship Queue Burndown</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Remaining orders to ship • Now: 1,566 • Predicted @ 14:00: 0 (clear)</p></div>
          <Badge status="success" label="100% complete by shift end" />
        </div>
        <PredictiveTimeline data={shipTimeline} height={160} />
        <div style={{ display: 'flex', gap: sp.lg, marginTop: sp.md, padding: sp.md, background: C.neutral[50], borderRadius: 6 }}>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Velocity</span><p style={{ fontSize: '16px', fontWeight: 500 }}>420/hr</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Time to Clear</span><p style={{ fontSize: '16px', fontWeight: 500 }}>~3.7 hrs</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Predicted Carryover</span><p style={{ fontSize: '16px', fontWeight: 500, color: C.success[600] }}>0 orders ✓</p></div>
        </div>
      </Card>
      
      {/* FedEx Ground Cutoff */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>FedEx Ground — Cutoff 14:00</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Orders ready for pickup • Target: 1,850 • Predicted: 1,920 (+70 buffer)</p></div>
          <Badge status="success" label="Will meet cutoff" />
        </div>
        <PredictiveTimeline data={fedexTimeline} height={140} target={1850} />
        <div style={{ display: 'flex', gap: sp.lg, marginTop: sp.md, padding: sp.md, background: C.success[50], borderRadius: 6 }}>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Current</span><p style={{ fontSize: '16px', fontWeight: 500 }}>1,247</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Velocity</span><p style={{ fontSize: '16px', fontWeight: 500 }}>156/hr</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Predicted @ Cutoff</span><p style={{ fontSize: '16px', fontWeight: 500, color: C.success[600] }}>1,920 ✓</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Buffer</span><p style={{ fontSize: '16px', fontWeight: 500, color: C.success[600] }}>+70</p></div>
        </div>
      </Card>
      
      {/* UPS Cutoff - At Risk */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>UPS — Cutoff 15:30</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Orders ready for pickup • Target: 1,420 • Predicted: 1,380 (-40 short)</p></div>
          <Badge status="warning" label="At risk — need velocity boost" />
        </div>
        <PredictiveTimeline data={upsTimeline} height={140} target={1420} warning={1350} critical={1280} />
        <div style={{ display: 'flex', gap: sp.lg, marginTop: sp.md, padding: sp.md, background: C.warning[50], borderRadius: 6 }}>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Current</span><p style={{ fontSize: '16px', fontWeight: 500 }}>680</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Current Velocity</span><p style={{ fontSize: '16px', fontWeight: 500 }}>142/hr</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Predicted @ Cutoff</span><p style={{ fontSize: '16px', fontWeight: 500, color: C.warning[600] }}>1,380</p></div>
          <div><span style={{ fontSize: '11px', color: C.neutral[500] }}>Need Velocity</span><p style={{ fontSize: '16px', fontWeight: 500, color: C.warning[600] }}>185/hr (+30%)</p></div>
        </div>
      </Card>
      
      {/* Analysis - BOTTOM */}
      <Card style={{ borderLeft: `4px solid ${C.orange[500]}` }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
          <div style={{ width: 32, height: 32, borderRadius: 6, background: C.orange[50], display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Zap style={{ width: 16, height: 16, color: C.orange[500] }} /></div>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Root causes and recommendations for throughput</p></div>
          <Badge status="warning" label={`${workAlerts.length} Active`} style={{ marginLeft: 'auto' }} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>{workAlerts.map((a, i) => <Alert key={i} {...a} />)}</div>
      </Card>
    </div>
  );
};

const SchedView = ({ onBack }) => {
  const inb = [{ id: 'TRL-2241', carrier: 'FedEx', type: 'Live', eta: '10:30', dock: 'Door 3', ok: true }, { id: 'TRL-2242', carrier: 'UPS', type: 'Drop', eta: '11:00', dock: 'Door 5', ok: true }, { id: 'TRL-2243', carrier: 'DHL', type: 'Live', eta: '11:45', dock: 'Door 7', ok: false }];
  const out = [{ carrier: 'FedEx Ground', window: '14:00-14:30', doors: '1, 2, 3', pred: 95 }, { carrier: 'UPS', window: '15:30-16:00', doors: '4, 5', pred: 72 }, { carrier: 'USPS', window: '16:00-16:30', doors: '6', pred: 100 }];
  const changes = [{ time: '09:45', title: 'TRL-2243 delayed', desc: 'ETA +30m', icon: Truck, color: C.warning[500] }, { time: '09:30', title: 'Maria S. reassigned', desc: 'Putaway → Picking', icon: Users, color: C.brand[500] }, { time: '09:15', title: 'Dock 8 maintenance', desc: 'Until 12:00', icon: Wrench, color: C.error[500] }];
  const schedData = [
    { id: 'TRL-2241', type: 'Inbound', carrier: 'FedEx', eta: '10:30', dock: 'Door 3', pallets: 24, status: 'On Time' },
    { id: 'TRL-2242', type: 'Inbound', carrier: 'UPS', eta: '11:00', dock: 'Door 5', pallets: 32, status: 'On Time' },
    { id: 'TRL-2243', type: 'Inbound', carrier: 'DHL', eta: '11:45', dock: 'Door 7', pallets: 18, status: 'Delayed' },
    { id: 'TRL-2244', type: 'Inbound', carrier: 'ABC Freight', eta: '12:30', dock: 'Door 2', pallets: 40, status: 'On Time' },
    { id: 'OUT-001', type: 'Outbound', carrier: 'FedEx Ground', window: '14:00-14:30', dock: 'Doors 1-3', orders: 1850, status: 'Ready' },
    { id: 'OUT-002', type: 'Outbound', carrier: 'UPS', window: '15:30-16:00', dock: 'Doors 4-5', orders: 1420, status: 'At Risk' },
    { id: 'OUT-003', type: 'Outbound', carrier: 'USPS', window: '16:00-16:30', dock: 'Door 6', orders: 680, status: 'Ready' },
    { id: 'OUT-004', type: 'Outbound', carrier: 'FedEx Express', window: '18:00-18:30', dock: 'Door 8', orders: 520, status: 'Ready' },
  ];
  const schedColumns = [
    { key: 'id', label: 'ID' },
    { key: 'type', label: 'Type' },
    { key: 'carrier', label: 'Carrier' },
    { key: 'eta', label: 'ETA/Window', render: (v, row) => row.window || v },
    { key: 'dock', label: 'Dock' },
    { key: 'pallets', label: 'Pallets/Orders', align: 'right', render: (v, row) => row.orders || v },
    { key: 'status', label: 'Status', render: (v) => <Badge status={v === 'On Time' || v === 'Ready' ? 'success' : v === 'Delayed' || v === 'At Risk' ? 'warning' : 'neutral'} label={v} /> }
  ];
  const schedFilters = [
    { key: 'type', label: 'Type', options: ['Inbound', 'Outbound'] },
    { key: 'status', label: 'Status', options: ['On Time', 'Delayed', 'Ready', 'At Risk'] }
  ];
  const schedAlerts = [
    { sev: 'warning', title: 'Dock Saturation — 11:00 & 14:00', msg: 'All 12 docks predicted active at peak. Plan for TRL-2243 delay cascade.', time: '1hr out', conf: 85 },
    { sev: 'warning', title: 'UPS Pickup Readiness Low', msg: '72% ready at 15:30 window. Prioritize UPS orders.', time: '5.5hr out', conf: 76 },
    { sev: 'success', title: 'Inbound Clearing by 14:00', msg: 'All inbound trailers complete before shift change.', time: '4hr out', conf: 92 }
  ];

  
  // Dock utilization forecast
  const dockTimeline = [
    { time: '06:00', actual: 4, predicted: null },
    { time: '07:00', actual: 6, predicted: null },
    { time: '08:00', actual: 8, predicted: null },
    { time: '09:00', actual: 10, predicted: null },
    { time: '10:00', actual: 11, predicted: 11, now: true },
    { time: '11:00', actual: null, predicted: 12, upper: 12, lower: 11 },
    { time: '12:00', actual: null, predicted: 10, upper: 11, lower: 9 },
    { time: '13:00', actual: null, predicted: 8, upper: 9, lower: 7 },
    { time: '14:00', actual: null, predicted: 12, upper: 12, lower: 11 }
  ];
  const inboundTimeline = [
    { time: '06:00', actual: 2, predicted: null },
    { time: '07:00', actual: 3, predicted: null },
    { time: '08:00', actual: 4, predicted: null },
    { time: '09:00', actual: 3, predicted: null },
    { time: '10:00', actual: 3, predicted: 3, now: true },
    { time: '11:00', actual: null, predicted: 4, upper: 5, lower: 3 },
    { time: '12:00', actual: null, predicted: 2, upper: 3, lower: 1 },
    { time: '13:00', actual: null, predicted: 1, upper: 2, lower: 0 },
    { time: '14:00', actual: null, predicted: 0, upper: 1, lower: 0 }
  ];

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg, background: 'white', margin: `-${sp.lg}`, padding: sp.lg, minHeight: '100vh' }}>
      <Breadcrumb items={[{ label: 'Executive Summary', onClick: onBack }, { label: 'Schedules' }]} />
      <Header icon={Calendar} title="Schedules" sub="Inbound, outbound, changes" color={C.greenLight[500]} />
      
      {/* Schedules Data Grid */}
      <DataGrid title="Scheduled Events" subtitle="Inbound trailers and outbound pickups" columns={schedColumns} data={schedData} color={C.greenLight[500]} filterOptions={schedFilters} />
      
      {/* Dock Utilization */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Dock Utilization</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Active docks (12 total) • All 12 docks active at 11:00 & 14:00 • Plan for outbound surge</p></div>
          <Badge status="warning" label="Peak @ 11:00" />
        </div>
        <PredictiveTimeline data={dockTimeline} height={160} target={12} warning={10} critical={12} />
      </Card>
      
      {/* Inbound Arrivals */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Inbound Arrivals</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Trailers per hour • Peak receiving 11:00 • Clearing by 14:00</p></div>
          <Badge status="success" label="Clearing" />
        </div>
        <PredictiveTimeline data={inboundTimeline} height={160} />
      </Card>
      
      {/* Inbound Trailers */}
      <Card>
        <div style={{ marginBottom: sp.md }}><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Inbound Trailers</h3></div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {inb.map((t, i) => (
            <div key={i} style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: sp.md, background: C.neutral[50], borderRadius: 6, borderLeft: `3px solid ${t.ok ? C.success[500] : C.warning[500]}` }}>
              <div><p style={{ fontSize: '14px', fontWeight: 500 }}>{t.id}</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>{t.carrier} • {t.type}</p></div>
              <div style={{ textAlign: 'center' }}><p style={{ fontSize: '16px', fontWeight: 500 }}>{t.eta}</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>{t.dock}</p></div>
              <Badge status={t.ok ? 'success' : 'warning'} label={t.ok ? 'On Time' : 'Delayed'} />
            </div>
          ))}
        </div>
      </Card>
      
      {/* Outbound Pickups */}
      <Card>
        <div style={{ marginBottom: sp.md }}><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Outbound Pickups</h3></div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {out.map((p, i) => (
            <div key={i} style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: sp.md, background: C.neutral[50], borderRadius: 6 }}>
              <div><p style={{ fontSize: '14px', fontWeight: 500 }}>{p.carrier}</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>Doors: {p.doors}</p></div>
              <div style={{ textAlign: 'right' }}><p style={{ fontSize: '16px', fontWeight: 500 }}>{p.window}</p><Badge status={p.pred >= 95 ? 'success' : p.pred >= 80 ? 'warning' : 'error'} label={`${p.pred}% ready`} /></div>
            </div>
          ))}
        </div>
      </Card>
      
      {/* Schedule Change Log */}
      <Card>
        <div style={{ marginBottom: sp.md }}><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Schedule Change Log</h3></div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
          {changes.map((c, i) => (
            <div key={i} style={{ display: 'flex', gap: sp.sm, padding: sp.sm, borderBottom: i < changes.length - 1 ? `1px solid ${C.neutral[200]}` : 'none' }}>
              <div style={{ width: 32, height: 32, borderRadius: 6, background: `${c.color}15`, display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}><c.icon style={{ width: 16, height: 16, color: c.color }} /></div>
              <div style={{ flex: 1 }}><p style={{ fontSize: '14px', fontWeight: 500 }}>{c.title}</p><p style={{ fontSize: '12px', color: C.neutral[500] }}>{c.desc}</p></div>
              <span style={{ fontSize: '13px', color: C.neutral[500] }}>{c.time}</span>
            </div>
          ))}
        </div>
      </Card>
      
      {/* Analysis - BOTTOM */}
      <Card style={{ borderLeft: `4px solid ${C.greenLight[500]}` }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
          <div style={{ width: 32, height: 32, borderRadius: 6, background: C.greenLight[50], display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Zap style={{ width: 16, height: 16, color: C.greenLight[500] }} /></div>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>AI-generated schedule predictions</p></div>
          <Badge status="warning" label={`${schedAlerts.length} Active`} style={{ marginLeft: 'auto' }} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>{schedAlerts.map((a, i) => <Alert key={i} {...a} />)}</div>
      </Card>
    </div>
  );
};

const FinView = ({ onBack }) => {
  const metrics = [{ l: 'Cost per Order', v: '$4.82', tr: '-2.4%', ok: true }, { l: 'Cost per Unit', v: '$0.42', tr: '-3.1%', ok: true }, { l: 'Labor Cost Today', v: '$12,450', tr: '+5.2%', ok: false }, { l: 'Overtime Cost', v: '$1,840', tr: '+8.1%', ok: false }];
  const budget = [{ fn: 'Receiving', act: 2100, bud: 2000, pred: 2250 }, { fn: 'Putaway', act: 1800, bud: 2200, pred: 2100 }, { fn: 'Picking', act: 4200, bud: 4000, pred: 4400 }, { fn: 'Packing', act: 2800, bud: 2600, pred: 2950 }, { fn: 'Shipping', act: 1550, bud: 1600, pred: 1620 }];
  const finData = [
    { fn: 'Receiving', budgeted: 2000, actual: 2100, predicted: 2250, variance: '+12.5%', rate: 18.50 },
    { fn: 'Putaway', budgeted: 2200, actual: 1800, predicted: 2100, variance: '-4.5%', rate: 17.25 },
    { fn: 'Picking', budgeted: 4000, actual: 4200, predicted: 4400, variance: '+10.0%', rate: 19.00 },
    { fn: 'Packing', budgeted: 2600, actual: 2800, predicted: 2950, variance: '+13.5%', rate: 18.00 },
    { fn: 'Shipping', budgeted: 1600, actual: 1550, predicted: 1620, variance: '+1.3%', rate: 17.50 },
    { fn: 'QC/Returns', budgeted: 800, actual: 720, predicted: 780, variance: '-2.5%', rate: 16.75 },
    { fn: 'Supervision', budgeted: 1200, actual: 1180, predicted: 1200, variance: '0.0%', rate: 28.00 },
  ];
  const finColumns = [
    { key: 'fn', label: 'Function' },
    { key: 'budgeted', label: 'Budget', align: 'right', render: (v) => '$' + v.toLocaleString() },
    { key: 'actual', label: 'Actual', align: 'right', render: (v) => '$' + v.toLocaleString() },
    { key: 'predicted', label: 'Predicted', align: 'right', render: (v) => '$' + v.toLocaleString() },
    { key: 'variance', label: 'Variance', align: 'right', render: (v) => <span style={{ color: v.startsWith('+') && parseFloat(v) > 5 ? C.error[600] : v.startsWith('-') ? C.success[600] : C.neutral[600] }}>{v}</span> },
    { key: 'rate', label: '$/hr', align: 'right', render: (v) => '$' + v.toFixed(2) }
  ];
  const finFilters = [];
  const finAlerts = [
    { sev: 'warning', title: 'Labor Budget Overage — $700', msg: '$13,100 predicted vs $12,400 budget (+5.6%).', time: 'EOD', conf: 88 },
    { sev: 'warning', title: 'Overtime Exceeding Cap', msg: '$1,920 predicted vs $1,600 budget (+20%).', time: 'EOD', conf: 84 },
    { sev: 'success', title: 'Cost per Unit Improving', msg: '$0.42 today vs $0.43 target (-3.1%).', time: 'Current', conf: 96 }
  ];

  
  // Cost forecast timeline
  const costTimeline = [
    { time: '06:00', actual: 0, predicted: null },
    { time: '07:00', actual: 1520, predicted: null },
    { time: '08:00', actual: 3180, predicted: null },
    { time: '09:00', actual: 4920, predicted: null },
    { time: '10:00', actual: 6450, predicted: 6450, now: true },
    { time: '11:00', actual: null, predicted: 8100, upper: 8400, lower: 7800 },
    { time: '12:00', actual: null, predicted: 9800, upper: 10200, lower: 9400 },
    { time: '13:00', actual: null, predicted: 11400, upper: 11900, lower: 10900 },
    { time: '14:00', actual: null, predicted: 13100, upper: 13800, lower: 12400 }
  ];
  const overtimeTimeline = [
    { time: '06:00', actual: 0, predicted: null },
    { time: '07:00', actual: 180, predicted: null },
    { time: '08:00', actual: 420, predicted: null },
    { time: '09:00', actual: 720, predicted: null },
    { time: '10:00', actual: 920, predicted: 920, now: true },
    { time: '11:00', actual: null, predicted: 1180, upper: 1280, lower: 1080 },
    { time: '12:00', actual: null, predicted: 1450, upper: 1600, lower: 1300 },
    { time: '13:00', actual: null, predicted: 1680, upper: 1880, lower: 1480 },
    { time: '14:00', actual: null, predicted: 1920, upper: 2200, lower: 1640 }
  ];

  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg, background: 'white', margin: `-${sp.lg}`, padding: sp.lg, minHeight: '100vh' }}>
      <Breadcrumb items={[{ label: 'Executive Summary', onClick: onBack }, { label: 'Financials' }]} />
      <Header icon={DollarSign} title="Financials" sub="Cost tracking, budget variance" color={C.success[500]} />
      
      {/* Financials Data Grid */}
      <DataGrid title="Labor Cost by Function" subtitle="Budget vs actual vs predicted" columns={finColumns} data={finData} color={C.success[500]} filterOptions={finFilters} />
      
      {/* Labor Cost Forecast */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Labor Cost Forecast</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Budget: $12,400 • Predicted: $13,100 • 5.6% over budget</p></div>
          <Badge status="warning" label="+$700 over" />
        </div>
        <PredictiveTimeline data={costTimeline} height={160} target={12400} />
      </Card>
      
      {/* Overtime Cost Forecast */}
      <Card>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: sp.sm }}>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Overtime Cost Forecast</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>Budget: $1,600 • Current: $920 • Predicted: $1,920 (+20% over budget)</p></div>
          <Badge status="warning" label="+$320 over" />
        </div>
        <PredictiveTimeline data={overtimeTimeline} height={160} target={1600} warning={1400} critical={1800} />
      </Card>
      
      {/* Key Metrics */}
      <Card>
        <div style={{ marginBottom: sp.md }}><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Cost Metrics</h3></div>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.md }}>
          {metrics.map((m, i) => (
            <div key={i} style={{ padding: sp.lg, background: C.neutral[50], borderRadius: 8, borderLeft: `3px solid ${m.ok ? C.success[500] : C.warning[500]}` }}>
              <p style={{ fontSize: '12px', fontWeight: 500, color: C.neutral[500], marginBottom: sp.sm, textTransform: 'uppercase' }}>{m.l}</p>
              <p style={{ fontSize: '32px', fontWeight: 300, marginBottom: sp.sm }}>{m.v}</p>
              <span style={{ display: 'flex', alignItems: 'center', gap: 2, fontSize: '14px', fontWeight: 500, color: m.ok ? C.success[600] : C.warning[600] }}>
                {m.tr.startsWith('-') ? <ArrowDownRight style={{ width: 16, height: 16 }} /> : <ArrowUpRight style={{ width: 16, height: 16 }} />}{m.tr}
              </span>
            </div>
          ))}
        </div>
      </Card>
      
      {/* Labor Cost by Function */}
      <Card>
        <div style={{ marginBottom: sp.md }}><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Labor Cost by Function (Current → Predicted)</h3></div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.md }}>
          {budget.map((b, i) => {
            const overNow = b.act > b.bud;
            const overPred = b.pred > b.bud;
            return (
              <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
                <span style={{ fontSize: '14px', fontWeight: 500, minWidth: 100 }}>{b.fn}</span>
                <div style={{ flex: 1 }}>
                  <div style={{ position: 'relative', height: 28, background: C.neutral[100], borderRadius: 4, overflow: 'hidden' }}>
                    <div style={{ position: 'absolute', height: '100%', width: `${(b.pred / Math.max(b.pred, b.bud) * 100)}%`, background: overPred ? C.purple[200] : C.purple[100] }} />
                    <div style={{ position: 'absolute', height: '100%', width: `${(b.act / Math.max(b.pred, b.bud)) * 100}%`, background: overNow ? C.warning[500] : C.success[500] }} />
                    <div style={{ position: 'absolute', top: 0, bottom: 0, left: `${(b.bud / Math.max(b.pred, b.bud)) * 100}%`, width: 2, background: C.neutral[800] }} />
                  </div>
                </div>
                <div style={{ display: 'flex', gap: sp.sm, minWidth: 220, fontSize: '13px' }}>
                  <span style={{ color: overNow ? C.warning[600] : C.success[600] }}>${b.act.toLocaleString()}</span>
                  <ArrowRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
                  <span style={{ color: C.purple[600] }}>${b.pred.toLocaleString()}</span>
                  <span style={{ color: C.neutral[500] }}>/ ${b.bud.toLocaleString()}</span>
                </div>
              </div>
            );
          })}
        </div>
      </Card>
      
      {/* Analysis - BOTTOM */}
      <Card style={{ borderLeft: `4px solid ${C.success[500]}` }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm, marginBottom: sp.md }}>
          <div style={{ width: 32, height: 32, borderRadius: 6, background: C.success[50], display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Zap style={{ width: 16, height: 16, color: C.success[600] }} /></div>
          <div><h3 style={{ fontSize: '16px', fontWeight: 500 }}>Analysis</h3><p style={{ fontSize: '12px', color: C.neutral[500] }}>AI-generated financial predictions</p></div>
          <Badge status="warning" label={`${finAlerts.length} Active`} style={{ marginLeft: 'auto' }} />
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>{finAlerts.map((a, i) => <Alert key={i} {...a} />)}</div>
      </Card>
    </div>
  );
};

// ===== ZONE PANEL (Contextual Side Panel for Zones) =====
const ZonePanel = ({ zoneId, zoneName, zoneType, onNavigate, onBack }) => {
  const { contextualTime, isContextualDifferent, isContextualPast, interpolateValue } = useTimeContext();
  const [activeTab, setActiveTab] = useState('dashboard');
  
  // Zone data (would come from props/context in real app)
  const zoneData = {
    status: 'Active',
    dockDoors: 4,
    spaceUtil: { cur: 68, pred: 74, target: 80 },
    kpis: {
      palletsHr: { cur: 142, pred: 168, target: 180, timeline: [
        { time: '06:00', actual: 0 }, { time: '08:00', actual: 78 }, { time: '10:00', actual: 142 },
        { time: '12:00', predicted: 165 }, { time: '14:00', predicted: 168 }
      ]},
      avgDwell: { cur: 38, pred: 42, target: 45, warn: false, timeline: [
        { time: '06:00', actual: 32 }, { time: '08:00', actual: 35 }, { time: '10:00', actual: 38 },
        { time: '12:00', predicted: 44 }, { time: '14:00', predicted: 42 }
      ]},
      accuracy: { cur: 98.2, pred: 97.8, target: 99, format: v => `${v.toFixed(1)}%`, timeline: [
        { time: '06:00', actual: 99.1 }, { time: '08:00', actual: 98.8 }, { time: '10:00', actual: 98.2 },
        { time: '12:00', predicted: 97.9 }, { time: '14:00', predicted: 97.8 }
      ]},
      stagedPallets: { cur: 47, pred: 62, target: 80, timeline: [
        { time: '06:00', actual: 22 }, { time: '08:00', actual: 35 }, { time: '10:00', actual: 47 },
        { time: '12:00', predicted: 58 }, { time: '14:00', predicted: 62 }
      ]},
      dockUtil: { cur: 75, pred: 85, target: 90, format: v => `${Math.round(v)}%`, timeline: [
        { time: '06:00', actual: 50 }, { time: '08:00', actual: 75 }, { time: '10:00', actual: 75 },
        { time: '12:00', predicted: 100 }, { time: '14:00', predicted: 85 }
      ]}
    }
  };
  
  const alerts = [
    { sev: 'warning', title: 'Staged pallet congestion', msg: 'Predicted 62 pallets @ 12:00 (capacity: 80)', time: '+2hr', conf: 78 },
    { sev: 'info', title: 'Pallet jack in maintenance', msg: 'EPJ-03 scheduled maintenance until 11:30', time: 'Now', conf: 100 }
  ];
  
  const connections = {
    upstream: [
      { id: 'TRL-1000', type: 'Trailer', label: 'TRL-1000', metric: '42%', metricLabel: 'progress' },
      { id: 'recv-team', type: 'Staff', label: 'Recv Team', metric: '100%', metricLabel: 'staffed' }
    ],
    downstream: [
      { id: 'staging', type: 'Location', label: 'Staging', metric: '68%', metricLabel: 'capacity' },
      { id: 'Z04', type: 'Zone', label: 'Z04 Bulk', metric: '83%', metricLabel: 'capacity' }
    ]
  };
  
  // Work content data for Work Content tab
  const workContent = {
    stagedPallets: {
      current: 47, predicted: 62, capacity: 80,
      byStatus: [
        { status: 'Awaiting Putaway', count: 28, color: C.warning[500] },
        { status: 'QC Hold', count: 8, color: C.error[500] },
        { status: 'Ready for Putaway', count: 11, color: C.success[500] }
      ],
      timeline: [
        { time: '06:00', actual: 22 }, { time: '08:00', actual: 35 }, { time: '10:00', actual: 47 },
        { time: '12:00', predicted: 58 }, { time: '14:00', predicted: 62 }
      ]
    },
    asnData: [
      { asn: 'ASN-4521', po: 'PO-8834', vendor: 'Acme Corp', lines: 12, received: 10, status: 'in-progress' },
      { asn: 'ASN-4522', po: 'PO-8835', vendor: 'Global Supply', lines: 8, received: 8, status: 'complete' },
      { asn: 'ASN-4523', po: 'PO-8836', vendor: 'FastShip Inc', lines: 24, received: 5, status: 'in-progress' },
      { asn: 'ASN-4524', po: 'PO-8837', vendor: 'Prime Dist', lines: 6, received: 0, status: 'pending' }
    ],
    palletList: [
      { id: 'PLT-00847', status: 'Awaiting Putaway', source: 'TRL-1000', arrived: '08:32', dwell: 92, destination: 'Z04-A12' },
      { id: 'PLT-00848', status: 'QC Hold', source: 'TRL-1000', arrived: '08:35', dwell: 89, destination: 'QC Station' },
      { id: 'PLT-00849', status: 'Ready for Putaway', source: 'TRL-1001', arrived: '09:15', dwell: 45, destination: 'Z05-B03' },
      { id: 'PLT-00850', status: 'Awaiting Putaway', source: 'TRL-1001', arrived: '09:18', dwell: 42, destination: 'Z04-C08' },
      { id: 'PLT-00851', status: 'Awaiting Putaway', source: 'TRL-1002', arrived: '09:52', dwell: 8, destination: 'Z04-A15' }
    ]
  };
  
  // Tab definitions
  const tabs = [
    { id: 'dashboard', icon: LayoutDashboard, label: 'Dashboard' },
    { id: 'financial', icon: DollarSign, label: 'Financial' },
    { id: 'staff', icon: Users, label: 'Staff' },
    { id: 'work', icon: Package, label: 'Work Content' },
    { id: 'space', icon: MapPin, label: 'Space' },
    { id: 'equipment', icon: Wrench, label: 'Equipment' },
    { id: 'schedule', icon: Calendar, label: 'Schedule' },
    { id: 'insights', icon: Lightbulb, label: 'Insights' },
    { id: 'config', icon: Filter, label: 'Config' }
  ];
  
  // KPI Card component (clickable to navigate to relevant tab)
  const KpiCard = ({ label, current, predicted, target, timeline, format, warn, targetTab, icon: Icon }) => {
    const ctxVal = isContextualDifferent && timeline ? interpolateValue(timeline, contextualTime) : null;
    const displayCtx = ctxVal !== null ? (format ? format(ctxVal) : Math.round(ctxVal)) : null;
    const displayCur = format ? format(current) : current;
    const displayPred = format ? format(predicted) : predicted;
    
    return (
      <div 
        onClick={() => targetTab && setActiveTab(targetTab)}
        style={{ 
          background: 'rgba(255,255,255,0.1)', 
          borderRadius: 8, 
          padding: sp.sm,
          cursor: targetTab ? 'pointer' : 'default',
          transition: 'background 0.15s'
        }}
        className={targetTab ? 'card-click' : ''}
      >
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 4 }}>
          <span style={{ fontSize: '11px', opacity: 0.8 }}>{label}</span>
          {Icon && <Icon style={{ width: 12, height: 12, opacity: 0.6 }} />}
        </div>
        <div style={{ display: 'flex', alignItems: 'baseline', gap: 4, flexWrap: 'wrap' }}>
          <span style={{ fontSize: '18px', fontWeight: 300 }}>{displayCur}</span>
          {displayCtx !== null && (
            <>
              <ArrowRight style={{ width: 8, height: 8, opacity: 0.5 }} />
              <span style={{ fontSize: '12px', fontWeight: 500, padding: '1px 4px', background: 'rgba(47,114,255,0.4)', borderRadius: 3 }}>{displayCtx}</span>
            </>
          )}
          <ArrowRight style={{ width: 8, height: 8, opacity: 0.5 }} />
          <span style={{ fontSize: '13px', opacity: 0.9, color: warn ? C.warning[200] : 'inherit' }}>{displayPred}</span>
        </div>
        <p style={{ fontSize: '9px', opacity: 0.5, marginTop: 2 }}>Target: {target}</p>
      </div>
    );
  };
  
  // Connection card component
  const ConnectionCard = ({ id, type, label, metric, metricLabel, direction }) => (
    <div 
      onClick={() => onNavigate && onNavigate(type.toLowerCase(), id)}
      style={{ 
        background: C.neutral[100], 
        borderRadius: 6, 
        padding: sp.sm, 
        textAlign: 'center',
        cursor: 'pointer',
        minWidth: 70,
        border: `1px solid ${C.neutral[200]}`
      }}
      className="card-click"
    >
      <p style={{ fontSize: '11px', fontWeight: 500, color: C.neutral[700], marginBottom: 2 }}>{label}</p>
      <p style={{ fontSize: '16px', fontWeight: 600, color: direction === 'upstream' ? C.brand[600] : C.purple[600] }}>{metric}</p>
      <p style={{ fontSize: '9px', color: C.neutral[500] }}>{metricLabel}</p>
    </div>
  );
  
  // Financial Tab State
  const [financialPeriod, setFinancialPeriod] = React.useState('mtd');
  const [financialComparison, setFinancialComparison] = React.useState('budget');
  
  // Financial Mock Data
  const financialData = {
    periods: {
      mtd: { label: 'Month to Date', days: 17, totalDays: 31 },
      qtd: { label: 'Quarter to Date', days: 78, totalDays: 92 },
      ytd: { label: 'Year to Date', days: 352, totalDays: 365 }
    },
    summary: {
      mtd: {
        totalOpEx: 847500,
        budget: 830000,
        priorPeriod: 812000,
        costPerOrder: 4.23,
        costPerOrderBudget: 4.00,
        costPerOrderPrior: 4.15,
        costPerUnit: 1.68,
        ordersProcessed: 200354,
        unitsHandled: 504464,
        laborCostPct: 58,
        fulfillmentPctRevenue: 12.4,
        forecast: 1540000,
        forecastBudget: 1500000
      },
      qtd: {
        totalOpEx: 2485000,
        budget: 2450000,
        priorPeriod: 2380000,
        costPerOrder: 4.18,
        costPerOrderBudget: 4.00,
        costPerOrderPrior: 4.10,
        costPerUnit: 1.65,
        ordersProcessed: 594498,
        unitsHandled: 1506061,
        laborCostPct: 57,
        fulfillmentPctRevenue: 12.2,
        forecast: 2920000,
        forecastBudget: 2900000
      },
      ytd: {
        totalOpEx: 9234000,
        budget: 9100000,
        priorPeriod: 8750000,
        costPerOrder: 4.12,
        costPerOrderBudget: 4.00,
        costPerOrderPrior: 4.05,
        costPerUnit: 1.62,
        ordersProcessed: 2241262,
        unitsHandled: 5699383,
        laborCostPct: 56,
        fulfillmentPctRevenue: 12.1,
        forecast: 9580000,
        forecastBudget: 9400000
      }
    },
    costBreakdown: {
      mtd: [
        { category: 'Direct Labor', amount: 389550, pct: 46, budget: 375000, prior: 368000, icon: Users },
        { category: 'Indirect Labor', amount: 101700, pct: 12, budget: 100000, prior: 97000, icon: Users },
        { category: 'Facility', amount: 169500, pct: 20, budget: 170000, prior: 168000, icon: MapPin },
        { category: 'Equipment', amount: 84750, pct: 10, budget: 82000, prior: 80000, icon: Truck },
        { category: 'Materials', amount: 59325, pct: 7, budget: 60000, prior: 58000, icon: Package },
        { category: 'Technology', amount: 25425, pct: 3, budget: 25000, prior: 24000, icon: Settings },
        { category: 'Other', amount: 17250, pct: 2, budget: 18000, prior: 17000, icon: MoreHorizontal }
      ]
    },
    monthlyTrend: [
      { month: 'Jul', actual: 795000, budget: 800000, prior: 760000 },
      { month: 'Aug', actual: 810000, budget: 810000, prior: 775000 },
      { month: 'Sep', actual: 825000, budget: 815000, prior: 790000 },
      { month: 'Oct', actual: 838000, budget: 820000, prior: 802000 },
      { month: 'Nov', actual: 855000, budget: 825000, prior: 815000 },
      { month: 'Dec', actual: 847500, budget: 830000, prior: 812000, current: true }
    ],
    alerts: [
      { type: 'warning', message: 'Labor costs 3.9% over budget', category: 'Direct Labor', amount: 14550 },
      { type: 'info', message: 'Equipment maintenance trending up', category: 'Equipment', amount: 2750 },
      { type: 'success', message: 'Materials costs under budget', category: 'Materials', amount: -675 }
    ],
    costPerOrderTrend: [
      { month: 'Jul', value: 4.05, budget: 4.00 },
      { month: 'Aug', value: 4.08, budget: 4.00 },
      { month: 'Sep', value: 4.12, budget: 4.00 },
      { month: 'Oct', value: 4.15, budget: 4.00 },
      { month: 'Nov', value: 4.20, budget: 4.00 },
      { month: 'Dec', value: 4.23, budget: 4.00, current: true }
    ]
  };
  
  // Render Financial Tab
  const renderFinancialTab = () => {
    const periodData = financialData.summary[financialPeriod];
    const periodInfo = financialData.periods[financialPeriod];
    const breakdown = financialData.costBreakdown.mtd;
    
    const getVariance = (actual, compare) => actual - compare;
    const getVariancePct = (actual, compare) => ((actual - compare) / compare * 100).toFixed(1);
    const formatCurrency = (val) => val >= 1000000 ? `$${(val/1000000).toFixed(2)}M` : `$${(val/1000).toFixed(0)}K`;
    
    const comparisonValue = financialComparison === 'budget' ? periodData.budget : periodData.priorPeriod;
    const comparisonLabel = financialComparison === 'budget' ? 'Budget' : 'Prior Period';
    const variance = getVariance(periodData.totalOpEx, comparisonValue);
    const variancePct = getVariancePct(periodData.totalOpEx, comparisonValue);
    const isUnfavorable = variance > 0;
    
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap: sp.md }}>
        {/* Header with Period Selector */}
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <h2 style={{ fontSize: '18px', fontWeight: 500, margin: 0 }}>Financial Overview</h2>
          <div style={{ display: 'flex', gap: sp.sm }}>
            {/* Time Period Selector */}
            <div style={{ display: 'flex', background: C.neutral[100], borderRadius: 6, padding: 2 }}>
              {['mtd', 'qtd', 'ytd'].map(period => (
                <button
                  key={period}
                  onClick={() => setFinancialPeriod(period)}
                  style={{
                    padding: '6px 12px',
                    fontSize: '12px',
                    fontWeight: 500,
                    border: 'none',
                    borderRadius: 4,
                    cursor: 'pointer',
                    background: financialPeriod === period ? 'white' : 'transparent',
                    color: financialPeriod === period ? C.brand[600] : C.neutral[600],
                    boxShadow: financialPeriod === period ? '0 1px 3px rgba(0,0,0,0.1)' : 'none',
                    transition: 'all 0.15s'
                  }}
                >
                  {period.toUpperCase()}
                </button>
              ))}
            </div>
            {/* Comparison Selector */}
            <select
              value={financialComparison}
              onChange={(e) => setFinancialComparison(e.target.value)}
              style={{
                padding: '6px 10px',
                fontSize: '12px',
                border: `1px solid ${C.neutral[300]}`,
                borderRadius: 6,
                background: 'white',
                color: C.neutral[700],
                cursor: 'pointer'
              }}
            >
              <option value="budget">vs Budget</option>
              <option value="prior">vs Prior Period</option>
            </select>
          </div>
        </div>
        
        {/* Summary Cards Row */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: sp.sm }}>
          {/* Total OpEx */}
          <Card>
            <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Total Operating Costs</p>
            <p style={{ fontSize: '22px', fontWeight: 500, margin: 0 }}>{formatCurrency(periodData.totalOpEx)}</p>
            <div style={{ display: 'flex', alignItems: 'center', gap: 4, marginTop: 4 }}>
              {isUnfavorable ? 
                <TrendingUp style={{ width: 12, height: 12, color: C.error[500] }} /> :
                <TrendingDown style={{ width: 12, height: 12, color: C.success[500] }} />
              }
              <span style={{ fontSize: '11px', color: isUnfavorable ? C.error[600] : C.success[600] }}>
                {isUnfavorable ? '+' : ''}{variancePct}% vs {comparisonLabel.toLowerCase()}
              </span>
            </div>
          </Card>
          
          {/* Cost Per Order */}
          <Card>
            <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Cost Per Order</p>
            <p style={{ fontSize: '22px', fontWeight: 500, margin: 0, color: periodData.costPerOrder > periodData.costPerOrderBudget ? C.warning[600] : C.success[600] }}>
              ${periodData.costPerOrder.toFixed(2)}
            </p>
            <p style={{ fontSize: '10px', color: C.neutral[400] }}>Target: ${periodData.costPerOrderBudget.toFixed(2)}</p>
          </Card>
          
          {/* Budget Variance */}
          <Card style={{ borderLeft: `4px solid ${isUnfavorable ? C.error[500] : C.success[500]}` }}>
            <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Budget Variance</p>
            <p style={{ fontSize: '22px', fontWeight: 500, margin: 0, color: isUnfavorable ? C.error[600] : C.success[600] }}>
              {isUnfavorable ? '+' : ''}{formatCurrency(Math.abs(variance))}
            </p>
            <p style={{ fontSize: '10px', color: isUnfavorable ? C.error[500] : C.success[500] }}>
              {isUnfavorable ? 'Over budget' : 'Under budget'}
            </p>
          </Card>
          
          {/* Forecast */}
          <Card>
            <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>EOM Forecast</p>
            <p style={{ fontSize: '22px', fontWeight: 500, margin: 0 }}>{formatCurrency(periodData.forecast)}</p>
            <p style={{ fontSize: '10px', color: periodData.forecast > periodData.forecastBudget ? C.warning[500] : C.success[500] }}>
              Budget: {formatCurrency(periodData.forecastBudget)}
            </p>
          </Card>
        </div>
        
        {/* Cost Breakdown */}
        <Card>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.md }}>
            <h3 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Cost Breakdown</h3>
            <span style={{ fontSize: '11px', color: C.neutral[500] }}>{periodInfo.label}</span>
          </div>
          
          {/* Donut Chart Visualization */}
          <div style={{ display: 'flex', gap: sp.lg, marginBottom: sp.md }}>
            <div style={{ width: 140, height: 140, position: 'relative' }}>
              <svg width="140" height="140" viewBox="0 0 140 140">
                {(() => {
                  let cumulative = 0;
                  const colors = [C.purple[500], C.purple[300], C.brand[500], C.warning[500], C.success[500], C.blueLight[500], C.neutral[400]];
                  return breakdown.map((item, i) => {
                    const start = cumulative;
                    cumulative += item.pct;
                    const startAngle = (start / 100) * 360 - 90;
                    const endAngle = (cumulative / 100) * 360 - 90;
                    const largeArc = item.pct > 50 ? 1 : 0;
                    const startX = 70 + 50 * Math.cos(startAngle * Math.PI / 180);
                    const startY = 70 + 50 * Math.sin(startAngle * Math.PI / 180);
                    const endX = 70 + 50 * Math.cos(endAngle * Math.PI / 180);
                    const endY = 70 + 50 * Math.sin(endAngle * Math.PI / 180);
                    return (
                      <path
                        key={i}
                        d={`M 70 70 L ${startX} ${startY} A 50 50 0 ${largeArc} 1 ${endX} ${endY} Z`}
                        fill={colors[i % colors.length]}
                        style={{ cursor: 'pointer', transition: 'opacity 0.15s' }}
                      />
                    );
                  });
                })()}
                <circle cx="70" cy="70" r="30" fill="white" />
              </svg>
              <div style={{ position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', textAlign: 'center' }}>
                <p style={{ fontSize: '14px', fontWeight: 600, margin: 0 }}>{formatCurrency(periodData.totalOpEx)}</p>
                <p style={{ fontSize: '9px', color: C.neutral[500] }}>Total</p>
              </div>
            </div>
            
            {/* Legend */}
            <div style={{ flex: 1, display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: sp.xs }}>
              {(() => {
                const colors = [C.purple[500], C.purple[300], C.brand[500], C.warning[500], C.success[500], C.blueLight[500], C.neutral[400]];
                return breakdown.map((item, i) => (
                  <div key={i} style={{ display: 'flex', alignItems: 'center', gap: sp.xs }}>
                    <div style={{ width: 10, height: 10, borderRadius: 2, background: colors[i % colors.length] }} />
                    <span style={{ fontSize: '11px', color: C.neutral[600] }}>{item.category} ({item.pct}%)</span>
                  </div>
                ));
              })()}
            </div>
          </div>
          
          {/* Breakdown Table */}
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
            <div style={{ display: 'grid', gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr', gap: sp.sm, padding: `${sp.xs} ${sp.sm}`, background: C.neutral[50], borderRadius: 4 }}>
              <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500] }}>CATEGORY</span>
              <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textAlign: 'right' }}>ACTUAL</span>
              <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textAlign: 'right' }}>{comparisonLabel.toUpperCase()}</span>
              <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textAlign: 'right' }}>VARIANCE</span>
              <span style={{ fontSize: '10px', fontWeight: 600, color: C.neutral[500], textAlign: 'right' }}>VAR %</span>
            </div>
            {breakdown.map((item, i) => {
              const compareVal = financialComparison === 'budget' ? item.budget : item.prior;
              const itemVariance = item.amount - compareVal;
              const itemVariancePct = ((itemVariance / compareVal) * 100).toFixed(1);
              const Icon = item.icon;
              return (
                <div 
                  key={i} 
                  style={{ 
                    display: 'grid', 
                    gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr', 
                    gap: sp.sm, 
                    padding: sp.sm,
                    background: 'white',
                    borderRadius: 6,
                    cursor: 'pointer',
                    transition: 'all 0.15s'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = C.neutral[50];
                    e.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.05)';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = 'white';
                    e.currentTarget.style.boxShadow = 'none';
                  }}
                >
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <Icon style={{ width: 14, height: 14, color: C.neutral[400] }} />
                    <span style={{ fontSize: '12px', fontWeight: 500 }}>{item.category}</span>
                  </div>
                  <span style={{ fontSize: '12px', textAlign: 'right' }}>{formatCurrency(item.amount)}</span>
                  <span style={{ fontSize: '12px', textAlign: 'right', color: C.neutral[500] }}>{formatCurrency(compareVal)}</span>
                  <span style={{ fontSize: '12px', textAlign: 'right', color: itemVariance > 0 ? C.error[600] : C.success[600] }}>
                    {itemVariance > 0 ? '+' : ''}{formatCurrency(Math.abs(itemVariance))}
                  </span>
                  <span style={{ fontSize: '12px', textAlign: 'right', color: itemVariance > 0 ? C.error[600] : C.success[600] }}>
                    {itemVariance > 0 ? '+' : ''}{itemVariancePct}%
                  </span>
                </div>
              );
            })}
          </div>
        </Card>
        
        {/* Cost Trends */}
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: sp.md }}>
          {/* Monthly OpEx Trend */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Monthly Operating Costs</h3>
            <div style={{ height: 120, display: 'flex', alignItems: 'flex-end', gap: sp.xs }}>
              {financialData.monthlyTrend.map((month, i) => {
                const maxVal = Math.max(...financialData.monthlyTrend.map(m => Math.max(m.actual, m.budget)));
                const actualHeight = (month.actual / maxVal) * 100;
                const budgetHeight = (month.budget / maxVal) * 100;
                return (
                  <div key={i} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                    <div style={{ width: '100%', height: 100, display: 'flex', alignItems: 'flex-end', justifyContent: 'center', gap: 2 }}>
                      <div style={{ 
                        width: '35%', 
                        height: `${actualHeight}%`, 
                        background: month.current ? C.brand[500] : C.brand[300],
                        borderRadius: '3px 3px 0 0'
                      }} />
                      <div style={{ 
                        width: '35%', 
                        height: `${budgetHeight}%`, 
                        background: C.neutral[300],
                        borderRadius: '3px 3px 0 0'
                      }} />
                    </div>
                    <span style={{ fontSize: '9px', color: C.neutral[500], marginTop: 4 }}>{month.month}</span>
                  </div>
                );
              })}
            </div>
            <div style={{ display: 'flex', gap: sp.md, marginTop: sp.sm, justifyContent: 'center' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                <div style={{ width: 10, height: 10, background: C.brand[500], borderRadius: 2 }} />
                <span style={{ fontSize: '10px', color: C.neutral[500] }}>Actual</span>
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: 4 }}>
                <div style={{ width: 10, height: 10, background: C.neutral[300], borderRadius: 2 }} />
                <span style={{ fontSize: '10px', color: C.neutral[500] }}>Budget</span>
              </div>
            </div>
          </Card>
          
          {/* Cost Per Order Trend */}
          <Card>
            <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Cost Per Order Trend</h3>
            <div style={{ height: 120, position: 'relative' }}>
              {/* Target line */}
              <div style={{ 
                position: 'absolute', 
                left: 0, right: 0, 
                top: `${100 - ((4.00 / 4.30) * 100)}%`,
                borderTop: `2px dashed ${C.success[400]}`,
                zIndex: 1
              }}>
                <span style={{ 
                  position: 'absolute', 
                  right: 0, 
                  top: -14, 
                  fontSize: '9px', 
                  color: C.success[600],
                  background: 'white',
                  padding: '0 4px'
                }}>
                  Target $4.00
                </span>
              </div>
              
              {/* Line chart area */}
              <svg width="100%" height="100" viewBox="0 0 300 100" preserveAspectRatio="none">
                <polyline
                  fill="none"
                  stroke={C.brand[500]}
                  strokeWidth="2"
                  points={financialData.costPerOrderTrend.map((d, i) => {
                    const x = (i / (financialData.costPerOrderTrend.length - 1)) * 280 + 10;
                    const y = 100 - ((d.value - 3.90) / 0.40) * 100;
                    return `${x},${y}`;
                  }).join(' ')}
                />
                {financialData.costPerOrderTrend.map((d, i) => {
                  const x = (i / (financialData.costPerOrderTrend.length - 1)) * 280 + 10;
                  const y = 100 - ((d.value - 3.90) / 0.40) * 100;
                  return (
                    <circle
                      key={i}
                      cx={x}
                      cy={y}
                      r={d.current ? 5 : 3}
                      fill={d.current ? C.brand[600] : C.brand[400]}
                    />
                  );
                })}
              </svg>
              
              {/* X-axis labels */}
              <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: 4 }}>
                {financialData.costPerOrderTrend.map((d, i) => (
                  <span key={i} style={{ fontSize: '9px', color: C.neutral[500] }}>{d.month}</span>
                ))}
              </div>
            </div>
          </Card>
        </div>
        
        {/* Financial Alerts */}
        <Card>
          <h3 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.md }}>Alerts & Insights</h3>
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.sm }}>
            {financialData.alerts.map((alert, i) => (
              <div 
                key={i}
                style={{ 
                  display: 'flex', 
                  alignItems: 'center', 
                  gap: sp.sm,
                  padding: sp.sm,
                  background: alert.type === 'warning' ? C.warning[50] : alert.type === 'success' ? C.success[50] : C.brand[50],
                  borderRadius: 6,
                  borderLeft: `4px solid ${alert.type === 'warning' ? C.warning[500] : alert.type === 'success' ? C.success[500] : C.brand[500]}`
                }}
              >
                {alert.type === 'warning' && <AlertTriangle style={{ width: 16, height: 16, color: C.warning[600] }} />}
                {alert.type === 'success' && <CheckCircle style={{ width: 16, height: 16, color: C.success[600] }} />}
                {alert.type === 'info' && <TrendingUp style={{ width: 16, height: 16, color: C.brand[600] }} />}
                <div style={{ flex: 1 }}>
                  <p style={{ fontSize: '13px', fontWeight: 500, margin: 0 }}>{alert.message}</p>
                  <p style={{ fontSize: '11px', color: C.neutral[500], margin: 0 }}>{alert.category}</p>
                </div>
                <span style={{ 
                  fontSize: '12px', 
                  fontWeight: 600,
                  color: alert.amount > 0 ? C.error[600] : C.success[600]
                }}>
                  {alert.amount > 0 ? '+' : ''}{formatCurrency(Math.abs(alert.amount))}
                </span>
              </div>
            ))}
          </div>
        </Card>
        
        {/* Additional Metrics Row */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm }}>
          <Card>
            <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Orders Processed</p>
            <p style={{ fontSize: '20px', fontWeight: 500, margin: 0 }}>{periodData.ordersProcessed.toLocaleString()}</p>
            <p style={{ fontSize: '10px', color: C.neutral[400] }}>{periodInfo.label}</p>
          </Card>
          <Card>
            <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Units Handled</p>
            <p style={{ fontSize: '20px', fontWeight: 500, margin: 0 }}>{periodData.unitsHandled.toLocaleString()}</p>
            <p style={{ fontSize: '10px', color: C.neutral[400] }}>{periodInfo.label}</p>
          </Card>
          <Card>
            <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: 2 }}>Fulfillment % of Revenue</p>
            <p style={{ fontSize: '20px', fontWeight: 500, margin: 0, color: periodData.fulfillmentPctRevenue > 14 ? C.warning[600] : C.success[600] }}>
              {periodData.fulfillmentPctRevenue}%
            </p>
            <p style={{ fontSize: '10px', color: C.neutral[400] }}>Target: &lt;14%</p>
          </Card>
        </div>
      </div>
    );
  };
  
  // Render Dashboard Tab
  const renderDashboardTab = () => (
    <div style={{ display: 'flex', flexDirection: 'column', gap: sp.md }}>
      {/* Header Card with KPIs */}
      <div style={{ background: `linear-gradient(135deg, ${C.blueLight[500]} 0%, ${C.brand[600]} 100%)`, borderRadius: 10, padding: sp.md, color: 'white' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.md }}>
          <div>
            <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
              <span style={{ fontSize: '18px', fontWeight: 500 }}>{zoneId} — {zoneName}</span>
              <Badge status="success" label={zoneData.status} />
            </div>
            <p style={{ fontSize: '12px', opacity: 0.8, marginTop: 2 }}>{zoneType} • {zoneData.dockDoors} Dock Doors</p>
          </div>
          <div style={{ textAlign: 'right' }}>
            <p style={{ fontSize: '10px', opacity: 0.7 }}>Space Utilization</p>
            <div style={{ display: 'flex', alignItems: 'baseline', gap: 4 }}>
              <span style={{ fontSize: '28px', fontWeight: 300 }}>{zoneData.spaceUtil.cur}%</span>
              <ArrowRight style={{ width: 12, height: 12, opacity: 0.6 }} />
              <span style={{ fontSize: '18px', fontWeight: 500 }}>{zoneData.spaceUtil.pred}%</span>
            </div>
          </div>
        </div>
        
        {/* KPI Grid */}
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: sp.sm }}>
          <KpiCard label="Pallets/Hr" icon={Package} current={zoneData.kpis.palletsHr.cur} predicted={zoneData.kpis.palletsHr.pred} target={zoneData.kpis.palletsHr.target} timeline={zoneData.kpis.palletsHr.timeline} targetTab="work" />
          <KpiCard label="Avg Dwell" icon={Clock} current={zoneData.kpis.avgDwell.cur} predicted={zoneData.kpis.avgDwell.pred} target={`≤${zoneData.kpis.avgDwell.target}`} timeline={zoneData.kpis.avgDwell.timeline} targetTab="work" />
          <KpiCard label="Accuracy" icon={CheckCircle} current={zoneData.kpis.accuracy.cur} predicted={zoneData.kpis.accuracy.pred} target={`${zoneData.kpis.accuracy.target}%`} timeline={zoneData.kpis.accuracy.timeline} format={v => `${v.toFixed(1)}%`} targetTab="work" />
          <KpiCard label="Staged" icon={Package} current={zoneData.kpis.stagedPallets.cur} predicted={zoneData.kpis.stagedPallets.pred} target={zoneData.kpis.stagedPallets.target} timeline={zoneData.kpis.stagedPallets.timeline} targetTab="work" />
          <KpiCard label="Dock Util" icon={MapPin} current={`${zoneData.kpis.dockUtil.cur}%`} predicted={`${zoneData.kpis.dockUtil.pred}%`} target={`${zoneData.kpis.dockUtil.target}%`} timeline={zoneData.kpis.dockUtil.timeline} format={v => `${Math.round(v)}%`} targetTab="space" />
        </div>
      </div>
      
      {/* Zone Alerts */}
      <div>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
          <h4 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Zone Alerts</h4>
          <span style={{ fontSize: '12px', color: C.warning[600] }}>{alerts.length} active</span>
        </div>
        <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
          {alerts.map((a, i) => (
            <div key={i} style={{ 
              display: 'flex', 
              alignItems: 'flex-start', 
              gap: sp.sm, 
              padding: sp.sm, 
              background: a.sev === 'warning' ? C.warning[50] : a.sev === 'critical' ? C.error[50] : C.brand[50], 
              borderRadius: 6,
              borderLeft: `3px solid ${a.sev === 'warning' ? C.warning[500] : a.sev === 'critical' ? C.error[500] : C.brand[500]}`
            }}>
              {a.sev === 'warning' ? <AlertTriangle style={{ width: 14, height: 14, color: C.warning[600], flexShrink: 0, marginTop: 1 }} /> : <Info style={{ width: 14, height: 14, color: C.brand[600], flexShrink: 0, marginTop: 1 }} />}
              <div style={{ flex: 1 }}>
                <p style={{ fontSize: '13px', fontWeight: 500, color: a.sev === 'warning' ? C.warning[700] : C.brand[700] }}>{a.title}</p>
                <p style={{ fontSize: '11px', color: a.sev === 'warning' ? C.warning[600] : C.brand[600] }}>{a.msg}</p>
              </div>
              <div style={{ textAlign: 'right' }}>
                <span style={{ fontSize: '10px', color: C.neutral[500] }}>{a.time}</span>
                <p style={{ fontSize: '9px', color: C.neutral[400] }}>{a.conf}% conf</p>
              </div>
            </div>
          ))}
        </div>
      </div>
      
      {/* Connections */}
      <div>
        <h4 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.sm }}>Connections</h4>
        <div style={{ display: 'flex', alignItems: 'center', gap: sp.md }}>
          {/* Upstream */}
          <div style={{ flex: 1 }}>
            <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.xs, textAlign: 'center' }}>← UPSTREAM</p>
            <div style={{ display: 'flex', gap: sp.xs, justifyContent: 'center' }}>
              {connections.upstream.map((c, i) => <ConnectionCard key={i} {...c} direction="upstream" />)}
            </div>
          </div>
          
          {/* Current entity */}
          <div style={{ 
            background: C.brand[500], 
            color: 'white', 
            borderRadius: 8, 
            padding: sp.sm, 
            textAlign: 'center',
            minWidth: 60
          }}>
            <p style={{ fontSize: '12px', fontWeight: 600 }}>{zoneId}</p>
            <p style={{ fontSize: '14px', fontWeight: 500 }}>{zoneData.spaceUtil.cur}%</p>
          </div>
          
          {/* Downstream */}
          <div style={{ flex: 1 }}>
            <p style={{ fontSize: '10px', color: C.neutral[500], marginBottom: sp.xs, textAlign: 'center' }}>DOWNSTREAM →</p>
            <div style={{ display: 'flex', gap: sp.xs, justifyContent: 'center' }}>
              {connections.downstream.map((c, i) => <ConnectionCard key={i} {...c} direction="downstream" />)}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
  
  // Render Work Content Tab
  const renderWorkContentTab = () => {
    const ctxPallets = isContextualDifferent ? interpolateValue(workContent.stagedPallets.timeline, contextualTime) : null;
    
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap: sp.md }}>
        {/* Staged Pallets Summary */}
        <Card>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: sp.sm }}>
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                <h4 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>Staged Pallets</h4>
                {ctxPallets !== null && (
                  <span style={{ fontSize: '12px', padding: '2px 6px', background: C.brand[100], color: C.brand[600], borderRadius: 4 }}>
                    @{contextualTime}: <strong>{ctxPallets}</strong>
                  </span>
                )}
              </div>
              <p style={{ fontSize: '11px', color: C.neutral[500] }}>Now: {workContent.stagedPallets.current} → Pred: {workContent.stagedPallets.predicted} • Capacity: {workContent.stagedPallets.capacity}</p>
            </div>
            <Badge status={workContent.stagedPallets.predicted > workContent.stagedPallets.capacity * 0.85 ? 'warning' : 'success'} label={`${Math.round(workContent.stagedPallets.current / workContent.stagedPallets.capacity * 100)}%`} />
          </div>
          
          {/* By Status breakdown */}
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: sp.sm, marginBottom: sp.sm }}>
            {workContent.stagedPallets.byStatus.map((s, i) => (
              <div key={i} style={{ padding: sp.sm, background: C.neutral[50], borderRadius: 6, borderLeft: `3px solid ${s.color}`, textAlign: 'center' }}>
                <p style={{ fontSize: '20px', fontWeight: 500 }}>{s.count}</p>
                <p style={{ fontSize: '10px', color: C.neutral[500] }}>{s.status}</p>
              </div>
            ))}
          </div>
          
          <Progress value={workContent.stagedPallets.current} max={workContent.stagedPallets.capacity} pred={workContent.stagedPallets.predicted} color={C.brand[500]} h={6} />
        </Card>
        
        {/* ASN/PO Tracking */}
        <Card>
          <h4 style={{ fontSize: '14px', fontWeight: 500, marginBottom: sp.sm }}>ASN/PO Tracking</h4>
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
            {workContent.asnData.map((asn, i) => (
              <div key={i} style={{ 
                display: 'flex', 
                alignItems: 'center', 
                gap: sp.sm, 
                padding: sp.sm, 
                background: C.neutral[50], 
                borderRadius: 6,
                cursor: 'pointer'
              }} className="card-click">
                <div style={{ flex: 1 }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
                    <span style={{ fontSize: '13px', fontWeight: 500 }}>{asn.asn}</span>
                    <span style={{ fontSize: '11px', color: C.neutral[500] }}>{asn.po}</span>
                  </div>
                  <p style={{ fontSize: '11px', color: C.neutral[500] }}>{asn.vendor}</p>
                </div>
                <div style={{ textAlign: 'right' }}>
                  <p style={{ fontSize: '13px', fontWeight: 500 }}>{asn.received}/{asn.lines}</p>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>lines</p>
                </div>
                <Badge status={asn.status === 'complete' ? 'success' : asn.status === 'in-progress' ? 'info' : 'neutral'} label={asn.status} />
                <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
              </div>
            ))}
          </div>
        </Card>
        
        {/* Pallet List */}
        <Card>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: sp.sm }}>
            <h4 style={{ fontSize: '14px', fontWeight: 500, margin: 0 }}>All Pallets in Zone</h4>
            <span style={{ fontSize: '11px', color: C.neutral[500] }}>{workContent.palletList.length} items</span>
          </div>
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.xs }}>
            {workContent.palletList.map((plt, i) => (
              <div key={i} style={{ 
                display: 'flex', 
                alignItems: 'center', 
                gap: sp.sm, 
                padding: sp.sm, 
                background: C.neutral[50], 
                borderRadius: 6,
                cursor: 'pointer'
              }} className="card-click" onClick={() => onNavigate && onNavigate('pallet', plt.id)}>
                <div style={{ 
                  width: 6, 
                  height: 6, 
                  borderRadius: '50%', 
                  background: plt.status === 'Ready for Putaway' ? C.success[500] : plt.status === 'QC Hold' ? C.error[500] : C.warning[500] 
                }} />
                <div style={{ flex: 1 }}>
                  <span style={{ fontSize: '13px', fontWeight: 500, fontFamily: 'monospace' }}>{plt.id}</span>
                  <p style={{ fontSize: '10px', color: C.neutral[500] }}>{plt.source} → {plt.destination}</p>
                </div>
                <div style={{ textAlign: 'right' }}>
                  <p style={{ fontSize: '12px', fontWeight: 500, color: plt.dwell > 60 ? C.warning[600] : C.neutral[600] }}>{plt.dwell}m</p>
                  <p style={{ fontSize: '9px', color: C.neutral[400] }}>dwell</p>
                </div>
                <ChevronRight style={{ width: 14, height: 14, color: C.neutral[400] }} />
              </div>
            ))}
          </div>
        </Card>
      </div>
    );
  };
  
  // Placeholder for other tabs
  const renderPlaceholderTab = (tabName) => (
    <div style={{ padding: sp.xl, textAlign: 'center' }}>
      <div style={{ width: 48, height: 48, borderRadius: 12, background: C.neutral[100], display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto', marginBottom: sp.md }}>
        {tabs.find(t => t.id === activeTab)?.icon && React.createElement(tabs.find(t => t.id === activeTab).icon, { style: { width: 24, height: 24, color: C.neutral[400] } })}
      </div>
      <h3 style={{ fontSize: '16px', fontWeight: 500, color: C.neutral[600], marginBottom: sp.sm }}>{tabName}</h3>
      <p style={{ fontSize: '13px', color: C.neutral[400] }}>Content for {zoneName}'s {tabName.toLowerCase()} will appear here</p>
    </div>
  );
  
  // Render active tab content
  const renderTabContent = () => {
    switch (activeTab) {
      case 'dashboard': return renderDashboardTab();
      case 'financial': return renderFinancialTab();
      case 'work': return renderWorkContentTab();
      case 'staff': return renderPlaceholderTab('Staff');
      case 'space': return renderPlaceholderTab('Space & Locations');
      case 'equipment': return renderPlaceholderTab('Equipment');
      case 'schedule': return renderPlaceholderTab('Schedule');
      case 'insights': return renderPlaceholderTab('Insights');
      case 'config': return renderPlaceholderTab('Configuration');
      default: return renderDashboardTab();
    }
  };

  return (
    <div style={{ display: 'flex', height: '100%' }}>
      {/* Tab sidebar - LEFT SIDE */}
      <div style={{ width: 48, background: C.neutral[100], borderRight: `1px solid ${C.neutral[200]}`, display: 'flex', flexDirection: 'column', paddingTop: sp.sm }}>
        {tabs.map(tab => {
          const Icon = tab.icon;
          const isActive = activeTab === tab.id;
          return (
            <div
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              title={tab.label}
              style={{
                width: 40,
                height: 40,
                margin: '0 auto',
                marginBottom: 4,
                borderRadius: 8,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                cursor: 'pointer',
                background: isActive ? C.brand[100] : 'transparent',
                border: isActive ? `2px solid ${C.brand[500]}` : '2px solid transparent'
              }}
            >
              <Icon style={{ width: 18, height: 18, color: isActive ? C.brand[600] : C.neutral[500] }} />
            </div>
          );
        })}
      </div>
      
      {/* Main content area */}
      <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden', maxWidth: 708 }}>
        {/* Breadcrumb */}
        <div style={{ padding: `${sp.sm} ${sp.md}`, borderBottom: `1px solid ${C.neutral[200]}`, background: C.neutral[50] }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.xs, fontSize: '12px' }}>
            <span style={{ color: C.brand[600], cursor: 'pointer' }} onClick={onBack}>🏠 {'{facilityName}'} Overview</span>
            <ChevronRight style={{ width: 12, height: 12, color: C.neutral[400] }} />
            <span style={{ color: C.neutral[700], fontWeight: 500 }}>{zoneId} {zoneName}</span>
          </div>
        </div>
        
        {/* Header */}
        <div style={{ padding: sp.md, borderBottom: `1px solid ${C.neutral[200]}`, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: sp.sm }}>
            <div style={{ width: 32, height: 32, borderRadius: 8, background: C.blueLight[100], display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
              <MapPin style={{ width: 18, height: 18, color: C.blueLight[600] }} />
            </div>
            <h2 style={{ fontSize: '18px', fontWeight: 500, margin: 0 }}>{zoneId} {zoneName}</h2>
          </div>
          <button style={{ 
            padding: `${sp.sm} ${sp.md}`, 
            background: C.brand[500], 
            color: 'white', 
            border: 'none', 
            borderRadius: 6, 
            fontSize: '13px', 
            fontWeight: 500,
            cursor: 'pointer',
            display: 'flex',
            alignItems: 'center',
            gap: sp.xs
          }}>
            LOCATION ACTIONS <ChevronRight style={{ width: 14, height: 14 }} />
          </button>
        </div>
        
        {/* Scrollable content */}
        <div style={{ flex: 1, overflow: 'auto', padding: sp.md }}>
          {renderTabContent()}
        </div>
      </div>
    </div>
  );
};

// ===== MAIN APP =====
const WarehouseDashboard = () => {
  const [view, setView] = useState('exec');
  const [selectedZone, setSelectedZone] = useState(null);
  const [selectedLocation, setSelectedLocation] = useState(null);
  const [targetTab, setTargetTab] = useState('dashboard');
  const [selectedItem, setSelectedItem] = useState(null);
  
  // Handler for drilling into specific nouns/items
  const handleNavigate = (type, id) => {
    console.log(`Navigate to: ${type} / ${id}`);
    setSelectedItem({ type, id });
    setView('item-detail');
  };
  
  // Handler for navigating to dock/location detail with optional target tab
  const handleDockDetail = (locationId, tab = 'dashboard') => {
    setSelectedLocation(locationId || 'D01');
    setTargetTab(tab);
    setView('dock-detail');
  };
  
  const renderView = () => {
    switch (view) {
      case 'exec': return <Executive onCat={setView} onShift={setView} onZone={(zoneId) => { setSelectedZone(zoneId); setView('zone-detail'); }} />;
      case 'day': return <DayShift onBack={() => setView('exec')} />;
      case 'swing': return <SwingShift onBack={() => setView('exec')} />;
      case 'night': return <NightShift onBack={() => setView('exec')} />;
      case 'staff': return <StaffView onBack={() => setView('exec')} />;
      case 'zones': return <ZonesView onBack={() => setView('exec')} onZone={(zoneId) => { setSelectedZone(zoneId); setView('zone-detail'); }} />;
      case 'zone-detail': 
        // Route to appropriate zone detail component (legacy full-page views)
        if (selectedZone === 'Z04') {
          return <StorageZoneDetail zoneId={selectedZone} onBack={() => setView('zones')} onBackToExec={() => setView('exec')} onNavigate={handleNavigate} />;
        }
        return <InboundZoneDetail zoneId={selectedZone} onBack={() => setView('zones')} onBackToExec={() => setView('exec')} onDockDetail={handleDockDetail} />;
      case 'item-detail':
        // Placeholder for item detail pages
        return (
          <div style={{ display: 'flex', flexDirection: 'column', gap: sp.lg }}>
            <Breadcrumb items={[
              { label: 'Executive Summary', onClick: () => setView('exec') },
              { label: 'Zones', onClick: () => setView('zones') },
              { label: selectedZone, onClick: () => setView('zone-detail') },
              { label: `${selectedItem?.type}: ${selectedItem?.id}` }
            ]} />
            <Card>
              <div style={{ padding: sp.xl, textAlign: 'center' }}>
                <div style={{ width: 64, height: 64, borderRadius: 16, background: C.brand[100], display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto', marginBottom: sp.md }}>
                  <Package style={{ width: 32, height: 32, color: C.brand[600] }} />
                </div>
                <h2 style={{ fontSize: '24px', fontWeight: 500, marginBottom: sp.sm }}>{selectedItem?.type}</h2>
                <p style={{ fontSize: '18px', color: C.brand[600], fontFamily: 'monospace', marginBottom: sp.lg }}>{selectedItem?.id}</p>
                <p style={{ fontSize: '14px', color: C.neutral[500], marginBottom: sp.lg }}>Detail page placeholder — will be implemented based on your mockup pattern</p>
                <div style={{ display: 'flex', gap: sp.md, justifyContent: 'center' }}>
                  <button 
                    onClick={() => setView('zone-detail')}
                    style={{ padding: `${sp.sm} ${sp.lg}`, background: C.brand[500], color: 'white', border: 'none', borderRadius: 8, cursor: 'pointer', fontSize: '14px' }}
                  >
                    ← Back to Zone
                  </button>
                </div>
              </div>
            </Card>
          </div>
        );
      case 'work': return <WorkView onBack={() => setView('exec')} />;
      case 'dock-detail': return <DockDoorsDetail zoneId={selectedZone} locationId={selectedLocation} initialTab={targetTab} onBack={() => setView('zone-detail')} onBackToZones={() => setView('zones')} onBackToExec={() => setView('exec')} />;
      case 'sched': return <SchedView onBack={() => setView('exec')} />;
      case 'fin': return <FinView onBack={() => setView('exec')} />;
      default: return <Executive onCat={setView} onShift={setView} />;
    }
  };

  return (
    <TimeProvider>
      <style>{styles}</style>
      <div className="wd">{renderView()}</div>
    </TimeProvider>
  );
};

export default WarehouseDashboard;